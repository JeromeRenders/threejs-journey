(()=>{var n={755:function(Qt,en){var tn;
/*!
 * jQuery JavaScript Library v3.6.0
 * https://jquery.com/
 *
 * Includes Sizzle.js
 * https://sizzlejs.com/
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license
 * https://jquery.org/license
 *
 * Date: 2021-03-02T17:08Z
 */
!function(e,t){"use strict";"object"==typeof Qt.exports?Qt.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(w,e){"use strict";function m(e){return"function"==typeof e&&"number"!=typeof e.nodeType&&"function"!=typeof e.item}function g(e){return null!=e&&e===e.window}var t=[],n=Object.getPrototypeOf,o=t.slice,v=t.flat?function(e){return t.flat.call(e)}:function(e){return t.concat.apply([],e)},l=t.push,i=t.indexOf,r={},s=r.toString,y=r.hasOwnProperty,a=y.toString,c=a.call(Object),x={},M=w.document,u={type:!0,src:!0,nonce:!0,noModule:!0};function b(e,t,n){var r,i,s=(n=n||M).createElement("script");if(s.text=e,t)for(r in u)(i=t[r]||t.getAttribute&&t.getAttribute(r))&&s.setAttribute(r,i);n.head.appendChild(s).parentNode.removeChild(s)}function f(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?r[s.call(e)]||"object":typeof e}var h="3.6.0",S=function(e,t){return new S.fn.init(e,t)};function d(e){var t=!!e&&"length"in e&&e.length,n=f(e);return!m(e)&&!g(e)&&("array"===n||0===t||"number"==typeof t&&0<t&&t-1 in e)}S.fn=S.prototype={jquery:h,constructor:S,length:0,toArray:function(){return o.call(this)},get:function(e){return null==e?o.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){e=S.merge(this.constructor(),e);return e.prevObject=this,e},each:function(e){return S.each(this,e)},map:function(n){return this.pushStack(S.map(this,function(e,t){return n.call(e,t,e)}))},slice:function(){return this.pushStack(o.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(S.grep(this,function(e,t){return(t+1)%2}))},odd:function(){return this.pushStack(S.grep(this,function(e,t){return t%2}))},eq:function(e){var t=this.length,e=+e+(e<0?t:0);return this.pushStack(0<=e&&e<t?[this[e]]:[])},end:function(){return this.prevObject||this.constructor()},push:l,sort:t.sort,splice:t.splice},S.extend=S.fn.extend=function(){var e,t,n,r,i,s=arguments[0]||{},a=1,o=arguments.length,l=!1;for("boolean"==typeof s&&(l=s,s=arguments[a]||{},a++),"object"==typeof s||m(s)||(s={}),a===o&&(s=this,a--);a<o;a++)if(null!=(e=arguments[a]))for(t in e)n=e[t],"__proto__"!==t&&s!==n&&(l&&n&&(S.isPlainObject(n)||(r=Array.isArray(n)))?(i=s[t],i=r&&!Array.isArray(i)?[]:r||S.isPlainObject(i)?i:{},r=!1,s[t]=S.extend(l,i,n)):void 0!==n&&(s[t]=n));return s},S.extend({expando:"jQuery"+(h+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){return!(!e||"[object Object]"!==s.call(e))&&(!(e=n(e))||"function"==typeof(e=y.call(e,"constructor")&&e.constructor)&&a.call(e)===c)},isEmptyObject:function(e){for(var t in e)return!1;return!0},globalEval:function(e,t,n){b(e,{nonce:t&&t.nonce},n)},each:function(e,t){var n,r=0;if(d(e))for(n=e.length;r<n&&!1!==t.call(e[r],r,e[r]);r++);else for(r in e)if(!1===t.call(e[r],r,e[r]))break;return e},makeArray:function(e,t){t=t||[];return null!=e&&(d(Object(e))?S.merge(t,"string"==typeof e?[e]:e):l.call(t,e)),t},inArray:function(e,t,n){return null==t?-1:i.call(t,e,n)},merge:function(e,t){for(var n=+t.length,r=0,i=e.length;r<n;r++)e[i++]=t[r];return e.length=i,e},grep:function(e,t,n){for(var r=[],i=0,s=e.length,a=!n;i<s;i++)!t(e[i],i)!=a&&r.push(e[i]);return r},map:function(e,t,n){var r,i,s=0,a=[];if(d(e))for(r=e.length;s<r;s++)null!=(i=t(e[s],s,n))&&a.push(i);else for(s in e)null!=(i=t(e[s],s,n))&&a.push(i);return v(a)},guid:1,support:x}),"function"==typeof Symbol&&(S.fn[Symbol.iterator]=t[Symbol.iterator]),S.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(e,t){r["[object "+t+"]"]=t.toLowerCase()});var p=
/*!
 * Sizzle CSS Selector Engine v2.3.6
 * https://sizzlejs.com/
 *
 * Copyright JS Foundation and other contributors
 * Released under the MIT license
 * https://js.foundation/
 *
 * Date: 2021-02-16
 */
function(n){function h(e,t){return e="0x"+e.slice(1)-65536,t||(e<0?String.fromCharCode(65536+e):String.fromCharCode(e>>10|55296,1023&e|56320))}function d(e,t){return t?"\0"===e?"ï¿½":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e}function r(){w()}var e,p,b,s,i,f,m,g,_,l,c,w,M,a,S,v,o,u,y,E="sizzle"+ +new Date,x=n.document,T=0,C=0,L=le(),A=le(),P=le(),R=le(),D=function(e,t){return e===t&&(c=!0),0},N={}.hasOwnProperty,t=[],I=t.pop,k=t.push,O=t.push,z=t.slice,U=function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1},V="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",F="[\\x20\\t\\r\\n\\f]",H="(?:\\\\[\\da-fA-F]{1,6}"+F+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",B="\\["+F+"*("+H+")(?:"+F+"*([*^$|!~]?=)"+F+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+H+"))|)"+F+"*\\]",G=":("+H+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+B+")*)|.*)\\)|)",W=new RegExp(F+"+","g"),j=new RegExp("^"+F+"+|((?:^|[^\\\\])(?:\\\\.)*)"+F+"+$","g"),q=new RegExp("^"+F+"*,"+F+"*"),X=new RegExp("^"+F+"*([>+~]|"+F+")"+F+"*"),Y=new RegExp(F+"|>"),K=new RegExp(G),J=new RegExp("^"+H+"$"),Z={ID:new RegExp("^#("+H+")"),CLASS:new RegExp("^\\.("+H+")"),TAG:new RegExp("^("+H+"|[*])"),ATTR:new RegExp("^"+B),PSEUDO:new RegExp("^"+G),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+F+"*(even|odd|(([+-]|)(\\d*)n|)"+F+"*(?:([+-]|)"+F+"*(\\d+)|))"+F+"*\\)|)","i"),bool:new RegExp("^(?:"+V+")$","i"),needsContext:new RegExp("^"+F+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+F+"*((?:-\\d)?\\d*)"+F+"*\\)|)(?=[^-]|$)","i")},$=/HTML$/i,Q=/^(?:input|select|textarea|button)$/i,ee=/^h\d$/i,te=/^[^{]+\{\s*\[native \w/,ne=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,re=/[+~]/,ie=new RegExp("\\\\[\\da-fA-F]{1,6}"+F+"?|\\\\([^\\r\\n\\f])","g"),se=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,ae=ye(function(e){return!0===e.disabled&&"fieldset"===e.nodeName.toLowerCase()},{dir:"parentNode",next:"legend"});try{O.apply(t=z.call(x.childNodes),x.childNodes),t[x.childNodes.length].nodeType}catch(e){O={apply:t.length?function(e,t){k.apply(e,z.call(t))}:function(e,t){for(var n=e.length,r=0;e[n++]=t[r++];);e.length=n-1}}}function oe(t,e,n,r){var i,s,a,o,l,c,u=e&&e.ownerDocument,h=e?e.nodeType:9;if(n=n||[],"string"!=typeof t||!t||1!==h&&9!==h&&11!==h)return n;if(!r&&(w(e),e=e||M,S)){if(11!==h&&(o=ne.exec(t)))if(c=o[1]){if(9===h){if(!(s=e.getElementById(c)))return n;if(s.id===c)return n.push(s),n}else if(u&&(s=u.getElementById(c))&&y(e,s)&&s.id===c)return n.push(s),n}else{if(o[2])return O.apply(n,e.getElementsByTagName(t)),n;if((c=o[3])&&p.getElementsByClassName&&e.getElementsByClassName)return O.apply(n,e.getElementsByClassName(c)),n}if(p.qsa&&!R[t+" "]&&(!v||!v.test(t))&&(1!==h||"object"!==e.nodeName.toLowerCase())){if(c=t,u=e,1===h&&(Y.test(t)||X.test(t))){for((u=re.test(t)&&me(e.parentNode)||e)===e&&p.scope||((a=e.getAttribute("id"))?a=a.replace(se,d):e.setAttribute("id",a=E)),i=(l=f(t)).length;i--;)l[i]=(a?"#"+a:":scope")+" "+ve(l[i]);c=l.join(",")}try{return O.apply(n,u.querySelectorAll(c)),n}catch(e){R(t,!0)}finally{a===E&&e.removeAttribute("id")}}}return g(t.replace(j,"$1"),e,n,r)}function le(){var n=[];function r(e,t){return n.push(e+" ")>b.cacheLength&&delete r[n.shift()],r[e+" "]=t}return r}function ce(e){return e[E]=!0,e}function ue(e){var t=M.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t)}}function he(e,t){for(var n=e.split("|"),r=n.length;r--;)b.attrHandle[n[r]]=t}function de(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(r)return r;if(n)for(;n=n.nextSibling;)if(n===t)return-1;return e?1:-1}function pe(t){return function(e){return"form"in e?e.parentNode&&!1===e.disabled?"label"in e?"label"in e.parentNode?e.parentNode.disabled===t:e.disabled===t:e.isDisabled===t||e.isDisabled!==!t&&ae(e)===t:e.disabled===t:"label"in e&&e.disabled===t}}function fe(a){return ce(function(s){return s=+s,ce(function(e,t){for(var n,r=a([],e.length,s),i=r.length;i--;)e[n=r[i]]&&(e[n]=!(t[n]=e[n]))})})}function me(e){return e&&void 0!==e.getElementsByTagName&&e}for(e in p=oe.support={},i=oe.isXML=function(e){var t=e&&e.namespaceURI,e=e&&(e.ownerDocument||e).documentElement;return!$.test(t||e&&e.nodeName||"HTML")},w=oe.setDocument=function(e){var t,e=e?e.ownerDocument||e:x;return e!=M&&9===e.nodeType&&e.documentElement&&(a=(M=e).documentElement,S=!i(M),x!=M&&(t=M.defaultView)&&t.top!==t&&(t.addEventListener?t.addEventListener("unload",r,!1):t.attachEvent&&t.attachEvent("onunload",r)),p.scope=ue(function(e){return a.appendChild(e).appendChild(M.createElement("div")),void 0!==e.querySelectorAll&&!e.querySelectorAll(":scope fieldset div").length}),p.attributes=ue(function(e){return e.className="i",!e.getAttribute("className")}),p.getElementsByTagName=ue(function(e){return e.appendChild(M.createComment("")),!e.getElementsByTagName("*").length}),p.getElementsByClassName=te.test(M.getElementsByClassName),p.getById=ue(function(e){return a.appendChild(e).id=E,!M.getElementsByName||!M.getElementsByName(E).length}),p.getById?(b.filter.ID=function(e){var t=e.replace(ie,h);return function(e){return e.getAttribute("id")===t}},b.find.ID=function(e,t){if(void 0!==t.getElementById&&S){e=t.getElementById(e);return e?[e]:[]}}):(b.filter.ID=function(e){var t=e.replace(ie,h);return function(e){e=void 0!==e.getAttributeNode&&e.getAttributeNode("id");return e&&e.value===t}},b.find.ID=function(e,t){if(void 0!==t.getElementById&&S){var n,r,i,s=t.getElementById(e);if(s){if((n=s.getAttributeNode("id"))&&n.value===e)return[s];for(i=t.getElementsByName(e),r=0;s=i[r++];)if((n=s.getAttributeNode("id"))&&n.value===e)return[s]}return[]}}),b.find.TAG=p.getElementsByTagName?function(e,t){return void 0!==t.getElementsByTagName?t.getElementsByTagName(e):p.qsa?t.querySelectorAll(e):void 0}:function(e,t){var n,r=[],i=0,s=t.getElementsByTagName(e);if("*"!==e)return s;for(;n=s[i++];)1===n.nodeType&&r.push(n);return r},b.find.CLASS=p.getElementsByClassName&&function(e,t){if(void 0!==t.getElementsByClassName&&S)return t.getElementsByClassName(e)},o=[],v=[],(p.qsa=te.test(M.querySelectorAll))&&(ue(function(e){var t;a.appendChild(e).innerHTML="<a id='"+E+"'></a><select id='"+E+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&v.push("[*^$]="+F+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||v.push("\\["+F+"*(?:value|"+V+")"),e.querySelectorAll("[id~="+E+"-]").length||v.push("~="),(t=M.createElement("input")).setAttribute("name",""),e.appendChild(t),e.querySelectorAll("[name='']").length||v.push("\\["+F+"*name"+F+"*="+F+"*(?:''|\"\")"),e.querySelectorAll(":checked").length||v.push(":checked"),e.querySelectorAll("a#"+E+"+*").length||v.push(".#.+[+~]"),e.querySelectorAll("\\\f"),v.push("[\\r\\n\\f]")}),ue(function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=M.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&v.push("name"+F+"*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&v.push(":enabled",":disabled"),a.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&v.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),v.push(",.*:")})),(p.matchesSelector=te.test(u=a.matches||a.webkitMatchesSelector||a.mozMatchesSelector||a.oMatchesSelector||a.msMatchesSelector))&&ue(function(e){p.disconnectedMatch=u.call(e,"*"),u.call(e,"[s!='']:x"),o.push("!=",G)}),v=v.length&&new RegExp(v.join("|")),o=o.length&&new RegExp(o.join("|")),t=te.test(a.compareDocumentPosition),y=t||te.test(a.contains)?function(e,t){var n=9===e.nodeType?e.documentElement:e,t=t&&t.parentNode;return e===t||!(!t||1!==t.nodeType||!(n.contains?n.contains(t):e.compareDocumentPosition&&16&e.compareDocumentPosition(t)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},D=t?function(e,t){if(e===t)return c=!0,0;var n=!e.compareDocumentPosition-!t.compareDocumentPosition;return n||(1&(n=(e.ownerDocument||e)==(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!p.sortDetached&&t.compareDocumentPosition(e)===n?e==M||e.ownerDocument==x&&y(x,e)?-1:t==M||t.ownerDocument==x&&y(x,t)?1:l?U(l,e)-U(l,t):0:4&n?-1:1)}:function(e,t){if(e===t)return c=!0,0;var n,r=0,i=e.parentNode,s=t.parentNode,a=[e],o=[t];if(!i||!s)return e==M?-1:t==M?1:i?-1:s?1:l?U(l,e)-U(l,t):0;if(i===s)return de(e,t);for(n=e;n=n.parentNode;)a.unshift(n);for(n=t;n=n.parentNode;)o.unshift(n);for(;a[r]===o[r];)r++;return r?de(a[r],o[r]):a[r]==x?-1:o[r]==x?1:0}),M},oe.matches=function(e,t){return oe(e,null,null,t)},oe.matchesSelector=function(e,t){if(w(e),p.matchesSelector&&S&&!R[t+" "]&&(!o||!o.test(t))&&(!v||!v.test(t)))try{var n=u.call(e,t);if(n||p.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(e){R(t,!0)}return 0<oe(t,M,null,[e]).length},oe.contains=function(e,t){return(e.ownerDocument||e)!=M&&w(e),y(e,t)},oe.attr=function(e,t){(e.ownerDocument||e)!=M&&w(e);var n=b.attrHandle[t.toLowerCase()],n=n&&N.call(b.attrHandle,t.toLowerCase())?n(e,t,!S):void 0;return void 0!==n?n:p.attributes||!S?e.getAttribute(t):(n=e.getAttributeNode(t))&&n.specified?n.value:null},oe.escape=function(e){return(e+"").replace(se,d)},oe.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},oe.uniqueSort=function(e){var t,n=[],r=0,i=0;if(c=!p.detectDuplicates,l=!p.sortStable&&e.slice(0),e.sort(D),c){for(;t=e[i++];)t===e[i]&&(r=n.push(i));for(;r--;)e.splice(n[r],1)}return l=null,e},s=oe.getText=function(e){var t,n="",r=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=s(e)}else if(3===i||4===i)return e.nodeValue}else for(;t=e[r++];)n+=s(t);return n},(b=oe.selectors={cacheLength:50,createPseudo:ce,match:Z,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(ie,h),e[3]=(e[3]||e[4]||e[5]||"").replace(ie,h),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||oe.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&oe.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return Z.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&K.test(n)&&(t=f(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(ie,h).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=L[e+" "];return t||(t=new RegExp("(^|"+F+")"+e+"("+F+"|$)"))&&L(e,function(e){return t.test("string"==typeof e.className&&e.className||void 0!==e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(t,n,r){return function(e){e=oe.attr(e,t);return null==e?"!="===n:!n||(e+="","="===n?e===r:"!="===n?e!==r:"^="===n?r&&0===e.indexOf(r):"*="===n?r&&-1<e.indexOf(r):"$="===n?r&&e.slice(-r.length)===r:"~="===n?-1<(" "+e.replace(W," ")+" ").indexOf(r):"|="===n&&(e===r||e.slice(0,r.length+1)===r+"-"))}},CHILD:function(f,e,t,m,g){var v="nth"!==f.slice(0,3),y="last"!==f.slice(-4),x="of-type"===e;return 1===m&&0===g?function(e){return!!e.parentNode}:function(e,t,n){var r,i,s,a,o,l,c=v!=y?"nextSibling":"previousSibling",u=e.parentNode,h=x&&e.nodeName.toLowerCase(),d=!n&&!x,p=!1;if(u){if(v){for(;c;){for(a=e;a=a[c];)if(x?a.nodeName.toLowerCase()===h:1===a.nodeType)return!1;l=c="only"===f&&!l&&"nextSibling"}return!0}if(l=[y?u.firstChild:u.lastChild],y&&d){for(p=(o=(r=(i=(s=(a=u)[E]||(a[E]={}))[a.uniqueID]||(s[a.uniqueID]={}))[f]||[])[0]===T&&r[1])&&r[2],a=o&&u.childNodes[o];a=++o&&a&&a[c]||(p=o=0)||l.pop();)if(1===a.nodeType&&++p&&a===e){i[f]=[T,o,p];break}}else if(!1===(p=d?o=(r=(i=(s=(a=e)[E]||(a[E]={}))[a.uniqueID]||(s[a.uniqueID]={}))[f]||[])[0]===T&&r[1]:p))for(;(a=++o&&a&&a[c]||(p=o=0)||l.pop())&&((x?a.nodeName.toLowerCase()!==h:1!==a.nodeType)||!++p||(d&&((i=(s=a[E]||(a[E]={}))[a.uniqueID]||(s[a.uniqueID]={}))[f]=[T,p]),a!==e)););return(p-=g)===m||p%m==0&&0<=p/m}}},PSEUDO:function(e,s){var t,a=b.pseudos[e]||b.setFilters[e.toLowerCase()]||oe.error("unsupported pseudo: "+e);return a[E]?a(s):1<a.length?(t=[e,e,"",s],b.setFilters.hasOwnProperty(e.toLowerCase())?ce(function(e,t){for(var n,r=a(e,s),i=r.length;i--;)e[n=U(e,r[i])]=!(t[n]=r[i])}):function(e){return a(e,0,t)}):a}},pseudos:{not:ce(function(e){var r=[],i=[],o=m(e.replace(j,"$1"));return o[E]?ce(function(e,t,n,r){for(var i,s=o(e,null,r,[]),a=e.length;a--;)(i=s[a])&&(e[a]=!(t[a]=i))}):function(e,t,n){return r[0]=e,o(r,null,n,i),r[0]=null,!i.pop()}}),has:ce(function(t){return function(e){return 0<oe(t,e).length}}),contains:ce(function(t){return t=t.replace(ie,h),function(e){return-1<(e.textContent||s(e)).indexOf(t)}}),lang:ce(function(n){return J.test(n||"")||oe.error("unsupported lang: "+n),n=n.replace(ie,h).toLowerCase(),function(e){var t;do{if(t=S?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return(t=t.toLowerCase())===n||0===t.indexOf(n+"-")}while((e=e.parentNode)&&1===e.nodeType);return!1}}),target:function(e){var t=n.location&&n.location.hash;return t&&t.slice(1)===e.id},root:function(e){return e===a},focus:function(e){return e===M.activeElement&&(!M.hasFocus||M.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:pe(!1),disabled:pe(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!b.pseudos.empty(e)},header:function(e){return ee.test(e.nodeName)},input:function(e){return Q.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(e=e.getAttribute("type"))||"text"===e.toLowerCase())},first:fe(function(){return[0]}),last:fe(function(e,t){return[t-1]}),eq:fe(function(e,t,n){return[n<0?n+t:n]}),even:fe(function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e}),odd:fe(function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e}),lt:fe(function(e,t,n){for(var r=n<0?n+t:t<n?t:n;0<=--r;)e.push(r);return e}),gt:fe(function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e})}}).pseudos.nth=b.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})b.pseudos[e]=function(t){return function(e){return"input"===e.nodeName.toLowerCase()&&e.type===t}}(e);for(e in{submit:!0,reset:!0})b.pseudos[e]=function(n){return function(e){var t=e.nodeName.toLowerCase();return("input"===t||"button"===t)&&e.type===n}}(e);function ge(){}function ve(e){for(var t=0,n=e.length,r="";t<n;t++)r+=e[t].value;return r}function ye(a,e,t){var o=e.dir,l=e.next,c=l||o,u=t&&"parentNode"===c,h=C++;return e.first?function(e,t,n){for(;e=e[o];)if(1===e.nodeType||u)return a(e,t,n);return!1}:function(e,t,n){var r,i,s=[T,h];if(n){for(;e=e[o];)if((1===e.nodeType||u)&&a(e,t,n))return!0}else for(;e=e[o];)if(1===e.nodeType||u)if(r=(i=e[E]||(e[E]={}))[e.uniqueID]||(i[e.uniqueID]={}),l&&l===e.nodeName.toLowerCase())e=e[o]||e;else{if((i=r[c])&&i[0]===T&&i[1]===h)return s[2]=i[2];if((r[c]=s)[2]=a(e,t,n))return!0}return!1}}function xe(i){return 1<i.length?function(e,t,n){for(var r=i.length;r--;)if(!i[r](e,t,n))return!1;return!0}:i[0]}function be(e,t,n,r,i){for(var s,a=[],o=0,l=e.length,c=null!=t;o<l;o++)(s=e[o])&&(n&&!n(s,r,i)||(a.push(s),c&&t.push(o)));return a}function _e(p,f,m,g,v,e){return g&&!g[E]&&(g=_e(g)),v&&!v[E]&&(v=_e(v,e)),ce(function(e,t,n,r){var i,s,a,o=[],l=[],c=t.length,u=e||function(e,t,n){for(var r=0,i=t.length;r<i;r++)oe(e,t[r],n);return n}(f||"*",n.nodeType?[n]:n,[]),h=!p||!e&&f?u:be(u,o,p,n,r),d=m?v||(e?p:c||g)?[]:t:h;if(m&&m(h,d,n,r),g)for(i=be(d,l),g(i,[],n,r),s=i.length;s--;)(a=i[s])&&(d[l[s]]=!(h[l[s]]=a));if(e){if(v||p){if(v){for(i=[],s=d.length;s--;)(a=d[s])&&i.push(h[s]=a);v(null,d=[],i,r)}for(s=d.length;s--;)(a=d[s])&&-1<(i=v?U(e,a):o[s])&&(e[i]=!(t[i]=a))}}else d=be(d===t?d.splice(c,d.length):d),v?v(null,t,d,r):O.apply(t,d)})}function we(g,v){function e(e,t,n,r,i){var s,a,o,l=0,c="0",u=e&&[],h=[],d=_,p=e||x&&b.find.TAG("*",i),f=T+=null==d?1:Math.random()||.1,m=p.length;for(i&&(_=t==M||t||i);c!==m&&null!=(s=p[c]);c++){if(x&&s){for(a=0,t||s.ownerDocument==M||(w(s),n=!S);o=g[a++];)if(o(s,t||M,n)){r.push(s);break}i&&(T=f)}y&&((s=!o&&s)&&l--,e&&u.push(s))}if(l+=c,y&&c!==l){for(a=0;o=v[a++];)o(u,h,t,n);if(e){if(0<l)for(;c--;)u[c]||h[c]||(h[c]=I.call(r));h=be(h)}O.apply(r,h),i&&!e&&0<h.length&&1<l+v.length&&oe.uniqueSort(r)}return i&&(T=f,_=d),u}var y=0<v.length,x=0<g.length;return y?ce(e):e}return ge.prototype=b.filters=b.pseudos,b.setFilters=new ge,f=oe.tokenize=function(e,t){var n,r,i,s,a,o,l,c=A[e+" "];if(c)return t?0:c.slice(0);for(a=e,o=[],l=b.preFilter;a;){for(s in n&&!(r=q.exec(a))||(r&&(a=a.slice(r[0].length)||a),o.push(i=[])),n=!1,(r=X.exec(a))&&(n=r.shift(),i.push({value:n,type:r[0].replace(j," ")}),a=a.slice(n.length)),b.filter)!(r=Z[s].exec(a))||l[s]&&!(r=l[s](r))||(n=r.shift(),i.push({value:n,type:s,matches:r}),a=a.slice(n.length));if(!n)break}return t?a.length:a?oe.error(e):A(e,o).slice(0)},m=oe.compile=function(e,t){var n,r=[],i=[],s=P[e+" "];if(!s){for(n=(t=t||f(e)).length;n--;)((s=function e(t){for(var r,n,i,s=t.length,a=b.relative[t[0].type],o=a||b.relative[" "],l=a?1:0,c=ye(function(e){return e===r},o,!0),u=ye(function(e){return-1<U(r,e)},o,!0),h=[function(e,t,n){return n=!a&&(n||t!==_)||((r=t).nodeType?c:u)(e,t,n),r=null,n}];l<s;l++)if(n=b.relative[t[l].type])h=[ye(xe(h),n)];else{if((n=b.filter[t[l].type].apply(null,t[l].matches))[E]){for(i=++l;i<s&&!b.relative[t[i].type];i++);return _e(1<l&&xe(h),1<l&&ve(t.slice(0,l-1).concat({value:" "===t[l-2].type?"*":""})).replace(j,"$1"),n,l<i&&e(t.slice(l,i)),i<s&&e(t=t.slice(i)),i<s&&ve(t))}h.push(n)}return xe(h)}(t[n]))[E]?r:i).push(s);(s=P(e,we(i,r))).selector=e}return s},g=oe.select=function(e,t,n,r){var i,s,a,o,l,c="function"==typeof e&&e,u=!r&&f(e=c.selector||e);if(n=n||[],1===u.length){if(2<(s=u[0]=u[0].slice(0)).length&&"ID"===(a=s[0]).type&&9===t.nodeType&&S&&b.relative[s[1].type]){if(!(t=(b.find.ID(a.matches[0].replace(ie,h),t)||[])[0]))return n;c&&(t=t.parentNode),e=e.slice(s.shift().value.length)}for(i=Z.needsContext.test(e)?0:s.length;i--&&(a=s[i],!b.relative[o=a.type]);)if((l=b.find[o])&&(r=l(a.matches[0].replace(ie,h),re.test(s[0].type)&&me(t.parentNode)||t))){if(s.splice(i,1),!(e=r.length&&ve(s)))return O.apply(n,r),n;break}}return(c||m(e,u))(r,t,!S,n,!t||re.test(e)&&me(t.parentNode)||t),n},p.sortStable=E.split("").sort(D).join("")===E,p.detectDuplicates=!!c,w(),p.sortDetached=ue(function(e){return 1&e.compareDocumentPosition(M.createElement("fieldset"))}),ue(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||he("type|href|height|width",function(e,t,n){if(!n)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),p.attributes&&ue(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||he("value",function(e,t,n){if(!n&&"input"===e.nodeName.toLowerCase())return e.defaultValue}),ue(function(e){return null==e.getAttribute("disabled")})||he(V,function(e,t,n){if(!n)return!0===e[t]?t.toLowerCase():(t=e.getAttributeNode(t))&&t.specified?t.value:null}),oe}(w);S.find=p,S.expr=p.selectors,S.expr[":"]=S.expr.pseudos,S.uniqueSort=S.unique=p.uniqueSort,S.text=p.getText,S.isXMLDoc=p.isXML,S.contains=p.contains,S.escapeSelector=p.escape;function _(e,t,n){for(var r=[],i=void 0!==n;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(i&&S(e).is(n))break;r.push(e)}return r}function E(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n}var T=S.expr.match.needsContext;function C(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}var L=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function A(e,n,r){return m(n)?S.grep(e,function(e,t){return!!n.call(e,t,e)!==r}):n.nodeType?S.grep(e,function(e){return e===n!==r}):"string"!=typeof n?S.grep(e,function(e){return-1<i.call(n,e)!==r}):S.filter(n,e,r)}S.filter=function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?S.find.matchesSelector(r,e)?[r]:[]:S.find.matches(e,S.grep(t,function(e){return 1===e.nodeType}))},S.fn.extend({find:function(e){var t,n,r=this.length,i=this;if("string"!=typeof e)return this.pushStack(S(e).filter(function(){for(t=0;t<r;t++)if(S.contains(i[t],this))return!0}));for(n=this.pushStack([]),t=0;t<r;t++)S.find(e,i[t],n);return 1<r?S.uniqueSort(n):n},filter:function(e){return this.pushStack(A(this,e||[],!1))},not:function(e){return this.pushStack(A(this,e||[],!0))},is:function(e){return!!A(this,"string"==typeof e&&T.test(e)?S(e):e||[],!1).length}});var P=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(S.fn.init=function(e,t,n){if(!e)return this;if(n=n||R,"string"!=typeof e)return e.nodeType?(this[0]=e,this.length=1,this):m(e)?void 0!==n.ready?n.ready(e):e(S):S.makeArray(e,this);if(!(r="<"===e[0]&&">"===e[e.length-1]&&3<=e.length?[null,e,null]:P.exec(e))||!r[1]&&t)return(!t||t.jquery?t||n:this.constructor(t)).find(e);if(r[1]){if(t=t instanceof S?t[0]:t,S.merge(this,S.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:M,!0)),L.test(r[1])&&S.isPlainObject(t))for(var r in t)m(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return(e=M.getElementById(r[2]))&&(this[0]=e,this.length=1),this}).prototype=S.fn;var R=S(M),D=/^(?:parents|prev(?:Until|All))/,N={children:!0,contents:!0,next:!0,prev:!0};function I(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}S.fn.extend({has:function(e){var t=S(e,this),n=t.length;return this.filter(function(){for(var e=0;e<n;e++)if(S.contains(this,t[e]))return!0})},closest:function(e,t){var n,r=0,i=this.length,s=[],a="string"!=typeof e&&S(e);if(!T.test(e))for(;r<i;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(a?-1<a.index(n):1===n.nodeType&&S.find.matchesSelector(n,e))){s.push(n);break}return this.pushStack(1<s.length?S.uniqueSort(s):s)},index:function(e){return e?"string"==typeof e?i.call(S(e),this[0]):i.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(S.uniqueSort(S.merge(this.get(),S(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),S.each({parent:function(e){e=e.parentNode;return e&&11!==e.nodeType?e:null},parents:function(e){return _(e,"parentNode")},parentsUntil:function(e,t,n){return _(e,"parentNode",n)},next:function(e){return I(e,"nextSibling")},prev:function(e){return I(e,"previousSibling")},nextAll:function(e){return _(e,"nextSibling")},prevAll:function(e){return _(e,"previousSibling")},nextUntil:function(e,t,n){return _(e,"nextSibling",n)},prevUntil:function(e,t,n){return _(e,"previousSibling",n)},siblings:function(e){return E((e.parentNode||{}).firstChild,e)},children:function(e){return E(e.firstChild)},contents:function(e){return null!=e.contentDocument&&n(e.contentDocument)?e.contentDocument:(C(e,"template")&&(e=e.content||e),S.merge([],e.childNodes))}},function(r,i){S.fn[r]=function(e,t){var n=S.map(this,i,e);return(t="Until"!==r.slice(-5)?e:t)&&"string"==typeof t&&(n=S.filter(t,n)),1<this.length&&(N[r]||S.uniqueSort(n),D.test(r)&&n.reverse()),this.pushStack(n)}});var k=/[^\x20\t\r\n\f]+/g;function O(e){return e}function z(e){throw e}function U(e,t,n,r){var i;try{e&&m(i=e.promise)?i.call(e).done(t).fail(n):e&&m(i=e.then)?i.call(e,t,n):t.apply(void 0,[e].slice(r))}catch(e){n.apply(void 0,[e])}}S.Callbacks=function(r){var e,n;r="string"==typeof r?(e=r,n={},S.each(e.match(k)||[],function(e,t){n[t]=!0}),n):S.extend({},r);function i(){for(o=o||r.once,a=s=!0;c.length;u=-1)for(t=c.shift();++u<l.length;)!1===l[u].apply(t[0],t[1])&&r.stopOnFalse&&(u=l.length,t=!1);r.memory||(t=!1),s=!1,o&&(l=t?[]:"")}var s,t,a,o,l=[],c=[],u=-1,h={add:function(){return l&&(t&&!s&&(u=l.length-1,c.push(t)),function n(e){S.each(e,function(e,t){m(t)?r.unique&&h.has(t)||l.push(t):t&&t.length&&"string"!==f(t)&&n(t)})}(arguments),t&&!s&&i()),this},remove:function(){return S.each(arguments,function(e,t){for(var n;-1<(n=S.inArray(t,l,n));)l.splice(n,1),n<=u&&u--}),this},has:function(e){return e?-1<S.inArray(e,l):0<l.length},empty:function(){return l=l&&[],this},disable:function(){return o=c=[],l=t="",this},disabled:function(){return!l},lock:function(){return o=c=[],t||s||(l=t=""),this},locked:function(){return!!o},fireWith:function(e,t){return o||(t=[e,(t=t||[]).slice?t.slice():t],c.push(t),s||i()),this},fire:function(){return h.fireWith(this,arguments),this},fired:function(){return!!a}};return h},S.extend({Deferred:function(e){var s=[["notify","progress",S.Callbacks("memory"),S.Callbacks("memory"),2],["resolve","done",S.Callbacks("once memory"),S.Callbacks("once memory"),0,"resolved"],["reject","fail",S.Callbacks("once memory"),S.Callbacks("once memory"),1,"rejected"]],i="pending",a={state:function(){return i},always:function(){return o.done(arguments).fail(arguments),this},catch:function(e){return a.then(null,e)},pipe:function(){var i=arguments;return S.Deferred(function(r){S.each(s,function(e,t){var n=m(i[t[4]])&&i[t[4]];o[t[1]](function(){var e=n&&n.apply(this,arguments);e&&m(e.promise)?e.promise().progress(r.notify).done(r.resolve).fail(r.reject):r[t[0]+"With"](this,n?[e]:arguments)})}),i=null}).promise()},then:function(t,n,r){var l=0;function c(i,s,a,o){return function(){function e(){var e,t;if(!(i<l)){if((e=a.apply(n,r))===s.promise())throw new TypeError("Thenable self-resolution");t=e&&("object"==typeof e||"function"==typeof e)&&e.then,m(t)?o?t.call(e,c(l,s,O,o),c(l,s,z,o)):(l++,t.call(e,c(l,s,O,o),c(l,s,z,o),c(l,s,O,s.notifyWith))):(a!==O&&(n=void 0,r=[e]),(o||s.resolveWith)(n,r))}}var n=this,r=arguments,t=o?e:function(){try{e()}catch(e){S.Deferred.exceptionHook&&S.Deferred.exceptionHook(e,t.stackTrace),l<=i+1&&(a!==z&&(n=void 0,r=[e]),s.rejectWith(n,r))}};i?t():(S.Deferred.getStackHook&&(t.stackTrace=S.Deferred.getStackHook()),w.setTimeout(t))}}return S.Deferred(function(e){s[0][3].add(c(0,e,m(r)?r:O,e.notifyWith)),s[1][3].add(c(0,e,m(t)?t:O)),s[2][3].add(c(0,e,m(n)?n:z))}).promise()},promise:function(e){return null!=e?S.extend(e,a):a}},o={};return S.each(s,function(e,t){var n=t[2],r=t[5];a[t[1]]=n.add,r&&n.add(function(){i=r},s[3-e][2].disable,s[3-e][3].disable,s[0][2].lock,s[0][3].lock),n.add(t[3].fire),o[t[0]]=function(){return o[t[0]+"With"](this===o?void 0:this,arguments),this},o[t[0]+"With"]=n.fireWith}),a.promise(o),e&&e.call(o,o),o},when:function(e){function t(t){return function(e){i[t]=this,s[t]=1<arguments.length?o.call(arguments):e,--n||a.resolveWith(i,s)}}var n=arguments.length,r=n,i=Array(r),s=o.call(arguments),a=S.Deferred();if(n<=1&&(U(e,a.done(t(r)).resolve,a.reject,!n),"pending"===a.state()||m(s[r]&&s[r].then)))return a.then();for(;r--;)U(s[r],t(r),a.reject);return a.promise()}});var V=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;S.Deferred.exceptionHook=function(e,t){w.console&&w.console.warn&&e&&V.test(e.name)&&w.console.warn("jQuery.Deferred exception: "+e.message,e.stack,t)},S.readyException=function(e){w.setTimeout(function(){throw e})};var F=S.Deferred();function H(){M.removeEventListener("DOMContentLoaded",H),w.removeEventListener("load",H),S.ready()}S.fn.ready=function(e){return F.then(e).catch(function(e){S.readyException(e)}),this},S.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--S.readyWait:S.isReady)||(S.isReady=!0)!==e&&0<--S.readyWait||F.resolveWith(M,[S])}}),S.ready.then=F.then,"complete"===M.readyState||"loading"!==M.readyState&&!M.documentElement.doScroll?w.setTimeout(S.ready):(M.addEventListener("DOMContentLoaded",H),w.addEventListener("load",H));function B(e,t,n,r,i,s,a){var o=0,l=e.length,c=null==n;if("object"===f(n))for(o in i=!0,n)B(e,t,o,n[o],!0,s,a);else if(void 0!==r&&(i=!0,m(r)||(a=!0),t=c?a?(t.call(e,r),null):(c=t,function(e,t,n){return c.call(S(e),n)}):t))for(;o<l;o++)t(e[o],n,a?r:r.call(e[o],o,t(e[o],n)));return i?e:c?t.call(e):l?t(e[0],n):s}var G=/^-ms-/,W=/-([a-z])/g;function j(e,t){return t.toUpperCase()}function q(e){return e.replace(G,"ms-").replace(W,j)}function X(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType}function Y(){this.expando=S.expando+Y.uid++}Y.uid=1,Y.prototype={cache:function(e){var t=e[this.expando];return t||(t={},X(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,n){var r,i=this.cache(e);if("string"==typeof t)i[q(t)]=n;else for(r in t)i[q(r)]=t[r];return i},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][q(t)]},access:function(e,t,n){return void 0===t||t&&"string"==typeof t&&void 0===n?this.get(e,t):(this.set(e,t,n),void 0!==n?n:t)},remove:function(e,t){var n,r=e[this.expando];if(void 0!==r){if(void 0!==t){n=(t=Array.isArray(t)?t.map(q):(t=q(t))in r?[t]:t.match(k)||[]).length;for(;n--;)delete r[t[n]]}void 0!==t&&!S.isEmptyObject(r)||(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){e=e[this.expando];return void 0!==e&&!S.isEmptyObject(e)}};var K=new Y,J=new Y,Z=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,$=/[A-Z]/g;function Q(e,t,n){var r,i;if(void 0===n&&1===e.nodeType)if(r="data-"+t.replace($,"-$&").toLowerCase(),"string"==typeof(n=e.getAttribute(r))){try{n="true"===(i=n)||"false"!==i&&("null"===i?null:i===+i+""?+i:Z.test(i)?JSON.parse(i):i)}catch(e){}J.set(e,t,n)}else n=void 0;return n}S.extend({hasData:function(e){return J.hasData(e)||K.hasData(e)},data:function(e,t,n){return J.access(e,t,n)},removeData:function(e,t){J.remove(e,t)},_data:function(e,t,n){return K.access(e,t,n)},_removeData:function(e,t){K.remove(e,t)}}),S.fn.extend({data:function(n,e){var t,r,i,s=this[0],a=s&&s.attributes;if(void 0!==n)return"object"==typeof n?this.each(function(){J.set(this,n)}):B(this,function(e){var t;return s&&void 0===e?void 0!==(t=J.get(s,n))||void 0!==(t=Q(s,n))?t:void 0:void this.each(function(){J.set(this,n,e)})},null,e,1<arguments.length,null,!0);if(this.length&&(i=J.get(s),1===s.nodeType&&!K.get(s,"hasDataAttrs"))){for(t=a.length;t--;)a[t]&&0===(r=a[t].name).indexOf("data-")&&(r=q(r.slice(5)),Q(s,r,i[r]));K.set(s,"hasDataAttrs",!0)}return i},removeData:function(e){return this.each(function(){J.remove(this,e)})}}),S.extend({queue:function(e,t,n){var r;if(e)return r=K.get(e,t=(t||"fx")+"queue"),n&&(!r||Array.isArray(n)?r=K.access(e,t,S.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=S.queue(e,t),r=n.length,i=n.shift(),s=S._queueHooks(e,t);"inprogress"===i&&(i=n.shift(),r--),i&&("fx"===t&&n.unshift("inprogress"),delete s.stop,i.call(e,function(){S.dequeue(e,t)},s)),!r&&s&&s.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return K.get(e,n)||K.access(e,n,{empty:S.Callbacks("once memory").add(function(){K.remove(e,[t+"queue",n])})})}}),S.fn.extend({queue:function(t,n){var e=2;return"string"!=typeof t&&(n=t,t="fx",e--),arguments.length<e?S.queue(this[0],t):void 0===n?this:this.each(function(){var e=S.queue(this,t,n);S._queueHooks(this,t),"fx"===t&&"inprogress"!==e[0]&&S.dequeue(this,t)})},dequeue:function(e){return this.each(function(){S.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){function n(){--i||s.resolveWith(a,[a])}var r,i=1,s=S.Deferred(),a=this,o=this.length;for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";o--;)(r=K.get(a[o],e+"queueHooks"))&&r.empty&&(i++,r.empty.add(n));return n(),s.promise(t)}});var ee=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,te=new RegExp("^(?:([+-])=|)("+ee+")([a-z%]*)$","i"),ne=["Top","Right","Bottom","Left"],re=M.documentElement,ie=function(e){return S.contains(e.ownerDocument,e)},se={composed:!0};re.getRootNode&&(ie=function(e){return S.contains(e.ownerDocument,e)||e.getRootNode(se)===e.ownerDocument});function ae(e,t){return"none"===(e=t||e).style.display||""===e.style.display&&ie(e)&&"none"===S.css(e,"display")}function oe(e,t,n,r){var i,s,a=20,o=r?function(){return r.cur()}:function(){return S.css(e,t,"")},l=o(),c=n&&n[3]||(S.cssNumber[t]?"":"px"),u=e.nodeType&&(S.cssNumber[t]||"px"!==c&&+l)&&te.exec(S.css(e,t));if(u&&u[3]!==c){for(c=c||u[3],u=+(l/=2)||1;a--;)S.style(e,t,u+c),(1-s)*(1-(s=o()/l||.5))<=0&&(a=0),u/=s;S.style(e,t,(u*=2)+c),n=n||[]}return n&&(u=+u||+l||0,i=n[1]?u+(n[1]+1)*n[2]:+n[2],r&&(r.unit=c,r.start=u,r.end=i)),i}var le={};function ce(e,t){for(var n,r,i,s,a,o=[],l=0,c=e.length;l<c;l++)(r=e[l]).style&&(n=r.style.display,t?("none"===n&&(o[l]=K.get(r,"display")||null,o[l]||(r.style.display="")),""===r.style.display&&ae(r)&&(o[l]=(a=s=void 0,s=(i=r).ownerDocument,a=i.nodeName,(i=le[a])||(s=s.body.appendChild(s.createElement(a)),i=S.css(s,"display"),s.parentNode.removeChild(s),le[a]=i="none"===i?"block":i)))):"none"!==n&&(o[l]="none",K.set(r,"display",n)));for(l=0;l<c;l++)null!=o[l]&&(e[l].style.display=o[l]);return e}S.fn.extend({show:function(){return ce(this,!0)},hide:function(){return ce(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){ae(this)?S(this).show():S(this).hide()})}});var ue=/^(?:checkbox|radio)$/i,he=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,de=/^$|^module$|\/(?:java|ecma)script/i;h=M.createDocumentFragment().appendChild(M.createElement("div")),(p=M.createElement("input")).setAttribute("type","radio"),p.setAttribute("checked","checked"),p.setAttribute("name","t"),h.appendChild(p),x.checkClone=h.cloneNode(!0).cloneNode(!0).lastChild.checked,h.innerHTML="<textarea>x</textarea>",x.noCloneChecked=!!h.cloneNode(!0).lastChild.defaultValue,h.innerHTML="<option></option>",x.option=!!h.lastChild;var pe={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function fe(e,t){var n=void 0!==e.getElementsByTagName?e.getElementsByTagName(t||"*"):void 0!==e.querySelectorAll?e.querySelectorAll(t||"*"):[];return void 0===t||t&&C(e,t)?S.merge([e],n):n}function me(e,t){for(var n=0,r=e.length;n<r;n++)K.set(e[n],"globalEval",!t||K.get(t[n],"globalEval"))}pe.tbody=pe.tfoot=pe.colgroup=pe.caption=pe.thead,pe.th=pe.td,x.option||(pe.optgroup=pe.option=[1,"<select multiple='multiple'>","</select>"]);var ge=/<|&#?\w+;/;function ve(e,t,n,r,i){for(var s,a,o,l,c,u=t.createDocumentFragment(),h=[],d=0,p=e.length;d<p;d++)if((s=e[d])||0===s)if("object"===f(s))S.merge(h,s.nodeType?[s]:s);else if(ge.test(s)){for(a=a||u.appendChild(t.createElement("div")),o=(he.exec(s)||["",""])[1].toLowerCase(),o=pe[o]||pe._default,a.innerHTML=o[1]+S.htmlPrefilter(s)+o[2],c=o[0];c--;)a=a.lastChild;S.merge(h,a.childNodes),(a=u.firstChild).textContent=""}else h.push(t.createTextNode(s));for(u.textContent="",d=0;s=h[d++];)if(r&&-1<S.inArray(s,r))i&&i.push(s);else if(l=ie(s),a=fe(u.appendChild(s),"script"),l&&me(a),n)for(c=0;s=a[c++];)de.test(s.type||"")&&n.push(s);return u}var ye=/^([^.]*)(?:\.(.+)|)/;function xe(){return!0}function be(){return!1}function _e(e,t){return e===function(){try{return M.activeElement}catch(e){}}()==("focus"===t)}function we(e,t,n,r,i,s){var a,o;if("object"==typeof t){for(o in"string"!=typeof n&&(r=r||n,n=void 0),t)we(e,o,n,r,t[o],s);return e}if(null==r&&null==i?(i=n,r=n=void 0):null==i&&("string"==typeof n?(i=r,r=void 0):(i=r,r=n,n=void 0)),!1===i)i=be;else if(!i)return e;return 1===s&&(a=i,(i=function(e){return S().off(e),a.apply(this,arguments)}).guid=a.guid||(a.guid=S.guid++)),e.each(function(){S.event.add(this,t,i,r,n)})}function Me(e,i,s){s?(K.set(e,i,!1),S.event.add(e,i,{namespace:!1,handler:function(e){var t,n,r=K.get(this,i);if(1&e.isTrigger&&this[i]){if(r.length)(S.event.special[i]||{}).delegateType&&e.stopPropagation();else if(r=o.call(arguments),K.set(this,i,r),t=s(this,i),this[i](),r!==(n=K.get(this,i))||t?K.set(this,i,!1):n={},r!==n)return e.stopImmediatePropagation(),e.preventDefault(),n&&n.value}else r.length&&(K.set(this,i,{value:S.event.trigger(S.extend(r[0],S.Event.prototype),r.slice(1),this)}),e.stopImmediatePropagation())}})):void 0===K.get(e,i)&&S.event.add(e,i,xe)}S.event={global:{},add:function(t,e,n,r,i){var s,a,o,l,c,u,h,d,p,f=K.get(t);if(X(t))for(n.handler&&(n=(s=n).handler,i=s.selector),i&&S.find.matchesSelector(re,i),n.guid||(n.guid=S.guid++),(o=f.events)||(o=f.events=Object.create(null)),(a=f.handle)||(a=f.handle=function(e){return void 0!==S&&S.event.triggered!==e.type?S.event.dispatch.apply(t,arguments):void 0}),l=(e=(e||"").match(k)||[""]).length;l--;)h=p=(c=ye.exec(e[l])||[])[1],d=(c[2]||"").split(".").sort(),h&&(u=S.event.special[h]||{},h=(i?u.delegateType:u.bindType)||h,u=S.event.special[h]||{},c=S.extend({type:h,origType:p,data:r,handler:n,guid:n.guid,selector:i,needsContext:i&&S.expr.match.needsContext.test(i),namespace:d.join(".")},s),(p=o[h])||((p=o[h]=[]).delegateCount=0,u.setup&&!1!==u.setup.call(t,r,d,a)||t.addEventListener&&t.addEventListener(h,a)),u.add&&(u.add.call(t,c),c.handler.guid||(c.handler.guid=n.guid)),i?p.splice(p.delegateCount++,0,c):p.push(c),S.event.global[h]=!0)},remove:function(e,t,n,r,i){var s,a,o,l,c,u,h,d,p,f,m,g=K.hasData(e)&&K.get(e);if(g&&(l=g.events)){for(c=(t=(t||"").match(k)||[""]).length;c--;)if(p=m=(o=ye.exec(t[c])||[])[1],f=(o[2]||"").split(".").sort(),p){for(h=S.event.special[p]||{},d=l[p=(r?h.delegateType:h.bindType)||p]||[],o=o[2]&&new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=s=d.length;s--;)u=d[s],!i&&m!==u.origType||n&&n.guid!==u.guid||o&&!o.test(u.namespace)||r&&r!==u.selector&&("**"!==r||!u.selector)||(d.splice(s,1),u.selector&&d.delegateCount--,h.remove&&h.remove.call(e,u));a&&!d.length&&(h.teardown&&!1!==h.teardown.call(e,f,g.handle)||S.removeEvent(e,p,g.handle),delete l[p])}else for(p in l)S.event.remove(e,p+t[c],n,r,!0);S.isEmptyObject(l)&&K.remove(e,"handle events")}},dispatch:function(e){var t,n,r,i,s,a=new Array(arguments.length),o=S.event.fix(e),l=(K.get(this,"events")||Object.create(null))[o.type]||[],e=S.event.special[o.type]||{};for(a[0]=o,t=1;t<arguments.length;t++)a[t]=arguments[t];if(o.delegateTarget=this,!e.preDispatch||!1!==e.preDispatch.call(this,o)){for(s=S.event.handlers.call(this,o,l),t=0;(r=s[t++])&&!o.isPropagationStopped();)for(o.currentTarget=r.elem,n=0;(i=r.handlers[n++])&&!o.isImmediatePropagationStopped();)o.rnamespace&&!1!==i.namespace&&!o.rnamespace.test(i.namespace)||(o.handleObj=i,o.data=i.data,void 0!==(i=((S.event.special[i.origType]||{}).handle||i.handler).apply(r.elem,a))&&!1===(o.result=i)&&(o.preventDefault(),o.stopPropagation()));return e.postDispatch&&e.postDispatch.call(this,o),o.result}},handlers:function(e,t){var n,r,i,s,a,o=[],l=t.delegateCount,c=e.target;if(l&&c.nodeType&&!("click"===e.type&&1<=e.button))for(;c!==this;c=c.parentNode||this)if(1===c.nodeType&&("click"!==e.type||!0!==c.disabled)){for(s=[],a={},n=0;n<l;n++)void 0===a[i=(r=t[n]).selector+" "]&&(a[i]=r.needsContext?-1<S(i,this).index(c):S.find(i,this,null,[c]).length),a[i]&&s.push(r);s.length&&o.push({elem:c,handlers:s})}return c=this,l<t.length&&o.push({elem:c,handlers:t.slice(l)}),o},addProp:function(t,e){Object.defineProperty(S.Event.prototype,t,{enumerable:!0,configurable:!0,get:m(e)?function(){if(this.originalEvent)return e(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[t]},set:function(e){Object.defineProperty(this,t,{enumerable:!0,configurable:!0,writable:!0,value:e})}})},fix:function(e){return e[S.expando]?e:new S.Event(e)},special:{load:{noBubble:!0},click:{setup:function(e){e=this||e;return ue.test(e.type)&&e.click&&C(e,"input")&&Me(e,"click",xe),!1},trigger:function(e){e=this||e;return ue.test(e.type)&&e.click&&C(e,"input")&&Me(e,"click"),!0},_default:function(e){e=e.target;return ue.test(e.type)&&e.click&&C(e,"input")&&K.get(e,"click")||C(e,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},S.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n)},S.Event=function(e,t){if(!(this instanceof S.Event))return new S.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?xe:be,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&S.extend(this,t),this.timeStamp=e&&e.timeStamp||Date.now(),this[S.expando]=!0},S.Event.prototype={constructor:S.Event,isDefaultPrevented:be,isPropagationStopped:be,isImmediatePropagationStopped:be,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=xe,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=xe,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=xe,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},S.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},S.event.addProp),S.each({focus:"focusin",blur:"focusout"},function(e,t){S.event.special[e]={setup:function(){return Me(this,e,_e),!1},trigger:function(){return Me(this,e),!0},_default:function(){return!0},delegateType:t}}),S.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,i){S.event.special[e]={delegateType:i,bindType:i,handle:function(e){var t,n=e.relatedTarget,r=e.handleObj;return n&&(n===this||S.contains(this,n))||(e.type=r.origType,t=r.handler.apply(this,arguments),e.type=i),t}}}),S.fn.extend({on:function(e,t,n,r){return we(this,e,t,n,r)},one:function(e,t,n,r){return we(this,e,t,n,r,1)},off:function(e,t,n){var r,i;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,S(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"!=typeof e)return!1!==t&&"function"!=typeof t||(n=t,t=void 0),!1===n&&(n=be),this.each(function(){S.event.remove(this,e,n,t)});for(i in e)this.off(i,t,e[i]);return this}});var Se=/<script|<style|<link/i,Ee=/checked\s*(?:[^=]|=\s*.checked.)/i,Te=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function Ce(e,t){return C(e,"table")&&C(11!==t.nodeType?t:t.firstChild,"tr")&&S(e).children("tbody")[0]||e}function Le(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function Ae(e){return"true/"===(e.type||"").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute("type"),e}function Pe(e,t){var n,r,i,s;if(1===t.nodeType){if(K.hasData(e)&&(s=K.get(e).events))for(i in K.remove(t,"handle events"),s)for(n=0,r=s[i].length;n<r;n++)S.event.add(t,i,s[i][n]);J.hasData(e)&&(e=J.access(e),e=S.extend({},e),J.set(t,e))}}function Re(n,r,i,s){r=v(r);var e,t,a,o,l,c,u=0,h=n.length,d=h-1,p=r[0],f=m(p);if(f||1<h&&"string"==typeof p&&!x.checkClone&&Ee.test(p))return n.each(function(e){var t=n.eq(e);f&&(r[0]=p.call(this,e,t.html())),Re(t,r,i,s)});if(h&&(t=(e=ve(r,n[0].ownerDocument,!1,n,s)).firstChild,1===e.childNodes.length&&(e=t),t||s)){for(o=(a=S.map(fe(e,"script"),Le)).length;u<h;u++)l=e,u!==d&&(l=S.clone(l,!0,!0),o&&S.merge(a,fe(l,"script"))),i.call(n[u],l,u);if(o)for(c=a[a.length-1].ownerDocument,S.map(a,Ae),u=0;u<o;u++)l=a[u],de.test(l.type||"")&&!K.access(l,"globalEval")&&S.contains(c,l)&&(l.src&&"module"!==(l.type||"").toLowerCase()?S._evalUrl&&!l.noModule&&S._evalUrl(l.src,{nonce:l.nonce||l.getAttribute("nonce")},c):b(l.textContent.replace(Te,""),l,c))}return n}function De(e,t,n){for(var r,i=t?S.filter(t,e):e,s=0;null!=(r=i[s]);s++)n||1!==r.nodeType||S.cleanData(fe(r)),r.parentNode&&(n&&ie(r)&&me(fe(r,"script")),r.parentNode.removeChild(r));return e}S.extend({htmlPrefilter:function(e){return e},clone:function(e,t,n){var r,i,s,a,o,l,c,u=e.cloneNode(!0),h=ie(e);if(!(x.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||S.isXMLDoc(e)))for(a=fe(u),r=0,i=(s=fe(e)).length;r<i;r++)o=s[r],l=a[r],c=void 0,"input"===(c=l.nodeName.toLowerCase())&&ue.test(o.type)?l.checked=o.checked:"input"!==c&&"textarea"!==c||(l.defaultValue=o.defaultValue);if(t)if(n)for(s=s||fe(e),a=a||fe(u),r=0,i=s.length;r<i;r++)Pe(s[r],a[r]);else Pe(e,u);return 0<(a=fe(u,"script")).length&&me(a,!h&&fe(e,"script")),u},cleanData:function(e){for(var t,n,r,i=S.event.special,s=0;void 0!==(n=e[s]);s++)if(X(n)){if(t=n[K.expando]){if(t.events)for(r in t.events)i[r]?S.event.remove(n,r):S.removeEvent(n,r,t.handle);n[K.expando]=void 0}n[J.expando]&&(n[J.expando]=void 0)}}}),S.fn.extend({detach:function(e){return De(this,e,!0)},remove:function(e){return De(this,e)},text:function(e){return B(this,function(e){return void 0===e?S.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)})},null,e,arguments.length)},append:function(){return Re(this,arguments,function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||Ce(this,e).appendChild(e)})},prepend:function(){return Re(this,arguments,function(e){var t;1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(t=Ce(this,e)).insertBefore(e,t.firstChild)})},before:function(){return Re(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return Re(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(S.cleanData(fe(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return S.clone(this,e,t)})},html:function(e){return B(this,function(e){var t=this[0]||{},n=0,r=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!Se.test(e)&&!pe[(he.exec(e)||["",""])[1].toLowerCase()]){e=S.htmlPrefilter(e);try{for(;n<r;n++)1===(t=this[n]||{}).nodeType&&(S.cleanData(fe(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var n=[];return Re(this,arguments,function(e){var t=this.parentNode;S.inArray(this,n)<0&&(S.cleanData(fe(this)),t&&t.replaceChild(e,this))},n)}}),S.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,a){S.fn[e]=function(e){for(var t,n=[],r=S(e),i=r.length-1,s=0;s<=i;s++)t=s===i?this:this.clone(!0),S(r[s])[a](t),l.apply(n,t.get());return this.pushStack(n)}});function Ne(e){var t=e.ownerDocument.defaultView;return(t=!t||!t.opener?w:t).getComputedStyle(e)}function Ie(e,t,n){var r,i={};for(r in t)i[r]=e.style[r],e.style[r]=t[r];for(r in n=n.call(e),t)e.style[r]=i[r];return n}var ke,Oe,ze,Ue,Ve,Fe,He,Be,Ge=new RegExp("^("+ee+")(?!px)[a-z%]+$","i"),We=new RegExp(ne.join("|"),"i");function je(){var e;Be&&(He.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",Be.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",re.appendChild(He).appendChild(Be),e=w.getComputedStyle(Be),ke="1%"!==e.top,Fe=12===qe(e.marginLeft),Be.style.right="60%",Ue=36===qe(e.right),Oe=36===qe(e.width),Be.style.position="absolute",ze=12===qe(Be.offsetWidth/3),re.removeChild(He),Be=null)}function qe(e){return Math.round(parseFloat(e))}function Xe(e,t,n){var r,i,s=e.style;return(n=n||Ne(e))&&(""!==(i=n.getPropertyValue(t)||n[t])||ie(e)||(i=S.style(e,t)),!x.pixelBoxStyles()&&Ge.test(i)&&We.test(t)&&(r=s.width,e=s.minWidth,t=s.maxWidth,s.minWidth=s.maxWidth=s.width=i,i=n.width,s.width=r,s.minWidth=e,s.maxWidth=t)),void 0!==i?i+"":i}function Ye(e,t){return{get:function(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}He=M.createElement("div"),(Be=M.createElement("div")).style&&(Be.style.backgroundClip="content-box",Be.cloneNode(!0).style.backgroundClip="",x.clearCloneStyle="content-box"===Be.style.backgroundClip,S.extend(x,{boxSizingReliable:function(){return je(),Oe},pixelBoxStyles:function(){return je(),Ue},pixelPosition:function(){return je(),ke},reliableMarginLeft:function(){return je(),Fe},scrollboxSize:function(){return je(),ze},reliableTrDimensions:function(){var e,t,n;return null==Ve&&(e=M.createElement("table"),t=M.createElement("tr"),n=M.createElement("div"),e.style.cssText="position:absolute;left:-11111px;border-collapse:separate",t.style.cssText="border:1px solid",t.style.height="1px",n.style.height="9px",n.style.display="block",re.appendChild(e).appendChild(t).appendChild(n),n=w.getComputedStyle(t),Ve=parseInt(n.height,10)+parseInt(n.borderTopWidth,10)+parseInt(n.borderBottomWidth,10)===t.offsetHeight,re.removeChild(e)),Ve}}));var Ke=["Webkit","Moz","ms"],Je=M.createElement("div").style,Ze={};function $e(e){var t=S.cssProps[e]||Ze[e];return t||(e in Je?e:Ze[e]=function(e){for(var t=e[0].toUpperCase()+e.slice(1),n=Ke.length;n--;)if((e=Ke[n]+t)in Je)return e}(e)||e)}var Qe=/^(none|table(?!-c[ea]).+)/,et=/^--/,tt={position:"absolute",visibility:"hidden",display:"block"},nt={letterSpacing:"0",fontWeight:"400"};function rt(e,t,n){var r=te.exec(t);return r?Math.max(0,r[2]-(n||0))+(r[3]||"px"):t}function it(e,t,n,r,i,s){var a="width"===t?1:0,o=0,l=0;if(n===(r?"border":"content"))return 0;for(;a<4;a+=2)"margin"===n&&(l+=S.css(e,n+ne[a],!0,i)),r?("content"===n&&(l-=S.css(e,"padding"+ne[a],!0,i)),"margin"!==n&&(l-=S.css(e,"border"+ne[a]+"Width",!0,i))):(l+=S.css(e,"padding"+ne[a],!0,i),"padding"!==n?l+=S.css(e,"border"+ne[a]+"Width",!0,i):o+=S.css(e,"border"+ne[a]+"Width",!0,i));return!r&&0<=s&&(l+=Math.max(0,Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-s-l-o-.5))||0),l}function st(e,t,n){var r=Ne(e),i=(!x.boxSizingReliable()||n)&&"border-box"===S.css(e,"boxSizing",!1,r),s=i,a=Xe(e,t,r),o="offset"+t[0].toUpperCase()+t.slice(1);if(Ge.test(a)){if(!n)return a;a="auto"}return(!x.boxSizingReliable()&&i||!x.reliableTrDimensions()&&C(e,"tr")||"auto"===a||!parseFloat(a)&&"inline"===S.css(e,"display",!1,r))&&e.getClientRects().length&&(i="border-box"===S.css(e,"boxSizing",!1,r),(s=o in e)&&(a=e[o])),(a=parseFloat(a)||0)+it(e,t,n||(i?"border":"content"),s,r,a)+"px"}function at(e,t,n,r,i){return new at.prototype.init(e,t,n,r,i)}S.extend({cssHooks:{opacity:{get:function(e,t){if(t){e=Xe(e,"opacity");return""===e?"1":e}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(e,t,n,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var i,s,a,o=q(t),l=et.test(t),c=e.style;if(l||(t=$e(o)),a=S.cssHooks[t]||S.cssHooks[o],void 0===n)return a&&"get"in a&&void 0!==(i=a.get(e,!1,r))?i:c[t];"string"===(s=typeof n)&&(i=te.exec(n))&&i[1]&&(n=oe(e,t,i),s="number"),null!=n&&n==n&&("number"!==s||l||(n+=i&&i[3]||(S.cssNumber[o]?"":"px")),x.clearCloneStyle||""!==n||0!==t.indexOf("background")||(c[t]="inherit"),a&&"set"in a&&void 0===(n=a.set(e,n,r))||(l?c.setProperty(t,n):c[t]=n))}},css:function(e,t,n,r){var i,s=q(t);return et.test(t)||(t=$e(s)),"normal"===(i=void 0===(i=(s=S.cssHooks[t]||S.cssHooks[s])&&"get"in s?s.get(e,!0,n):i)?Xe(e,t,r):i)&&t in nt&&(i=nt[t]),""===n||n?(t=parseFloat(i),!0===n||isFinite(t)?t||0:i):i}}),S.each(["height","width"],function(e,o){S.cssHooks[o]={get:function(e,t,n){if(t)return!Qe.test(S.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?st(e,o,n):Ie(e,tt,function(){return st(e,o,n)})},set:function(e,t,n){var r,i=Ne(e),s=!x.scrollboxSize()&&"absolute"===i.position,a=(s||n)&&"border-box"===S.css(e,"boxSizing",!1,i),n=n?it(e,o,n,a,i):0;return a&&s&&(n-=Math.ceil(e["offset"+o[0].toUpperCase()+o.slice(1)]-parseFloat(i[o])-it(e,o,"border",!1,i)-.5)),n&&(r=te.exec(t))&&"px"!==(r[3]||"px")&&(e.style[o]=t,t=S.css(e,o)),rt(0,t,n)}}}),S.cssHooks.marginLeft=Ye(x.reliableMarginLeft,function(e,t){if(t)return(parseFloat(Xe(e,"marginLeft"))||e.getBoundingClientRect().left-Ie(e,{marginLeft:0},function(){return e.getBoundingClientRect().left}))+"px"}),S.each({margin:"",padding:"",border:"Width"},function(i,s){S.cssHooks[i+s]={expand:function(e){for(var t=0,n={},r="string"==typeof e?e.split(" "):[e];t<4;t++)n[i+ne[t]+s]=r[t]||r[t-2]||r[0];return n}},"margin"!==i&&(S.cssHooks[i+s].set=rt)}),S.fn.extend({css:function(e,t){return B(this,function(e,t,n){var r,i,s={},a=0;if(Array.isArray(t)){for(r=Ne(e),i=t.length;a<i;a++)s[t[a]]=S.css(e,t[a],!1,r);return s}return void 0!==n?S.style(e,t,n):S.css(e,t)},e,t,1<arguments.length)}}),((S.Tween=at).prototype={constructor:at,init:function(e,t,n,r,i,s){this.elem=e,this.prop=n,this.easing=i||S.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=s||(S.cssNumber[n]?"":"px")},cur:function(){var e=at.propHooks[this.prop];return(e&&e.get?e:at.propHooks._default).get(this)},run:function(e){var t,n=at.propHooks[this.prop];return this.options.duration?this.pos=t=S.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),(n&&n.set?n:at.propHooks._default).set(this),this}}).init.prototype=at.prototype,(at.propHooks={_default:{get:function(e){return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(e=S.css(e.elem,e.prop,""))&&"auto"!==e?e:0},set:function(e){S.fx.step[e.prop]?S.fx.step[e.prop](e):1!==e.elem.nodeType||!S.cssHooks[e.prop]&&null==e.elem.style[$e(e.prop)]?e.elem[e.prop]=e.now:S.style(e.elem,e.prop,e.now+e.unit)}}}).scrollTop=at.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},S.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},S.fx=at.prototype.init,S.fx.step={};var ot,lt,ct=/^(?:toggle|show|hide)$/,ut=/queueHooks$/;function ht(){lt&&(!1===M.hidden&&w.requestAnimationFrame?w.requestAnimationFrame(ht):w.setTimeout(ht,S.fx.interval),S.fx.tick())}function dt(){return w.setTimeout(function(){ot=void 0}),ot=Date.now()}function pt(e,t){var n,r=0,i={height:e};for(t=t?1:0;r<4;r+=2-t)i["margin"+(n=ne[r])]=i["padding"+n]=e;return t&&(i.opacity=i.width=e),i}function ft(e,t,n){for(var r,i=(mt.tweeners[t]||[]).concat(mt.tweeners["*"]),s=0,a=i.length;s<a;s++)if(r=i[s].call(n,t,e))return r}function mt(i,e,t){var n,s,r=0,a=mt.prefilters.length,o=S.Deferred().always(function(){delete l.elem}),l=function(){if(s)return!1;for(var e=ot||dt(),e=Math.max(0,c.startTime+c.duration-e),t=1-(e/c.duration||0),n=0,r=c.tweens.length;n<r;n++)c.tweens[n].run(t);return o.notifyWith(i,[c,t,e]),t<1&&r?e:(r||o.notifyWith(i,[c,1,0]),o.resolveWith(i,[c]),!1)},c=o.promise({elem:i,props:S.extend({},e),opts:S.extend(!0,{specialEasing:{},easing:S.easing._default},t),originalProperties:e,originalOptions:t,startTime:ot||dt(),duration:t.duration,tweens:[],createTween:function(e,t){e=S.Tween(i,c.opts,e,t,c.opts.specialEasing[e]||c.opts.easing);return c.tweens.push(e),e},stop:function(e){var t=0,n=e?c.tweens.length:0;if(s)return this;for(s=!0;t<n;t++)c.tweens[t].run(1);return e?(o.notifyWith(i,[c,1,0]),o.resolveWith(i,[c,e])):o.rejectWith(i,[c,e]),this}}),u=c.props;for(!function(e,t){var n,r,i,s,a;for(n in e)if(i=t[r=q(n)],s=e[n],Array.isArray(s)&&(i=s[1],s=e[n]=s[0]),n!==r&&(e[r]=s,delete e[n]),(a=S.cssHooks[r])&&"expand"in a)for(n in s=a.expand(s),delete e[r],s)n in e||(e[n]=s[n],t[n]=i);else t[r]=i}(u,c.opts.specialEasing);r<a;r++)if(n=mt.prefilters[r].call(c,i,u,c.opts))return m(n.stop)&&(S._queueHooks(c.elem,c.opts.queue).stop=n.stop.bind(n)),n;return S.map(u,ft,c),m(c.opts.start)&&c.opts.start.call(i,c),c.progress(c.opts.progress).done(c.opts.done,c.opts.complete).fail(c.opts.fail).always(c.opts.always),S.fx.timer(S.extend(l,{elem:i,anim:c,queue:c.opts.queue})),c}S.Animation=S.extend(mt,{tweeners:{"*":[function(e,t){var n=this.createTween(e,t);return oe(n.elem,e,te.exec(t),n),n}]},tweener:function(e,t){for(var n,r=0,i=(e=m(e)?(t=e,["*"]):e.match(k)).length;r<i;r++)n=e[r],mt.tweeners[n]=mt.tweeners[n]||[],mt.tweeners[n].unshift(t)},prefilters:[function(e,t,n){var r,i,s,a,o,l,c,u="width"in t||"height"in t,h=this,d={},p=e.style,f=e.nodeType&&ae(e),m=K.get(e,"fxshow");for(r in n.queue||(null==(a=S._queueHooks(e,"fx")).unqueued&&(a.unqueued=0,o=a.empty.fire,a.empty.fire=function(){a.unqueued||o()}),a.unqueued++,h.always(function(){h.always(function(){a.unqueued--,S.queue(e,"fx").length||a.empty.fire()})})),t)if(i=t[r],ct.test(i)){if(delete t[r],s=s||"toggle"===i,i===(f?"hide":"show")){if("show"!==i||!m||void 0===m[r])continue;f=!0}d[r]=m&&m[r]||S.style(e,r)}if((l=!S.isEmptyObject(t))||!S.isEmptyObject(d))for(r in u&&1===e.nodeType&&(n.overflow=[p.overflow,p.overflowX,p.overflowY],null==(c=m&&m.display)&&(c=K.get(e,"display")),"none"===(u=S.css(e,"display"))&&(c?u=c:(ce([e],!0),c=e.style.display||c,u=S.css(e,"display"),ce([e]))),("inline"===u||"inline-block"===u&&null!=c)&&"none"===S.css(e,"float")&&(l||(h.done(function(){p.display=c}),null==c&&(u=p.display,c="none"===u?"":u)),p.display="inline-block")),n.overflow&&(p.overflow="hidden",h.always(function(){p.overflow=n.overflow[0],p.overflowX=n.overflow[1],p.overflowY=n.overflow[2]})),l=!1,d)l||(m?"hidden"in m&&(f=m.hidden):m=K.access(e,"fxshow",{display:c}),s&&(m.hidden=!f),f&&ce([e],!0),h.done(function(){for(r in f||ce([e]),K.remove(e,"fxshow"),d)S.style(e,r,d[r])})),l=ft(f?m[r]:0,r,h),r in m||(m[r]=l.start,f&&(l.end=l.start,l.start=0))}],prefilter:function(e,t){t?mt.prefilters.unshift(e):mt.prefilters.push(e)}}),S.speed=function(e,t,n){var r=e&&"object"==typeof e?S.extend({},e):{complete:n||!n&&t||m(e)&&e,duration:e,easing:n&&t||t&&!m(t)&&t};return S.fx.off?r.duration=0:"number"!=typeof r.duration&&(r.duration in S.fx.speeds?r.duration=S.fx.speeds[r.duration]:r.duration=S.fx.speeds._default),null!=r.queue&&!0!==r.queue||(r.queue="fx"),r.old=r.complete,r.complete=function(){m(r.old)&&r.old.call(this),r.queue&&S.dequeue(this,r.queue)},r},S.fn.extend({fadeTo:function(e,t,n,r){return this.filter(ae).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(t,e,n,r){var i=S.isEmptyObject(t),s=S.speed(e,n,r),r=function(){var e=mt(this,S.extend({},t),s);(i||K.get(this,"finish"))&&e.stop(!0)};return r.finish=r,i||!1===s.queue?this.each(r):this.queue(s.queue,r)},stop:function(i,e,s){function a(e){var t=e.stop;delete e.stop,t(s)}return"string"!=typeof i&&(s=e,e=i,i=void 0),e&&this.queue(i||"fx",[]),this.each(function(){var e=!0,t=null!=i&&i+"queueHooks",n=S.timers,r=K.get(this);if(t)r[t]&&r[t].stop&&a(r[t]);else for(t in r)r[t]&&r[t].stop&&ut.test(t)&&a(r[t]);for(t=n.length;t--;)n[t].elem!==this||null!=i&&n[t].queue!==i||(n[t].anim.stop(s),e=!1,n.splice(t,1));!e&&s||S.dequeue(this,i)})},finish:function(a){return!1!==a&&(a=a||"fx"),this.each(function(){var e,t=K.get(this),n=t[a+"queue"],r=t[a+"queueHooks"],i=S.timers,s=n?n.length:0;for(t.finish=!0,S.queue(this,a,[]),r&&r.stop&&r.stop.call(this,!0),e=i.length;e--;)i[e].elem===this&&i[e].queue===a&&(i[e].anim.stop(!0),i.splice(e,1));for(e=0;e<s;e++)n[e]&&n[e].finish&&n[e].finish.call(this);delete t.finish})}}),S.each(["toggle","show","hide"],function(e,r){var i=S.fn[r];S.fn[r]=function(e,t,n){return null==e||"boolean"==typeof e?i.apply(this,arguments):this.animate(pt(r,!0),e,t,n)}}),S.each({slideDown:pt("show"),slideUp:pt("hide"),slideToggle:pt("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,r){S.fn[e]=function(e,t,n){return this.animate(r,e,t,n)}}),S.timers=[],S.fx.tick=function(){var e,t=0,n=S.timers;for(ot=Date.now();t<n.length;t++)(e=n[t])()||n[t]!==e||n.splice(t--,1);n.length||S.fx.stop(),ot=void 0},S.fx.timer=function(e){S.timers.push(e),S.fx.start()},S.fx.interval=13,S.fx.start=function(){lt||(lt=!0,ht())},S.fx.stop=function(){lt=null},S.fx.speeds={slow:600,fast:200,_default:400},S.fn.delay=function(r,e){return r=S.fx&&S.fx.speeds[r]||r,this.queue(e=e||"fx",function(e,t){var n=w.setTimeout(e,r);t.stop=function(){w.clearTimeout(n)}})},h=M.createElement("input"),ee=M.createElement("select").appendChild(M.createElement("option")),h.type="checkbox",x.checkOn=""!==h.value,x.optSelected=ee.selected,(h=M.createElement("input")).value="t",h.type="radio",x.radioValue="t"===h.value;var gt,vt=S.expr.attrHandle;S.fn.extend({attr:function(e,t){return B(this,S.attr,e,t,1<arguments.length)},removeAttr:function(e){return this.each(function(){S.removeAttr(this,e)})}}),S.extend({attr:function(e,t,n){var r,i,s=e.nodeType;if(3!==s&&8!==s&&2!==s)return void 0===e.getAttribute?S.prop(e,t,n):(1===s&&S.isXMLDoc(e)||(i=S.attrHooks[t.toLowerCase()]||(S.expr.match.bool.test(t)?gt:void 0)),void 0!==n?null===n?void S.removeAttr(e,t):i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:(e.setAttribute(t,n+""),n):!(i&&"get"in i&&null!==(r=i.get(e,t)))&&null==(r=S.find.attr(e,t))?void 0:r)},attrHooks:{type:{set:function(e,t){if(!x.radioValue&&"radio"===t&&C(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},removeAttr:function(e,t){var n,r=0,i=t&&t.match(k);if(i&&1===e.nodeType)for(;n=i[r++];)e.removeAttribute(n)}}),gt={set:function(e,t,n){return!1===t?S.removeAttr(e,n):e.setAttribute(n,n),n}},S.each(S.expr.match.bool.source.match(/\w+/g),function(e,t){var a=vt[t]||S.find.attr;vt[t]=function(e,t,n){var r,i,s=t.toLowerCase();return n||(i=vt[s],vt[s]=r,r=null!=a(e,t,n)?s:null,vt[s]=i),r}});var yt=/^(?:input|select|textarea|button)$/i,xt=/^(?:a|area)$/i;function bt(e){return(e.match(k)||[]).join(" ")}function _t(e){return e.getAttribute&&e.getAttribute("class")||""}function wt(e){return Array.isArray(e)?e:"string"==typeof e&&e.match(k)||[]}S.fn.extend({prop:function(e,t){return B(this,S.prop,e,t,1<arguments.length)},removeProp:function(e){return this.each(function(){delete this[S.propFix[e]||e]})}}),S.extend({prop:function(e,t,n){var r,i,s=e.nodeType;if(3!==s&&8!==s&&2!==s)return 1===s&&S.isXMLDoc(e)||(t=S.propFix[t]||t,i=S.propHooks[t]),void 0!==n?i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:e[t]=n:i&&"get"in i&&null!==(r=i.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=S.find.attr(e,"tabindex");return t?parseInt(t,10):yt.test(e.nodeName)||xt.test(e.nodeName)&&e.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),x.optSelected||(S.propHooks.selected={get:function(e){e=e.parentNode;return e&&e.parentNode&&e.parentNode.selectedIndex,null},set:function(e){e=e.parentNode;e&&(e.selectedIndex,e.parentNode&&e.parentNode.selectedIndex)}}),S.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){S.propFix[this.toLowerCase()]=this}),S.fn.extend({addClass:function(t){var e,n,r,i,s,a,o=0;if(m(t))return this.each(function(e){S(this).addClass(t.call(this,e,_t(this)))});if((e=wt(t)).length)for(;n=this[o++];)if(a=_t(n),r=1===n.nodeType&&" "+bt(a)+" "){for(s=0;i=e[s++];)r.indexOf(" "+i+" ")<0&&(r+=i+" ");a!==(a=bt(r))&&n.setAttribute("class",a)}return this},removeClass:function(t){var e,n,r,i,s,a,o=0;if(m(t))return this.each(function(e){S(this).removeClass(t.call(this,e,_t(this)))});if(!arguments.length)return this.attr("class","");if((e=wt(t)).length)for(;n=this[o++];)if(a=_t(n),r=1===n.nodeType&&" "+bt(a)+" "){for(s=0;i=e[s++];)for(;-1<r.indexOf(" "+i+" ");)r=r.replace(" "+i+" "," ");a!==(a=bt(r))&&n.setAttribute("class",a)}return this},toggleClass:function(i,t){var s=typeof i,a="string"==s||Array.isArray(i);return"boolean"==typeof t&&a?t?this.addClass(i):this.removeClass(i):m(i)?this.each(function(e){S(this).toggleClass(i.call(this,e,_t(this),t),t)}):this.each(function(){var e,t,n,r;if(a)for(t=0,n=S(this),r=wt(i);e=r[t++];)n.hasClass(e)?n.removeClass(e):n.addClass(e);else void 0!==i&&"boolean"!=s||((e=_t(this))&&K.set(this,"__className__",e),this.setAttribute&&this.setAttribute("class",!e&&!1!==i&&K.get(this,"__className__")||""))})},hasClass:function(e){for(var t,n=0,r=" "+e+" ";t=this[n++];)if(1===t.nodeType&&-1<(" "+bt(_t(t))+" ").indexOf(r))return!0;return!1}});var Mt=/\r/g;S.fn.extend({val:function(t){var n,e,r,i=this[0];return arguments.length?(r=m(t),this.each(function(e){1===this.nodeType&&(null==(e=r?t.call(this,e,S(this).val()):t)?e="":"number"==typeof e?e+="":Array.isArray(e)&&(e=S.map(e,function(e){return null==e?"":e+""})),(n=S.valHooks[this.type]||S.valHooks[this.nodeName.toLowerCase()])&&"set"in n&&void 0!==n.set(this,e,"value")||(this.value=e))})):i?(n=S.valHooks[i.type]||S.valHooks[i.nodeName.toLowerCase()])&&"get"in n&&void 0!==(e=n.get(i,"value"))?e:"string"==typeof(e=i.value)?e.replace(Mt,""):null==e?"":e:void 0}}),S.extend({valHooks:{option:{get:function(e){var t=S.find.attr(e,"value");return null!=t?t:bt(S.text(e))}},select:{get:function(e){for(var t,n=e.options,r=e.selectedIndex,i="select-one"===e.type,s=i?null:[],a=i?r+1:n.length,o=r<0?a:i?r:0;o<a;o++)if(((t=n[o]).selected||o===r)&&!t.disabled&&(!t.parentNode.disabled||!C(t.parentNode,"optgroup"))){if(t=S(t).val(),i)return t;s.push(t)}return s},set:function(e,t){for(var n,r,i=e.options,s=S.makeArray(t),a=i.length;a--;)((r=i[a]).selected=-1<S.inArray(S.valHooks.option.get(r),s))&&(n=!0);return n||(e.selectedIndex=-1),s}}}}),S.each(["radio","checkbox"],function(){S.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=-1<S.inArray(S(e).val(),t)}},x.checkOn||(S.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})}),x.focusin="onfocusin"in w;function St(e){e.stopPropagation()}var Et=/^(?:focusinfocus|focusoutblur)$/;S.extend(S.event,{trigger:function(e,t,n,r){var i,s,a,o,l,c,u,h=[n||M],d=y.call(e,"type")?e.type:e,p=y.call(e,"namespace")?e.namespace.split("."):[],f=u=s=n=n||M;if(3!==n.nodeType&&8!==n.nodeType&&!Et.test(d+S.event.triggered)&&(-1<d.indexOf(".")&&(d=(p=d.split(".")).shift(),p.sort()),o=d.indexOf(":")<0&&"on"+d,(e=e[S.expando]?e:new S.Event(d,"object"==typeof e&&e)).isTrigger=r?2:3,e.namespace=p.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=n),t=null==t?[e]:S.makeArray(t,[e]),c=S.event.special[d]||{},r||!c.trigger||!1!==c.trigger.apply(n,t))){if(!r&&!c.noBubble&&!g(n)){for(a=c.delegateType||d,Et.test(a+d)||(f=f.parentNode);f;f=f.parentNode)h.push(f),s=f;s===(n.ownerDocument||M)&&h.push(s.defaultView||s.parentWindow||w)}for(i=0;(f=h[i++])&&!e.isPropagationStopped();)u=f,e.type=1<i?a:c.bindType||d,(l=(K.get(f,"events")||Object.create(null))[e.type]&&K.get(f,"handle"))&&l.apply(f,t),(l=o&&f[o])&&l.apply&&X(f)&&(e.result=l.apply(f,t),!1===e.result&&e.preventDefault());return e.type=d,r||e.isDefaultPrevented()||c._default&&!1!==c._default.apply(h.pop(),t)||!X(n)||o&&m(n[d])&&!g(n)&&((s=n[o])&&(n[o]=null),S.event.triggered=d,e.isPropagationStopped()&&u.addEventListener(d,St),n[d](),e.isPropagationStopped()&&u.removeEventListener(d,St),S.event.triggered=void 0,s&&(n[o]=s)),e.result}},simulate:function(e,t,n){e=S.extend(new S.Event,n,{type:e,isSimulated:!0});S.event.trigger(e,null,t)}}),S.fn.extend({trigger:function(e,t){return this.each(function(){S.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];if(n)return S.event.trigger(e,t,n,!0)}}),x.focusin||S.each({focus:"focusin",blur:"focusout"},function(n,r){function i(e){S.event.simulate(r,e.target,S.event.fix(e))}S.event.special[r]={setup:function(){var e=this.ownerDocument||this.document||this,t=K.access(e,r);t||e.addEventListener(n,i,!0),K.access(e,r,(t||0)+1)},teardown:function(){var e=this.ownerDocument||this.document||this,t=K.access(e,r)-1;t?K.access(e,r,t):(e.removeEventListener(n,i,!0),K.remove(e,r))}}});var Tt=w.location,Ct={guid:Date.now()},Lt=/\?/;S.parseXML=function(e){var t,n;if(!e||"string"!=typeof e)return null;try{t=(new w.DOMParser).parseFromString(e,"text/xml")}catch(e){}return n=t&&t.getElementsByTagName("parsererror")[0],t&&!n||S.error("Invalid XML: "+(n?S.map(n.childNodes,function(e){return e.textContent}).join("\n"):e)),t};var At=/\[\]$/,Pt=/\r?\n/g,Rt=/^(?:submit|button|image|reset|file)$/i,Dt=/^(?:input|select|textarea|keygen)/i;S.param=function(e,t){function n(e,t){t=m(t)?t():t,i[i.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==t?"":t)}var r,i=[];if(null==e)return"";if(Array.isArray(e)||e.jquery&&!S.isPlainObject(e))S.each(e,function(){n(this.name,this.value)});else for(r in e)!function n(r,e,i,s){if(Array.isArray(e))S.each(e,function(e,t){i||At.test(r)?s(r,t):n(r+"["+("object"==typeof t&&null!=t?e:"")+"]",t,i,s)});else if(i||"object"!==f(e))s(r,e);else for(var t in e)n(r+"["+t+"]",e[t],i,s)}(r,e[r],t,n);return i.join("&")},S.fn.extend({serialize:function(){return S.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=S.prop(this,"elements");return e?S.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!S(this).is(":disabled")&&Dt.test(this.nodeName)&&!Rt.test(e)&&(this.checked||!ue.test(e))}).map(function(e,t){var n=S(this).val();return null==n?null:Array.isArray(n)?S.map(n,function(e){return{name:t.name,value:e.replace(Pt,"\r\n")}}):{name:t.name,value:n.replace(Pt,"\r\n")}}).get()}});var Nt=/%20/g,It=/#.*$/,kt=/([?&])_=[^&]*/,Ot=/^(.*?):[ \t]*([^\r\n]*)$/gm,zt=/^(?:GET|HEAD)$/,Ut=/^\/\//,Vt={},Ft={},Ht="*/".concat("*"),Bt=M.createElement("a");function Gt(s){return function(e,t){"string"!=typeof e&&(t=e,e="*");var n,r=0,i=e.toLowerCase().match(k)||[];if(m(t))for(;n=i[r++];)"+"===n[0]?(n=n.slice(1)||"*",(s[n]=s[n]||[]).unshift(t)):(s[n]=s[n]||[]).push(t)}}function Wt(t,r,i,s){var a={},o=t===Ft;function l(e){var n;return a[e]=!0,S.each(t[e]||[],function(e,t){t=t(r,i,s);return"string"!=typeof t||o||a[t]?o?!(n=t):void 0:(r.dataTypes.unshift(t),l(t),!1)}),n}return l(r.dataTypes[0])||!a["*"]&&l("*")}function jt(e,t){var n,r,i=S.ajaxSettings.flatOptions||{};for(n in t)void 0!==t[n]&&((i[n]?e:r=r||{})[n]=t[n]);return r&&S.extend(!0,e,r),e}Bt.href=Tt.href,S.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Tt.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(Tt.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Ht,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":S.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?jt(jt(e,S.ajaxSettings),t):jt(S.ajaxSettings,e)},ajaxPrefilter:Gt(Vt),ajaxTransport:Gt(Ft),ajax:function(e,t){"object"==typeof e&&(t=e,e=void 0);var l,c,u,n,h,d,p,r,i,f=S.ajaxSetup({},t=t||{}),m=f.context||f,g=f.context&&(m.nodeType||m.jquery)?S(m):S.event,v=S.Deferred(),y=S.Callbacks("once memory"),x=f.statusCode||{},s={},a={},o="canceled",b={readyState:0,getResponseHeader:function(e){var t;if(d){if(!n)for(n={};t=Ot.exec(u);)n[t[1].toLowerCase()+" "]=(n[t[1].toLowerCase()+" "]||[]).concat(t[2]);t=n[e.toLowerCase()+" "]}return null==t?null:t.join(", ")},getAllResponseHeaders:function(){return d?u:null},setRequestHeader:function(e,t){return null==d&&(e=a[e.toLowerCase()]=a[e.toLowerCase()]||e,s[e]=t),this},overrideMimeType:function(e){return null==d&&(f.mimeType=e),this},statusCode:function(e){if(e)if(d)b.always(e[b.status]);else for(var t in e)x[t]=[x[t],e[t]];return this},abort:function(e){e=e||o;return l&&l.abort(e),_(0,e),this}};if(v.promise(b),f.url=((e||f.url||Tt.href)+"").replace(Ut,Tt.protocol+"//"),f.type=t.method||t.type||f.method||f.type,f.dataTypes=(f.dataType||"*").toLowerCase().match(k)||[""],null==f.crossDomain){i=M.createElement("a");try{i.href=f.url,i.href=i.href,f.crossDomain=Bt.protocol+"//"+Bt.host!=i.protocol+"//"+i.host}catch(e){f.crossDomain=!0}}if(f.data&&f.processData&&"string"!=typeof f.data&&(f.data=S.param(f.data,f.traditional)),Wt(Vt,f,t,b),d)return b;for(r in(p=S.event&&f.global)&&0==S.active++&&S.event.trigger("ajaxStart"),f.type=f.type.toUpperCase(),f.hasContent=!zt.test(f.type),c=f.url.replace(It,""),f.hasContent?f.data&&f.processData&&0===(f.contentType||"").indexOf("application/x-www-form-urlencoded")&&(f.data=f.data.replace(Nt,"+")):(i=f.url.slice(c.length),f.data&&(f.processData||"string"==typeof f.data)&&(c+=(Lt.test(c)?"&":"?")+f.data,delete f.data),!1===f.cache&&(c=c.replace(kt,"$1"),i=(Lt.test(c)?"&":"?")+"_="+Ct.guid+++i),f.url=c+i),f.ifModified&&(S.lastModified[c]&&b.setRequestHeader("If-Modified-Since",S.lastModified[c]),S.etag[c]&&b.setRequestHeader("If-None-Match",S.etag[c])),(f.data&&f.hasContent&&!1!==f.contentType||t.contentType)&&b.setRequestHeader("Content-Type",f.contentType),b.setRequestHeader("Accept",f.dataTypes[0]&&f.accepts[f.dataTypes[0]]?f.accepts[f.dataTypes[0]]+("*"!==f.dataTypes[0]?", "+Ht+"; q=0.01":""):f.accepts["*"]),f.headers)b.setRequestHeader(r,f.headers[r]);if(f.beforeSend&&(!1===f.beforeSend.call(m,b,f)||d))return b.abort();if(o="abort",y.add(f.complete),b.done(f.success),b.fail(f.error),l=Wt(Ft,f,t,b)){if(b.readyState=1,p&&g.trigger("ajaxSend",[b,f]),d)return b;f.async&&0<f.timeout&&(h=w.setTimeout(function(){b.abort("timeout")},f.timeout));try{d=!1,l.send(s,_)}catch(e){if(d)throw e;_(-1,e)}}else _(-1,"No Transport");function _(e,t,n,r){var i,s,a,o=t;d||(d=!0,h&&w.clearTimeout(h),l=void 0,u=r||"",b.readyState=0<e?4:0,r=200<=e&&e<300||304===e,n&&(a=function(e,t,n){for(var r,i,s,a,o=e.contents,l=e.dataTypes;"*"===l[0];)l.shift(),void 0===r&&(r=e.mimeType||t.getResponseHeader("Content-Type"));if(r)for(i in o)if(o[i]&&o[i].test(r)){l.unshift(i);break}if(l[0]in n)s=l[0];else{for(i in n){if(!l[0]||e.converters[i+" "+l[0]]){s=i;break}a=a||i}s=s||a}if(s)return s!==l[0]&&l.unshift(s),n[s]}(f,b,n)),!r&&-1<S.inArray("script",f.dataTypes)&&S.inArray("json",f.dataTypes)<0&&(f.converters["text script"]=function(){}),a=function(e,t,n,r){var i,s,a,o,l,c={},u=e.dataTypes.slice();if(u[1])for(a in e.converters)c[a.toLowerCase()]=e.converters[a];for(s=u.shift();s;)if(e.responseFields[s]&&(n[e.responseFields[s]]=t),!l&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),l=s,s=u.shift())if("*"===s)s=l;else if("*"!==l&&l!==s){if(!(a=c[l+" "+s]||c["* "+s]))for(i in c)if((o=i.split(" "))[1]===s&&(a=c[l+" "+o[0]]||c["* "+o[0]])){!0===a?a=c[i]:!0!==c[i]&&(s=o[0],u.unshift(o[1]));break}if(!0!==a)if(a&&e.throws)t=a(t);else try{t=a(t)}catch(e){return{state:"parsererror",error:a?e:"No conversion from "+l+" to "+s}}}return{state:"success",data:t}}(f,a,b,r),r?(f.ifModified&&((n=b.getResponseHeader("Last-Modified"))&&(S.lastModified[c]=n),(n=b.getResponseHeader("etag"))&&(S.etag[c]=n)),204===e||"HEAD"===f.type?o="nocontent":304===e?o="notmodified":(o=a.state,i=a.data,r=!(s=a.error))):(s=o,!e&&o||(o="error",e<0&&(e=0))),b.status=e,b.statusText=(t||o)+"",r?v.resolveWith(m,[i,o,b]):v.rejectWith(m,[b,o,s]),b.statusCode(x),x=void 0,p&&g.trigger(r?"ajaxSuccess":"ajaxError",[b,f,r?i:s]),y.fireWith(m,[b,o]),p&&(g.trigger("ajaxComplete",[b,f]),--S.active||S.event.trigger("ajaxStop")))}return b},getJSON:function(e,t,n){return S.get(e,t,n,"json")},getScript:function(e,t){return S.get(e,void 0,t,"script")}}),S.each(["get","post"],function(e,i){S[i]=function(e,t,n,r){return m(t)&&(r=r||n,n=t,t=void 0),S.ajax(S.extend({url:e,type:i,dataType:r,data:t,success:n},S.isPlainObject(e)&&e))}}),S.ajaxPrefilter(function(e){for(var t in e.headers)"content-type"===t.toLowerCase()&&(e.contentType=e.headers[t]||"")}),S._evalUrl=function(e,t,n){return S.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(e){S.globalEval(e,t,n)}})},S.fn.extend({wrapAll:function(e){return this[0]&&(m(e)&&(e=e.call(this[0])),e=S(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&e.insertBefore(this[0]),e.map(function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e}).append(this)),this},wrapInner:function(n){return m(n)?this.each(function(e){S(this).wrapInner(n.call(this,e))}):this.each(function(){var e=S(this),t=e.contents();t.length?t.wrapAll(n):e.append(n)})},wrap:function(t){var n=m(t);return this.each(function(e){S(this).wrapAll(n?t.call(this,e):t)})},unwrap:function(e){return this.parent(e).not("body").each(function(){S(this).replaceWith(this.childNodes)}),this}}),S.expr.pseudos.hidden=function(e){return!S.expr.pseudos.visible(e)},S.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},S.ajaxSettings.xhr=function(){try{return new w.XMLHttpRequest}catch(e){}};var qt={0:200,1223:204},Xt=S.ajaxSettings.xhr();x.cors=!!Xt&&"withCredentials"in Xt,x.ajax=Xt=!!Xt,S.ajaxTransport(function(i){var s,a;if(x.cors||Xt&&!i.crossDomain)return{send:function(e,t){var n,r=i.xhr();if(r.open(i.type,i.url,i.async,i.username,i.password),i.xhrFields)for(n in i.xhrFields)r[n]=i.xhrFields[n];for(n in i.mimeType&&r.overrideMimeType&&r.overrideMimeType(i.mimeType),i.crossDomain||e["X-Requested-With"]||(e["X-Requested-With"]="XMLHttpRequest"),e)r.setRequestHeader(n,e[n]);s=function(e){return function(){s&&(s=a=r.onload=r.onerror=r.onabort=r.ontimeout=r.onreadystatechange=null,"abort"===e?r.abort():"error"===e?"number"!=typeof r.status?t(0,"error"):t(r.status,r.statusText):t(qt[r.status]||r.status,r.statusText,"text"!==(r.responseType||"text")||"string"!=typeof r.responseText?{binary:r.response}:{text:r.responseText},r.getAllResponseHeaders()))}},r.onload=s(),a=r.onerror=r.ontimeout=s("error"),void 0!==r.onabort?r.onabort=a:r.onreadystatechange=function(){4===r.readyState&&w.setTimeout(function(){s&&a()})},s=s("abort");try{r.send(i.hasContent&&i.data||null)}catch(e){if(s)throw e}},abort:function(){s&&s()}}}),S.ajaxPrefilter(function(e){e.crossDomain&&(e.contents.script=!1)}),S.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return S.globalEval(e),e}}}),S.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),S.ajaxTransport("script",function(n){var r,i;if(n.crossDomain||n.scriptAttrs)return{send:function(e,t){r=S("<script>").attr(n.scriptAttrs||{}).prop({charset:n.scriptCharset,src:n.url}).on("load error",i=function(e){r.remove(),i=null,e&&t("error"===e.type?404:200,e.type)}),M.head.appendChild(r[0])},abort:function(){i&&i()}}});var Yt=[],Kt=/(=)\?(?=&|$)|\?\?/;S.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Yt.pop()||S.expando+"_"+Ct.guid++;return this[e]=!0,e}}),S.ajaxPrefilter("json jsonp",function(e,t,n){var r,i,s,a=!1!==e.jsonp&&(Kt.test(e.url)?"url":"string"==typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&Kt.test(e.data)&&"data");if(a||"jsonp"===e.dataTypes[0])return r=e.jsonpCallback=m(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,a?e[a]=e[a].replace(Kt,"$1"+r):!1!==e.jsonp&&(e.url+=(Lt.test(e.url)?"&":"?")+e.jsonp+"="+r),e.converters["script json"]=function(){return s||S.error(r+" was not called"),s[0]},e.dataTypes[0]="json",i=w[r],w[r]=function(){s=arguments},n.always(function(){void 0===i?S(w).removeProp(r):w[r]=i,e[r]&&(e.jsonpCallback=t.jsonpCallback,Yt.push(r)),s&&m(i)&&i(s[0]),s=i=void 0}),"script"}),x.createHTMLDocument=((h=M.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===h.childNodes.length),S.parseHTML=function(e,t,n){return"string"!=typeof e?[]:("boolean"==typeof t&&(n=t,t=!1),t||(x.createHTMLDocument?((r=(t=M.implementation.createHTMLDocument("")).createElement("base")).href=M.location.href,t.head.appendChild(r)):t=M),r=!n&&[],(n=L.exec(e))?[t.createElement(n[1])]:(n=ve([e],t,r),r&&r.length&&S(r).remove(),S.merge([],n.childNodes)));var r},S.fn.load=function(e,t,n){var r,i,s,a=this,o=e.indexOf(" ");return-1<o&&(r=bt(e.slice(o)),e=e.slice(0,o)),m(t)?(n=t,t=void 0):t&&"object"==typeof t&&(i="POST"),0<a.length&&S.ajax({url:e,type:i||"GET",dataType:"html",data:t}).done(function(e){s=arguments,a.html(r?S("<div>").append(S.parseHTML(e)).find(r):e)}).always(n&&function(e,t){a.each(function(){n.apply(this,s||[e.responseText,t,e])})}),this},S.expr.pseudos.animated=function(t){return S.grep(S.timers,function(e){return t===e.elem}).length},S.offset={setOffset:function(e,t,n){var r,i,s,a,o=S.css(e,"position"),l=S(e),c={};"static"===o&&(e.style.position="relative"),s=l.offset(),r=S.css(e,"top"),a=S.css(e,"left"),a=("absolute"===o||"fixed"===o)&&-1<(r+a).indexOf("auto")?(i=(o=l.position()).top,o.left):(i=parseFloat(r)||0,parseFloat(a)||0),null!=(t=m(t)?t.call(e,n,S.extend({},s)):t).top&&(c.top=t.top-s.top+i),null!=t.left&&(c.left=t.left-s.left+a),"using"in t?t.using.call(e,c):l.css(c)}},S.fn.extend({offset:function(t){if(arguments.length)return void 0===t?this:this.each(function(e){S.offset.setOffset(this,t,e)});var e,n=this[0];return n?n.getClientRects().length?(e=n.getBoundingClientRect(),n=n.ownerDocument.defaultView,{top:e.top+n.pageYOffset,left:e.left+n.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var e,t,n,r=this[0],i={top:0,left:0};if("fixed"===S.css(r,"position"))t=r.getBoundingClientRect();else{for(t=this.offset(),n=r.ownerDocument,e=r.offsetParent||n.documentElement;e&&(e===n.body||e===n.documentElement)&&"static"===S.css(e,"position");)e=e.parentNode;e&&e!==r&&1===e.nodeType&&((i=S(e).offset()).top+=S.css(e,"borderTopWidth",!0),i.left+=S.css(e,"borderLeftWidth",!0))}return{top:t.top-i.top-S.css(r,"marginTop",!0),left:t.left-i.left-S.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent;e&&"static"===S.css(e,"position");)e=e.offsetParent;return e||re})}}),S.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,i){var s="pageYOffset"===i;S.fn[t]=function(e){return B(this,function(e,t,n){var r;return g(e)?r=e:9===e.nodeType&&(r=e.defaultView),void 0===n?r?r[i]:e[t]:void(r?r.scrollTo(s?r.pageXOffset:n,s?n:r.pageYOffset):e[t]=n)},t,e,arguments.length)}}),S.each(["top","left"],function(e,n){S.cssHooks[n]=Ye(x.pixelPosition,function(e,t){if(t)return t=Xe(e,n),Ge.test(t)?S(e).position()[n]+"px":t})}),S.each({Height:"height",Width:"width"},function(a,o){S.each({padding:"inner"+a,content:o,"":"outer"+a},function(r,s){S.fn[s]=function(e,t){var n=arguments.length&&(r||"boolean"!=typeof e),i=r||(!0===e||!0===t?"margin":"border");return B(this,function(e,t,n){var r;return g(e)?0===s.indexOf("outer")?e["inner"+a]:e.document.documentElement["client"+a]:9===e.nodeType?(r=e.documentElement,Math.max(e.body["scroll"+a],r["scroll"+a],e.body["offset"+a],r["offset"+a],r["client"+a])):void 0===n?S.css(e,t,i):S.style(e,t,n,i)},o,n?e:void 0,n)}})}),S.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){S.fn[t]=function(e){return this.on(t,e)}}),S.fn.extend({bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),S.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(e,n){S.fn[n]=function(e,t){return 0<arguments.length?this.on(n,null,e,t):this.trigger(n)}});var Jt=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;S.proxy=function(e,t){var n,r;if("string"==typeof t&&(r=e[t],t=e,e=r),m(e))return n=o.call(arguments,2),(r=function(){return e.apply(t||this,n.concat(o.call(arguments)))}).guid=e.guid=e.guid||S.guid++,r},S.holdReady=function(e){e?S.readyWait++:S.ready(!0)},S.isArray=Array.isArray,S.parseJSON=JSON.parse,S.nodeName=C,S.isFunction=m,S.isWindow=g,S.camelCase=q,S.type=f,S.now=Date.now,S.isNumeric=function(e){var t=S.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},S.trim=function(e){return null==e?"":(e+"").replace(Jt,"")},void 0===(tn=function(){return S}.apply(en,[]))||(Qt.exports=tn);var Zt=w.jQuery,$t=w.$;return S.noConflict=function(e){return w.$===S&&(w.$=$t),e&&w.jQuery===S&&(w.jQuery=Zt),S},void 0===e&&(w.jQuery=w.$=S),S})},466:function(e){var u;e.exports=((u=function(){function e(e){return r.appendChild(e.dom),e}function t(e){for(var t=0;t<r.children.length;t++)r.children[t].style.display=t===e?"block":"none";n=e}var n=0,r=document.createElement("div");r.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",r.addEventListener("click",function(e){e.preventDefault(),t(++n%r.children.length)},!1);var i,s=(performance||Date).now(),a=s,o=0,l=e(new u.Panel("FPS","#0ff","#002")),c=e(new u.Panel("MS","#0f0","#020"));return self.performance&&self.performance.memory&&(i=e(new u.Panel("MB","#f08","#201"))),t(0),{REVISION:16,dom:r,addPanel:e,showPanel:t,begin:function(){s=(performance||Date).now()},end:function(){o++;var e,t=(performance||Date).now();return c.update(t-s,200),a+1e3<t&&(l.update(1e3*o/(t-a),100),a=t,o=0,i)&&(e=performance.memory,i.update(e.usedJSHeapSize/1048576,e.jsHeapSizeLimit/1048576)),t},update:function(){s=this.end()},domElement:r,setMode:t}}).Panel=function(n,r,i){var s=1/0,a=0,o=Math.round,l=o(window.devicePixelRatio||1),c=80*l,e=48*l,u=3*l,h=2*l,d=3*l,p=15*l,f=74*l,m=30*l,g=document.createElement("canvas");g.width=c,g.height=e,g.style.cssText="width:80px;height:48px";var v=g.getContext("2d");return v.font="bold "+9*l+"px Helvetica,Arial,sans-serif",v.textBaseline="top",v.fillStyle=i,v.fillRect(0,0,c,e),v.fillStyle=r,v.fillText(n,u,h),v.fillRect(d,p,f,m),v.fillStyle=i,v.globalAlpha=.9,v.fillRect(d,p,f,m),{dom:g,update:function(e,t){s=Math.min(s,e),a=Math.max(a,e),v.fillStyle=i,v.globalAlpha=1,v.fillRect(0,0,c,p),v.fillStyle=r,v.fillText(o(e)+" "+n+" ("+o(s)+"-"+o(a)+")",u,h),v.drawImage(g,d+l,p,f-l,m,d,p,f-l,m),v.fillRect(d+f-l,p,l,m),v.fillStyle=i,v.globalAlpha=.9,v.fillRect(d+f-l,p,l,o((1-e/t)*m))}}},u)},498:function(e,t){
/*! Tweakpane 3.0.5 (c) 2016 cocopon, licensed under the MIT license. */
!function(e){"use strict";class t{constructor(e){const[t,n]=e.split("-");const r=t.split(".");this.major=parseInt(r[0],10);this.minor=parseInt(r[1],10);this.patch=parseInt(r[2],10);this.prerelease=n!==null&&n!==void 0?n:null}toString(){const e=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[e,this.prerelease].join("-"):e}}class n{constructor(e){this.controller_=e}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(e){this.controller_.viewProps.set("disabled",e)}get hidden(){return this.controller_.viewProps.get("hidden")}set hidden(e){this.controller_.viewProps.set("hidden",e)}dispose(){this.controller_.viewProps.set("disposed",true)}}class i{constructor(e){this.target=e}}class s extends i{constructor(e,t,n,r){super(e);this.value=t;this.presetKey=n;this.last=r!==null&&r!==void 0?r:true}}class r extends i{constructor(e,t,n){super(e);this.value=t;this.presetKey=n}}class a extends i{constructor(e,t){super(e);this.expanded=t}}function o(e){return e}function g(e){return e===null||e===undefined}function l(t,n){if(t.length!==n.length)return false;for(let e=0;e<t.length;e++)if(t[e]!==n[e])return false;return true}const c={alreadydisposed:()=>"View has been already disposed",invalidparams:e=>`Invalid parameters for '${e.name}'`,nomatchingcontroller:e=>`No matching controller for '${e.key}'`,nomatchingview:e=>`No matching view for '${JSON.stringify(e.params)}'`,notbindable:()=>`Value is not bindable`,propertynotfound:e=>`Property '${e.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class u{constructor(e){var t;this.message=(t=c[e.type](o(e.context)))!==null&&t!==void 0?t:"Unexpected error";this.name=this.constructor.name;this.stack=new Error(this.message).stack;this.type=e.type}static alreadyDisposed(){return new u({type:"alreadydisposed"})}static notBindable(){return new u({type:"notbindable"})}static propertyNotFound(e){return new u({type:"propertynotfound",context:{name:e}})}static shouldNeverHappen(){return new u({type:"shouldneverhappen"})}}class h{constructor(e,t,n){this.obj_=e;this.key_=t;this.presetKey_=n!==null&&n!==void 0?n:t}static isBindable(e){if(e===null)return false;if(typeof e!=="object")return false;return true}get key(){return this.key_}get presetKey(){return this.presetKey_}read(){return this.obj_[this.key_]}write(e){this.obj_[this.key_]=e}writeProperty(e,t){const n=this.read();if(!h.isBindable(n))throw u.notBindable();if(!(e in n))throw u.propertyNotFound(e);n[e]=t}}class d extends n{get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}get title(){var e;return(e=this.controller_.valueController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller_.valueController.props.set("title",e)}on(e,t){const n=t.bind(this);const r=this.controller_.valueController.emitter;r.on(e,()=>{n(new i(this))});return this}}class p{constructor(){this.observers_={}}on(e,t){let n=this.observers_[e];if(!n)n=this.observers_[e]=[];n.push({handler:t});return this}off(e,t){const n=this.observers_[e];if(n)this.observers_[e]=n.filter(e=>{return e.handler!==t});return this}emit(e,t){const n=this.observers_[e];if(!n)return;n.forEach(e=>{e.handler(t)})}}const f="tp";function m(n){const e=(e,t)=>{return[f,"-",n,"v",e?`_${e}`:"",t?`-${t}`:""].join("")};return e}function v(t,n){return e=>n(t(e))}function y(e){return e.rawValue}function x(e,t){e.emitter.on("change",v(y,t));t(e.rawValue)}function b(e,t,n){x(e.value(t),n)}function _(e,t,n){if(n)e.classList.add(t);else e.classList.remove(t)}function w(t,n){return e=>{_(t,n,e)}}function M(e,t){x(e,e=>{t.textContent=e!==null&&e!==void 0?e:""})}const S=m("btn");class E{constructor(e,t){this.element=e.createElement("div");this.element.classList.add(S());t.viewProps.bindClassModifiers(this.element);const n=e.createElement("button");n.classList.add(S("b"));t.viewProps.bindDisabled(n);this.element.appendChild(n);this.buttonElement=n;const r=e.createElement("div");r.classList.add(S("t"));M(t.props.value("title"),r);this.buttonElement.appendChild(r)}}class T{constructor(e,t){this.emitter=new p;this.onClick_=this.onClick_.bind(this);this.props=t.props;this.viewProps=t.viewProps;this.view=new E(e,{props:this.props,viewProps:this.viewProps});this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class C{constructor(e,t){var n;this.constraint_=t===null||t===void 0?void 0:t.constraint;this.equals_=(n=t===null||t===void 0?void 0:t.equals)!==null&&n!==void 0?n:(e,t)=>e===t;this.emitter=new p;this.rawValue_=e}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(e){this.setRawValue(e,{forceEmit:false,last:true})}setRawValue(e,t){const n=t!==null&&t!==void 0?t:{forceEmit:false,last:true};const r=this.constraint_?this.constraint_.constrain(e):e;const i=!this.equals_(this.rawValue_,r);if(!i&&!n.forceEmit)return;this.emitter.emit("beforechange",{sender:this});this.rawValue_=r;this.emitter.emit("change",{options:n,rawValue:r,sender:this})}}class L{constructor(e){this.emitter=new p;this.value_=e}get rawValue(){return this.value_}set rawValue(e){this.setRawValue(e,{forceEmit:false,last:true})}setRawValue(e,t){const n=t!==null&&t!==void 0?t:{forceEmit:false,last:true};if(this.value_===e&&!n.forceEmit)return;this.emitter.emit("beforechange",{sender:this});this.value_=e;this.emitter.emit("change",{options:n,rawValue:this.value_,sender:this})}}function A(e,t){const n=t===null||t===void 0?void 0:t.constraint;const r=t===null||t===void 0?void 0:t.equals;if(!n&&!r)return new L(e);return new C(e,t)}class P{constructor(e){this.emitter=new p;this.valMap_=e;for(const t in this.valMap_){const n=this.valMap_[t];n.emitter.on("change",()=>{this.emitter.emit("change",{key:t,sender:this})})}}static createCore(n){const e=Object.keys(n);return e.reduce((e,t)=>{return Object.assign(e,{[t]:A(n[t])})},{})}static fromObject(e){const t=this.createCore(e);return new P(t)}get(e){return this.valMap_[e].rawValue}set(e,t){this.valMap_[e].rawValue=t}value(e){return this.valMap_[e]}}function R(i,s){const e=Object.keys(s);const t=e.reduce((e,t)=>{if(e===undefined)return undefined;const n=s[t];const r=n(i[t]);return r.succeeded?Object.assign(Object.assign({},e),{[t]:r.value}):undefined},{});return o(t)}function D(e,r){return e.reduce((e,t)=>{if(e===undefined)return undefined;const n=r(t);if(!n.succeeded||n.value===undefined)return undefined;return[...e,n.value]},[])}function N(e){if(e===null)return false;return typeof e==="object"}function I(r){return n=>e=>{if(!n&&e===undefined)return{succeeded:false,value:undefined};if(n&&e===undefined)return{succeeded:true,value:undefined};const t=r(e);return t!==undefined?{succeeded:true,value:t}:{succeeded:false,value:undefined}}}function k(n){return{custom:e=>I(e)(n),boolean:I(e=>typeof e==="boolean"?e:undefined)(n),number:I(e=>typeof e==="number"?e:undefined)(n),string:I(e=>typeof e==="string"?e:undefined)(n),function:I(e=>typeof e==="function"?e:undefined)(n),constant:t=>I(e=>e===t?t:undefined)(n),raw:I(e=>e)(n),object:t=>I(e=>{if(!N(e))return undefined;return R(e,t)})(n),array:t=>I(e=>{if(!Array.isArray(e))return undefined;return D(e,t)})(n)}}const O={optional:k(true),required:k(false)};function z(e,t){const n=O.required.object(t)(e);return n.succeeded?n.value:undefined}function U(e){if(e&&e.parentElement)e.parentElement.removeChild(e);return null}function V(){return["veryfirst","first","last","verylast"]}const F=m(""),H={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class B{constructor(e){this.parent_=null;this.blade=e.blade;this.view=e.view;this.viewProps=e.viewProps;const t=this.view.element;this.blade.value("positions").emitter.on("change",()=>{V().forEach(e=>{t.classList.remove(F(undefined,H[e]))});this.blade.get("positions").forEach(e=>{t.classList.add(F(undefined,H[e]))})});this.viewProps.handleDispose(()=>{U(t)})}get parent(){return this.parent_}}const G="http://www.w3.org/2000/svg";function W(e){e.offsetHeight}function j(e,t){const n=e.style.transition;e.style.transition="none";t();e.style.transition=n}function q(e){return e.ontouchstart!==undefined}function X(){return new Function("return this")()}function Y(){const e=o(X());return e.document}function K(){return"document"in X()}function J(e){return K()?e.getContext("2d"):null}const Z={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function $(e,t){const n=e.createElementNS(G,"svg");n.innerHTML=Z[t];return n}function Q(e,t,n){e.insertBefore(t,e.children[n])}function ee(e){if(e.parentElement)e.parentElement.removeChild(e)}function te(e){while(e.children.length>0)e.removeChild(e.children[0])}function ne(e){while(e.childNodes.length>0)e.removeChild(e.childNodes[0])}function re(e){if(e.relatedTarget)return o(e.relatedTarget);if("explicitOriginalTarget"in e)return e.explicitOriginalTarget;return null}const ie=m("lbl");function se(n,e){const r=n.createDocumentFragment();const t=e.split("\n").map(e=>{return n.createTextNode(e)});t.forEach((e,t)=>{if(t>0)r.appendChild(n.createElement("br"));r.appendChild(e)});return r}class ae{constructor(t,e){this.element=t.createElement("div");this.element.classList.add(ie());e.viewProps.bindClassModifiers(this.element);const n=t.createElement("div");n.classList.add(ie("l"));b(e.props,"label",e=>{if(g(e))this.element.classList.add(ie(undefined,"nol"));else{this.element.classList.remove(ie(undefined,"nol"));ne(n);n.appendChild(se(t,e))}});this.element.appendChild(n);this.labelElement=n;const r=t.createElement("div");r.classList.add(ie("v"));this.element.appendChild(r);this.valueElement=r}}class oe extends B{constructor(e,t){const n=t.valueController.viewProps;super(Object.assign(Object.assign({},t),{view:new ae(e,{props:t.props,viewProps:n}),viewProps:n}));this.props=t.props;this.valueController=t.valueController;this.view.valueElement.appendChild(this.valueController.view.element)}}const le={id:"button",type:"blade",accept(e){const t=O;const n=z(e,{title:t.required.string,view:t.required.constant("button"),label:t.optional.string});return n?{params:n}:null},controller(e){return new oe(e.document,{blade:e.blade,props:P.fromObject({label:e.params.label}),valueController:new T(e.document,{props:P.fromObject({title:e.params.title}),viewProps:e.viewProps})})},api(e){if(!(e.controller instanceof oe))return null;if(!(e.controller.valueController instanceof T))return null;return new d(e.controller)}};class ce extends B{constructor(e){super(e);this.value=e.value}}function ue(){return new P({positions:A([],{equals:l})})}class he extends P{constructor(e){super(e)}static create(e){const t={completed:true,expanded:e,expandedHeight:null,shouldFixHeight:false,temporaryExpanded:null};const n=P.createCore(t);return new he(n)}get styleExpanded(){var e;return(e=this.get("temporaryExpanded"))!==null&&e!==void 0?e:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const e=this.get("expandedHeight");if(this.get("shouldFixHeight")&&!g(e))return`${e}px`;return"auto"}bindExpandedClass(t,n){b(this,"expanded",()=>{const e=this.styleExpanded;if(e)t.classList.add(n);else t.classList.remove(n)})}}function de(e,t){let n=0;j(t,()=>{e.set("expandedHeight",null);e.set("temporaryExpanded",true);W(t);n=t.clientHeight;e.set("temporaryExpanded",null);W(t)});return n}function pe(e,t){t.style.height=e.styleHeight}function fe(t,e){t.value("expanded").emitter.on("beforechange",()=>{t.set("completed",false);if(g(t.get("expandedHeight")))t.set("expandedHeight",de(t,e));t.set("shouldFixHeight",true);W(e)});t.emitter.on("change",()=>{pe(t,e)});pe(t,e);e.addEventListener("transitionend",e=>{if(e.propertyName!=="height")return;t.set("shouldFixHeight",false);t.set("expandedHeight",null);t.set("completed",true)})}class me extends n{constructor(e,t){super(e);this.rackApi_=t}}function ge(e,t){return e.addBlade(Object.assign(Object.assign({},t),{view:"button"}))}function ve(e,t){return e.addBlade(Object.assign(Object.assign({},t),{view:"folder"}))}function ye(e,t){const n=t||{};return e.addBlade(Object.assign(Object.assign({},n),{view:"separator"}))}function xe(e,t){return e.addBlade(Object.assign(Object.assign({},t),{view:"tab"}))}class be{constructor(e){this.emitter=new p;this.items_=[];this.cache_=new Set;this.onSubListAdd_=this.onSubListAdd_.bind(this);this.onSubListRemove_=this.onSubListRemove_.bind(this);this.extract_=e}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(e){for(const t of this.allItems())if(e(t))return t;return null}includes(e){return this.cache_.has(e)}add(e,t){if(this.includes(e))throw u.shouldNeverHappen();const n=t!==undefined?t:this.items_.length;this.items_.splice(n,0,e);this.cache_.add(e);const r=this.extract_(e);if(r){r.emitter.on("add",this.onSubListAdd_);r.emitter.on("remove",this.onSubListRemove_);r.allItems().forEach(e=>{this.cache_.add(e)})}this.emitter.emit("add",{index:n,item:e,root:this,target:this})}remove(e){const t=this.items_.indexOf(e);if(t<0)return;this.items_.splice(t,1);this.cache_.delete(e);const n=this.extract_(e);if(n){n.emitter.off("add",this.onSubListAdd_);n.emitter.off("remove",this.onSubListRemove_)}this.emitter.emit("remove",{index:t,item:e,root:this,target:this})}onSubListAdd_(e){this.cache_.add(e.item);this.emitter.emit("add",{index:e.index,item:e.item,root:this,target:e.target})}onSubListRemove_(e){this.cache_.delete(e.item);this.emitter.emit("remove",{index:e.index,item:e.item,root:this,target:e.target})}}class _e extends n{constructor(e){super(e);this.onBindingChange_=this.onBindingChange_.bind(this);this.emitter_=new p;this.controller_.binding.emitter.on("change",this.onBindingChange_)}get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}on(e,t){const n=t.bind(this);this.emitter_.on(e,e=>{n(e.event)});return this}refresh(){this.controller_.binding.read()}onBindingChange_(e){const t=e.sender.target.read();this.emitter_.emit("change",{event:new s(this,o(t),this.controller_.binding.target.presetKey,e.options.last)})}}class we extends oe{constructor(e,t){super(e,t);this.binding=t.binding}}class Me extends n{constructor(e){super(e);this.onBindingUpdate_=this.onBindingUpdate_.bind(this);this.emitter_=new p;this.controller_.binding.emitter.on("update",this.onBindingUpdate_)}get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}on(e,t){const n=t.bind(this);this.emitter_.on(e,e=>{n(e.event)});return this}refresh(){this.controller_.binding.read()}onBindingUpdate_(e){const t=e.sender.target.read();this.emitter_.emit("update",{event:new r(this,o(t),this.controller_.binding.target.presetKey)})}}class Se extends oe{constructor(e,t){super(e,t);this.binding=t.binding;this.viewProps.bindDisabled(this.binding.ticker);this.viewProps.handleDispose(()=>{this.binding.dispose()})}}function Ee(e){if(e instanceof Le)return e["apiSet_"];if(e instanceof me)return e["rackApi_"]["apiSet_"];return null}function Te(e,t){const n=e.find(e=>e.controller_===t);if(!n)throw u.shouldNeverHappen();return n}function Ce(e,t,n){if(!h.isBindable(e))throw u.notBindable();return new h(e,t,n)}class Le extends n{constructor(e,t){super(e);this.onRackAdd_=this.onRackAdd_.bind(this);this.onRackRemove_=this.onRackRemove_.bind(this);this.onRackInputChange_=this.onRackInputChange_.bind(this);this.onRackMonitorUpdate_=this.onRackMonitorUpdate_.bind(this);this.emitter_=new p;this.apiSet_=new be(Ee);this.pool_=t;const n=this.controller_.rack;n.emitter.on("add",this.onRackAdd_);n.emitter.on("remove",this.onRackRemove_);n.emitter.on("inputchange",this.onRackInputChange_);n.emitter.on("monitorupdate",this.onRackMonitorUpdate_);n.children.forEach(e=>{this.setUpApi_(e)})}get children(){return this.controller_.rack.children.map(e=>Te(this.apiSet_,e))}addInput(e,t,n){const r=n||{};const i=this.controller_.view.element.ownerDocument;const s=this.pool_.createInput(i,Ce(e,t,r.presetKey),r);const a=new _e(s);return this.add(a,r.index)}addMonitor(e,t,n){const r=n||{};const i=this.controller_.view.element.ownerDocument;const s=this.pool_.createMonitor(i,Ce(e,t),r);const a=new Me(s);return o(this.add(a,r.index))}addFolder(e){return ve(this,e)}addButton(e){return ge(this,e)}addSeparator(e){return ye(this,e)}addTab(e){return xe(this,e)}add(t,e){this.controller_.rack.add(t.controller_,e);const n=this.apiSet_.find(e=>e.controller_===t.controller_);if(n)this.apiSet_.remove(n);this.apiSet_.add(t);return t}remove(e){this.controller_.rack.remove(e.controller_)}addBlade(e){const t=this.controller_.view.element.ownerDocument;const n=this.pool_.createBlade(t,e);const r=this.pool_.createBladeApi(n);return this.add(r,e.index)}on(e,t){const n=t.bind(this);this.emitter_.on(e,e=>{n(e.event)});return this}setUpApi_(t){const e=this.apiSet_.find(e=>e.controller_===t);if(!e)this.apiSet_.add(this.pool_.createBladeApi(t))}onRackAdd_(e){this.setUpApi_(e.bladeController)}onRackRemove_(e){if(e.isRoot){const t=Te(this.apiSet_,e.bladeController);this.apiSet_.remove(t)}}onRackInputChange_(e){const t=e.bladeController;if(t instanceof we){const n=Te(this.apiSet_,t);const r=t.binding;this.emitter_.emit("change",{event:new s(n,o(r.target.read()),r.target.presetKey,e.options.last)})}else if(t instanceof ce){const i=Te(this.apiSet_,t);this.emitter_.emit("change",{event:new s(i,t.value.rawValue,undefined,e.options.last)})}}onRackMonitorUpdate_(e){if(!(e.bladeController instanceof Se))throw u.shouldNeverHappen();const t=Te(this.apiSet_,e.bladeController);const n=e.bladeController.binding;this.emitter_.emit("update",{event:new r(t,o(n.target.read()),n.target.presetKey)})}}class Ae extends me{constructor(e,t){super(e,new Le(e.rackController,t));this.emitter_=new p;this.controller_.foldable.value("expanded").emitter.on("change",e=>{this.emitter_.emit("fold",{event:new a(this,e.sender.rawValue)})});this.rackApi_.on("change",e=>{this.emitter_.emit("change",{event:e})});this.rackApi_.on("update",e=>{this.emitter_.emit("update",{event:e})})}get expanded(){return this.controller_.foldable.get("expanded")}set expanded(e){this.controller_.foldable.set("expanded",e)}get title(){return this.controller_.props.get("title")}set title(e){this.controller_.props.set("title",e)}get children(){return this.rackApi_.children}addInput(e,t,n){return this.rackApi_.addInput(e,t,n)}addMonitor(e,t,n){return this.rackApi_.addMonitor(e,t,n)}addFolder(e){return this.rackApi_.addFolder(e)}addButton(e){return this.rackApi_.addButton(e)}addSeparator(e){return this.rackApi_.addSeparator(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){return this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBlade(e){return this.rackApi_.addBlade(e)}on(e,t){const n=t.bind(this);this.emitter_.on(e,e=>{n(e.event)});return this}}class Pe extends B{constructor(e){super({blade:e.blade,view:e.view,viewProps:e.rackController.viewProps});this.rackController=e.rackController}}class Re{constructor(e,t){const n=m(t.viewName);this.element=e.createElement("div");this.element.classList.add(n());t.viewProps.bindClassModifiers(this.element)}}function De(t,n){for(let e=0;e<t.length;e++){const r=t[e];if(r instanceof we&&r.binding===n)return r}return null}function Ne(t,n){for(let e=0;e<t.length;e++){const r=t[e];if(r instanceof Se&&r.binding===n)return r}return null}function Ie(t,n){for(let e=0;e<t.length;e++){const r=t[e];if(r instanceof ce&&r.value===n)return r}return null}function ke(e){if(e instanceof Ue)return e.rack;if(e instanceof Pe)return e.rackController.rack;return null}function Oe(e){const t=ke(e);return t?t["bcSet_"]:null}class ze{constructor(e){var t;this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this);this.onSetAdd_=this.onSetAdd_.bind(this);this.onSetRemove_=this.onSetRemove_.bind(this);this.onChildDispose_=this.onChildDispose_.bind(this);this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this);this.onChildInputChange_=this.onChildInputChange_.bind(this);this.onChildMonitorUpdate_=this.onChildMonitorUpdate_.bind(this);this.onChildValueChange_=this.onChildValueChange_.bind(this);this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this);this.onDescendantLayout_=this.onDescendantLayout_.bind(this);this.onDescendantInputChange_=this.onDescendantInputChange_.bind(this);this.onDescendantMonitorUpdate_=this.onDescendantMonitorUpdate_.bind(this);this.emitter=new p;this.blade_=e!==null&&e!==void 0?e:null;(t=this.blade_)===null||t===void 0?void 0:t.value("positions").emitter.on("change",this.onBladePositionsChange_);this.bcSet_=new be(Oe);this.bcSet_.emitter.on("add",this.onSetAdd_);this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(e,t){if(e.parent)e.parent.remove(e);e["parent_"]=this;this.bcSet_.add(e,t)}remove(e){e["parent_"]=null;this.bcSet_.remove(e)}find(t){return o(this.bcSet_.allItems().filter(e=>{return e instanceof t}))}onSetAdd_(e){this.updatePositions_();const t=e.target===e.root;this.emitter.emit("add",{bladeController:e.item,index:e.index,isRoot:t,sender:this});if(!t)return;const n=e.item;n.viewProps.emitter.on("change",this.onChildViewPropsChange_);n.blade.value("positions").emitter.on("change",this.onChildPositionsChange_);n.viewProps.handleDispose(this.onChildDispose_);if(n instanceof we)n.binding.emitter.on("change",this.onChildInputChange_);else if(n instanceof Se)n.binding.emitter.on("update",this.onChildMonitorUpdate_);else if(n instanceof ce)n.value.emitter.on("change",this.onChildValueChange_);else{const r=ke(n);if(r){const i=r.emitter;i.on("layout",this.onDescendantLayout_);i.on("inputchange",this.onDescendantInputChange_);i.on("monitorupdate",this.onDescendantMonitorUpdate_)}}}onSetRemove_(e){this.updatePositions_();const t=e.target===e.root;this.emitter.emit("remove",{bladeController:e.item,isRoot:t,sender:this});if(!t)return;const n=e.item;if(n instanceof we)n.binding.emitter.off("change",this.onChildInputChange_);else if(n instanceof Se)n.binding.emitter.off("update",this.onChildMonitorUpdate_);else if(n instanceof ce)n.value.emitter.off("change",this.onChildValueChange_);else{const r=ke(n);if(r){const i=r.emitter;i.off("layout",this.onDescendantLayout_);i.off("inputchange",this.onDescendantInputChange_);i.off("monitorupdate",this.onDescendantMonitorUpdate_)}}}updatePositions_(){const e=this.bcSet_.items.filter(e=>!e.viewProps.get("hidden"));const n=e[0];const r=e[e.length-1];this.bcSet_.items.forEach(e=>{const t=[];if(e===n){t.push("first");if(!this.blade_||this.blade_.get("positions").includes("veryfirst"))t.push("veryfirst")}if(e===r){t.push("last");if(!this.blade_||this.blade_.get("positions").includes("verylast"))t.push("verylast")}e.blade.set("positions",t)})}onChildPositionsChange_(){this.updatePositions_();this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(e){this.updatePositions_();this.emitter.emit("layout",{sender:this})}onChildDispose_(){const e=this.bcSet_.items.filter(e=>{return e.viewProps.get("disposed")});e.forEach(e=>{this.bcSet_.remove(e)})}onChildInputChange_(e){const t=De(this.find(we),e.sender);if(!t)throw u.shouldNeverHappen();this.emitter.emit("inputchange",{bladeController:t,options:e.options,sender:this})}onChildMonitorUpdate_(e){const t=Ne(this.find(Se),e.sender);if(!t)throw u.shouldNeverHappen();this.emitter.emit("monitorupdate",{bladeController:t,sender:this})}onChildValueChange_(e){const t=Ie(this.find(ce),e.sender);if(!t)throw u.shouldNeverHappen();this.emitter.emit("inputchange",{bladeController:t,options:e.options,sender:this})}onDescendantLayout_(e){this.updatePositions_();this.emitter.emit("layout",{sender:this})}onDescendantInputChange_(e){this.emitter.emit("inputchange",{bladeController:e.bladeController,options:e.options,sender:this})}onDescendantMonitorUpdate_(e){this.emitter.emit("monitorupdate",{bladeController:e.bladeController,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class Ue extends B{constructor(e,t){super(Object.assign(Object.assign({},t),{view:new Re(e,{viewName:"brk",viewProps:t.viewProps})}));this.onRackAdd_=this.onRackAdd_.bind(this);this.onRackRemove_=this.onRackRemove_.bind(this);const n=new ze(t.root?undefined:t.blade);n.emitter.on("add",this.onRackAdd_);n.emitter.on("remove",this.onRackRemove_);this.rack=n;this.viewProps.handleDispose(()=>{for(let e=this.rack.children.length-1;e>=0;e--){const t=this.rack.children[e];t.viewProps.set("disposed",true)}})}onRackAdd_(e){if(!e.isRoot)return;Q(this.view.element,e.bladeController.view.element,e.index)}onRackRemove_(e){if(!e.isRoot)return;ee(e.bladeController.view.element)}}const Ve=m("cnt");class Fe{constructor(e,t){this.className_=m(t.viewName||"fld");this.element=e.createElement("div");this.element.classList.add(this.className_(),Ve());t.viewProps.bindClassModifiers(this.element);this.foldable_=t.foldable;this.foldable_.bindExpandedClass(this.element,this.className_(undefined,"expanded"));b(this.foldable_,"completed",w(this.element,this.className_(undefined,"cpl")));const n=e.createElement("button");n.classList.add(this.className_("b"));b(t.props,"title",e=>{if(g(e))this.element.classList.add(this.className_(undefined,"not"));else this.element.classList.remove(this.className_(undefined,"not"))});t.viewProps.bindDisabled(n);this.element.appendChild(n);this.buttonElement=n;const r=e.createElement("div");r.classList.add(this.className_("t"));M(t.props.value("title"),r);this.buttonElement.appendChild(r);this.titleElement=r;const i=e.createElement("div");i.classList.add(this.className_("m"));this.buttonElement.appendChild(i);const s=t.containerElement;s.classList.add(this.className_("c"));this.element.appendChild(s);this.containerElement=s}}class He extends Pe{constructor(e,t){var n;const r=he.create((n=t.expanded)!==null&&n!==void 0?n:true);const i=new Ue(e,{blade:t.blade,root:t.root,viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:i,view:new Fe(e,{containerElement:i.view.element,foldable:r,props:t.props,viewName:t.root?"rot":undefined,viewProps:t.viewProps})}));this.onTitleClick_=this.onTitleClick_.bind(this);this.props=t.props;this.foldable=r;fe(this.foldable,this.view.containerElement);this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}const Be={id:"folder",type:"blade",accept(e){const t=O;const n=z(e,{title:t.required.string,view:t.required.constant("folder"),expanded:t.optional.boolean});return n?{params:n}:null},controller(e){return new He(e.document,{blade:e.blade,expanded:e.params.expanded,props:P.fromObject({title:e.params.title}),viewProps:e.viewProps})},api(e){if(!(e.controller instanceof He))return null;return new Ae(e.controller,e.pool)}};class Ge extends ce{constructor(e,t){const n=t.valueController.viewProps;super(Object.assign(Object.assign({},t),{value:t.valueController.value,view:new ae(e,{props:t.props,viewProps:n}),viewProps:n}));this.props=t.props;this.valueController=t.valueController;this.view.valueElement.appendChild(this.valueController.view.element)}}class We extends n{}const je=m("spr");class qe{constructor(e,t){this.element=e.createElement("div");this.element.classList.add(je());t.viewProps.bindClassModifiers(this.element);const n=e.createElement("hr");n.classList.add(je("r"));this.element.appendChild(n)}}class Xe extends B{constructor(e,t){super(Object.assign(Object.assign({},t),{view:new qe(e,{viewProps:t.viewProps})}))}}const Ye={id:"separator",type:"blade",accept(e){const t=O;const n=z(e,{view:t.required.constant("separator")});return n?{params:n}:null},controller(e){return new Xe(e.document,{blade:e.blade,viewProps:e.viewProps})},api(e){if(!(e.controller instanceof Xe))return null;return new We(e.controller)}},Ke=m("");function Je(e,t){return w(e,Ke(undefined,t))}class Ze extends P{constructor(e){super(e)}static create(e){var t,n;const r=e!==null&&e!==void 0?e:{};const i={disabled:(t=r.disabled)!==null&&t!==void 0?t:false,disposed:false,hidden:(n=r.hidden)!==null&&n!==void 0?n:false};const s=P.createCore(i);return new Ze(s)}bindClassModifiers(e){b(this,"disabled",Je(e,"disabled"));b(this,"hidden",Je(e,"hidden"))}bindDisabled(t){b(this,"disabled",e=>{t.disabled=e})}bindTabIndex(t){b(this,"disabled",e=>{t.tabIndex=e?-1:0})}handleDispose(t){this.value("disposed").emitter.on("change",e=>{if(e)t()})}}const $e=m("tbi");class Qe{constructor(e,t){this.element=e.createElement("div");this.element.classList.add($e());t.viewProps.bindClassModifiers(this.element);b(t.props,"selected",e=>{if(e)this.element.classList.add($e(undefined,"sel"));else this.element.classList.remove($e(undefined,"sel"))});const n=e.createElement("button");n.classList.add($e("b"));t.viewProps.bindDisabled(n);this.element.appendChild(n);this.buttonElement=n;const r=e.createElement("div");r.classList.add($e("t"));M(t.props.value("title"),r);this.buttonElement.appendChild(r);this.titleElement=r}}class et{constructor(e,t){this.emitter=new p;this.onClick_=this.onClick_.bind(this);this.props=t.props;this.viewProps=t.viewProps;this.view=new Qe(e,{props:t.props,viewProps:t.viewProps});this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class tt{constructor(e,t){this.onItemClick_=this.onItemClick_.bind(this);this.ic_=new et(e,{props:t.itemProps,viewProps:Ze.create()});this.ic_.emitter.on("click",this.onItemClick_);this.cc_=new Ue(e,{blade:ue(),viewProps:Ze.create()});this.props=t.props;b(this.props,"selected",e=>{this.itemController.props.set("selected",e);this.contentController.viewProps.set("hidden",!e)})}get itemController(){return this.ic_}get contentController(){return this.cc_}onItemClick_(){this.props.set("selected",true)}}class nt{constructor(e,t){this.controller_=e;this.rackApi_=t}get title(){var e;return(e=this.controller_.itemController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller_.itemController.props.set("title",e)}get selected(){return this.controller_.props.get("selected")}set selected(e){this.controller_.props.set("selected",e)}get children(){return this.rackApi_.children}addButton(e){return this.rackApi_.addButton(e)}addFolder(e){return this.rackApi_.addFolder(e)}addSeparator(e){return this.rackApi_.addSeparator(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addInput(e,t,n){return this.rackApi_.addInput(e,t,n)}addMonitor(e,t,n){return this.rackApi_.addMonitor(e,t,n)}addBlade(e){return this.rackApi_.addBlade(e)}}class rt extends me{constructor(e,t){super(e,new Le(e.rackController,t));this.onPageAdd_=this.onPageAdd_.bind(this);this.onPageRemove_=this.onPageRemove_.bind(this);this.emitter_=new p;this.pageApiMap_=new Map;this.rackApi_.on("change",e=>{this.emitter_.emit("change",{event:e})});this.rackApi_.on("update",e=>{this.emitter_.emit("update",{event:e})});this.controller_.pageSet.emitter.on("add",this.onPageAdd_);this.controller_.pageSet.emitter.on("remove",this.onPageRemove_);this.controller_.pageSet.items.forEach(e=>{this.setUpPageApi_(e)})}get pages(){return this.controller_.pageSet.items.map(e=>{const t=this.pageApiMap_.get(e);if(!t)throw u.shouldNeverHappen();return t})}addPage(e){const t=this.controller_.view.element.ownerDocument;const n=new tt(t,{itemProps:P.fromObject({selected:false,title:e.title}),props:P.fromObject({selected:false})});this.controller_.add(n,e.index);const r=this.pageApiMap_.get(n);if(!r)throw u.shouldNeverHappen();return r}removePage(e){this.controller_.remove(e)}on(e,t){const n=t.bind(this);this.emitter_.on(e,e=>{n(e.event)});return this}setUpPageApi_(t){const e=this.rackApi_["apiSet_"].find(e=>e.controller_===t.contentController);if(!e)throw u.shouldNeverHappen();const n=new nt(t,e);this.pageApiMap_.set(t,n)}onPageAdd_(e){this.setUpPageApi_(e.item)}onPageRemove_(e){const t=this.pageApiMap_.get(e.item);if(!t)throw u.shouldNeverHappen();this.pageApiMap_.delete(e.item)}}const it=m("tab");class st{constructor(e,t){this.element=e.createElement("div");this.element.classList.add(it(),Ve());t.viewProps.bindClassModifiers(this.element);x(t.empty,w(this.element,it(undefined,"nop")));const n=e.createElement("div");n.classList.add(it("i"));this.element.appendChild(n);this.itemsElement=n;const r=t.contentsElement;r.classList.add(it("c"));this.element.appendChild(r);this.contentsElement=r}}class at extends Pe{constructor(e,t){const n=new Ue(e,{blade:t.blade,viewProps:t.viewProps});const r=A(true);super({blade:t.blade,rackController:n,view:new st(e,{contentsElement:n.view.element,empty:r,viewProps:t.viewProps})});this.onPageAdd_=this.onPageAdd_.bind(this);this.onPageRemove_=this.onPageRemove_.bind(this);this.onPageSelectedChange_=this.onPageSelectedChange_.bind(this);this.pageSet_=new be(()=>null);this.pageSet_.emitter.on("add",this.onPageAdd_);this.pageSet_.emitter.on("remove",this.onPageRemove_);this.empty_=r;this.applyPages_()}get pageSet(){return this.pageSet_}add(e,t){this.pageSet_.add(e,t!==null&&t!==void 0?t:this.pageSet_.items.length)}remove(e){this.pageSet_.remove(this.pageSet_.items[e])}applyPages_(){this.keepSelection_();this.empty_.rawValue=this.pageSet_.items.length===0}onPageAdd_(e){const t=e.item;Q(this.view.itemsElement,t.itemController.view.element,e.index);this.rackController.rack.add(t.contentController,e.index);t.props.value("selected").emitter.on("change",this.onPageSelectedChange_);this.applyPages_()}onPageRemove_(e){const t=e.item;ee(t.itemController.view.element);this.rackController.rack.remove(t.contentController);t.props.value("selected").emitter.off("change",this.onPageSelectedChange_);this.applyPages_()}keepSelection_(){if(this.pageSet_.items.length===0)return;const n=this.pageSet_.items.findIndex(e=>e.props.get("selected"));if(n<0)this.pageSet_.items.forEach((e,t)=>{e.props.set("selected",t===0)});else this.pageSet_.items.forEach((e,t)=>{e.props.set("selected",t===n)})}onPageSelectedChange_(t){if(t.rawValue){const n=this.pageSet_.items.findIndex(e=>e.props.value("selected")===t.sender);this.pageSet_.items.forEach((e,t)=>{e.props.set("selected",t===n)})}else this.keepSelection_()}}const ot={id:"tab",type:"blade",accept(e){const t=O;const n=z(e,{pages:t.required.array(t.required.object({title:t.required.string})),view:t.required.constant("tab")});if(!n||n.pages.length===0)return null;return{params:n}},controller(n){const r=new at(n.document,{blade:n.blade,viewProps:n.viewProps});n.params.pages.forEach(e=>{const t=new tt(n.document,{itemProps:P.fromObject({selected:false,title:e.title}),props:P.fromObject({selected:false})});r.add(t)});return r},api(e){if(!(e.controller instanceof at))return null;return new rt(e.controller,e.pool)}};function lt(e,t){const n=e.accept(t.params);if(!n)return null;const r=O.optional.boolean(t.params["disabled"]).value;const i=O.optional.boolean(t.params["hidden"]).value;return e.controller({blade:ue(),document:t.document,params:o(Object.assign(Object.assign({},n.params),{disabled:r,hidden:i})),viewProps:Ze.create({disabled:r,hidden:i})})}class ct{constructor(){this.disabled=false;this.emitter=new p}dispose(){}tick(){if(this.disabled)return;this.emitter.emit("tick",{sender:this})}}class ut{constructor(e,t){this.disabled_=false;this.timerId_=null;this.onTick_=this.onTick_.bind(this);this.doc_=e;this.emitter=new p;this.interval_=t;this.setTimer_()}get disabled(){return this.disabled_}set disabled(e){this.disabled_=e;if(this.disabled_)this.clearTimer_();else this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;const e=this.doc_.defaultView;if(e)e.clearInterval(this.timerId_);this.timerId_=null}setTimer_(){this.clearTimer_();if(this.interval_<=0)return;const e=this.doc_.defaultView;if(e)this.timerId_=e.setInterval(this.onTick_,this.interval_)}onTick_(){if(this.disabled_)return;this.emitter.emit("tick",{sender:this})}}class ht{constructor(e){this.constraints=e}constrain(e){return this.constraints.reduce((e,t)=>{return t.constrain(e)},e)}}function dt(e,n){if(e instanceof n)return e;if(e instanceof ht){const t=e.constraints.reduce((e,t)=>{if(e)return e;return t instanceof n?t:null},null);if(t)return t}return null}class pt{constructor(e){this.options=e}constrain(t){const e=this.options;if(e.length===0)return t;const n=e.filter(e=>{return e.value===t}).length>0;return n?t:e[0].value}}class ft{constructor(e){this.maxValue=e.max;this.minValue=e.min}constrain(e){let t=e;if(!g(this.minValue))t=Math.max(t,this.minValue);if(!g(this.maxValue))t=Math.min(t,this.maxValue);return t}}class mt{constructor(e){this.step=e}constrain(e){const t=e<0?-Math.round(-e/this.step):Math.round(e/this.step);return t*this.step}}const gt=m("lst");class vt{constructor(r,e){this.onValueChange_=this.onValueChange_.bind(this);this.props_=e.props;this.element=r.createElement("div");this.element.classList.add(gt());e.viewProps.bindClassModifiers(this.element);const i=r.createElement("select");i.classList.add(gt("s"));b(this.props_,"options",e=>{te(i);e.forEach((e,t)=>{const n=r.createElement("option");n.dataset.index=String(t);n.textContent=e.text;n.value=String(e.value);i.appendChild(n)})});e.viewProps.bindDisabled(i);this.element.appendChild(i);this.selectElement=i;const t=r.createElement("div");t.classList.add(gt("m"));t.appendChild($(r,"dropdown"));this.element.appendChild(t);e.value.emitter.on("change",this.onValueChange_);this.value_=e.value;this.update_()}update_(){this.selectElement.value=String(this.value_.rawValue)}onValueChange_(){this.update_()}}class yt{constructor(e,t){this.onSelectChange_=this.onSelectChange_.bind(this);this.props=t.props;this.value=t.value;this.viewProps=t.viewProps;this.view=new vt(e,{props:this.props,value:this.value,viewProps:this.viewProps});this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(e){const t=o(e.currentTarget);const n=t.selectedOptions.item(0);if(!n)return;const r=Number(n.dataset.index);this.value.rawValue=this.props.get("options")[r].value}}const xt=m("pop");class bt{constructor(e,t){this.element=e.createElement("div");this.element.classList.add(xt());t.viewProps.bindClassModifiers(this.element);x(t.shows,w(this.element,xt(undefined,"v")))}}class _t{constructor(e,t){this.shows=A(false);this.viewProps=t.viewProps;this.view=new bt(e,{shows:this.shows,viewProps:this.viewProps})}}const wt=m("txt");class Mt{constructor(e,t){this.onChange_=this.onChange_.bind(this);this.element=e.createElement("div");this.element.classList.add(wt());t.viewProps.bindClassModifiers(this.element);this.props_=t.props;this.props_.emitter.on("change",this.onChange_);const n=e.createElement("input");n.classList.add(wt("i"));n.type="text";t.viewProps.bindDisabled(n);this.element.appendChild(n);this.inputElement=n;t.value.emitter.on("change",this.onChange_);this.value_=t.value;this.refresh()}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value_.rawValue)}onChange_(){this.refresh()}}class St{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this);this.parser_=t.parser;this.props=t.props;this.value=t.value;this.viewProps=t.viewProps;this.view=new Mt(e,{props:t.props,value:this.value,viewProps:this.viewProps});this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const t=o(e.currentTarget);const n=t.value;const r=this.parser_(n);if(!g(r))this.value.rawValue=r;this.view.refresh()}}function Et(e){return String(e)}function Tt(e){if(e==="false")return false;return!!e}function Ct(e){return Et(e)}class Lt{constructor(e){this.text=e}evaluate(){return Number(this.text)}toString(){return this.text}}const At={"**":(e,t)=>Math.pow(e,t),"*":(e,t)=>e*t,"/":(e,t)=>e/t,"%":(e,t)=>e%t,"+":(e,t)=>e+t,"-":(e,t)=>e-t,"<<":(e,t)=>e<<t,">>":(e,t)=>e>>t,">>>":(e,t)=>e>>>t,"&":(e,t)=>e&t,"^":(e,t)=>e^t,"|":(e,t)=>e|t};class Pt{constructor(e,t,n){this.left=t;this.operator=e;this.right=n}evaluate(){const e=At[this.operator];if(!e)throw new Error(`unexpected binary operator: '${this.operator}`);return e(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const Rt={"+":e=>e,"-":e=>-e,"~":e=>~e};class Dt{constructor(e,t){this.operator=e;this.expression=t}evaluate(){const e=Rt[this.operator];if(!e)throw new Error(`unexpected unary operator: '${this.operator}`);return e(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function Nt(i){return(t,n)=>{for(let e=0;e<i.length;e++){const r=i[e](t,n);if(r!=="")return r}return""}}function It(e,t){var n;const r=e.substr(t).match(/^\s+/);return(n=r&&r[0])!==null&&n!==void 0?n:""}function kt(e,t){const n=e.substr(t,1);return n.match(/^[1-9]$/)?n:""}function Ot(e,t){var n;const r=e.substr(t).match(/^[0-9]+/);return(n=r&&r[0])!==null&&n!==void 0?n:""}function zt(e,t){const n=Ot(e,t);if(n!=="")return n;const r=e.substr(t,1);t+=1;if(r!=="-"&&r!=="+")return"";const i=Ot(e,t);if(i==="")return"";return r+i}function Ut(e,t){const n=e.substr(t,1);t+=1;if(n.toLowerCase()!=="e")return"";const r=zt(e,t);if(r==="")return"";return n+r}function Vt(e,t){const n=e.substr(t,1);if(n==="0")return n;const r=kt(e,t);t+=r.length;if(r==="")return"";return r+Ot(e,t)}function Ft(e,t){const n=Vt(e,t);t+=n.length;if(n==="")return"";const r=e.substr(t,1);t+=r.length;if(r!==".")return"";const i=Ot(e,t);t+=i.length;return n+r+i+Ut(e,t)}function Ht(e,t){const n=e.substr(t,1);t+=n.length;if(n!==".")return"";const r=Ot(e,t);t+=r.length;if(r==="")return"";return n+r+Ut(e,t)}function Bt(e,t){const n=Vt(e,t);t+=n.length;if(n==="")return"";return n+Ut(e,t)}const Gt=Nt([Ft,Ht,Bt]);function Wt(e,t){var n;const r=e.substr(t).match(/^[01]+/);return(n=r&&r[0])!==null&&n!==void 0?n:""}function jt(e,t){const n=e.substr(t,2);t+=n.length;if(n.toLowerCase()!=="0b")return"";const r=Wt(e,t);if(r==="")return"";return n+r}function qt(e,t){var n;const r=e.substr(t).match(/^[0-7]+/);return(n=r&&r[0])!==null&&n!==void 0?n:""}function Xt(e,t){const n=e.substr(t,2);t+=n.length;if(n.toLowerCase()!=="0o")return"";const r=qt(e,t);if(r==="")return"";return n+r}function Yt(e,t){var n;const r=e.substr(t).match(/^[0-9a-f]+/i);return(n=r&&r[0])!==null&&n!==void 0?n:""}function Kt(e,t){const n=e.substr(t,2);t+=n.length;if(n.toLowerCase()!=="0x")return"";const r=Yt(e,t);if(r==="")return"";return n+r}const Jt=Nt([jt,Xt,Kt]),Zt=Nt([Jt,Gt]);function $t(e,t){const n=Zt(e,t);t+=n.length;if(n==="")return null;return{evaluable:new Lt(n),cursor:t}}function Qt(e,t){const n=e.substr(t,1);t+=n.length;if(n!=="(")return null;const r=an(e,t);if(!r)return null;t=r.cursor;t+=It(e,t).length;const i=e.substr(t,1);t+=i.length;if(i!==")")return null;return{evaluable:r.evaluable,cursor:t}}function en(e,t){return $t(e,t)||Qt(e,t)}function tn(e,t){const n=en(e,t);if(n)return n;const r=e.substr(t,1);t+=r.length;if(r!=="+"&&r!=="-"&&r!=="~")return null;const i=tn(e,t);if(!i)return null;t=i.cursor;return{cursor:t,evaluable:new Dt(r,i.evaluable)}}function nn(e,t,n){n+=It(t,n).length;const r=e.filter(e=>t.startsWith(e,n))[0];if(!r)return null;n+=r.length;n+=It(t,n).length;return{cursor:n,operator:r}}function rn(a,o){return(e,t)=>{const n=a(e,t);if(!n)return null;t=n.cursor;let r=n.evaluable;for(;;){const i=nn(o,e,t);if(!i)break;t=i.cursor;const s=a(e,t);if(!s)return null;t=s.cursor;r=new Pt(i.operator,r,s.evaluable)}return r?{cursor:t,evaluable:r}:null}}const sn=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((e,t)=>{return rn(e,t)},tn);function an(e,t){t+=It(e,t).length;return sn(e,t)}function on(e){const t=an(e,0);if(!t)return null;const n=t.cursor+It(e,t.cursor).length;if(n!==e.length)return null;return t.evaluable}function ln(e){var t;const n=on(e);return(t=n===null||n===void 0?void 0:n.evaluate())!==null&&t!==void 0?t:null}function cn(e){if(typeof e==="number")return e;if(typeof e==="string"){const t=ln(e);if(!g(t))return t}return 0}function un(e){return String(e)}function hn(t){return e=>{return e.toFixed(Math.max(Math.min(t,20),0))}}const dn=hn(0);function pn(e){return dn(e)+"%"}function fn(e){return String(e)}function mn(e){return e}function gn(e,t){while(e.length<t)e.push(undefined)}function vn(e){const t=[];gn(t,e);return A(t)}function yn(e){const t=e.indexOf(undefined);return o(t<0?e:e.slice(0,t))}function xn(e,t){const n=[...yn(e),t];if(n.length>e.length)n.splice(0,n.length-e.length);else gn(n,e.length);return n}function bn({primary:t,secondary:n,forward:r,backward:i}){let s=false;function a(e){if(s)return;s=true;e();s=false}t.emitter.on("change",e=>{a(()=>{n.setRawValue(r(t,n),e.options)})});n.emitter.on("change",e=>{a(()=>{t.setRawValue(i(t,n),e.options)});a(()=>{n.setRawValue(r(t,n),e.options)})});a(()=>{n.setRawValue(r(t,n),{forceEmit:false,last:true})})}function _n(e,t){const n=e*(t.altKey?.1:1)*(t.shiftKey?10:1);if(t.upKey)return+n;else if(t.downKey)return-n;return 0}function wn(e){return{altKey:e.altKey,downKey:e.key==="ArrowDown",shiftKey:e.shiftKey,upKey:e.key==="ArrowUp"}}function Mn(e){return{altKey:e.altKey,downKey:e.key==="ArrowLeft",shiftKey:e.shiftKey,upKey:e.key==="ArrowRight"}}function Sn(e){return e==="ArrowUp"||e==="ArrowDown"}function En(e){return Sn(e)||e==="ArrowLeft"||e==="ArrowRight"}function Tn(e,t){const n=t.ownerDocument.defaultView;const r=t.getBoundingClientRect();return{x:e.pageX-((n&&n.scrollX||0)+r.left),y:e.pageY-((n&&n.scrollY||0)+r.top)}}class Cn{constructor(e){this.lastTouch_=null;this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this);this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this);this.onMouseDown_=this.onMouseDown_.bind(this);this.onTouchEnd_=this.onTouchEnd_.bind(this);this.onTouchMove_=this.onTouchMove_.bind(this);this.onTouchStart_=this.onTouchStart_.bind(this);this.elem_=e;this.emitter=new p;e.addEventListener("touchstart",this.onTouchStart_);e.addEventListener("touchmove",this.onTouchMove_);e.addEventListener("touchend",this.onTouchEnd_);e.addEventListener("mousedown",this.onMouseDown_)}computePosition_(e){const t=this.elem_.getBoundingClientRect();return{bounds:{width:t.width,height:t.height},point:e?{x:e.x,y:e.y}:null}}onMouseDown_(e){var t;e.preventDefault();(t=e.currentTarget)===null||t===void 0?void 0:t.focus();const n=this.elem_.ownerDocument;n.addEventListener("mousemove",this.onDocumentMouseMove_);n.addEventListener("mouseup",this.onDocumentMouseUp_);this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(Tn(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseMove_(e){this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(Tn(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseUp_(e){const t=this.elem_.ownerDocument;t.removeEventListener("mousemove",this.onDocumentMouseMove_);t.removeEventListener("mouseup",this.onDocumentMouseUp_);this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(Tn(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onTouchStart_(e){e.preventDefault();const t=e.targetTouches.item(0);const n=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-n.left,y:t.clientY-n.top}:undefined),sender:this,shiftKey:e.shiftKey});this.lastTouch_=t}onTouchMove_(e){const t=e.targetTouches.item(0);const n=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-n.left,y:t.clientY-n.top}:undefined),sender:this,shiftKey:e.shiftKey});this.lastTouch_=t}onTouchEnd_(e){var t;const n=(t=e.targetTouches.item(0))!==null&&t!==void 0?t:this.lastTouch_;const r=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(n?{x:n.clientX-r.left,y:n.clientY-r.top}:undefined),sender:this,shiftKey:e.shiftKey})}}function Ln(e,t,n,r,i){const s=(e-t)/(n-t);return r+s*(i-r)}function An(e){const t=String(e.toFixed(10));const n=t.split(".")[1];return n.replace(/0+$/,"").length}function Pn(e,t,n){return Math.min(Math.max(e,t),n)}function Rn(e,t){return(e%t+t)%t}const Dn=m("txt");class Nn{constructor(e,t){this.onChange_=this.onChange_.bind(this);this.props_=t.props;this.props_.emitter.on("change",this.onChange_);this.element=e.createElement("div");this.element.classList.add(Dn(),Dn(undefined,"num"));if(t.arrayPosition)this.element.classList.add(Dn(undefined,t.arrayPosition));t.viewProps.bindClassModifiers(this.element);const n=e.createElement("input");n.classList.add(Dn("i"));n.type="text";t.viewProps.bindDisabled(n);this.element.appendChild(n);this.inputElement=n;this.onDraggingChange_=this.onDraggingChange_.bind(this);this.dragging_=t.dragging;this.dragging_.emitter.on("change",this.onDraggingChange_);this.element.classList.add(Dn());this.inputElement.classList.add(Dn("i"));const r=e.createElement("div");r.classList.add(Dn("k"));this.element.appendChild(r);this.knobElement=r;const i=e.createElementNS(G,"svg");i.classList.add(Dn("g"));this.knobElement.appendChild(i);const s=e.createElementNS(G,"path");s.classList.add(Dn("gb"));i.appendChild(s);this.guideBodyElem_=s;const a=e.createElementNS(G,"path");a.classList.add(Dn("gh"));i.appendChild(a);this.guideHeadElem_=a;const o=e.createElement("div");o.classList.add(m("tt")());this.knobElement.appendChild(o);this.tooltipElem_=o;t.value.emitter.on("change",this.onChange_);this.value=t.value;this.refresh()}onDraggingChange_(e){if(e.rawValue===null){this.element.classList.remove(Dn(undefined,"drg"));return}this.element.classList.add(Dn(undefined,"drg"));const t=e.rawValue/this.props_.get("draggingScale");const n=t+(t>0?-1:t<0?+1:0);const r=Pn(-n,-4,+4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${n+r},0 L${n},4 L${n+r},8`,`M ${t},-1 L${t},9`].join(" "));this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${t},4`);const i=this.props_.get("formatter");this.tooltipElem_.textContent=i(this.value.rawValue);this.tooltipElem_.style.left=`${t}px`}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value.rawValue)}onChange_(){this.refresh()}}class In{constructor(e,t){this.originRawValue_=0;this.onInputChange_=this.onInputChange_.bind(this);this.onInputKeyDown_=this.onInputKeyDown_.bind(this);this.onInputKeyUp_=this.onInputKeyUp_.bind(this);this.onPointerDown_=this.onPointerDown_.bind(this);this.onPointerMove_=this.onPointerMove_.bind(this);this.onPointerUp_=this.onPointerUp_.bind(this);this.baseStep_=t.baseStep;this.parser_=t.parser;this.props=t.props;this.value=t.value;this.viewProps=t.viewProps;this.dragging_=A(null);this.view=new Nn(e,{arrayPosition:t.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps});this.view.inputElement.addEventListener("change",this.onInputChange_);this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_);this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const n=new Cn(this.view.knobElement);n.emitter.on("down",this.onPointerDown_);n.emitter.on("move",this.onPointerMove_);n.emitter.on("up",this.onPointerUp_)}onInputChange_(e){const t=o(e.currentTarget);const n=t.value;const r=this.parser_(n);if(!g(r))this.value.rawValue=r;this.view.refresh()}onInputKeyDown_(e){const t=_n(this.baseStep_,wn(e));if(t===0)return;this.value.setRawValue(this.value.rawValue+t,{forceEmit:false,last:false})}onInputKeyUp_(e){const t=_n(this.baseStep_,wn(e));if(t===0)return;this.value.setRawValue(this.value.rawValue,{forceEmit:true,last:true})}onPointerDown_(){this.originRawValue_=this.value.rawValue;this.dragging_.rawValue=0}computeDraggingValue_(e){if(!e.point)return null;const t=e.point.x-e.bounds.width/2;return this.originRawValue_+t*this.props.get("draggingScale")}onPointerMove_(e){const t=this.computeDraggingValue_(e.data);if(t===null)return;this.value.setRawValue(t,{forceEmit:false,last:false});this.dragging_.rawValue=this.value.rawValue-this.originRawValue_}onPointerUp_(e){const t=this.computeDraggingValue_(e.data);if(t===null)return;this.value.setRawValue(t,{forceEmit:true,last:true});this.dragging_.rawValue=null}}const kn=m("sld");class On{constructor(e,t){this.onChange_=this.onChange_.bind(this);this.props_=t.props;this.props_.emitter.on("change",this.onChange_);this.element=e.createElement("div");this.element.classList.add(kn());t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(kn("t"));t.viewProps.bindTabIndex(n);this.element.appendChild(n);this.trackElement=n;const r=e.createElement("div");r.classList.add(kn("k"));this.trackElement.appendChild(r);this.knobElement=r;t.value.emitter.on("change",this.onChange_);this.value=t.value;this.update_()}update_(){const e=Pn(Ln(this.value.rawValue,this.props_.get("minValue"),this.props_.get("maxValue"),0,100),0,100);this.knobElement.style.width=`${e}%`}onChange_(){this.update_()}}class zn{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this);this.onKeyUp_=this.onKeyUp_.bind(this);this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this);this.onPointerUp_=this.onPointerUp_.bind(this);this.baseStep_=t.baseStep;this.value=t.value;this.viewProps=t.viewProps;this.props=t.props;this.view=new On(e,{props:this.props,value:this.value,viewProps:this.viewProps});this.ptHandler_=new Cn(this.view.trackElement);this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_);this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_);this.ptHandler_.emitter.on("up",this.onPointerUp_);this.view.trackElement.addEventListener("keydown",this.onKeyDown_);this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;this.value.setRawValue(Ln(Pn(e.point.x,0,e.bounds.width),0,e.bounds.width,this.props.get("minValue"),this.props.get("maxValue")),t)}onPointerDownOrMove_(e){this.handlePointerEvent_(e.data,{forceEmit:false,last:false})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:true,last:true})}onKeyDown_(e){const t=_n(this.baseStep_,Mn(e));if(t===0)return;this.value.setRawValue(this.value.rawValue+t,{forceEmit:false,last:false})}onKeyUp_(e){const t=_n(this.baseStep_,Mn(e));if(t===0)return;this.value.setRawValue(this.value.rawValue,{forceEmit:true,last:true})}}const Un=m("sldtxt");class Vn{constructor(e,t){this.element=e.createElement("div");this.element.classList.add(Un());const n=e.createElement("div");n.classList.add(Un("s"));this.sliderView_=t.sliderView;n.appendChild(this.sliderView_.element);this.element.appendChild(n);const r=e.createElement("div");r.classList.add(Un("t"));this.textView_=t.textView;r.appendChild(this.textView_.element);this.element.appendChild(r)}}class Fn{constructor(e,t){this.value=t.value;this.viewProps=t.viewProps;this.sliderC_=new zn(e,{baseStep:t.baseStep,props:t.sliderProps,value:t.value,viewProps:this.viewProps});this.textC_=new In(e,{baseStep:t.baseStep,parser:t.parser,props:t.textProps,value:t.value,viewProps:t.viewProps});this.view=new Vn(e,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}}function Hn(e,t){e.write(t)}function Bn(e){const t=O;if(Array.isArray(e))return t.required.array(t.required.object({text:t.required.string,value:t.required.raw}))(e).value;if(typeof e==="object")return t.required.raw(e).value;return undefined}function Gn(e){if(e==="inline"||e==="popup")return e;return undefined}function Wn(e){const t=O;return t.required.object({max:t.optional.number,min:t.optional.number,step:t.optional.number})(e).value}function jn(t){if(Array.isArray(t))return t;const n=[];Object.keys(t).forEach(e=>{n.push({text:e,value:t[e]})});return n}function qn(e){return!g(e)?new pt(jn(o(e))):null}function Xn(e){const t=e?dt(e,pt):null;if(!t)return null;return t.options}function Yn(e){const t=e?dt(e,mt):null;if(!t)return null;return t.step}function Kn(e,t){const n=e&&dt(e,mt);if(n)return An(n.step);return Math.max(An(t),2)}function Jn(e){const t=Yn(e);return t!==null&&t!==void 0?t:1}function Zn(e,t){var n;const r=e&&dt(e,mt);const i=Math.abs((n=r===null||r===void 0?void 0:r.step)!==null&&n!==void 0?n:t);return i===0?.1:Math.pow(10,Math.floor(Math.log10(i))-1)}const $n=m("ckb");class Qn{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this);this.element=e.createElement("div");this.element.classList.add($n());t.viewProps.bindClassModifiers(this.element);const n=e.createElement("label");n.classList.add($n("l"));this.element.appendChild(n);const r=e.createElement("input");r.classList.add($n("i"));r.type="checkbox";n.appendChild(r);this.inputElement=r;t.viewProps.bindDisabled(this.inputElement);const i=e.createElement("div");i.classList.add($n("w"));n.appendChild(i);const s=$(e,"check");i.appendChild(s);t.value.emitter.on("change",this.onValueChange_);this.value=t.value;this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class er{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this);this.value=t.value;this.viewProps=t.viewProps;this.view=new Qn(e,{value:this.value,viewProps:this.viewProps});this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const t=o(e.currentTarget);this.value.rawValue=t.checked}}function tr(e){const t=[];const n=qn(e.options);if(n)t.push(n);return new ht(t)}const nr={id:"input-bool",type:"input",accept:(e,t)=>{if(typeof e!=="boolean")return null;const n=O;const r=z(t,{options:n.optional.custom(Bn)});return r?{initialValue:e,params:r}:null},binding:{reader:e=>Tt,constraint:e=>tr(e.params),writer:e=>Hn},controller:e=>{var t;const n=e.document;const r=e.value;const i=e.constraint;if(i&&dt(i,pt))return new yt(n,{props:P.fromObject({options:(t=Xn(i))!==null&&t!==void 0?t:[]}),value:r,viewProps:e.viewProps});return new er(n,{value:r,viewProps:e.viewProps})}},rr=m("col");class ir{constructor(e,t){this.element=e.createElement("div");this.element.classList.add(rr());t.foldable.bindExpandedClass(this.element,rr(undefined,"expanded"));b(t.foldable,"completed",w(this.element,rr(undefined,"cpl")));const n=e.createElement("div");n.classList.add(rr("h"));this.element.appendChild(n);const r=e.createElement("div");r.classList.add(rr("s"));n.appendChild(r);this.swatchElement=r;const i=e.createElement("div");i.classList.add(rr("t"));n.appendChild(i);this.textElement=i;if(t.pickerLayout==="inline"){const s=e.createElement("div");s.classList.add(rr("p"));this.element.appendChild(s);this.pickerElement=s}else this.pickerElement=null}}function sr(e,t,n){const r=Pn(e/255,0,1);const i=Pn(t/255,0,1);const s=Pn(n/255,0,1);const a=Math.max(r,i,s);const o=Math.min(r,i,s);const l=a-o;let c=0;let u=0;const h=(o+a)/2;if(l!==0){u=l/(1-Math.abs(a+o-1));if(r===a)c=(i-s)/l;else if(i===a)c=2+(s-r)/l;else c=4+(r-i)/l;c=c/6+(c<0?1:0)}return[c*360,u*100,h*100]}function ar(e,t,n){const r=(e%360+360)%360;const i=Pn(t/100,0,1);const s=Pn(n/100,0,1);const a=(1-Math.abs(2*s-1))*i;const o=a*(1-Math.abs(r/60%2-1));const l=s-a/2;let c,u,h;if(r>=0&&r<60)[c,u,h]=[a,o,0];else if(r>=60&&r<120)[c,u,h]=[o,a,0];else if(r>=120&&r<180)[c,u,h]=[0,a,o];else if(r>=180&&r<240)[c,u,h]=[0,o,a];else if(r>=240&&r<300)[c,u,h]=[o,0,a];else[c,u,h]=[a,0,o];return[(c+l)*255,(u+l)*255,(h+l)*255]}function or(e,t,n){const r=Pn(e/255,0,1);const i=Pn(t/255,0,1);const s=Pn(n/255,0,1);const a=Math.max(r,i,s);const o=Math.min(r,i,s);const l=a-o;let c;if(l===0)c=0;else if(a===r)c=60*(((i-s)/l%6+6)%6);else if(a===i)c=60*((s-r)/l+2);else c=60*((r-i)/l+4);const u=a===0?0:l/a;const h=a;return[c,u*100,h*100]}function lr(e,t,n){const r=Rn(e,360);const i=Pn(t/100,0,1);const s=Pn(n/100,0,1);const a=s*i;const o=a*(1-Math.abs(r/60%2-1));const l=s-a;let c,u,h;if(r>=0&&r<60)[c,u,h]=[a,o,0];else if(r>=60&&r<120)[c,u,h]=[o,a,0];else if(r>=120&&r<180)[c,u,h]=[0,a,o];else if(r>=180&&r<240)[c,u,h]=[0,o,a];else if(r>=240&&r<300)[c,u,h]=[o,0,a];else[c,u,h]=[a,0,o];return[(c+l)*255,(u+l)*255,(h+l)*255]}function cr(e,t,n){const r=n+t*(100-Math.abs(2*n-100))/(2*100);return[e,r!==0?t*(100-Math.abs(2*n-100))/r:0,n+t*(100-Math.abs(2*n-100))/(2*100)]}function ur(e,t,n){const r=100-Math.abs(n*(200-t)/100-100);return[e,r!==0?t*n/r:0,n*(200-t)/(2*100)]}function hr(e){return[e[0],e[1],e[2]]}function dr(e,t){return[e[0],e[1],e[2],t]}const pr={hsl:{hsl:(e,t,n)=>[e,t,n],hsv:cr,rgb:ar},hsv:{hsl:ur,hsv:(e,t,n)=>[e,t,n],rgb:lr},rgb:{hsl:sr,hsv:or,rgb:(e,t,n)=>[e,t,n]}};function fr(e,t,n){return pr[t][n](...e)}const mr={hsl:e=>{var t;return[Rn(e[0],360),Pn(e[1],0,100),Pn(e[2],0,100),Pn((t=e[3])!==null&&t!==void 0?t:1,0,1)]},hsv:e=>{var t;return[Rn(e[0],360),Pn(e[1],0,100),Pn(e[2],0,100),Pn((t=e[3])!==null&&t!==void 0?t:1,0,1)]},rgb:e=>{var t;return[Pn(e[0],0,255),Pn(e[1],0,255),Pn(e[2],0,255),Pn((t=e[3])!==null&&t!==void 0?t:1,0,1)]}};function gr(e,t){if(typeof e!=="object"||g(e))return false;return t in e&&typeof e[t]==="number"}class vr{constructor(e,t){this.mode_=t;this.comps_=mr[t](e)}static black(){return new vr([0,0,0],"rgb")}static fromObject(e){const t="a"in e?[e.r,e.g,e.b,e.a]:[e.r,e.g,e.b];return new vr(t,"rgb")}static toRgbaObject(e){return e.toRgbaObject()}static isRgbColorObject(e){return gr(e,"r")&&gr(e,"g")&&gr(e,"b")}static isRgbaColorObject(e){return this.isRgbColorObject(e)&&gr(e,"a")}static isColorObject(e){return this.isRgbColorObject(e)}static equals(e,t){if(e.mode_!==t.mode_)return false;const n=e.comps_;const r=t.comps_;for(let e=0;e<n.length;e++)if(n[e]!==r[e])return false;return true}get mode(){return this.mode_}getComponents(e){return dr(fr(hr(this.comps_),this.mode_,e||this.mode_),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}}const yr=m("colp");class xr{constructor(e,t){this.alphaViews_=null;this.element=e.createElement("div");this.element.classList.add(yr());const n=e.createElement("div");n.classList.add(yr("hsv"));const r=e.createElement("div");r.classList.add(yr("sv"));this.svPaletteView_=t.svPaletteView;r.appendChild(this.svPaletteView_.element);n.appendChild(r);const i=e.createElement("div");i.classList.add(yr("h"));this.hPaletteView_=t.hPaletteView;i.appendChild(this.hPaletteView_.element);n.appendChild(i);this.element.appendChild(n);const s=e.createElement("div");s.classList.add(yr("rgb"));this.textView_=t.textView;s.appendChild(this.textView_.element);this.element.appendChild(s);if(t.alphaViews){this.alphaViews_={palette:t.alphaViews.palette,text:t.alphaViews.text};const a=e.createElement("div");a.classList.add(yr("a"));const o=e.createElement("div");o.classList.add(yr("ap"));o.appendChild(this.alphaViews_.palette.element);a.appendChild(o);const l=e.createElement("div");l.classList.add(yr("at"));l.appendChild(this.alphaViews_.text.element);a.appendChild(l);this.element.appendChild(a)}}get allFocusableElements(){const e=[this.svPaletteView_.element,this.hPaletteView_.element,this.textView_.modeSelectElement,...this.textView_.textViews.map(e=>e.inputElement)];if(this.alphaViews_)e.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement);return e}}function br(e){const t=O;return z(e,{alpha:t.optional.boolean,expanded:t.optional.boolean,picker:t.optional.custom(Gn)})}function _r(e){return e?.1:1}function wr(e,t){const n=e.match(/^(.+)%$/);if(!n)return Math.min(parseFloat(e),t);return Math.min(parseFloat(n[1])*.01*t,t)}const Mr={deg:e=>e,grad:e=>e*360/400,rad:e=>e*360/(2*Math.PI),turn:e=>e*360};function Sr(e){const t=e.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!t)return parseFloat(e);const n=parseFloat(t[1]);const r=t[2];return Mr[r](n)}const Er={"func.rgb":e=>{const t=e.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const n=[wr(t[1],255),wr(t[2],255),wr(t[3],255)];if(isNaN(n[0])||isNaN(n[1])||isNaN(n[2]))return null;return new vr(n,"rgb")},"func.rgba":e=>{const t=e.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const n=[wr(t[1],255),wr(t[2],255),wr(t[3],255),wr(t[4],1)];if(isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(n[3]))return null;return new vr(n,"rgb")},"func.hsl":e=>{const t=e.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const n=[Sr(t[1]),wr(t[2],100),wr(t[3],100)];if(isNaN(n[0])||isNaN(n[1])||isNaN(n[2]))return null;return new vr(n,"hsl")},"func.hsla":e=>{const t=e.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const n=[Sr(t[1]),wr(t[2],100),wr(t[3],100),wr(t[4],1)];if(isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(n[3]))return null;return new vr(n,"hsl")},"hex.rgb":e=>{const t=e.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(t)return new vr([parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)],"rgb");const n=e.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);if(n)return new vr([parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16)],"rgb");return null},"hex.rgba":e=>{const t=e.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(t)return new vr([parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16),Ln(parseInt(t[4]+t[4],16),0,255,0,1)],"rgb");const n=e.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);if(n)return new vr([parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16),Ln(parseInt(n[4],16),0,255,0,1)],"rgb");return null}};function Tr(r){const e=Object.keys(Er);return e.reduce((e,t)=>{if(e)return e;const n=Er[t];return n(r)?t:null},null)}const Cr=e=>{const t=Tr(e);return t?Er[t](e):null};function Lr(e){return e==="func.hsla"||e==="func.rgba"||e==="hex.rgba"}function Ar(e){if(typeof e==="string"){const t=Cr(e);if(t)return t}return vr.black()}function Pr(e){const t=Pn(Math.floor(e),0,255).toString(16);return t.length===1?`0${t}`:t}function Rr(e,t="#"){const n=hr(e.getComponents("rgb")).map(Pr).join("");return`${t}${n}`}function Dr(e,t="#"){const n=e.getComponents("rgb");const r=[n[0],n[1],n[2],n[3]*255].map(Pr).join("");return`${t}${r}`}function Nr(e){const t=hn(0);const n=hr(e.getComponents("rgb")).map(e=>t(e));return`rgb(${n.join(", ")})`}function Ir(e){const r=hn(2);const i=hn(0);const t=e.getComponents("rgb").map((e,t)=>{const n=t===3?r:i;return n(e)});return`rgba(${t.join(", ")})`}function kr(e){const n=[hn(0),pn,pn];const t=hr(e.getComponents("hsl")).map((e,t)=>n[t](e));return`hsl(${t.join(", ")})`}function Or(e){const n=[hn(0),pn,pn,hn(2)];const t=e.getComponents("hsl").map((e,t)=>n[t](e));return`hsla(${t.join(", ")})`}const zr={"func.hsl":kr,"func.hsla":Or,"func.rgb":Nr,"func.rgba":Ir,"hex.rgb":Rr,"hex.rgba":Dr};function Ur(e){return zr[e]}const Vr=m("apl");class Fr{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this);this.value=t.value;this.value.emitter.on("change",this.onValueChange_);this.element=e.createElement("div");this.element.classList.add(Vr());t.viewProps.bindTabIndex(this.element);const n=e.createElement("div");n.classList.add(Vr("b"));this.element.appendChild(n);const r=e.createElement("div");r.classList.add(Vr("c"));n.appendChild(r);this.colorElem_=r;const i=e.createElement("div");i.classList.add(Vr("m"));this.element.appendChild(i);this.markerElem_=i;const s=e.createElement("div");s.classList.add(Vr("p"));this.markerElem_.appendChild(s);this.previewElem_=s;this.update_()}update_(){const e=this.value.rawValue;const t=e.getComponents("rgb");const n=new vr([t[0],t[1],t[2],0],"rgb");const r=new vr([t[0],t[1],t[2],255],"rgb");const i=["to right",Ir(n),Ir(r)];this.colorElem_.style.background=`linear-gradient(${i.join(",")})`;this.previewElem_.style.backgroundColor=Ir(e);const s=Ln(t[3],0,1,0,100);this.markerElem_.style.left=`${s}%`}onValueChange_(){this.update_()}}class Hr{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this);this.onKeyUp_=this.onKeyUp_.bind(this);this.onPointerDown_=this.onPointerDown_.bind(this);this.onPointerMove_=this.onPointerMove_.bind(this);this.onPointerUp_=this.onPointerUp_.bind(this);this.value=t.value;this.viewProps=t.viewProps;this.view=new Fr(e,{value:this.value,viewProps:this.viewProps});this.ptHandler_=new Cn(this.view.element);this.ptHandler_.emitter.on("down",this.onPointerDown_);this.ptHandler_.emitter.on("move",this.onPointerMove_);this.ptHandler_.emitter.on("up",this.onPointerUp_);this.view.element.addEventListener("keydown",this.onKeyDown_);this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const n=e.point.x/e.bounds.width;const r=this.value.rawValue;const[i,s,a]=r.getComponents("hsv");this.value.setRawValue(new vr([i,s,a,n],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:false,last:false})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:false,last:false})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:true,last:true})}onKeyDown_(e){const t=_n(_r(true),Mn(e));if(t===0)return;const n=this.value.rawValue;const[r,i,s,a]=n.getComponents("hsv");this.value.setRawValue(new vr([r,i,s,a+t],"hsv"),{forceEmit:false,last:false})}onKeyUp_(e){const t=_n(_r(true),Mn(e));if(t===0)return;this.value.setRawValue(this.value.rawValue,{forceEmit:true,last:true})}}const Br=m("coltxt");function Gr(r){const e=r.createElement("select");const t=[{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"}];e.appendChild(t.reduce((e,t)=>{const n=r.createElement("option");n.textContent=t.text;n.value=t.value;e.appendChild(n);return e},r.createDocumentFragment()));return e}class Wr{constructor(e,t){this.element=e.createElement("div");this.element.classList.add(Br());const n=e.createElement("div");n.classList.add(Br("m"));this.modeElem_=Gr(e);this.modeElem_.classList.add(Br("ms"));n.appendChild(this.modeSelectElement);const r=e.createElement("div");r.classList.add(Br("mm"));r.appendChild($(e,"dropdown"));n.appendChild(r);this.element.appendChild(n);const i=e.createElement("div");i.classList.add(Br("w"));this.element.appendChild(i);this.textsElem_=i;this.textViews_=t.textViews;this.applyTextViews_();x(t.colorMode,e=>{this.modeElem_.value=e})}get modeSelectElement(){return this.modeElem_}get textViews(){return this.textViews_}set textViews(e){this.textViews_=e;this.applyTextViews_()}applyTextViews_(){te(this.textsElem_);const n=this.element.ownerDocument;this.textViews_.forEach(e=>{const t=n.createElement("div");t.classList.add(Br("c"));t.appendChild(e.element);this.textsElem_.appendChild(t)})}}const jr=hn(0),qr={rgb:()=>{return new ft({min:0,max:255})},hsl:e=>{return e===0?new ft({min:0,max:360}):new ft({min:0,max:100})},hsv:e=>{return e===0?new ft({min:0,max:360}):new ft({min:0,max:100})}};function Xr(e,t,n){return new In(e,{arrayPosition:n===0?"fst":n===3-1?"lst":"mid",baseStep:_r(false),parser:t.parser,props:P.fromObject({draggingScale:1,formatter:jr}),value:A(0,{constraint:qr[t.colorMode](n)}),viewProps:t.viewProps})}class Yr{constructor(e,t){this.onModeSelectChange_=this.onModeSelectChange_.bind(this);this.parser_=t.parser;this.value=t.value;this.viewProps=t.viewProps;this.colorMode=A(this.value.rawValue.mode);this.ccs_=this.createComponentControllers_(e);this.view=new Wr(e,{colorMode:this.colorMode,textViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]});this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(e){const t={colorMode:this.colorMode.rawValue,parser:this.parser_,viewProps:this.viewProps};const n=[Xr(e,t,0),Xr(e,t,1),Xr(e,t,2)];n.forEach((e,i)=>{bn({primary:this.value,secondary:e.value,forward:e=>{return e.rawValue.getComponents(this.colorMode.rawValue)[i]},backward:(e,t)=>{const n=this.colorMode.rawValue;const r=e.rawValue.getComponents(n);r[i]=t.rawValue;return new vr(dr(hr(r),r[3]),n)}})});return n}onModeSelectChange_(e){const t=e.currentTarget;this.colorMode.rawValue=t.value;this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument);this.view.textViews=[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}}const Kr=m("hpl");class Jr{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this);this.value=t.value;this.value.emitter.on("change",this.onValueChange_);this.element=e.createElement("div");this.element.classList.add(Kr());t.viewProps.bindTabIndex(this.element);const n=e.createElement("div");n.classList.add(Kr("c"));this.element.appendChild(n);const r=e.createElement("div");r.classList.add(Kr("m"));this.element.appendChild(r);this.markerElem_=r;this.update_()}update_(){const e=this.value.rawValue;const[t]=e.getComponents("hsv");this.markerElem_.style.backgroundColor=Nr(new vr([t,100,100],"hsv"));const n=Ln(t,0,360,0,100);this.markerElem_.style.left=`${n}%`}onValueChange_(){this.update_()}}class Zr{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this);this.onKeyUp_=this.onKeyUp_.bind(this);this.onPointerDown_=this.onPointerDown_.bind(this);this.onPointerMove_=this.onPointerMove_.bind(this);this.onPointerUp_=this.onPointerUp_.bind(this);this.value=t.value;this.viewProps=t.viewProps;this.view=new Jr(e,{value:this.value,viewProps:this.viewProps});this.ptHandler_=new Cn(this.view.element);this.ptHandler_.emitter.on("down",this.onPointerDown_);this.ptHandler_.emitter.on("move",this.onPointerMove_);this.ptHandler_.emitter.on("up",this.onPointerUp_);this.view.element.addEventListener("keydown",this.onKeyDown_);this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const n=Ln(e.point.x,0,e.bounds.width,0,360);const r=this.value.rawValue;const[,i,s,a]=r.getComponents("hsv");this.value.setRawValue(new vr([n,i,s,a],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:false,last:false})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:false,last:false})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:true,last:true})}onKeyDown_(e){const t=_n(_r(false),Mn(e));if(t===0)return;const n=this.value.rawValue;const[r,i,s,a]=n.getComponents("hsv");this.value.setRawValue(new vr([r+t,i,s,a],"hsv"),{forceEmit:false,last:false})}onKeyUp_(e){const t=_n(_r(false),Mn(e));if(t===0)return;this.value.setRawValue(this.value.rawValue,{forceEmit:true,last:true})}}const $r=m("svp"),Qr=64;class ei{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this);this.value=t.value;this.value.emitter.on("change",this.onValueChange_);this.element=e.createElement("div");this.element.classList.add($r());t.viewProps.bindTabIndex(this.element);const n=e.createElement("canvas");n.height=Qr;n.width=Qr;n.classList.add($r("c"));this.element.appendChild(n);this.canvasElement=n;const r=e.createElement("div");r.classList.add($r("m"));this.element.appendChild(r);this.markerElem_=r;this.update_()}update_(){const e=J(this.canvasElement);if(!e)return;const t=this.value.rawValue;const n=t.getComponents("hsv");const r=this.canvasElement.width;const i=this.canvasElement.height;const s=e.getImageData(0,0,r,i);const a=s.data;for(let t=0;t<i;t++)for(let e=0;e<r;e++){const c=Ln(e,0,r,0,100);const u=Ln(t,0,i,100,0);const h=lr(n[0],c,u);const d=(t*r+e)*4;a[d]=h[0];a[d+1]=h[1];a[d+2]=h[2];a[d+3]=255}e.putImageData(s,0,0);const o=Ln(n[1],0,100,0,100);this.markerElem_.style.left=`${o}%`;const l=Ln(n[2],0,100,100,0);this.markerElem_.style.top=`${l}%`}onValueChange_(){this.update_()}}class ti{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this);this.onKeyUp_=this.onKeyUp_.bind(this);this.onPointerDown_=this.onPointerDown_.bind(this);this.onPointerMove_=this.onPointerMove_.bind(this);this.onPointerUp_=this.onPointerUp_.bind(this);this.value=t.value;this.viewProps=t.viewProps;this.view=new ei(e,{value:this.value,viewProps:this.viewProps});this.ptHandler_=new Cn(this.view.element);this.ptHandler_.emitter.on("down",this.onPointerDown_);this.ptHandler_.emitter.on("move",this.onPointerMove_);this.ptHandler_.emitter.on("up",this.onPointerUp_);this.view.element.addEventListener("keydown",this.onKeyDown_);this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const n=Ln(e.point.x,0,e.bounds.width,0,100);const r=Ln(e.point.y,0,e.bounds.height,100,0);const[i,,,s]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new vr([i,n,r,s],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:false,last:false})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:false,last:false})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:true,last:true})}onKeyDown_(e){if(En(e.key))e.preventDefault();const[t,n,r,i]=this.value.rawValue.getComponents("hsv");const s=_r(false);const a=_n(s,Mn(e));const o=_n(s,wn(e));if(a===0&&o===0)return;this.value.setRawValue(new vr([t,n+a,r+o,i],"hsv"),{forceEmit:false,last:false})}onKeyUp_(e){const t=_r(false);const n=_n(t,Mn(e));const r=_n(t,wn(e));if(n===0&&r===0)return;this.value.setRawValue(this.value.rawValue,{forceEmit:true,last:true})}}class ni{constructor(e,t){this.value=t.value;this.viewProps=t.viewProps;this.hPaletteC_=new Zr(e,{value:this.value,viewProps:this.viewProps});this.svPaletteC_=new ti(e,{value:this.value,viewProps:this.viewProps});this.alphaIcs_=t.supportsAlpha?{palette:new Hr(e,{value:this.value,viewProps:this.viewProps}),text:new In(e,{parser:ln,baseStep:.1,props:P.fromObject({draggingScale:.01,formatter:hn(2)}),value:A(0,{constraint:new ft({min:0,max:1})}),viewProps:this.viewProps})}:null;if(this.alphaIcs_)bn({primary:this.value,secondary:this.alphaIcs_.text.value,forward:e=>{return e.rawValue.getComponents()[3]},backward:(e,t)=>{const n=e.rawValue.getComponents();n[3]=t.rawValue;return new vr(n,e.rawValue.mode)}});this.textC_=new Yr(e,{parser:ln,value:this.value,viewProps:this.viewProps});this.view=new xr(e,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:t.supportsAlpha,svPaletteView:this.svPaletteC_.view,textView:this.textC_.view})}get textController(){return this.textC_}}const ri=m("colsw");class ii{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this);t.value.emitter.on("change",this.onValueChange_);this.value=t.value;this.element=e.createElement("div");this.element.classList.add(ri());t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(ri("sw"));this.element.appendChild(n);this.swatchElem_=n;const r=e.createElement("button");r.classList.add(ri("b"));t.viewProps.bindDisabled(r);this.element.appendChild(r);this.buttonElement=r;this.update_()}update_(){const e=this.value.rawValue;this.swatchElem_.style.backgroundColor=Dr(e)}onValueChange_(){this.update_()}}class si{constructor(e,t){this.value=t.value;this.viewProps=t.viewProps;this.view=new ii(e,{value:this.value,viewProps:this.viewProps})}}class ai{constructor(e,t){this.onButtonBlur_=this.onButtonBlur_.bind(this);this.onButtonClick_=this.onButtonClick_.bind(this);this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this);this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this);this.value=t.value;this.viewProps=t.viewProps;this.foldable_=he.create(t.expanded);this.swatchC_=new si(e,{value:this.value,viewProps:this.viewProps});const n=this.swatchC_.view.buttonElement;n.addEventListener("blur",this.onButtonBlur_);n.addEventListener("click",this.onButtonClick_);this.textC_=new St(e,{parser:t.parser,props:P.fromObject({formatter:t.formatter}),value:this.value,viewProps:this.viewProps});this.view=new ir(e,{foldable:this.foldable_,pickerLayout:t.pickerLayout});this.view.swatchElement.appendChild(this.swatchC_.view.element);this.view.textElement.appendChild(this.textC_.view.element);this.popC_=t.pickerLayout==="popup"?new _t(e,{viewProps:this.viewProps}):null;const r=new ni(e,{supportsAlpha:t.supportsAlpha,value:this.value,viewProps:this.viewProps});r.view.allFocusableElements.forEach(e=>{e.addEventListener("blur",this.onPopupChildBlur_);e.addEventListener("keydown",this.onPopupChildKeydown_)});this.pickerC_=r;if(this.popC_){this.view.element.appendChild(this.popC_.view.element);this.popC_.view.element.appendChild(r.view.element);bn({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:e=>e.rawValue,backward:(e,t)=>t.rawValue})}else if(this.view.pickerElement){this.view.pickerElement.appendChild(this.pickerC_.view.element);fe(this.foldable_,this.view.pickerElement)}}get textController(){return this.textC_}onButtonBlur_(e){if(!this.popC_)return;const t=this.view.element;const n=o(e.relatedTarget);if(!n||!t.contains(n))this.popC_.shows.rawValue=false}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded"));if(this.foldable_.get("expanded"))this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element;const n=re(e);if(n&&t.contains(n))return;if(n&&n===this.swatchC_.view.buttonElement&&!q(t.ownerDocument))return;this.popC_.shows.rawValue=false}onPopupChildKeydown_(e){if(this.popC_){if(e.key==="Escape")this.popC_.shows.rawValue=false}else if(this.view.pickerElement)if(e.key==="Escape")this.swatchC_.view.buttonElement.focus()}}function oi(e){if(vr.isColorObject(e))return vr.fromObject(e);return vr.black()}function li(e){return hr(e.getComponents("rgb")).reduce((e,t)=>{return e<<8|Math.floor(t)&255},0)}function ci(e){return e.getComponents("rgb").reduce((e,t,n)=>{const r=Math.floor(n===3?t*255:t)&255;return e<<8|r},0)>>>0}function ui(e){return new vr([e>>16&255,e>>8&255,e&255],"rgb")}function hi(e){return new vr([e>>24&255,e>>16&255,e>>8&255,Ln(e&255,0,255,0,1)],"rgb")}function di(e){if(typeof e!=="number")return vr.black();return ui(e)}function pi(e){if(typeof e!=="number")return vr.black();return hi(e)}function fi(e){const n=Ur(e);return(e,t)=>{Hn(e,n(t))}}function mi(e){const n=e?ci:li;return(e,t)=>{Hn(e,n(t))}}function gi(e,t){const n=t.toRgbaObject();e.writeProperty("r",n.r);e.writeProperty("g",n.g);e.writeProperty("b",n.b);e.writeProperty("a",n.a)}function vi(e,t){const n=t.toRgbaObject();e.writeProperty("r",n.r);e.writeProperty("g",n.g);e.writeProperty("b",n.b)}function yi(e){return e?gi:vi}function xi(e){return"alpha"in e&&e.alpha===true}function bi(e){return e?e=>Dr(e,"0x"):e=>Rr(e,"0x")}const _i={id:"input-color-number",type:"input",accept:(e,t)=>{if(typeof e!=="number")return null;if(!("view"in t))return null;if(t.view!=="color")return null;const n=br(t);return n?{initialValue:e,params:n}:null},binding:{reader:e=>{return xi(e.params)?pi:di},equals:vr.equals,writer:e=>{return mi(xi(e.params))}},controller:e=>{const t=xi(e.params);const n="expanded"in e.params?e.params.expanded:undefined;const r="picker"in e.params?e.params.picker:undefined;return new ai(e.document,{expanded:n!==null&&n!==void 0?n:false,formatter:bi(t),parser:Cr,pickerLayout:r!==null&&r!==void 0?r:"popup",supportsAlpha:t,value:e.value,viewProps:e.viewProps})}};function wi(e){return vr.isRgbaColorObject(e)}const Mi={id:"input-color-object",type:"input",accept:(e,t)=>{if(!vr.isColorObject(e))return null;const n=br(t);return n?{initialValue:e,params:n}:null},binding:{reader:e=>oi,equals:vr.equals,writer:e=>yi(wi(e.initialValue))},controller:e=>{const t=vr.isRgbaColorObject(e.initialValue);const n="expanded"in e.params?e.params.expanded:undefined;const r="picker"in e.params?e.params.picker:undefined;const i=t?Dr:Rr;return new ai(e.document,{expanded:n!==null&&n!==void 0?n:false,formatter:i,parser:Cr,pickerLayout:r!==null&&r!==void 0?r:"popup",supportsAlpha:t,value:e.value,viewProps:e.viewProps})}},Si={id:"input-color-string",type:"input",accept:(e,t)=>{if(typeof e!=="string")return null;if("view"in t&&t.view==="text")return null;const n=Tr(e);if(!n)return null;const r=br(t);return r?{initialValue:e,params:r}:null},binding:{reader:e=>Ar,equals:vr.equals,writer:e=>{const t=Tr(e.initialValue);if(!t)throw u.shouldNeverHappen();return fi(t)}},controller:e=>{const t=Tr(e.initialValue);if(!t)throw u.shouldNeverHappen();const n=Ur(t);const r="expanded"in e.params?e.params.expanded:undefined;const i="picker"in e.params?e.params.picker:undefined;return new ai(e.document,{expanded:r!==null&&r!==void 0?r:false,formatter:n,parser:Cr,pickerLayout:i!==null&&i!==void 0?i:"popup",supportsAlpha:Lr(t),value:e.value,viewProps:e.viewProps})}};class Ei{constructor(e){this.components=e.components;this.asm_=e.assembly}constrain(e){const t=this.asm_.toComponents(e).map((e,t)=>{var n,r;return(r=(n=this.components[t])===null||n===void 0?void 0:n.constrain(e))!==null&&r!==void 0?r:e});return this.asm_.fromComponents(t)}}const Ti=m("pndtxt");class Ci{constructor(n,e){this.textViews=e.textViews;this.element=n.createElement("div");this.element.classList.add(Ti());this.textViews.forEach(e=>{const t=n.createElement("div");t.classList.add(Ti("a"));t.appendChild(e.element);this.element.appendChild(t)})}}function Li(e,t,n){return new In(e,{arrayPosition:n===0?"fst":n===t.axes.length-1?"lst":"mid",baseStep:t.axes[n].baseStep,parser:t.parser,props:t.axes[n].textProps,value:A(0,{constraint:t.axes[n].constraint}),viewProps:t.viewProps})}class Ai{constructor(n,i){this.value=i.value;this.viewProps=i.viewProps;this.acs_=i.axes.map((e,t)=>Li(n,i,t));this.acs_.forEach((e,r)=>{bn({primary:this.value,secondary:e.value,forward:e=>{return i.assembly.toComponents(e.rawValue)[r]},backward:(e,t)=>{const n=i.assembly.toComponents(e.rawValue);n[r]=t.rawValue;return i.assembly.fromComponents(n)}})});this.view=new Ci(n,{textViews:this.acs_.map(e=>e.view)})}}function Pi(e){if("step"in e&&!g(e.step))return new mt(e.step);return null}function Ri(e){if("max"in e&&!g(e.max)||"min"in e&&!g(e.min))return new ft({max:e.max,min:e.min});return null}function Di(e){const t=[];const n=Pi(e);if(n)t.push(n);const r=Ri(e);if(r)t.push(r);const i=qn(e.options);if(i)t.push(i);return new ht(t)}function Ni(e){const t=e?dt(e,ft):null;if(!t)return[undefined,undefined];return[t.minValue,t.maxValue]}function Ii(e){const[t,n]=Ni(e);return[t!==null&&t!==void 0?t:0,n!==null&&n!==void 0?n:100]}const ki={id:"input-number",type:"input",accept:(e,t)=>{if(typeof e!=="number")return null;const n=O;const r=z(t,{format:n.optional.function,max:n.optional.number,min:n.optional.number,options:n.optional.custom(Bn),step:n.optional.number});return r?{initialValue:e,params:r}:null},binding:{reader:e=>cn,constraint:e=>Di(e.params),writer:e=>Hn},controller:e=>{var t,n;const r=e.value;const i=e.constraint;if(i&&dt(i,pt))return new yt(e.document,{props:P.fromObject({options:(t=Xn(i))!==null&&t!==void 0?t:[]}),value:r,viewProps:e.viewProps});const s=(n="format"in e.params?e.params.format:undefined)!==null&&n!==void 0?n:hn(Kn(i,r.rawValue));if(i&&dt(i,ft)){const[a,o]=Ii(i);return new Fn(e.document,{baseStep:Jn(i),parser:ln,sliderProps:P.fromObject({maxValue:o,minValue:a}),textProps:P.fromObject({draggingScale:Zn(i,r.rawValue),formatter:s}),value:r,viewProps:e.viewProps})}return new In(e.document,{baseStep:Jn(i),parser:ln,props:P.fromObject({draggingScale:Zn(i,r.rawValue),formatter:s}),value:r,viewProps:e.viewProps})}};class Oi{constructor(e=0,t=0){this.x=e;this.y=t}getComponents(){return[this.x,this.y]}static isObject(e){if(g(e))return false;const t=e.x;const n=e.y;if(typeof t!=="number"||typeof n!=="number")return false;return true}static equals(e,t){return e.x===t.x&&e.y===t.y}toObject(){return{x:this.x,y:this.y}}}const zi={toComponents:e=>e.getComponents(),fromComponents:e=>new Oi(...e)},Ui=m("p2d");class Vi{constructor(e,t){this.element=e.createElement("div");this.element.classList.add(Ui());t.viewProps.bindClassModifiers(this.element);x(t.expanded,w(this.element,Ui(undefined,"expanded")));const n=e.createElement("div");n.classList.add(Ui("h"));this.element.appendChild(n);const r=e.createElement("button");r.classList.add(Ui("b"));r.appendChild($(e,"p2dpad"));t.viewProps.bindDisabled(r);n.appendChild(r);this.buttonElement=r;const i=e.createElement("div");i.classList.add(Ui("t"));n.appendChild(i);this.textElement=i;if(t.pickerLayout==="inline"){const s=e.createElement("div");s.classList.add(Ui("p"));this.element.appendChild(s);this.pickerElement=s}else this.pickerElement=null}}const Fi=m("p2dp");class Hi{constructor(e,t){this.onFoldableChange_=this.onFoldableChange_.bind(this);this.onValueChange_=this.onValueChange_.bind(this);this.invertsY_=t.invertsY;this.maxValue_=t.maxValue;this.element=e.createElement("div");this.element.classList.add(Fi());if(t.layout==="popup")this.element.classList.add(Fi(undefined,"p"));const n=e.createElement("div");n.classList.add(Fi("p"));t.viewProps.bindTabIndex(n);this.element.appendChild(n);this.padElement=n;const r=e.createElementNS(G,"svg");r.classList.add(Fi("g"));this.padElement.appendChild(r);this.svgElem_=r;const i=e.createElementNS(G,"line");i.classList.add(Fi("ax"));i.setAttributeNS(null,"x1","0");i.setAttributeNS(null,"y1","50%");i.setAttributeNS(null,"x2","100%");i.setAttributeNS(null,"y2","50%");this.svgElem_.appendChild(i);const s=e.createElementNS(G,"line");s.classList.add(Fi("ax"));s.setAttributeNS(null,"x1","50%");s.setAttributeNS(null,"y1","0");s.setAttributeNS(null,"x2","50%");s.setAttributeNS(null,"y2","100%");this.svgElem_.appendChild(s);const a=e.createElementNS(G,"line");a.classList.add(Fi("l"));a.setAttributeNS(null,"x1","50%");a.setAttributeNS(null,"y1","50%");this.svgElem_.appendChild(a);this.lineElem_=a;const o=e.createElement("div");o.classList.add(Fi("m"));this.padElement.appendChild(o);this.markerElem_=o;t.value.emitter.on("change",this.onValueChange_);this.value=t.value;this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[e,t]=this.value.rawValue.getComponents();const n=this.maxValue_;const r=Ln(e,-n,+n,0,100);const i=Ln(t,-n,+n,0,100);const s=this.invertsY_?100-i:i;this.lineElem_.setAttributeNS(null,"x2",`${r}%`);this.lineElem_.setAttributeNS(null,"y2",`${s}%`);this.markerElem_.style.left=`${r}%`;this.markerElem_.style.top=`${s}%`}onValueChange_(){this.update_()}onFoldableChange_(){this.update_()}}function Bi(e,t,n){return[_n(t[0],Mn(e)),_n(t[1],wn(e))*(n?1:-1)]}class Gi{constructor(e,t){this.onPadKeyDown_=this.onPadKeyDown_.bind(this);this.onPadKeyUp_=this.onPadKeyUp_.bind(this);this.onPointerDown_=this.onPointerDown_.bind(this);this.onPointerMove_=this.onPointerMove_.bind(this);this.onPointerUp_=this.onPointerUp_.bind(this);this.value=t.value;this.viewProps=t.viewProps;this.baseSteps_=t.baseSteps;this.maxValue_=t.maxValue;this.invertsY_=t.invertsY;this.view=new Hi(e,{invertsY:this.invertsY_,layout:t.layout,maxValue:this.maxValue_,value:this.value,viewProps:this.viewProps});this.ptHandler_=new Cn(this.view.padElement);this.ptHandler_.emitter.on("down",this.onPointerDown_);this.ptHandler_.emitter.on("move",this.onPointerMove_);this.ptHandler_.emitter.on("up",this.onPointerUp_);this.view.padElement.addEventListener("keydown",this.onPadKeyDown_);this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const n=this.maxValue_;const r=Ln(e.point.x,0,e.bounds.width,-n,+n);const i=Ln(this.invertsY_?e.bounds.height-e.point.y:e.point.y,0,e.bounds.height,-n,+n);this.value.setRawValue(new Oi(r,i),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:false,last:false})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:false,last:false})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:true,last:true})}onPadKeyDown_(e){if(En(e.key))e.preventDefault();const[t,n]=Bi(e,this.baseSteps_,this.invertsY_);if(t===0&&n===0)return;this.value.setRawValue(new Oi(this.value.rawValue.x+t,this.value.rawValue.y+n),{forceEmit:false,last:false})}onPadKeyUp_(e){const[t,n]=Bi(e,this.baseSteps_,this.invertsY_);if(t===0&&n===0)return;this.value.setRawValue(this.value.rawValue,{forceEmit:true,last:true})}}class Wi{constructor(e,t){var n,r;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this);this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this);this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this);this.onPadButtonClick_=this.onPadButtonClick_.bind(this);this.value=t.value;this.viewProps=t.viewProps;this.foldable_=he.create(t.expanded);this.popC_=t.pickerLayout==="popup"?new _t(e,{viewProps:this.viewProps}):null;const i=new Gi(e,{baseSteps:[t.axes[0].baseStep,t.axes[1].baseStep],invertsY:t.invertsY,layout:t.pickerLayout,maxValue:t.maxValue,value:this.value,viewProps:this.viewProps});i.view.allFocusableElements.forEach(e=>{e.addEventListener("blur",this.onPopupChildBlur_);e.addEventListener("keydown",this.onPopupChildKeydown_)});this.pickerC_=i;this.textC_=new Ai(e,{assembly:zi,axes:t.axes,parser:t.parser,value:this.value,viewProps:this.viewProps});this.view=new Vi(e,{expanded:this.foldable_.value("expanded"),pickerLayout:t.pickerLayout,viewProps:this.viewProps});this.view.textElement.appendChild(this.textC_.view.element);(n=this.view.buttonElement)===null||n===void 0?void 0:n.addEventListener("blur",this.onPadButtonBlur_);(r=this.view.buttonElement)===null||r===void 0?void 0:r.addEventListener("click",this.onPadButtonClick_);if(this.popC_){this.view.element.appendChild(this.popC_.view.element);this.popC_.view.element.appendChild(this.pickerC_.view.element);bn({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:e=>e.rawValue,backward:(e,t)=>t.rawValue})}else if(this.view.pickerElement){this.view.pickerElement.appendChild(this.pickerC_.view.element);fe(this.foldable_,this.view.pickerElement)}}onPadButtonBlur_(e){if(!this.popC_)return;const t=this.view.element;const n=o(e.relatedTarget);if(!n||!t.contains(n))this.popC_.shows.rawValue=false}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded"));if(this.foldable_.get("expanded"))this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element;const n=re(e);if(n&&t.contains(n))return;if(n&&n===this.view.buttonElement&&!q(t.ownerDocument))return;this.popC_.shows.rawValue=false}onPopupChildKeydown_(e){if(this.popC_){if(e.key==="Escape")this.popC_.shows.rawValue=false}else if(this.view.pickerElement)if(e.key==="Escape")this.view.buttonElement.focus()}}function ji(e){return Oi.isObject(e)?new Oi(e.x,e.y):new Oi}function qi(e,t){e.writeProperty("x",t.x);e.writeProperty("y",t.y)}function Xi(e){if(!e)return undefined;const t=[];if(!g(e.step))t.push(new mt(e.step));if(!g(e.max)||!g(e.min))t.push(new ft({max:e.max,min:e.min}));return new ht(t)}function Yi(e){return new Ei({assembly:zi,components:[Xi("x"in e?e.x:undefined),Xi("y"in e?e.y:undefined)]})}function Ki(e,t){const n=e&&dt(e,ft);if(n)return Math.max(Math.abs(n.minValue||0),Math.abs(n.maxValue||0));const r=Jn(e);return Math.max(Math.abs(r)*10,Math.abs(t)*10)}function Ji(e,t){const n=t instanceof Ei?t.components[0]:undefined;const r=t instanceof Ei?t.components[1]:undefined;const i=Ki(n,e.x);const s=Ki(r,e.y);return Math.max(i,s)}function Zi(e,t){return{baseStep:Jn(t),constraint:t,textProps:P.fromObject({draggingScale:Zn(t,e),formatter:hn(Kn(t,e))})}}function $i(e){if(!("y"in e))return false;const t=e.y;if(!t)return false;return"inverted"in t?!!t.inverted:false}const Qi={id:"input-point2d",type:"input",accept:(e,t)=>{if(!Oi.isObject(e))return null;const n=O;const r=z(t,{expanded:n.optional.boolean,picker:n.optional.custom(Gn),x:n.optional.custom(Wn),y:n.optional.object({inverted:n.optional.boolean,max:n.optional.number,min:n.optional.number,step:n.optional.number})});return r?{initialValue:e,params:r}:null},binding:{reader:e=>ji,constraint:e=>Yi(e.params),equals:Oi.equals,writer:e=>qi},controller:e=>{const t=e.document;const n=e.value;const r=e.constraint;if(!(r instanceof Ei))throw u.shouldNeverHappen();const i="expanded"in e.params?e.params.expanded:undefined;const s="picker"in e.params?e.params.picker:undefined;return new Wi(t,{axes:[Zi(n.rawValue.x,r.components[0]),Zi(n.rawValue.y,r.components[1])],expanded:i!==null&&i!==void 0?i:false,invertsY:$i(e.params),maxValue:Ji(n.rawValue,r),parser:ln,pickerLayout:s!==null&&s!==void 0?s:"popup",value:n,viewProps:e.viewProps})}};class es{constructor(e=0,t=0,n=0){this.x=e;this.y=t;this.z=n}getComponents(){return[this.x,this.y,this.z]}static isObject(e){if(g(e))return false;const t=e.x;const n=e.y;const r=e.z;if(typeof t!=="number"||typeof n!=="number"||typeof r!=="number")return false;return true}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const ts={toComponents:e=>e.getComponents(),fromComponents:e=>new es(...e)};function ns(e){return es.isObject(e)?new es(e.x,e.y,e.z):new es}function rs(e,t){e.writeProperty("x",t.x);e.writeProperty("y",t.y);e.writeProperty("z",t.z)}function is(e){if(!e)return undefined;const t=[];if(!g(e.step))t.push(new mt(e.step));if(!g(e.max)||!g(e.min))t.push(new ft({max:e.max,min:e.min}));return new ht(t)}function ss(e){return new Ei({assembly:ts,components:[is("x"in e?e.x:undefined),is("y"in e?e.y:undefined),is("z"in e?e.z:undefined)]})}function as(e,t){return{baseStep:Jn(t),constraint:t,textProps:P.fromObject({draggingScale:Zn(t,e),formatter:hn(Kn(t,e))})}}const os={id:"input-point3d",type:"input",accept:(e,t)=>{if(!es.isObject(e))return null;const n=O;const r=z(t,{x:n.optional.custom(Wn),y:n.optional.custom(Wn),z:n.optional.custom(Wn)});return r?{initialValue:e,params:r}:null},binding:{reader:e=>ns,constraint:e=>ss(e.params),equals:es.equals,writer:e=>rs},controller:e=>{const t=e.value;const n=e.constraint;if(!(n instanceof Ei))throw u.shouldNeverHappen();return new Ai(e.document,{assembly:ts,axes:[as(t.rawValue.x,n.components[0]),as(t.rawValue.y,n.components[1]),as(t.rawValue.z,n.components[2])],parser:ln,value:t,viewProps:e.viewProps})}};class ls{constructor(e=0,t=0,n=0,r=0){this.x=e;this.y=t;this.z=n;this.w=r}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(e){if(g(e))return false;const t=e.x;const n=e.y;const r=e.z;const i=e.w;if(typeof t!=="number"||typeof n!=="number"||typeof r!=="number"||typeof i!=="number")return false;return true}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const cs={toComponents:e=>e.getComponents(),fromComponents:e=>new ls(...e)};function us(e){return ls.isObject(e)?new ls(e.x,e.y,e.z,e.w):new ls}function hs(e,t){e.writeProperty("x",t.x);e.writeProperty("y",t.y);e.writeProperty("z",t.z);e.writeProperty("w",t.w)}function ds(e){if(!e)return undefined;const t=[];if(!g(e.step))t.push(new mt(e.step));if(!g(e.max)||!g(e.min))t.push(new ft({max:e.max,min:e.min}));return new ht(t)}function ps(e){return new Ei({assembly:cs,components:[ds("x"in e?e.x:undefined),ds("y"in e?e.y:undefined),ds("z"in e?e.z:undefined),ds("w"in e?e.w:undefined)]})}function fs(e,t){return{baseStep:Jn(t),constraint:t,textProps:P.fromObject({draggingScale:Zn(t,e),formatter:hn(Kn(t,e))})}}const ms={id:"input-point4d",type:"input",accept:(e,t)=>{if(!ls.isObject(e))return null;const n=O;const r=z(t,{x:n.optional.custom(Wn),y:n.optional.custom(Wn),z:n.optional.custom(Wn),w:n.optional.custom(Wn)});return r?{initialValue:e,params:r}:null},binding:{reader:e=>us,constraint:e=>ps(e.params),equals:ls.equals,writer:e=>hs},controller:e=>{const t=e.value;const n=e.constraint;if(!(n instanceof Ei))throw u.shouldNeverHappen();return new Ai(e.document,{assembly:cs,axes:t.rawValue.getComponents().map((e,t)=>fs(e,n.components[t])),parser:ln,value:t,viewProps:e.viewProps})}};function gs(e){const t=[];const n=qn(e.options);if(n)t.push(n);return new ht(t)}const vs={id:"input-string",type:"input",accept:(e,t)=>{if(typeof e!=="string")return null;const n=O;const r=z(t,{options:n.optional.custom(Bn)});return r?{initialValue:e,params:r}:null},binding:{reader:e=>fn,constraint:e=>gs(e.params),writer:e=>Hn},controller:e=>{var t;const n=e.document;const r=e.value;const i=e.constraint;if(i&&dt(i,pt))return new yt(n,{props:P.fromObject({options:(t=Xn(i))!==null&&t!==void 0?t:[]}),value:r,viewProps:e.viewProps});return new St(n,{parser:e=>e,props:P.fromObject({formatter:mn}),value:r,viewProps:e.viewProps})}},ys={monitor:{defaultInterval:200,defaultLineCount:3}},xs=m("mll");class bs{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this);this.formatter_=t.formatter;this.element=e.createElement("div");this.element.classList.add(xs());t.viewProps.bindClassModifiers(this.element);const n=e.createElement("textarea");n.classList.add(xs("i"));n.style.height=`calc(var(--bld-us) * ${t.lineCount})`;n.readOnly=true;t.viewProps.bindDisabled(n);this.element.appendChild(n);this.textareaElem_=n;t.value.emitter.on("change",this.onValueUpdate_);this.value=t.value;this.update_()}update_(){const e=this.textareaElem_;const t=e.scrollTop===e.scrollHeight-e.clientHeight;const n=[];this.value.rawValue.forEach(e=>{if(e!==undefined)n.push(this.formatter_(e))});e.textContent=n.join("\n");if(t)e.scrollTop=e.scrollHeight}onValueUpdate_(){this.update_()}}class _s{constructor(e,t){this.value=t.value;this.viewProps=t.viewProps;this.view=new bs(e,{formatter:t.formatter,lineCount:t.lineCount,value:this.value,viewProps:this.viewProps})}}const ws=m("sgl");class Ms{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this);this.formatter_=t.formatter;this.element=e.createElement("div");this.element.classList.add(ws());t.viewProps.bindClassModifiers(this.element);const n=e.createElement("input");n.classList.add(ws("i"));n.readOnly=true;n.type="text";t.viewProps.bindDisabled(n);this.element.appendChild(n);this.inputElement=n;t.value.emitter.on("change",this.onValueUpdate_);this.value=t.value;this.update_()}update_(){const e=this.value.rawValue;const t=e[e.length-1];this.inputElement.value=t!==undefined?this.formatter_(t):""}onValueUpdate_(){this.update_()}}class Ss{constructor(e,t){this.value=t.value;this.viewProps=t.viewProps;this.view=new Ms(e,{formatter:t.formatter,value:this.value,viewProps:this.viewProps})}}const Es={id:"monitor-bool",type:"monitor",accept:(e,t)=>{if(typeof e!=="boolean")return null;const n=O;const r=z(t,{lineCount:n.optional.number});return r?{initialValue:e,params:r}:null},binding:{reader:e=>Tt},controller:e=>{var t;if(e.value.rawValue.length===1)return new Ss(e.document,{formatter:Ct,value:e.value,viewProps:e.viewProps});return new _s(e.document,{formatter:Ct,lineCount:(t=e.params.lineCount)!==null&&t!==void 0?t:ys.monitor.defaultLineCount,value:e.value,viewProps:e.viewProps})}};class Ts{constructor(){this.emitter=new p;this.index_=-1}get index(){return this.index_}set index(e){const t=this.index_!==e;if(t){this.index_=e;this.emitter.emit("change",{index:e,sender:this})}}}const Cs=m("grl");class Ls{constructor(e,t){this.onCursorChange_=this.onCursorChange_.bind(this);this.onValueUpdate_=this.onValueUpdate_.bind(this);this.element=e.createElement("div");this.element.classList.add(Cs());t.viewProps.bindClassModifiers(this.element);this.formatter_=t.formatter;this.minValue_=t.minValue;this.maxValue_=t.maxValue;this.cursor_=t.cursor;this.cursor_.emitter.on("change",this.onCursorChange_);const n=e.createElementNS(G,"svg");n.classList.add(Cs("g"));n.style.height=`calc(var(--bld-us) * ${t.lineCount})`;this.element.appendChild(n);this.svgElem_=n;const r=e.createElementNS(G,"polyline");this.svgElem_.appendChild(r);this.lineElem_=r;const i=e.createElement("div");i.classList.add(Cs("t"),m("tt")());this.element.appendChild(i);this.tooltipElem_=i;t.value.emitter.on("change",this.onValueUpdate_);this.value=t.value;this.update_()}get graphElement(){return this.svgElem_}update_(){const i=this.svgElem_.getBoundingClientRect();const s=this.value.rawValue.length-1;const a=this.minValue_;const o=this.maxValue_;const l=[];this.value.rawValue.forEach((e,t)=>{if(e===undefined)return;const n=Ln(t,0,s,0,i.width);const r=Ln(e,a,o,i.height,0);l.push([n,r].join(","))});this.lineElem_.setAttributeNS(null,"points",l.join(" "));const e=this.tooltipElem_;const t=this.value.rawValue[this.cursor_.index];if(t===undefined){e.classList.remove(Cs("t","a"));return}const n=Ln(this.cursor_.index,0,s,0,i.width);const r=Ln(t,a,o,i.height,0);e.style.left=`${n}px`;e.style.top=`${r}px`;e.textContent=`${this.formatter_(t)}`;if(!e.classList.contains(Cs("t","a"))){e.classList.add(Cs("t","a"),Cs("t","in"));W(e);e.classList.remove(Cs("t","in"))}}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class As{constructor(e,t){this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this);this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this);this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this);this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this);this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this);this.value=t.value;this.viewProps=t.viewProps;this.cursor_=new Ts;this.view=new Ls(e,{cursor:this.cursor_,formatter:t.formatter,lineCount:t.lineCount,maxValue:t.maxValue,minValue:t.minValue,value:this.value,viewProps:this.viewProps});if(!q(e)){this.view.element.addEventListener("mousemove",this.onGraphMouseMove_);this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_)}else{const n=new Cn(this.view.element);n.emitter.on("down",this.onGraphPointerDown_);n.emitter.on("move",this.onGraphPointerMove_);n.emitter.on("up",this.onGraphPointerUp_)}}onGraphMouseLeave_(){this.cursor_.index=-1}onGraphMouseMove_(e){const t=this.view.element.getBoundingClientRect();this.cursor_.index=Math.floor(Ln(e.offsetX,0,t.width,0,this.value.rawValue.length))}onGraphPointerDown_(e){this.onGraphPointerMove_(e)}onGraphPointerMove_(e){if(!e.data.point){this.cursor_.index=-1;return}this.cursor_.index=Math.floor(Ln(e.data.point.x,0,e.data.bounds.width,0,this.value.rawValue.length))}onGraphPointerUp_(){this.cursor_.index=-1}}function Ps(e){return"format"in e&&!g(e.format)?e.format:hn(2)}function Rs(e){var t;if(e.value.rawValue.length===1)return new Ss(e.document,{formatter:Ps(e.params),value:e.value,viewProps:e.viewProps});return new _s(e.document,{formatter:Ps(e.params),lineCount:(t=e.params.lineCount)!==null&&t!==void 0?t:ys.monitor.defaultLineCount,value:e.value,viewProps:e.viewProps})}function Ds(e){var t,n,r;return new As(e.document,{formatter:Ps(e.params),lineCount:(t=e.params.lineCount)!==null&&t!==void 0?t:ys.monitor.defaultLineCount,maxValue:(n="max"in e.params?e.params.max:null)!==null&&n!==void 0?n:100,minValue:(r="min"in e.params?e.params.min:null)!==null&&r!==void 0?r:0,value:e.value,viewProps:e.viewProps})}function Ns(e){return"view"in e&&e.view==="graph"}const Is={id:"monitor-number",type:"monitor",accept:(e,t)=>{if(typeof e!=="number")return null;const n=O;const r=z(t,{format:n.optional.function,lineCount:n.optional.number,max:n.optional.number,min:n.optional.number,view:n.optional.string});return r?{initialValue:e,params:r}:null},binding:{defaultBufferSize:e=>Ns(e)?64:1,reader:e=>cn},controller:e=>{if(Ns(e.params))return Ds(e);return Rs(e)}},ks={id:"monitor-string",type:"monitor",accept:(e,t)=>{if(typeof e!=="string")return null;const n=O;const r=z(t,{lineCount:n.optional.number,multiline:n.optional.boolean});return r?{initialValue:e,params:r}:null},binding:{reader:e=>fn},controller:e=>{var t;const n=e.value;const r=n.rawValue.length>1||"multiline"in e.params&&e.params.multiline;if(r)return new _s(e.document,{formatter:mn,lineCount:(t=e.params.lineCount)!==null&&t!==void 0?t:ys.monitor.defaultLineCount,value:n,viewProps:e.viewProps});return new Ss(e.document,{formatter:mn,value:n,viewProps:e.viewProps})}};class Os{constructor(e){this.onValueChange_=this.onValueChange_.bind(this);this.reader=e.reader;this.writer=e.writer;this.emitter=new p;this.value=e.value;this.value.emitter.on("change",this.onValueChange_);this.target=e.target;this.read()}read(){const e=this.target.read();if(e!==undefined)this.value.rawValue=this.reader(e)}write_(e){this.writer(this.target,e)}onValueChange_(e){this.write_(e.rawValue);this.emitter.emit("change",{options:e.options,rawValue:e.rawValue,sender:this})}}function zs(e,t){const n=e.accept(t.target.read(),t.params);if(g(n))return null;const r=O;const i={target:t.target,initialValue:n.initialValue,params:n.params};const s=e.binding.reader(i);const a=e.binding.constraint?e.binding.constraint(i):undefined;const o=A(s(n.initialValue),{constraint:a,equals:e.binding.equals});const l=new Os({reader:s,target:t.target,value:o,writer:e.binding.writer(i)});const c=r.optional.boolean(t.params.disabled).value;const u=r.optional.boolean(t.params.hidden).value;const h=e.controller({constraint:a,document:t.document,initialValue:n.initialValue,params:n.params,value:l.value,viewProps:Ze.create({disabled:c,hidden:u})});const d=r.optional.string(t.params.label).value;return new we(t.document,{binding:l,blade:ue(),props:P.fromObject({label:d||t.target.key}),valueController:h})}class Us{constructor(e){this.onTick_=this.onTick_.bind(this);this.reader_=e.reader;this.target=e.target;this.emitter=new p;this.value=e.value;this.ticker=e.ticker;this.ticker.emitter.on("tick",this.onTick_);this.read()}dispose(){this.ticker.dispose()}read(){const e=this.target.read();if(e===undefined)return;const t=this.value.rawValue;const n=this.reader_(e);this.value.rawValue=xn(t,n);this.emitter.emit("update",{rawValue:n,sender:this})}onTick_(e){this.read()}}function Vs(e,t){return t===0?new ct:new ut(e,t!==null&&t!==void 0?t:ys.monitor.defaultInterval)}function Fs(e,t){var n,r,i;const s=O;const a=e.accept(t.target.read(),t.params);if(g(a))return null;const o={target:t.target,initialValue:a.initialValue,params:a.params};const l=e.binding.reader(o);const c=(r=(n=s.optional.number(t.params.bufferSize).value)!==null&&n!==void 0?n:e.binding.defaultBufferSize&&e.binding.defaultBufferSize(a.params))!==null&&r!==void 0?r:1;const u=s.optional.number(t.params.interval).value;const h=new Us({reader:l,target:t.target,ticker:Vs(t.document,u),value:vn(c)});const d=s.optional.boolean(t.params.disabled).value;const p=s.optional.boolean(t.params.hidden).value;const f=e.controller({document:t.document,params:a.params,value:h.value,viewProps:Ze.create({disabled:d,hidden:p})});const m=(i=s.optional.string(t.params.label).value)!==null&&i!==void 0?i:t.target.key;return new Se(t.document,{binding:h,blade:ue(),props:P.fromObject({label:m}),valueController:f})}class Hs{constructor(){this.pluginsMap_={blades:[],inputs:[],monitors:[]}}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(e){if(e.type==="blade")this.pluginsMap_.blades.unshift(e);else if(e.type==="input")this.pluginsMap_.inputs.unshift(e);else if(e.type==="monitor")this.pluginsMap_.monitors.unshift(e)}createInput(n,r,i){const e=r.read();if(g(e))throw new u({context:{key:r.key},type:"nomatchingcontroller"});const t=this.pluginsMap_.inputs.reduce((e,t)=>e||zs(t,{document:n,target:r,params:i}),null);if(t)return t;throw new u({context:{key:r.key},type:"nomatchingcontroller"})}createMonitor(n,r,i){const e=this.pluginsMap_.monitors.reduce((e,t)=>e||Fs(t,{document:n,params:i,target:r}),null);if(e)return e;throw new u({context:{key:r.key},type:"nomatchingcontroller"})}createBlade(n,r){const e=this.pluginsMap_.blades.reduce((e,t)=>e||lt(t,{document:n,params:r}),null);if(!e)throw new u({type:"nomatchingview",context:{params:r}});return e}createBladeApi(n){if(n instanceof we)return new _e(n);if(n instanceof Se)return new Me(n);if(n instanceof Ue)return new Le(n,this);const e=this.pluginsMap_.blades.reduce((e,t)=>e||t.api({controller:n,pool:this}),null);if(!e)throw u.shouldNeverHappen();return e}}function Bs(){const t=new Hs;[Qi,os,ms,vs,ki,Si,Mi,_i,nr,Es,ks,Is,le,Be,Ye,ot].forEach(e=>{t.register(e)});return t}class Gs extends n{constructor(e){super(e);this.emitter_=new p;this.controller_.valueController.value.emitter.on("change",e=>{this.emitter_.emit("change",{event:new s(this,e.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}get options(){return this.controller_.valueController.props.get("options")}set options(e){this.controller_.valueController.props.set("options",e)}get value(){return this.controller_.valueController.value.rawValue}set value(e){this.controller_.valueController.value.rawValue=e}on(e,t){const n=t.bind(this);this.emitter_.on(e,e=>{n(e.event)});return this}}class Ws extends n{constructor(e){super(e);this.emitter_=new p;this.controller_.valueController.value.emitter.on("change",e=>{this.emitter_.emit("change",{event:new s(this,e.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}get maxValue(){return this.controller_.valueController.sliderController.props.get("maxValue")}set maxValue(e){this.controller_.valueController.sliderController.props.set("maxValue",e)}get minValue(){return this.controller_.valueController.sliderController.props.get("minValue")}set minValue(e){this.controller_.valueController.sliderController.props.set("minValue",e)}get value(){return this.controller_.valueController.value.rawValue}set value(e){this.controller_.valueController.value.rawValue=e}on(e,t){const n=t.bind(this);this.emitter_.on(e,e=>{n(e.event)});return this}}class js extends n{constructor(e){super(e);this.emitter_=new p;this.controller_.valueController.value.emitter.on("change",e=>{this.emitter_.emit("change",{event:new s(this,e.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}get formatter(){return this.controller_.valueController.props.get("formatter")}set formatter(e){this.controller_.valueController.props.set("formatter",e)}get value(){return this.controller_.valueController.value.rawValue}set value(e){this.controller_.valueController.value.rawValue=e}on(e,t){const n=t.bind(this);this.emitter_.on(e,e=>{n(e.event)});return this}}const qs=function(){return{id:"list",type:"blade",accept(e){const t=O;const n=z(e,{options:t.required.custom(Bn),value:t.required.raw,view:t.required.constant("list"),label:t.optional.string});return n?{params:n}:null},controller(e){const t=new yt(e.document,{props:P.fromObject({options:jn(e.params.options)}),value:A(e.params.value),viewProps:e.viewProps});return new Ge(e.document,{blade:e.blade,props:P.fromObject({label:e.params.label}),valueController:t})},api(e){if(!(e.controller instanceof Ge))return null;if(!(e.controller.valueController instanceof yt))return null;return new Gs(e.controller)}}}();function Xs(e){return e.reduce((e,t)=>{return Object.assign(e,{[t.presetKey]:t.read()})},{})}function Ys(e,n){e.forEach(e=>{const t=n[e.presetKey];if(t!==undefined)e.write(t)})}class Ks extends Ae{constructor(e,t){super(e,t)}get element(){return this.controller_.view.element}importPreset(e){const t=this.controller_.rackController.rack.find(we).map(e=>{return e.binding.target});Ys(t,e);this.refresh()}exportPreset(){const e=this.controller_.rackController.rack.find(we).map(e=>{return e.binding.target});return Xs(e)}refresh(){this.controller_.rackController.rack.find(we).forEach(e=>{e.binding.read()});this.controller_.rackController.rack.find(Se).forEach(e=>{e.binding.read()})}}class Js extends He{constructor(e,t){super(e,{expanded:t.expanded,blade:t.blade,props:t.props,root:true,viewProps:t.viewProps})}}const Zs={id:"slider",type:"blade",accept(e){const t=O;const n=z(e,{max:t.required.number,min:t.required.number,view:t.required.constant("slider"),format:t.optional.function,label:t.optional.string,value:t.optional.number});return n?{params:n}:null},controller(e){var t,n;const r=(t=e.params.value)!==null&&t!==void 0?t:0;const i=new Fn(e.document,{baseStep:1,parser:ln,sliderProps:P.fromObject({maxValue:e.params.max,minValue:e.params.min}),textProps:P.fromObject({draggingScale:Zn(undefined,r),formatter:(n=e.params.format)!==null&&n!==void 0?n:un}),value:A(r),viewProps:e.viewProps});return new Ge(e.document,{blade:e.blade,props:P.fromObject({label:e.params.label}),valueController:i})},api(e){if(!(e.controller instanceof Ge))return null;if(!(e.controller.valueController instanceof Fn))return null;return new Ws(e.controller)}},$s=function(){return{id:"text",type:"blade",accept(e){const t=O;const n=z(e,{parse:t.required.function,value:t.required.raw,view:t.required.constant("text"),format:t.optional.function,label:t.optional.string});return n?{params:n}:null},controller(e){var t;const n=new St(e.document,{parser:e.params.parse,props:P.fromObject({formatter:(t=e.params.format)!==null&&t!==void 0?t:e=>String(e)}),value:A(e.params.value),viewProps:e.viewProps});return new Ge(e.document,{blade:e.blade,props:P.fromObject({label:e.params.label}),valueController:n})},api(e){if(!(e.controller instanceof Ge))return null;if(!(e.controller.valueController instanceof St))return null;return new js(e.controller)}}}();function Qs(e){const t=e.createElement("div");t.classList.add(m("dfw")());if(e.body)e.body.appendChild(t);return t}function ea(e,t,n){if(e.querySelector(`style[data-tp-style=${t}]`))return;const r=e.createElement("style");r.dataset.tpStyle=t;r.textContent=n;e.head.appendChild(r)}class ta extends Ks{constructor(e){var t;const n=e||{};const r=(t=n.document)!==null&&t!==void 0?t:Y();const i=Bs();const s=new Js(r,{expanded:n.expanded,blade:ue(),props:P.fromObject({title:n.title}),viewProps:Ze.create()});super(s,i);this.pool_=i;this.containerElem_=n.container||Qs(r);this.containerElem_.appendChild(this.element);this.doc_=r;this.usesDefaultWrapper_=!n.container;this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw u.alreadyDisposed();return this.doc_}dispose(){const e=this.containerElem_;if(!e)throw u.alreadyDisposed();if(this.usesDefaultWrapper_){const t=e.parentElement;if(t)t.removeChild(e)}this.containerElem_=null;this.doc_=null;super.dispose()}registerPlugin(e){const t="plugin"in e?[e.plugin]:"plugins"in e?e.plugins:[];t.forEach(e=>{this.pool_.register(e);this.embedPluginStyle_(e)})}embedPluginStyle_(e){if(e.css)ea(this.document,`plugin-${e.id}`,e.css)}setUpDefaultPlugins_(){ea(this.document,"default",".tp-lstv_s,.tp-btnv_b,.tp-p2dv_b,.tp-colswv_sw,.tp-p2dpv_p,.tp-txtv_i,.tp-grlv_g,.tp-sglv_i,.tp-mllv_i,.tp-fldv_b,.tp-rotv_b,.tp-ckbv_i,.tp-coltxtv_ms,.tp-tbiv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-lstv_s,.tp-btnv_b,.tp-p2dv_b{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-lstv_s:hover,.tp-btnv_b:hover,.tp-p2dv_b:hover{background-color:var(--btn-bg-h)}.tp-lstv_s:focus,.tp-btnv_b:focus,.tp-p2dv_b:focus{background-color:var(--btn-bg-f)}.tp-lstv_s:active,.tp-btnv_b:active,.tp-p2dv_b:active{background-color:var(--btn-bg-a)}.tp-lstv_s:disabled,.tp-btnv_b:disabled,.tp-p2dv_b:disabled{opacity:0.5}.tp-colswv_sw,.tp-p2dpv_p,.tp-txtv_i{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-colswv_sw:hover,.tp-p2dpv_p:hover,.tp-txtv_i:hover{background-color:var(--in-bg-h)}.tp-colswv_sw:focus,.tp-p2dpv_p:focus,.tp-txtv_i:focus{background-color:var(--in-bg-f)}.tp-colswv_sw:active,.tp-p2dpv_p:active,.tp-txtv_i:active{background-color:var(--in-bg-a)}.tp-colswv_sw:disabled,.tp-p2dpv_p:disabled,.tp-txtv_i:disabled{opacity:0.5}.tp-grlv_g,.tp-sglv_i,.tp-mllv_i{background-color:var(--mo-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--mo-fg);height:var(--bld-us);width:100%}.tp-rotv{--font-family: var(--tp-font-family, Roboto Mono,Source Code Pro,Menlo,Courier,monospace);--bs-br: var(--tp-base-border-radius, 6px);--cnt-h-p: var(--tp-container-horizontal-padding, 4px);--cnt-v-p: var(--tp-container-vertical-padding, 4px);--elm-br: var(--tp-element-border-radius, 2px);--bld-s: var(--tp-blade-spacing, 4px);--bld-us: var(--tp-blade-unit-size, 20px);--bs-bg: var(--tp-base-background-color, #2f3137);--bs-sh: var(--tp-base-shadow-color, rgba(0,0,0,0.2));--btn-bg: var(--tp-button-background-color, #adafb8);--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, #2f3137);--cnt-bg: var(--tp-container-background-color, rgba(187,188,196,0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187,188,196,0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187,188,196,0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187,188,196,0.15));--cnt-fg: var(--tp-container-foreground-color, #bbbcc4);--in-bg: var(--tp-input-background-color, rgba(0,0,0,0.2));--in-bg-a: var(--tp-input-background-color-active, rgba(0,0,0,0.35));--in-bg-f: var(--tp-input-background-color-focus, rgba(0,0,0,0.3));--in-bg-h: var(--tp-input-background-color-hover, rgba(0,0,0,0.25));--in-fg: var(--tp-input-foreground-color, #bbbcc4);--lbl-fg: var(--tp-label-foreground-color, rgba(187,188,196,0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0,0,0,0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187,188,196,0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(0,0,0,0.2))}.tp-fldv_c>.tp-cntv.tp-v-lst,.tp-tabv_c .tp-brkv>.tp-cntv.tp-v-lst,.tp-rotv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1 * var(--cnt-v-p))}.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-fldv_c>*:not(.tp-v-fst),.tp-tabv_c .tp-brkv>*:not(.tp-v-fst),.tp-rotv_c>*:not(.tp-v-fst){margin-top:var(--bld-s)}.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-v-p)}.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-cntv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-v-p)}.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-fldv_c>.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv{margin-left:4px}.tp-fldv_c>.tp-fldv>.tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--elm-br);border-bottom-left-radius:var(--elm-br)}.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-fldv_c .tp-fldv>.tp-fldv_c,.tp-tabv_c .tp-brkv .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--elm-br)}.tp-fldv_c>.tp-tabv>.tp-tabv_i,.tp-tabv_c .tp-brkv>.tp-tabv>.tp-tabv_i{border-top-left-radius:var(--elm-br)}.tp-fldv_c .tp-tabv>.tp-tabv_c,.tp-tabv_c .tp-brkv .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--elm-br)}.tp-fldv_b,.tp-rotv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);overflow:hidden;padding-left:calc(var(--cnt-h-p) + 8px);padding-right:calc(2px * 2 + var(--bld-us) + var(--cnt-h-p));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-fldv_b:hover,.tp-rotv_b:hover{background-color:var(--cnt-bg-h)}.tp-fldv_b:focus,.tp-rotv_b:focus{background-color:var(--cnt-bg-f)}.tp-fldv_b:active,.tp-rotv_b:active{background-color:var(--cnt-bg-a)}.tp-fldv_b:disabled,.tp-rotv_b:disabled{opacity:0.5}.tp-fldv_m,.tp-rotv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:'';display:block;height:6px;right:calc(var(--cnt-h-p) + (var(--bld-us) + 4px - 6px) / 2 - 2px);margin:auto;opacity:0.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m,.tp-rotv.tp-rotv-expanded .tp-rotv_m{transform:none}.tp-fldv_c,.tp-rotv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c,.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c{display:none}.tp-fldv.tp-fldv-expanded>.tp-fldv_c,.tp-rotv.tp-rotv-expanded .tp-rotv_c{opacity:1;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-coltxtv_m,.tp-lstv{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-coltxtv_mm,.tp-lstv_m{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-coltxtv_mm svg,.tp-lstv_m svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-coltxtv_mm svg path,.tp-lstv_m svg path{fill:currentColor}.tp-coltxtv_w,.tp-pndtxtv{display:flex}.tp-coltxtv_c,.tp-pndtxtv_a{width:100%}.tp-coltxtv_c+.tp-coltxtv_c,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-pndtxtv_a{margin-left:2px}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--elm-br);cursor:pointer;display:block;height:var(--bld-us);position:relative;width:var(--bld-us)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:0.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--bld-s);opacity:1}.tp-colv .tp-popv{left:calc(-1 * var(--cnt-h-p));right:calc(-1 * var(--cnt-h-p));top:var(--bld-us)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--bld-s)}.tp-colpv_rgb{display:flex;margin-top:var(--bld-s);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-v-p);padding-top:calc(var(--cnt-v-p) + 2px);position:relative}.tp-colpv_a:before{background-color:var(--grv-fg);content:'';height:2px;left:calc(-1 * var(--cnt-h-p));position:absolute;right:calc(-1 * var(--cnt-h-p));top:0}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--elm-br);outline:none;overflow:hidden;position:relative}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--bld-us) * 4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,0.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0,0,0,0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--elm-br);border:rgba(255,255,255,0.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,0.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative;width:100%}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--elm-br);box-shadow:0 0 2px rgba(0,0,0,0.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--elm-br);border:rgba(255,255,255,0.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--elm-br)}.tp-colswv.tp-v-disabled{opacity:0.5}.tp-colswv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;cursor:pointer;display:block;height:var(--bld-us);left:0;margin:0;outline:none;padding:0;position:absolute;top:0;width:var(--bld-us)}.tp-colswv_b:focus::after{border:rgba(255,255,255,0.75) solid 2px;border-radius:var(--elm-br);bottom:0;content:'';display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--elm-br);color:var(--lbl-fg);cursor:pointer;height:var(--bld-us);line-height:var(--bld-us);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv.tp-fldv-not .tp-fldv_b{display:none}.tp-fldv_c{border-left:var(--cnt-bg) solid 4px}.tp-fldv_b:hover+.tp-fldv_c{border-left-color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_c{border-left-color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_c{border-left-color:var(--cnt-bg-a)}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--bld-us) * 3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left 0.05s, top 0.05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:0.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-h-p);padding-right:var(--cnt-h-p)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:0.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:160px}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding:0 4px}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:0.5}.tp-mllv_i{display:block;height:calc(var(--bld-us) * 3);line-height:var(--bld-us);padding:0 4px;resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:0.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--bld-us);margin-right:4px;position:relative;width:var(--bld-us)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--bld-s);opacity:1}.tp-p2dv .tp-popv{left:calc(-1 * var(--cnt-h-p));right:calc(-1 * var(--cnt-h-p));top:var(--bld-us)}.tp-p2dpv{padding-left:calc(var(--bld-us) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:0.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:0.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:6px;box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:168px;padding:var(--cnt-v-p) var(--cnt-h-p);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sldv.tp-v-disabled{opacity:0.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--bld-us);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:'';display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:'';display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--elm-br);bottom:0;content:'';display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv.tp-v-disabled{opacity:0.5}.tp-tabv_i{align-items:flex-end;display:flex;overflow:hidden}.tp-tabv.tp-tabv-nop .tp-tabv_i{height:calc(var(--bld-us) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_i::before{background-color:var(--cnt-bg);bottom:0;content:'';height:2px;left:0;position:absolute;right:0}.tp-tabv_c{border-left:var(--cnt-bg) solid 4px;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p)}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv::before{background-color:var(--cnt-bg);bottom:0;content:'';height:2px;left:-2px;position:absolute;width:2px}.tp-tbiv_b{background-color:var(--cnt-bg);display:block;padding-left:calc(var(--cnt-h-p) + 4px);padding-right:calc(var(--cnt-h-p) + 4px);width:100%}.tp-tbiv_b:hover{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active{background-color:var(--cnt-bg-a)}.tp-tbiv_b:disabled{opacity:0.5}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);opacity:0.5;overflow:hidden;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-txtv{position:relative}.tp-txtv_i{padding:0 4px}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:0.3}.tp-txtv_k{cursor:pointer;height:100%;left:-3px;position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:'';height:calc(var(--bld-us) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:0.1;position:absolute;top:0;transition:border-radius 0.1s, height 0.1s, transform 0.1s, width 0.1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--elm-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) transparent transparent transparent;border-style:solid;border-width:2px;box-sizing:border-box;content:'';font-size:0.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--font-family);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(2px * 2 + var(--bld-us) + var(--cnt-h-p));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0}.tp-rotv.tp-rotv-not .tp-rotv_b{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c,.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1 * var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1 * var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_i{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}");this.pool_.getAll().forEach(e=>{this.embedPluginStyle_(e)});this.registerPlugin({plugins:[Zs,qs,ot,$s]})}}const na=new t("3.0.5");e.BladeApi=n,e.ButtonApi=d,e.FolderApi=Ae,e.InputBindingApi=_e,e.ListApi=Gs,e.MonitorBindingApi=Me,e.Pane=ta,e.SeparatorApi=We,e.SliderApi=Ws,e.TabApi=rt,e.TabPageApi=nt,e.TextApi=js,e.TpChangeEvent=s,e.VERSION=na,Object.defineProperty(e,"__esModule",{value:true})}(t)}},r={};function Ch(e){var t=r[e];if(void 0!==t)return t.exports;t=r[e]={exports:{}};return n[e].call(t.exports,t,t.exports,Ch),t.exports}Ch.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return Ch.d(t,{a:t}),t},Ch.d=(e,t)=>{for(var n in t)Ch.o(t,n)&&!Ch.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},Ch.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),Ch.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;Ch.g.importScripts&&(e=Ch.g.location+"");var t=Ch.g.document;if(!e&&t&&((e=t.currentScript?t.currentScript.src:e)||(t=t.getElementsByTagName("script")).length&&(e=t[t.length-1].src)),!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),Ch.p=e+"../"})();(()=>{"use strict";var e=Ch(755),t=Ch.n(e);const N={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2};const j=0,q=1,X=2;const T=1,C=3,Ae=0,Pe=1,Re=2;const Y=0,K=1,J=2,Z=3,$=4,Q=5,ee=100,te=101,ne=102,re=103,ie=104,se=200,ae=201,oe=202,le=203,ce=204,ue=205,he=206,de=207,pe=208,fe=209,me=210,ge=0,ve=1,ye=2,xe=3,be=4,_e=5,we=6,Me=7,De=0,M=301,S=302,l=303,c=304,L=306,A=307,V=1e3,Ne=1001,F=1002,Ie=1003,H=1004;const B=1005;const G=1006,W=1007;const ke=1008;const Oe=1009,i=1010,s=1011,Se=1012,a=1013,Ee=1014,ze=1015,Ue=1016,o=1017,u=1018,h=1019,Te=1020,d=1021,Ce=1022,Ve=1023,p=1024,f=1025,r=Ve,Le=1026,Fe=1027,m=1028,g=1029,v=1030,y=1031,x=1032,b=1033,_=33776,w=33777,E=33778,P=33779,R=35840,D=35841,I=35842,k=35843,O=36196,z=37492,U=37496,He=37808,Be=37809,Ge=37810,We=37811,je=37812,qe=37813,Xe=37814,Ye=37815,Ke=37816,Je=37817,Ze=37818,$e=37819,Qe=37820,et=37821,tt=36492,nt=37840,rt=37841,it=37842,st=37843,at=37844,ot=37845,lt=37846,ct=37847,ut=37848,ht=37849,dt=37850,pt=37851,ft=37852,mt=37853,gt=3e3,n=3201,vt=0,yt=1;const xt="300 es";class bt{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){if(void 0!==this._listeners){const n=this._listeners[e];void 0===n||-1!==(t=n.indexOf(t))&&n.splice(t,1)}}dispatchEvent(n){if(void 0!==this._listeners){const e=this._listeners[n.type];if(void 0!==e){n.target=this;const r=e.slice(0);for(let e=0,t=r.length;e<t;e++)r[e].call(this,n);n.target=null}}}}const _t=[];for(let e=0;e<256;e++)_t[e]=(e<16?"0":"")+e.toString(16);let wt=1234567;const Mt=Math.PI/180,St=180/Math.PI;function Et(){var e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;const i=_t[255&e]+_t[e>>8&255]+_t[e>>16&255]+_t[e>>24&255]+"-"+_t[255&t]+_t[t>>8&255]+"-"+_t[t>>16&15|64]+_t[t>>24&255]+"-"+_t[63&n|128]+_t[n>>8&255]+"-"+_t[n>>16&255]+_t[n>>24&255]+_t[255&r]+_t[r>>8&255]+_t[r>>16&255]+_t[r>>24&255];return i.toUpperCase()}function Tt(e,t,n){return Math.max(t,Math.min(n,e))}function Ct(e,t){return(e%t+t)%t}function Lt(e,t,n){return(1-n)*e+n*t}function At(e){return 0==(e&e-1)&&0!==e}function Pt(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function Rt(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}var Dt=Object.freeze({__proto__:null,DEG2RAD:Mt,RAD2DEG:St,generateUUID:Et,clamp:Tt,euclideanModulo:Ct,mapLinear:function(e,t,n,r,i){return r+(e-t)*(i-r)/(n-t)},inverseLerp:function(e,t,n){return e!==t?(n-e)/(t-e):0},lerp:Lt,damp:function(e,t,n,r){return Lt(e,t,1-Math.exp(-n*r))},pingpong:function(e,t=1){return t-Math.abs(Ct(e,2*t)-t)},smoothstep:function(e,t,n){return e<=t?0:n<=e?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:n<=e?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){return void 0!==e&&(wt=e%2147483647),wt=16807*wt%2147483647,(wt-1)/2147483646},degToRad:function(e){return e*Mt},radToDeg:function(e){return e*St},isPowerOfTwo:At,ceilPowerOfTwo:Pt,floorPowerOfTwo:Rt,setQuaternionFromProperEuler:function(e,t,n,r,i){const s=Math.cos,a=Math.sin;var o=s(n/2),l=a(n/2),c=s((t+r)/2),u=a((t+r)/2),h=s((t-r)/2),d=a((t-r)/2),p=s((r-t)/2),f=a((r-t)/2);switch(i){case"XYX":e.set(o*u,l*h,l*d,o*c);break;case"YZY":e.set(l*d,o*u,l*h,o*c);break;case"ZXZ":e.set(l*h,l*d,o*u,o*c);break;case"XZX":e.set(o*u,l*f,l*p,o*c);break;case"YXY":e.set(l*p,o*u,l*f,o*c);break;case"ZYZ":e.set(l*f,l*p,o*u,o*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}});class Nt{constructor(e=0,t=0){this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){var t=this.x,n=this.y,e=e.elements;return this.x=e[0]*t+e[3]*n+e[6],this.y=e[1]*t+e[4]*n+e[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){var t=this.x-e.x,e=this.y-e.y;return t*t+e*e}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){var n=Math.cos(t),r=Math.sin(t),i=this.x-e.x,t=this.y-e.y;return this.x=i*n-t*r+e.x,this.y=i*r+t*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}}Nt.prototype.isVector2=!0;class It{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],0<arguments.length&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,t,n,r,i,s,a,o,l){const c=this.elements;return c[0]=e,c[1]=r,c[2]=a,c[3]=t,c[4]=i,c[5]=o,c[6]=n,c[7]=s,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements;e=e.elements;return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){e=e.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){var n=e.elements,r=t.elements;const i=this.elements;var s=n[0],a=n[3],o=n[6],l=n[1],c=n[4],u=n[7],h=n[2],d=n[5],p=n[8],f=r[0],m=r[3],g=r[6],v=r[1],y=r[4],e=r[7],t=r[2],n=r[5],r=r[8];return i[0]=s*f+a*v+o*t,i[3]=s*m+a*y+o*n,i[6]=s*g+a*e+o*r,i[1]=l*f+c*v+u*t,i[4]=l*m+c*y+u*n,i[7]=l*g+c*e+u*r,i[2]=h*f+d*v+p*t,i[5]=h*m+d*y+p*n,i[8]=h*g+d*e+p*r,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){var e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],a=e[5],o=e[6],l=e[7],e=e[8];return t*s*e-t*a*l-n*i*e+n*a*o+r*i*l-r*s*o}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],a=e[5],o=e[6],l=e[7],c=e[8],u=c*s-a*l,h=a*o-c*i,d=l*i-s*o,p=t*u+n*h+r*d;if(0==p)return this.set(0,0,0,0,0,0,0,0,0);var f=1/p;return e[0]=u*f,e[1]=(r*l-c*n)*f,e[2]=(a*n-r*s)*f,e[3]=h*f,e[4]=(c*t-r*o)*f,e[5]=(r*i-a*t)*f,e[6]=d*f,e[7]=(n*o-l*t)*f,e[8]=(s*t-n*i)*f,this}transpose(){var e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,r,i,s,a){var o=Math.cos(i),i=Math.sin(i);return this.set(n*o,n*i,-n*(o*s+i*a)+s+e,-r*i,r*o,-r*(-i*s+o*a)+a+t,0,0,1),this}scale(e,t){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}rotate(e){var t=Math.cos(e),n=Math.sin(e);const r=this.elements;var i=r[0],s=r[3],a=r[6],o=r[1],l=r[4],e=r[7];return r[0]=t*i+n*o,r[3]=t*s+n*l,r[6]=t*a+n*e,r[1]=-n*i+t*o,r[4]=-n*s+t*l,r[7]=-n*a+t*e,this}translate(e,t){const n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}equals(e){var t=this.elements,n=e.elements;for(let e=0;e<9;e++)if(t[e]!==n[e])return!1;return!0}fromArray(t,n=0){for(let e=0;e<9;e++)this.elements[e]=t[e+n];return this}toArray(e=[],t=0){var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}It.prototype.isMatrix3=!0;let kt;class Ot{static getDataURL(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===kt&&(kt=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),kt.width=e.width,kt.height=e.height;const n=kt.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=kt}return 2048<t.width||2048<t.height?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}}let zt=0;class Ut extends bt{constructor(e=Ut.DEFAULT_IMAGE,t=Ut.DEFAULT_MAPPING,n=Ne,r=Ne,i=G,s=ke,a=Ve,o=Oe,l=1,c=gt){super(),Object.defineProperty(this,"id",{value:zt++}),this.uuid=Et(),this.name="",this.image=e,this.mipmaps=[],this.mapping=t,this.wrapS=n,this.wrapT=r,this.magFilter=i,this.minFilter=s,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=o,this.offset=new Nt(0,0),this.repeat=new Nt(1,1),this.center=new Nt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new It,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c,this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this}toJSON(e){var t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){const r=this.image;if(void 0===r.uuid&&(r.uuid=Et()),!t&&void 0===e.images[r.uuid]){let n;if(Array.isArray(r)){n=[];for(let e=0,t=r.length;e<t;e++)r[e].isDataTexture?n.push(Vt(r[e].image)):n.push(Vt(r[e]))}else n=Vt(r);e.images[r.uuid]={uuid:r.uuid,url:n}}n.image=r.uuid}return t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||1<e.x)switch(this.wrapS){case V:e.x=e.x-Math.floor(e.x);break;case Ne:e.x=e.x<0?0:1;break;case F:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||1<e.y)switch(this.wrapT){case V:e.y=e.y-Math.floor(e.y);break;case Ne:e.y=e.y<0?0:1;break;case F:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&this.version++}}function Vt(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?Ot.getDataURL(e):e.data?{data:Array.prototype.slice.call(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}Ut.DEFAULT_IMAGE=void 0,Ut.DEFAULT_MAPPING=300,Ut.prototype.isTexture=!0;class Ft{constructor(e=0,t=0,n=0,r=1){this.x=e,this.y=t,this.z=n,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){var t=this.x,n=this.y,r=this.z,i=this.w,e=e.elements;return this.x=e[0]*t+e[4]*n+e[8]*r+e[12]*i,this.y=e[1]*t+e[5]*n+e[9]*r+e[13]*i,this.z=e[2]*t+e[6]*n+e[10]*r+e[14]*i,this.w=e[3]*t+e[7]*n+e[11]*r+e[15]*i,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,r,i;var s=e.elements,a=s[0],o=s[4],l=s[8],c=s[1],u=s[5],h=s[9],d=s[2],p=s[6],f=s[10];if(Math.abs(o-c)<.01&&Math.abs(l-d)<.01&&Math.abs(h-p)<.01){if(Math.abs(o+c)<.1&&Math.abs(l+d)<.1&&Math.abs(h+p)<.1&&Math.abs(a+u+f-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;var m=(a+1)/2,g=(u+1)/2,v=(f+1)/2,y=(o+c)/4,e=(l+d)/4,s=(h+p)/4;return g<m&&v<m?i=m<.01?(n=0,r=.707106781):(n=Math.sqrt(m),r=y/n,e/n):v<g?i=g<.01?(n=.707106781,r=0,.707106781):(r=Math.sqrt(g),n=y/r,s/r):v<.01?(n=.707106781,r=.707106781,i=0):(i=Math.sqrt(v),n=e/i,r=s/i),this.set(n,r,i,t),this}let x=Math.sqrt((p-h)*(p-h)+(l-d)*(l-d)+(c-o)*(c-o));return Math.abs(x)<.001&&(x=1),this.x=(p-h)/x,this.y=(l-d)/x,this.z=(c-o)/x,this.w=Math.acos((a+u+f-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}Ft.prototype.isVector4=!0;class Ht extends bt{constructor(e,t,n={}){super(),this.width=e,this.height=t,this.depth=1,this.scissor=new Ft(0,0,e,t),this.scissorTest=!1,this.viewport=new Ft(0,0,e,t),this.texture=new Ut(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.isRenderTargetTexture=!0,this.texture.image={width:e,height:t,depth:1},this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.internalFormat=void 0!==n.internalFormat?n.internalFormat:null,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:G,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0!==n.stencilBuffer&&n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null}setTexture(e){e.image={width:this.width,height:this.height,depth:this.depth},this.texture=e}setSize(e,t,n=1){this.width===e&&this.height===t&&this.depth===n||(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.image={...this.texture.image},this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}}Ht.prototype.isWebGLRenderTarget=!0;(class extends Ht{});class Bt extends Ht{constructor(e,t,n){super(e,t,n),this.samples=4}copy(e){return super.copy.call(this,e),this.samples=e.samples,this}}Bt.prototype.isWebGLMultisampleRenderTarget=!0;class Gt{constructor(e=0,t=0,n=0,r=1){this._x=e,this._y=t,this._z=n,this._w=r}static slerp(e,t,n,r){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),n.slerpQuaternions(e,t,r)}static slerpFlat(e,t,n,r,i,s,a){let o=n[r+0],l=n[r+1],c=n[r+2],u=n[r+3];var h=i[s+0],d=i[s+1],p=i[s+2],n=i[s+3];if(0===a)return e[t+0]=o,e[t+1]=l,e[t+2]=c,void(e[t+3]=u);if(1===a)return e[t+0]=h,e[t+1]=d,e[t+2]=p,void(e[t+3]=n);if(u!==n||o!==h||l!==d||c!==p){let e=1-a;r=o*h+l*d+c*p+u*n,i=0<=r?1:-1,s=1-r*r;s>Number.EPSILON&&(s=Math.sqrt(s),r=Math.atan2(s,r*i),e=Math.sin(e*r)/s,a=Math.sin(a*r)/s);i=a*i;o=o*e+h*i,l=l*e+d*i,c=c*e+p*i,u=u*e+n*i,e===1-a&&(a=1/Math.sqrt(o*o+l*l+c*c+u*u),o*=a,l*=a,c*=a,u*=a)}e[t]=o,e[t+1]=l,e[t+2]=c,e[t+3]=u}static multiplyQuaternionsFlat(e,t,n,r,i,s){var a=n[r],o=n[r+1],l=n[r+2],c=n[r+3],u=i[s],n=i[s+1],r=i[s+2],s=i[s+3];return e[t]=a*s+c*u+o*r-l*n,e[t+1]=o*s+c*n+l*u-a*r,e[t+2]=l*s+c*r+a*n-o*u,e[t+3]=c*s-a*u-o*n-l*r,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var n=e._x,r=e._y,i=e._z,s=e._order;const a=Math.cos,o=Math.sin;var l=a(n/2),c=a(r/2),u=a(i/2),h=o(n/2),d=o(r/2),p=o(i/2);switch(s){case"XYZ":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case"YXZ":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case"ZXY":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case"ZYX":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case"YZX":this._x=h*c*u+l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u-h*d*p;break;case"XZY":this._x=h*c*u-l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u+h*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){var n=t/2,t=Math.sin(n);return this._x=e.x*t,this._y=e.y*t,this._z=e.z*t,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){var t,n=e.elements,r=n[0],i=n[4],s=n[8],a=n[1],o=n[5],l=n[9],c=n[2],u=n[6],e=n[10],n=r+o+e;return 0<n?(n=.5/Math.sqrt(n+1),this._w=.25/n,this._x=(u-l)*n,this._y=(s-c)*n,this._z=(a-i)*n):o<r&&e<r?(t=2*Math.sqrt(1+r-o-e),this._w=(u-l)/t,this._x=.25*t,this._y=(i+a)/t,this._z=(s+c)/t):e<o?(t=2*Math.sqrt(1+o-r-e),this._w=(s-c)/t,this._x=(i+a)/t,this._y=.25*t,this._z=(l+u)/t):(o=2*Math.sqrt(1+e-r-o),this._w=(a-i)/o,this._x=(s+c)/o,this._y=(l+u)/o,this._z=.25*o),this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0):(this._x=0,this._y=-e.z,this._z=e.y)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x),this._w=n,this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Tt(this.dot(e),-1,1)))}rotateTowards(e,t){var n=this.angleTo(e);if(0===n)return this;n=Math.min(1,t/n);return this.slerp(e,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(this._x=this._x*(e=1/e),this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){var n=e._x,r=e._y,i=e._z,s=e._w,a=t._x,o=t._y,e=t._z,t=t._w;return this._x=n*t+s*a+r*e-i*o,this._y=r*t+s*o+i*a-n*e,this._z=i*t+s*e+n*o-r*a,this._w=s*t-n*a-r*o-i*e,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);var n=this._x,r=this._y,i=this._z,s=this._w;let a=s*e._w+n*e._x+r*e._y+i*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),1<=a)return this._w=s,this._x=n,this._y=r,this._z=i,this;var o=1-a*a;if(o<=Number.EPSILON){var l=1-t;return this._w=l*s+t*this._w,this._x=l*n+t*this._x,this._y=l*r+t*this._y,this._z=l*i+t*this._z,this.normalize(),this._onChangeCallback(),this}e=Math.sqrt(o),l=Math.atan2(e,a),o=Math.sin((1-t)*l)/e,e=Math.sin(t*l)/e;return this._w=s*o+this._w*e,this._x=n*o+this._x*e,this._y=r*o+this._y*e,this._z=i*o+this._z*e,this._onChangeCallback(),this}slerpQuaternions(e,t,n){this.copy(e).slerp(t,n)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}Gt.prototype.isQuaternion=!0;class Wt{constructor(e=0,t=0,n=0){this.x=e,this.y=t,this.z=n}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(qt.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(qt.setFromAxisAngle(e,t))}applyMatrix3(e){var t=this.x,n=this.y,r=this.z,e=e.elements;return this.x=e[0]*t+e[3]*n+e[6]*r,this.y=e[1]*t+e[4]*n+e[7]*r,this.z=e[2]*t+e[5]*n+e[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){var t=this.x,n=this.y,r=this.z,i=e.elements,e=1/(i[3]*t+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*t+i[4]*n+i[8]*r+i[12])*e,this.y=(i[1]*t+i[5]*n+i[9]*r+i[13])*e,this.z=(i[2]*t+i[6]*n+i[10]*r+i[14])*e,this}applyQuaternion(e){var t=this.x,n=this.y,r=this.z,i=e.x,s=e.y,a=e.z,o=e.w,l=o*t+s*r-a*n,c=o*n+a*t-i*r,e=o*r+i*n-s*t,r=-i*t-s*n-a*r;return this.x=l*o+r*-i+c*-a-e*-s,this.y=c*o+r*-s+e*-i-l*-a,this.z=e*o+r*-a+l*-s-c*-i,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){var t=this.x,n=this.y,r=this.z,e=e.elements;return this.x=e[0]*t+e[4]*n+e[8]*r,this.y=e[1]*t+e[5]*n+e[9]*r,this.z=e[2]*t+e[6]*n+e[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}crossVectors(e,t){var n=e.x,r=e.y,i=e.z,s=t.x,e=t.y,t=t.z;return this.x=r*t-i*e,this.y=i*s-n*t,this.z=n*e-r*s,this}projectOnVector(e){var t=e.lengthSq();if(0===t)return this.set(0,0,0);t=e.dot(this)/t;return this.copy(e).multiplyScalar(t)}projectOnPlane(e){return jt.copy(this).projectOnVector(e),this.sub(jt)}reflect(e){return this.sub(jt.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){var t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;t=this.dot(e)/t;return Math.acos(Tt(t,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){var t=this.x-e.x,n=this.y-e.y,e=this.z-e.z;return t*t+n*n+e*e}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){var r=Math.sin(t)*e;return this.x=r*Math.sin(n),this.y=Math.cos(t)*e,this.z=r*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){e=e.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(e){var t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),e=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=e,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}}Wt.prototype.isVector3=!0;const jt=new Wt,qt=new Gt;class Xt{constructor(e=new Wt(1/0,1/0,1/0),t=new Wt(-1/0,-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(n){let r=1/0,i=1/0,s=1/0,a=-1/0,o=-1/0,l=-1/0;for(let e=0,t=n.length;e<t;e+=3){var c=n[e],u=n[e+1],h=n[e+2];c<r&&(r=c),u<i&&(i=u),h<s&&(s=h),c>a&&(a=c),u>o&&(o=u),h>l&&(l=h)}return this.min.set(r,i,s),this.max.set(a,o,l),this}setFromBufferAttribute(n){let r=1/0,i=1/0,s=1/0,a=-1/0,o=-1/0,l=-1/0;for(let e=0,t=n.count;e<t;e++){var c=n.getX(e),u=n.getY(e),h=n.getZ(e);c<r&&(r=c),u<i&&(i=u),h<s&&(s=h),c>a&&(a=c),u>o&&(o=u),h>l&&(l=h)}return this.min.set(r,i,s),this.max.set(a,o,l),this}setFromPoints(n){this.makeEmpty();for(let e=0,t=n.length;e<t;e++)this.expandByPoint(n[e]);return this}setFromCenterAndSize(e,t){t=Kt.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(t),this.max.copy(e).add(t),this}setFromObject(e){return this.makeEmpty(),this.expandByObject(e)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){e.updateWorldMatrix(!1,!1);const t=e.geometry;void 0!==t&&(null===t.boundingBox&&t.computeBoundingBox(),Jt.copy(t.boundingBox),Jt.applyMatrix4(e.matrixWorld),this.union(Jt));var n=e.children;for(let e=0,t=n.length;e<t;e++)this.expandByObject(n[e]);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Kt),Kt.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return n=0<e.normal.x?(t=e.normal.x*this.min.x,e.normal.x*this.max.x):(t=e.normal.x*this.max.x,e.normal.x*this.min.x),0<e.normal.y?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),0<e.normal.z?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){return!this.isEmpty()&&(this.getCenter(rn),sn.subVectors(this.max,rn),Zt.subVectors(e.a,rn),$t.subVectors(e.b,rn),Qt.subVectors(e.c,rn),en.subVectors($t,Zt),tn.subVectors(Qt,$t),nn.subVectors(Zt,Qt),!!ln([0,-en.z,en.y,0,-tn.z,tn.y,0,-nn.z,nn.y,en.z,0,-en.x,tn.z,0,-tn.x,nn.z,0,-nn.x,-en.y,en.x,0,-tn.y,tn.x,0,-nn.y,nn.x,0],Zt,$t,Qt,sn)&&(!!ln([1,0,0,0,1,0,0,0,1],Zt,$t,Qt,sn)&&(an.crossVectors(en,tn),ln([an.x,an.y,an.z],Zt,$t,Qt,sn))))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){const t=Kt.copy(e).clamp(this.min,this.max);return t.sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=.5*this.getSize(Kt).length(),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(Yt[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Yt[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Yt[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Yt[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Yt[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Yt[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Yt[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Yt[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Yt)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}Xt.prototype.isBox3=!0;const Yt=[new Wt,new Wt,new Wt,new Wt,new Wt,new Wt,new Wt,new Wt],Kt=new Wt,Jt=new Xt,Zt=new Wt,$t=new Wt,Qt=new Wt,en=new Wt,tn=new Wt,nn=new Wt,rn=new Wt,sn=new Wt,an=new Wt,on=new Wt;function ln(n,r,i,s,a){for(let e=0,t=n.length-3;e<=t;e+=3){on.fromArray(n,e);var o=a.x*Math.abs(on.x)+a.y*Math.abs(on.y)+a.z*Math.abs(on.z),l=r.dot(on),c=i.dot(on),u=s.dot(on);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>o)return!1}return!0}const cn=new Xt,un=new Wt,hn=new Wt,dn=new Wt;class pn{constructor(e=new Wt,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(n,e){const r=this.center;void 0!==e?r.copy(e):cn.setFromPoints(n).getCenter(r);let i=0;for(let e=0,t=n.length;e<t;e++)i=Math.max(i,r.distanceToSquared(n[e]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){var n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?e.makeEmpty():(e.set(this.center,this.center),e.expandByScalar(this.radius)),e}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){dn.subVectors(e,this.center);var t=dn.lengthSq();return t>this.radius*this.radius&&(t=.5*((e=Math.sqrt(t))-this.radius),this.center.add(dn.multiplyScalar(t/e)),this.radius+=t),this}union(e){return hn.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(un.copy(e.center).add(hn)),this.expandByPoint(un.copy(e.center).sub(hn)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const fn=new Wt,mn=new Wt,gn=new Wt,vn=new Wt,yn=new Wt,xn=new Wt,bn=new Wt;class _n{constructor(e=new Wt,t=new Wt(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,fn)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);e=t.dot(this.direction);return e<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(e).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){var t=fn.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(fn.copy(this.direction).multiplyScalar(t).add(this.origin),fn.distanceToSquared(e))}distanceSqToSegment(e,t,n,r){mn.copy(e).add(t).multiplyScalar(.5),gn.copy(t).sub(e).normalize(),vn.copy(this.origin).sub(mn);var i=.5*e.distanceTo(t),s=-this.direction.dot(gn),a=vn.dot(this.direction),o=-vn.dot(gn),e=vn.lengthSq(),t=Math.abs(1-s*s);let l,c,u,h;return u=0<t?(l=s*o-a,c=s*a-o,h=i*t,0<=l?c>=-h?c<=h?(t=1/t,l*=t,c*=t,l*(l+s*c+2*a)+c*(s*l+c+2*o)+e):(c=i,l=Math.max(0,-(s*c+a)),-l*l+c*(c+2*o)+e):(c=-i,l=Math.max(0,-(s*c+a)),-l*l+c*(c+2*o)+e):c<=-h?(l=Math.max(0,-(-s*i+a)),c=0<l?-i:Math.min(Math.max(-i,-o),i),-l*l+c*(c+2*o)+e):c<=h?(l=0,c=Math.min(Math.max(-i,-o),i),c*(c+2*o)+e):(l=Math.max(0,-(s*i+a)),c=0<l?i:Math.min(Math.max(-i,-o),i),-l*l+c*(c+2*o)+e)):(c=0<s?-i:i,l=Math.max(0,-(s*c+a)),-l*l+c*(c+2*o)+e),n&&n.copy(this.direction).multiplyScalar(l).add(this.origin),r&&r.copy(gn).multiplyScalar(c).add(mn),u}intersectSphere(e,t){fn.subVectors(e.center,this.origin);var n=fn.dot(this.direction),r=fn.dot(fn)-n*n,e=e.radius*e.radius;if(e<r)return null;e=Math.sqrt(e-r),r=n-e,e=n+e;return r<0&&e<0?null:r<0?this.at(e,t):this.at(r,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;t=-(this.origin.dot(e.normal)+e.constant)/t;return 0<=t?t:null}intersectPlane(e,t){e=this.distanceToPlane(e);return null===e?null:this.at(e,t)}intersectsPlane(e){var t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,r,i,s,a,o;var l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return r=0<=l?(n=(e.min.x-h.x)*l,(e.max.x-h.x)*l):(n=(e.max.x-h.x)*l,(e.min.x-h.x)*l),s=0<=c?(i=(e.min.y-h.y)*c,(e.max.y-h.y)*c):(i=(e.max.y-h.y)*c,(e.min.y-h.y)*c),n>s||i>r?null:((i>n||n!=n)&&(n=i),(s<r||r!=r)&&(r=s),o=0<=u?(a=(e.min.z-h.z)*u,(e.max.z-h.z)*u):(a=(e.max.z-h.z)*u,(e.min.z-h.z)*u),n>o||a>r?null:((a>n||n!=n)&&(n=a),(o<r||r!=r)&&(r=o),r<0?null:this.at(0<=n?n:r,t)))}intersectsBox(e){return null!==this.intersectBox(e,fn)}intersectTriangle(e,t,n,r,i){yn.subVectors(t,e),xn.subVectors(n,e),bn.crossVectors(yn,xn);let s=this.direction.dot(bn),a;if(0<s){if(r)return null;a=1}else{if(!(s<0))return null;a=-1,s=-s}vn.subVectors(this.origin,e);r=a*this.direction.dot(xn.crossVectors(vn,xn));if(r<0)return null;e=a*this.direction.dot(yn.cross(vn));if(e<0)return null;if(r+e>s)return null;e=-a*vn.dot(bn);return e<0?null:this.at(e/s,i)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class wn{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],0<arguments.length&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,t,n,r,i,s,a,o,l,c,u,h,d,p,f,m){const g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=r,g[1]=i,g[5]=s,g[9]=a,g[13]=o,g[2]=l,g[6]=c,g[10]=u,g[14]=h,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new wn).fromArray(this.elements)}copy(e){const t=this.elements;e=e.elements;return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){e=e.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements;var n=e.elements,r=1/Mn.setFromMatrixColumn(e,0).length(),i=1/Mn.setFromMatrixColumn(e,1).length(),e=1/Mn.setFromMatrixColumn(e,2).length();return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=0,t[4]=n[4]*i,t[5]=n[5]*i,t[6]=n[6]*i,t[7]=0,t[8]=n[8]*e,t[9]=n[9]*e,t[10]=n[10]*e,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const t=this.elements;var n,r,i,s,a,o,l,c,u,h,d,p=e.x,f=e.y,m=e.z,g=Math.cos(p),v=Math.sin(p),y=Math.cos(f),x=Math.sin(f),p=Math.cos(m),f=Math.sin(m);return"XYZ"===e.order?(n=g*p,i=g*f,r=v*p,m=v*f,t[0]=y*p,t[4]=-y*f,t[8]=x,t[1]=i+r*x,t[5]=n-m*x,t[9]=-v*y,t[2]=m-n*x,t[6]=r+i*x,t[10]=g*y):"YXZ"===e.order?(s=y*p,n=y*f,r=x*p,i=x*f,t[0]=s+i*v,t[4]=r*v-n,t[8]=g*x,t[1]=g*f,t[5]=g*p,t[9]=-v,t[2]=n*v-r,t[6]=i+s*v,t[10]=g*y):"ZXY"===e.order?(l=y*p,s=y*f,a=x*p,o=x*f,t[0]=l-o*v,t[4]=-g*f,t[8]=a+s*v,t[1]=s+a*v,t[5]=g*p,t[9]=o-l*v,t[2]=-g*x,t[6]=v,t[10]=g*y):"ZYX"===e.order?(a=g*p,o=g*f,c=v*p,l=v*f,t[0]=y*p,t[4]=c*x-o,t[8]=a*x+l,t[1]=y*f,t[5]=l*x+a,t[9]=o*x-c,t[2]=-x,t[6]=v*y,t[10]=g*y):"YZX"===e.order?(h=g*y,c=g*x,u=v*y,d=v*x,t[0]=y*p,t[4]=d-h*f,t[8]=u*f+c,t[1]=f,t[5]=g*p,t[9]=-v*p,t[2]=-x*p,t[6]=c*f+u,t[10]=h-d*f):"XZY"===e.order&&(u=g*y,h=g*x,d=v*y,e=v*x,t[0]=y*p,t[4]=-f,t[8]=x*p,t[1]=u*f+e,t[5]=g*p,t[9]=h*f-d,t[2]=d*f-h,t[6]=v*p,t[10]=e*f+u),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(En,e,Tn)}lookAt(e,t,n){const r=this.elements;return An.subVectors(e,t),0===An.lengthSq()&&(An.z=1),An.normalize(),Cn.crossVectors(n,An),0===Cn.lengthSq()&&(1===Math.abs(n.z)?An.x+=1e-4:An.z+=1e-4,An.normalize(),Cn.crossVectors(n,An)),Cn.normalize(),Ln.crossVectors(An,Cn),r[0]=Cn.x,r[4]=Ln.x,r[8]=An.x,r[1]=Cn.y,r[5]=Ln.y,r[9]=An.y,r[2]=Cn.z,r[6]=Ln.z,r[10]=An.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){var n=e.elements,r=t.elements;const i=this.elements;var s=n[0],a=n[4],o=n[8],l=n[12],c=n[1],u=n[5],h=n[9],d=n[13],p=n[2],f=n[6],m=n[10],g=n[14],v=n[3],y=n[7],x=n[11],b=n[15],_=r[0],w=r[4],M=r[8],S=r[12],E=r[1],T=r[5],C=r[9],L=r[13],A=r[2],P=r[6],R=r[10],D=r[14],e=r[3],t=r[7],n=r[11],r=r[15];return i[0]=s*_+a*E+o*A+l*e,i[4]=s*w+a*T+o*P+l*t,i[8]=s*M+a*C+o*R+l*n,i[12]=s*S+a*L+o*D+l*r,i[1]=c*_+u*E+h*A+d*e,i[5]=c*w+u*T+h*P+d*t,i[9]=c*M+u*C+h*R+d*n,i[13]=c*S+u*L+h*D+d*r,i[2]=p*_+f*E+m*A+g*e,i[6]=p*w+f*T+m*P+g*t,i[10]=p*M+f*C+m*R+g*n,i[14]=p*S+f*L+m*D+g*r,i[3]=v*_+y*E+x*A+b*e,i[7]=v*w+y*T+x*P+b*t,i[11]=v*M+y*C+x*R+b*n,i[15]=v*S+y*L+x*D+b*r,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){var e=this.elements,t=e[0],n=e[4],r=e[8],i=e[12],s=e[1],a=e[5],o=e[9],l=e[13],c=e[2],u=e[6],h=e[10],d=e[14];return e[3]*(+i*o*u-r*l*u-i*a*h+n*l*h+r*a*d-n*o*d)+e[7]*(+t*o*d-t*l*h+i*s*h-r*s*d+r*l*c-i*o*c)+e[11]*(+t*l*u-t*a*d-i*s*u+n*s*d+i*a*c-n*l*c)+e[15]*(-r*a*c-t*o*u+t*a*h+r*s*u-n*s*h+n*o*c)}transpose(){const e=this.elements;var t=e[1];return e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],a=e[5],o=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11],p=e[12],f=e[13],m=e[14],g=e[15],v=u*m*l-f*h*l+f*o*d-a*m*d-u*o*g+a*h*g,y=p*h*l-c*m*l-p*o*d+s*m*d+c*o*g-s*h*g,x=c*f*l-p*u*l+p*a*d-s*f*d-c*a*g+s*u*g,b=p*u*o-c*f*o-p*a*h+s*f*h+c*a*m-s*u*m;var _=t*v+n*y+r*x+i*b;if(0==_)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);_=1/_;return e[0]=v*_,e[1]=(f*h*i-u*m*i-f*r*d+n*m*d+u*r*g-n*h*g)*_,e[2]=(a*m*i-f*o*i+f*r*l-n*m*l-a*r*g+n*o*g)*_,e[3]=(u*o*i-a*h*i-u*r*l+n*h*l+a*r*d-n*o*d)*_,e[4]=y*_,e[5]=(c*m*i-p*h*i+p*r*d-t*m*d-c*r*g+t*h*g)*_,e[6]=(p*o*i-s*m*i-p*r*l+t*m*l+s*r*g-t*o*g)*_,e[7]=(s*h*i-c*o*i+c*r*l-t*h*l-s*r*d+t*o*d)*_,e[8]=x*_,e[9]=(p*u*i-c*f*i-p*n*d+t*f*d+c*n*g-t*u*g)*_,e[10]=(s*f*i-p*a*i+p*n*l-t*f*l-s*n*g+t*a*g)*_,e[11]=(c*a*i-s*u*i-c*n*l+t*u*l+s*n*d-t*a*d)*_,e[12]=b*_,e[13]=(c*f*r-p*u*r+p*n*h-t*f*h-c*n*m+t*u*m)*_,e[14]=(p*a*r-s*f*r-p*n*o+t*f*o+s*n*m-t*a*m)*_,e[15]=(s*u*r-c*a*r+c*n*o-t*u*o-s*n*h+t*a*h)*_,this}scale(e){const t=this.elements;var n=e.x,r=e.y,e=e.z;return t[0]*=n,t[4]*=r,t[8]*=e,t[1]*=n,t[5]*=r,t[9]*=e,t[2]*=n,t[6]*=r,t[10]*=e,t[3]*=n,t[7]*=r,t[11]*=e,this}getMaxScaleOnAxis(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,e))}makeTranslation(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){var t=Math.cos(e),e=Math.sin(e);return this.set(1,0,0,0,0,t,-e,0,0,e,t,0,0,0,0,1),this}makeRotationY(e){var t=Math.cos(e),e=Math.sin(e);return this.set(t,0,e,0,0,1,0,0,-e,0,t,0,0,0,0,1),this}makeRotationZ(e){var t=Math.cos(e),e=Math.sin(e);return this.set(t,-e,0,0,e,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){var n=Math.cos(t),r=Math.sin(t),i=1-n,s=e.x,a=e.y,o=e.z,t=i*s,e=i*a;return this.set(t*s+n,t*a-r*o,t*o+r*a,0,t*a+r*o,e*a+n,e*o-r*s,0,t*o-r*a,e*o+r*s,i*o*o+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,r,i,s){return this.set(1,n,i,0,e,1,s,0,t,r,1,0,0,0,0,1),this}compose(e,t,n){const r=this.elements;var i=t._x,s=t._y,a=t._z,o=t._w,l=i+i,c=s+s,u=a+a,h=i*l,d=i*c,p=i*u,t=s*c,i=s*u,s=a*u,a=o*l,l=o*c,c=o*u,o=n.x,u=n.y,n=n.z;return r[0]=(1-(t+s))*o,r[1]=(d+c)*o,r[2]=(p-l)*o,r[3]=0,r[4]=(d-c)*u,r[5]=(1-(h+s))*u,r[6]=(i+a)*u,r[7]=0,r[8]=(p+l)*n,r[9]=(i-a)*n,r[10]=(1-(h+t))*n,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,n){var r=this.elements;let i=Mn.set(r[0],r[1],r[2]).length();var s=Mn.set(r[4],r[5],r[6]).length(),a=Mn.set(r[8],r[9],r[10]).length();this.determinant()<0&&(i=-i),e.x=r[12],e.y=r[13],e.z=r[14],Sn.copy(this);var o=1/i,e=1/s,r=1/a;return Sn.elements[0]*=o,Sn.elements[1]*=o,Sn.elements[2]*=o,Sn.elements[4]*=e,Sn.elements[5]*=e,Sn.elements[6]*=e,Sn.elements[8]*=r,Sn.elements[9]*=r,Sn.elements[10]*=r,t.setFromRotationMatrix(Sn),n.x=i,n.y=s,n.z=a,this}makePerspective(e,t,n,r,i,s){void 0===s&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const a=this.elements;var o=2*i/(n-r),l=(t+e)/(t-e),n=(n+r)/(n-r),r=-(s+i)/(s-i),s=-2*s*i/(s-i);return a[0]=2*i/(t-e),a[4]=0,a[8]=l,a[12]=0,a[1]=0,a[5]=o,a[9]=n,a[13]=0,a[2]=0,a[6]=0,a[10]=r,a[14]=s,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(e,t,n,r,i,s){const a=this.elements;var o=1/(t-e),l=1/(n-r),c=1/(s-i),e=(t+e)*o,r=(n+r)*l,i=(s+i)*c;return a[0]=2*o,a[4]=0,a[8]=0,a[12]=-e,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-r,a[2]=0,a[6]=0,a[10]=-2*c,a[14]=-i,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(e){var t=this.elements,n=e.elements;for(let e=0;e<16;e++)if(t[e]!==n[e])return!1;return!0}fromArray(t,n=0){for(let e=0;e<16;e++)this.elements[e]=t[e+n];return this}toArray(e=[],t=0){var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}wn.prototype.isMatrix4=!0;const Mn=new Wt,Sn=new wn,En=new Wt(0,0,0),Tn=new Wt(1,1,1),Cn=new Wt,Ln=new Wt,An=new Wt,Pn=new wn,Rn=new Gt;class Dn{constructor(e=0,t=0,n=0,r=Dn.DefaultOrder){this._x=e,this._y=t,this._z=n,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,r=this._order){return this._x=e,this._y=t,this._z=n,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){var e=e.elements,r=e[0],i=e[4],s=e[8],a=e[1],o=e[5],l=e[9],c=e[2],u=e[6],h=e[10];switch(t){case"XYZ":this._y=Math.asin(Tt(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-l,h),this._z=Math.atan2(-i,r)):(this._x=Math.atan2(u,o),this._z=0);break;case"YXZ":this._x=Math.asin(-Tt(l,-1,1)),Math.abs(l)<.9999999?(this._y=Math.atan2(s,h),this._z=Math.atan2(a,o)):(this._y=Math.atan2(-c,r),this._z=0);break;case"ZXY":this._x=Math.asin(Tt(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-c,h),this._z=Math.atan2(-i,o)):(this._y=0,this._z=Math.atan2(a,r));break;case"ZYX":this._y=Math.asin(-Tt(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(u,h),this._z=Math.atan2(a,r)):(this._x=0,this._z=Math.atan2(-i,o));break;case"YZX":this._z=Math.asin(Tt(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-l,o),this._y=Math.atan2(-c,r)):(this._x=0,this._y=Math.atan2(s,h));break;case"XZY":this._z=Math.asin(-Tt(i,-1,1)),Math.abs(i)<.9999999?(this._x=Math.atan2(u,o),this._y=Math.atan2(s,r)):(this._x=Math.atan2(-l,h),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===n&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return Pn.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Pn,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return Rn.setFromEuler(this),this.setFromQuaternion(Rn,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}toVector3(e){return e?e.set(this._x,this._y,this._z):new Wt(this._x,this._y,this._z)}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}Dn.prototype.isEuler=!0,Dn.DefaultOrder="XYZ",Dn.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class Nn{constructor(){this.mask=1}set(e){this.mask=1<<e|0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}}let In=0;const kn=new Wt,On=new Gt,zn=new wn,Un=new Wt,Vn=new Wt,Fn=new Wt,Hn=new Gt,Bn=new Wt(1,0,0),Gn=new Wt(0,1,0),Wn=new Wt(0,0,1),jn={type:"added"},qn={type:"removed"};class Xn extends bt{constructor(){super(),Object.defineProperty(this,"id",{value:In++}),this.uuid=Et(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Xn.DefaultUp.clone();var e=new Wt;const t=new Dn,n=new Gt;var r=new Wt(1,1,1);t._onChange(function(){n.setFromEuler(t,!1)}),n._onChange(function(){t.setFromQuaternion(n,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new wn},normalMatrix:{value:new It}}),this.matrix=new wn,this.matrixWorld=new wn,this.matrixAutoUpdate=Xn.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Nn,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return On.setFromAxisAngle(e,t),this.quaternion.multiply(On),this}rotateOnWorldAxis(e,t){return On.setFromAxisAngle(e,t),this.quaternion.premultiply(On),this}rotateX(e){return this.rotateOnAxis(Bn,e)}rotateY(e){return this.rotateOnAxis(Gn,e)}rotateZ(e){return this.rotateOnAxis(Wn,e)}translateOnAxis(e,t){return kn.copy(e).applyQuaternion(this.quaternion),this.position.add(kn.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(Bn,e)}translateY(e){return this.translateOnAxis(Gn,e)}translateZ(e){return this.translateOnAxis(Wn,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(zn.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?Un.copy(e):Un.set(e,t,n);n=this.parent;this.updateWorldMatrix(!0,!1),Vn.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?zn.lookAt(Vn,Un,this.up):zn.lookAt(Un,Vn,this.up),this.quaternion.setFromRotationMatrix(zn),n&&(zn.extractRotation(n.matrixWorld),On.setFromRotationMatrix(zn),this.quaternion.premultiply(On.invert()))}add(e){if(1<arguments.length){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?console.error("THREE.Object3D.add: object can't be added as a child of itself.",e):e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),(e.parent=this).children.push(e),e.dispatchEvent(jn)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this}remove(e){if(1<arguments.length){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}var t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(qn)),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(qn)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),zn.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),zn.multiply(e.parent.matrixWorld)),e.applyMatrix4(zn),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(n,r){if(this[n]===r)return this;for(let e=0,t=this.children.length;e<t;e++){const s=this.children[e];var i=s.getObjectByProperty(n,r);if(void 0!==i)return i}}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Vn,e,Fn),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Vn,Hn,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(n){n(this);const r=this.children;for(let e=0,t=r.length;e<t;e++)r[e].traverse(n)}traverseVisible(n){if(!1!==this.visible){n(this);const r=this.children;for(let e=0,t=r.length;e<t;e++)r[e].traverseVisible(n)}}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(n){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||n)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),n=!(this.matrixWorldNeedsUpdate=!1));const r=this.children;for(let e=0,t=r.length;e<t;e++)r[e].updateMatrixWorld(n)}updateWorldMatrix(e,t){const n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const r=this.children;for(let e=0,t=r.length;e<t;e++)r[e].updateWorldMatrix(!1,!0)}}toJSON(n){var e,t,r,i,s,a=void 0===n||"string"==typeof n;const o={};a&&(n={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},o.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const l={};function c(e,t){return void 0===e[t.uuid]&&(e[t.uuid]=t.toJSON(n)),t.uuid}if(l.uuid=this.uuid,l.type=this.type,""!==this.name&&(l.name=this.name),!0===this.castShadow&&(l.castShadow=!0),!0===this.receiveShadow&&(l.receiveShadow=!0),!1===this.visible&&(l.visible=!1),!1===this.frustumCulled&&(l.frustumCulled=!1),0!==this.renderOrder&&(l.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(l.userData=this.userData),l.layers=this.layers.mask,l.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(l.matrixAutoUpdate=!1),this.isInstancedMesh&&(l.type="InstancedMesh",l.count=this.count,l.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(l.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?l.background=this.background.toJSON():this.background.isTexture&&(l.background=this.background.toJSON(n).uuid)),this.environment&&this.environment.isTexture&&(l.environment=this.environment.toJSON(n).uuid);else if(this.isMesh||this.isLine||this.isPoints){l.geometry=c(n.geometries,this.geometry);var u=this.geometry.parameters;if(void 0!==u&&void 0!==u.shapes){var h=u.shapes;if(Array.isArray(h))for(let e=0,t=h.length;e<t;e++){var d=h[e];c(n.shapes,d)}else c(n.shapes,h)}}if(this.isSkinnedMesh&&(l.bindMode=this.bindMode,l.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(c(n.skeletons,this.skeleton),l.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const m=[];for(let e=0,t=this.material.length;e<t;e++)m.push(c(n.materials,this.material[e]));l.material=m}else l.material=c(n.materials,this.material);if(0<this.children.length){l.children=[];for(let e=0;e<this.children.length;e++)l.children.push(this.children[e].toJSON(n).object)}if(0<this.animations.length){l.animations=[];for(let e=0;e<this.animations.length;e++){var p=this.animations[e];l.animations.push(c(n.animations,p))}}return a&&(e=f(n.geometries),t=f(n.materials),r=f(n.textures),i=f(n.images),s=f(n.shapes),u=f(n.skeletons),a=f(n.animations),0<e.length&&(o.geometries=e),0<t.length&&(o.materials=t),0<r.length&&(o.textures=r),0<i.length&&(o.images=i),0<s.length&&(o.shapes=s),0<u.length&&(o.skeletons=u),0<a.length&&(o.animations=a)),o.object=l,o;function f(e){const t=[];for(const n in e){const r=e[n];delete r.metadata,t.push(r)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let e=0;e<t.children.length;e++){const n=t.children[e];this.add(n.clone())}return this}}Xn.DefaultUp=new Wt(0,1,0),Xn.DefaultMatrixAutoUpdate=!0,Xn.prototype.isObject3D=!0;const Yn=new Wt,Kn=new Wt,Jn=new Wt,Zn=new Wt,$n=new Wt,Qn=new Wt,er=new Wt,tr=new Wt,nr=new Wt,rr=new Wt;class ir{constructor(e=new Wt,t=new Wt,n=new Wt){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,r){r.subVectors(n,t),Yn.subVectors(e,t),r.cross(Yn);t=r.lengthSq();return 0<t?r.multiplyScalar(1/Math.sqrt(t)):r.set(0,0,0)}static getBarycoord(e,t,n,r,i){Yn.subVectors(r,t),Kn.subVectors(n,t),Jn.subVectors(e,t);var s=Yn.dot(Yn),a=Yn.dot(Kn),r=Yn.dot(Jn),n=Kn.dot(Kn),e=Kn.dot(Jn),t=s*n-a*a;if(0==t)return i.set(-2,-1,-1);t=1/t,n=(n*r-a*e)*t,t*=s*e-a*r;return i.set(1-n-t,t,n)}static containsPoint(e,t,n,r){return this.getBarycoord(e,t,n,r,Zn),0<=Zn.x&&0<=Zn.y&&Zn.x+Zn.y<=1}static getUV(e,t,n,r,i,s,a,o){return this.getBarycoord(e,t,n,r,Zn),o.set(0,0),o.addScaledVector(i,Zn.x),o.addScaledVector(s,Zn.y),o.addScaledVector(a,Zn.z),o}static isFrontFacing(e,t,n,r){return Yn.subVectors(n,t),Kn.subVectors(e,t),Yn.cross(Kn).dot(r)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Yn.subVectors(this.c,this.b),Kn.subVectors(this.a,this.b),.5*Yn.cross(Kn).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return ir.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return ir.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,r,i){return ir.getUV(e,this.a,this.b,this.c,t,n,r,i)}containsPoint(e){return ir.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return ir.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){var n=this.a,r=this.b,i=this.c;let s,a;$n.subVectors(r,n),Qn.subVectors(i,n),tr.subVectors(e,n);var o=$n.dot(tr),l=Qn.dot(tr);if(o<=0&&l<=0)return t.copy(n);nr.subVectors(e,r);var c=$n.dot(nr),u=Qn.dot(nr);if(0<=c&&u<=c)return t.copy(r);var h=o*u-c*l;if(h<=0&&0<=o&&c<=0)return s=o/(o-c),t.copy(n).addScaledVector($n,s);rr.subVectors(e,i);var d=$n.dot(rr),e=Qn.dot(rr);if(0<=e&&d<=e)return t.copy(i);o=d*l-o*e;if(o<=0&&0<=l&&e<=0)return a=l/(l-e),t.copy(n).addScaledVector(Qn,a);l=c*e-d*u;if(l<=0&&0<=u-c&&0<=d-e)return er.subVectors(i,r),a=(u-c)/(u-c+(d-e)),t.copy(r).addScaledVector(er,a);l=1/(l+o+h);return s=o*l,a=h*l,t.copy(n).addScaledVector($n,s).addScaledVector(Qn,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let sr=0;class ar extends bt{constructor(){super(),Object.defineProperty(this,"id",{value:sr++}),this.uuid=Et(),this.name="",this.type="Material",this.fog=!0,this.blending=K,this.side=Ae,this.vertexColors=!1,this.opacity=1,this.format=Ve,this.transparent=!1,this.blendSrc=ce,this.blendDst=ue,this.blendEquation=ee,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=xe,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=7680,this.stencilZFail=7680,this.stencilZPass=7680,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){0<this._alphaTest!=0<e&&this.version++,this._alphaTest=e}onBuild(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const n in e){var t=e[n];if(void 0!==t)if("shading"!==n){const r=this[n];void 0!==r?r&&r.isColor?r.set(t):r&&r.isVector3&&t&&t.isVector3?r.copy(t):this[n]=t:console.warn("THREE."+this.type+": '"+n+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===t;else console.warn("THREE.Material: '"+n+"' parameter is undefined.")}}toJSON(e){var t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function r(e){const t=[];for(const n in e){const r=e[n];delete r.metadata,t.push(r)}return t}return n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),this.sheenTint&&this.sheenTint.isColor&&(n.sheenTint=this.sheenTint.getHex()),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularTint&&this.specularTint.isColor&&(n.specularTint=this.specularTint.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularTintMap&&this.specularTintMap.isTexture&&(n.specularTintMap=this.specularTintMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationTint&&(n.attenuationTint=this.attenuationTint.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==K&&(n.blending=this.blending),this.side!==Ae&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.format!==Ve&&(n.format=this.format),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),0<this.alphaTest&&(n.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(n.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),1<this.wireframeLinewidth&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=this.flatShading),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t&&(t=r(e.textures),e=r(e.images),0<t.length&&(n.textures=t),0<e.length&&(n.images=e)),n}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.format=e.format,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(null!==t){var r=t.length;n=new Array(r);for(let e=0;e!==r;++e)n[e]=t[e].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}ar.prototype.isMaterial=!0;const or={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},lr={h:0,s:0,l:0},cr={h:0,s:0,l:0};function ur(e,t,n){return n<0&&(n+=1),1<n&&--n,n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}function hr(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function dr(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}class pr{constructor(e,t,n){return void 0===t&&void 0===n?this.set(e):this.setRGB(e,t,n)}set(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this}setRGB(e,t,n){return this.r=e,this.g=t,this.b=n,this}setHSL(e,t,n){return e=Ct(e,1),t=Tt(t,0,1),n=Tt(n,0,1),0===t?this.r=this.g=this.b=n:(this.r=ur(t=2*n-(n=n<=.5?n*(1+t):n+t-n*t),n,e+1/3),this.g=ur(t,n,e),this.b=ur(t,n,e-1/3)),this}setStyle(t){function n(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let r;if(r=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){let e;var i=r[1],s=r[2];switch(i){case"rgb":case"rgba":if(e=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(255,parseInt(e[1],10))/255,this.g=Math.min(255,parseInt(e[2],10))/255,this.b=Math.min(255,parseInt(e[3],10))/255,n(e[4]),this;if(e=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(100,parseInt(e[1],10))/100,this.g=Math.min(100,parseInt(e[2],10))/100,this.b=Math.min(100,parseInt(e[3],10))/100,n(e[4]),this;break;case"hsl":case"hsla":if(e=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s)){var a=parseFloat(e[1])/360,o=parseInt(e[2],10)/100,l=parseInt(e[3],10)/100;return n(e[4]),this.setHSL(a,o,l)}}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(t)){const e=r[1];i=e.length;if(3===i)return this.r=parseInt(e.charAt(0)+e.charAt(0),16)/255,this.g=parseInt(e.charAt(1)+e.charAt(1),16)/255,this.b=parseInt(e.charAt(2)+e.charAt(2),16)/255,this;if(6===i)return this.r=parseInt(e.charAt(0)+e.charAt(1),16)/255,this.g=parseInt(e.charAt(2)+e.charAt(3),16)/255,this.b=parseInt(e.charAt(4)+e.charAt(5),16)/255,this}return t&&0<t.length?this.setColorName(t):this}setColorName(e){var t=or[e.toLowerCase()];return void 0!==t?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copyGammaToLinear(e,t=2){return this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this}copyLinearToGamma(e,t=2){t=0<t?1/t:1;return this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this}convertGammaToLinear(e){return this.copyGammaToLinear(this,e),this}convertLinearToGamma(e){return this.copyLinearToGamma(this,e),this}copySRGBToLinear(e){return this.r=hr(e.r),this.g=hr(e.g),this.b=hr(e.b),this}copyLinearToSRGB(e){return this.r=dr(e.r),this.g=dr(e.g),this.b=dr(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(e){var t=this.r,n=this.g,r=this.b,i=Math.max(t,n,r),s=Math.min(t,n,r);let a,o;var l=(s+i)/2;if(s===i)a=0,o=0;else{var c=i-s;switch(o=l<=.5?c/(i+s):c/(2-i-s),i){case t:a=(n-r)/c+(n<r?6:0);break;case n:a=(r-t)/c+2;break;case r:a=(t-n)/c+4}a/=6}return e.h=a,e.s=o,e.l=l,e}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(e,t,n){return this.getHSL(lr),lr.h+=e,lr.s+=t,lr.l+=n,this.setHSL(lr.h,lr.s,lr.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(lr),e.getHSL(cr);var n=Lt(lr.h,cr.h,t),e=Lt(lr.s,cr.s,t),t=Lt(lr.l,cr.l,t);return this.setHSL(n,e,t),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),!0===e.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}pr.NAMES=or,pr.prototype.isColor=!0,pr.prototype.r=1,pr.prototype.g=1,pr.prototype.b=1;class fr extends ar{constructor(e){super(),this.type="MeshBasicMaterial",this.color=new pr(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}fr.prototype.isMeshBasicMaterial=!0;const mr=new Wt,gr=new Nt;class vr{constructor(e,t,n){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===n,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(n,r,i){n*=this.itemSize,i*=r.itemSize;for(let e=0,t=this.itemSize;e<t;e++)this.array[n+e]=r.array[i+e];return this}copyArray(e){return this.array.set(e),this}copyColorsArray(n){const r=this.array;let i=0;for(let t=0,e=n.length;t<e;t++){let e=n[t];void 0===e&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",t),e=new pr),r[i++]=e.r,r[i++]=e.g,r[i++]=e.b}return this}copyVector2sArray(n){const r=this.array;let i=0;for(let t=0,e=n.length;t<e;t++){let e=n[t];void 0===e&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",t),e=new Nt),r[i++]=e.x,r[i++]=e.y}return this}copyVector3sArray(n){const r=this.array;let i=0;for(let t=0,e=n.length;t<e;t++){let e=n[t];void 0===e&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",t),e=new Wt),r[i++]=e.x,r[i++]=e.y,r[i++]=e.z}return this}copyVector4sArray(n){const r=this.array;let i=0;for(let t=0,e=n.length;t<e;t++){let e=n[t];void 0===e&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",t),e=new Ft),r[i++]=e.x,r[i++]=e.y,r[i++]=e.z,r[i++]=e.w}return this}applyMatrix3(n){if(2===this.itemSize)for(let e=0,t=this.count;e<t;e++)gr.fromBufferAttribute(this,e),gr.applyMatrix3(n),this.setXY(e,gr.x,gr.y);else if(3===this.itemSize)for(let e=0,t=this.count;e<t;e++)mr.fromBufferAttribute(this,e),mr.applyMatrix3(n),this.setXYZ(e,mr.x,mr.y,mr.z);return this}applyMatrix4(n){for(let e=0,t=this.count;e<t;e++)mr.x=this.getX(e),mr.y=this.getY(e),mr.z=this.getZ(e),mr.applyMatrix4(n),this.setXYZ(e,mr.x,mr.y,mr.z);return this}applyNormalMatrix(n){for(let e=0,t=this.count;e<t;e++)mr.x=this.getX(e),mr.y=this.getY(e),mr.z=this.getZ(e),mr.applyNormalMatrix(n),this.setXYZ(e,mr.x,mr.y,mr.z);return this}transformDirection(n){for(let e=0,t=this.count;e<t;e++)mr.x=this.getX(e),mr.y=this.getY(e),mr.z=this.getZ(e),mr.transformDirection(n),this.setXYZ(e,mr.x,mr.y,mr.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){return this.array[e*this.itemSize]}setX(e,t){return this.array[e*this.itemSize]=t,this}getY(e){return this.array[e*this.itemSize+1]}setY(e,t){return this.array[e*this.itemSize+1]=t,this}getZ(e){return this.array[e*this.itemSize+2]}setZ(e,t){return this.array[e*this.itemSize+2]=t,this}getW(e){return this.array[e*this.itemSize+3]}setW(e,t){return this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this}setXYZW(e,t,n,r,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=i,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),35044!==this.usage&&(e.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(e.updateRange=this.updateRange),e}}vr.prototype.isBufferAttribute=!0;(class extends null{});(class extends null{});(class extends null{});(class extends null{});class yr extends vr{constructor(e,t,n){super(new Uint16Array(e),t,n)}}(class extends null{});class xr extends vr{constructor(e,t,n){super(new Uint32Array(e),t,n)}}(class extends vr{});class br extends vr{constructor(e,t,n){super(new Float32Array(e),t,n)}}(class extends null{});function _r(n){if(0===n.length)return-1/0;let r=n[0];for(let e=1,t=n.length;e<t;++e)n[e]>r&&(r=n[e]);return r}Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;let wr=0;const Mr=new wn,Sr=new Xn,Er=new Wt,Tr=new Xt,Cr=new Xt,Lr=new Wt;class Ar extends bt{constructor(){super(),Object.defineProperty(this,"id",{value:wr++}),this.uuid=Et(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(65535<_r(e)?xr:yr)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;var r;void 0!==n&&(r=(new It).getNormalMatrix(e),n.applyNormalMatrix(r),n.needsUpdate=!0);const i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(e),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return Mr.makeRotationFromQuaternion(e),this.applyMatrix4(Mr),this}rotateX(e){return Mr.makeRotationX(e),this.applyMatrix4(Mr),this}rotateY(e){return Mr.makeRotationY(e),this.applyMatrix4(Mr),this}rotateZ(e){return Mr.makeRotationZ(e),this.applyMatrix4(Mr),this}translate(e,t,n){return Mr.makeTranslation(e,t,n),this.applyMatrix4(Mr),this}scale(e,t,n){return Mr.makeScale(e,t,n),this.applyMatrix4(Mr),this}lookAt(e){return Sr.lookAt(e),Sr.updateMatrix(),this.applyMatrix4(Sr.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Er).negate(),this.translate(Er.x,Er.y,Er.z),this}setFromPoints(n){const r=[];for(let e=0,t=n.length;e<t;e++){var i=n[e];r.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new br(r,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Xt);var e=this.attributes.position,n=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new Wt(-1/0,-1/0,-1/0),new Wt(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),n)for(let e=0,t=n.length;e<t;e++){var r=n[e];Tr.setFromBufferAttribute(r),this.morphTargetsRelative?(Lr.addVectors(this.boundingBox.min,Tr.min),this.boundingBox.expandByPoint(Lr),Lr.addVectors(this.boundingBox.max,Tr.max),this.boundingBox.expandByPoint(Lr)):(this.boundingBox.expandByPoint(Tr.min),this.boundingBox.expandByPoint(Tr.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new pn);var r=this.attributes.position,i=this.morphAttributes.position;if(r&&r.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new Wt,1/0);if(r){const l=this.boundingSphere.center;if(Tr.setFromBufferAttribute(r),i)for(let e=0,t=i.length;e<t;e++){var s=i[e];Cr.setFromBufferAttribute(s),this.morphTargetsRelative?(Lr.addVectors(Tr.min,Cr.min),Tr.expandByPoint(Lr),Lr.addVectors(Tr.max,Cr.max),Tr.expandByPoint(Lr)):(Tr.expandByPoint(Cr.min),Tr.expandByPoint(Cr.max))}Tr.getCenter(l);let n=0;for(let e=0,t=r.count;e<t;e++)Lr.fromBufferAttribute(r,e),n=Math.max(n,l.distanceToSquared(Lr));if(i)for(let e=0,t=i.length;e<t;e++){var a=i[e],o=this.morphTargetsRelative;for(let e=0,t=a.count;e<t;e++)Lr.fromBufferAttribute(a,e),o&&(Er.fromBufferAttribute(r,e),Lr.add(Er)),n=Math.max(n,l.distanceToSquared(Lr))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){var e=this.index,t=this.attributes;if(null!==e&&void 0!==t.position&&void 0!==t.normal&&void 0!==t.uv){var r=e.array;const u=t.position.array,h=t.normal.array,d=t.uv.array;var i=u.length/3;void 0===t.tangent&&this.setAttribute("tangent",new vr(new Float32Array(4*i),4));const p=t.tangent.array,f=[],m=[];for(let e=0;e<i;e++)f[e]=new Wt,m[e]=new Wt;const g=new Wt,v=new Wt,y=new Wt,x=new Nt,b=new Nt,_=new Nt,w=new Wt,M=new Wt;let n=this.groups;0===n.length&&(n=[{start:0,count:r.length}]);for(let e=0,t=n.length;e<t;++e){var s=n[e],a=s.start;for(let e=a,t=a+s.count;e<t;e+=3)!function(e,t,n){g.fromArray(u,3*e),v.fromArray(u,3*t),y.fromArray(u,3*n),x.fromArray(d,2*e),b.fromArray(d,2*t),_.fromArray(d,2*n),v.sub(g),y.sub(g),b.sub(x),_.sub(x);var r=1/(b.x*_.y-_.x*b.y);isFinite(r)&&(w.copy(v).multiplyScalar(_.y).addScaledVector(y,-b.y).multiplyScalar(r),M.copy(y).multiplyScalar(b.x).addScaledVector(v,-_.x).multiplyScalar(r),f[e].add(w),f[t].add(w),f[n].add(w),m[e].add(M),m[t].add(M),m[n].add(M))}(r[e+0],r[e+1],r[e+2])}const S=new Wt,E=new Wt,T=new Wt,C=new Wt;for(let e=0,t=n.length;e<t;++e){var o=n[e],l=o.start;for(let e=l,t=l+o.count;e<t;e+=3)c(r[e+0]),c(r[e+1]),c(r[e+2])}function c(e){T.fromArray(h,3*e),C.copy(T);var t=f[e];S.copy(t),S.sub(T.multiplyScalar(T.dot(t))).normalize(),E.crossVectors(C,t);t=E.dot(m[e])<0?-1:1;p[4*e]=S.x,p[4*e+1]=S.y,p[4*e+2]=S.z,p[4*e+3]=t}}else console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)")}computeVertexNormals(){const r=this.index;var i=this.getAttribute("position");if(void 0!==i){let n=this.getAttribute("normal");if(void 0===n)n=new vr(new Float32Array(3*i.count),3),this.setAttribute("normal",n);else for(let e=0,t=n.count;e<t;e++)n.setXYZ(e,0,0,0);const l=new Wt,c=new Wt,u=new Wt,h=new Wt,d=new Wt,p=new Wt,f=new Wt,m=new Wt;if(r)for(let e=0,t=r.count;e<t;e+=3){var s=r.getX(e+0),a=r.getX(e+1),o=r.getX(e+2);l.fromBufferAttribute(i,s),c.fromBufferAttribute(i,a),u.fromBufferAttribute(i,o),f.subVectors(u,c),m.subVectors(l,c),f.cross(m),h.fromBufferAttribute(n,s),d.fromBufferAttribute(n,a),p.fromBufferAttribute(n,o),h.add(f),d.add(f),p.add(f),n.setXYZ(s,h.x,h.y,h.z),n.setXYZ(a,d.x,d.y,d.z),n.setXYZ(o,p.x,p.y,p.z)}else for(let e=0,t=i.count;e<t;e+=3)l.fromBufferAttribute(i,e+0),c.fromBufferAttribute(i,e+1),u.fromBufferAttribute(i,e+2),f.subVectors(u,c),m.subVectors(l,c),f.cross(m),n.setXYZ(e+0,f.x,f.y,f.z),n.setXYZ(e+1,f.x,f.y,f.z),n.setXYZ(e+2,f.x,f.y,f.z);this.normalizeNormals(),n.needsUpdate=!0}}merge(e,t){if(e&&e.isBufferGeometry){void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var n=this.attributes;for(const a in n)if(void 0!==e.attributes[a]){const o=n[a].array;var r=e.attributes[a],i=r.array,r=r.itemSize*t,s=Math.min(i.length,o.length-r);for(let e=0,t=r;e<s;e++,t++)o[t]=i[e]}return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e)}normalizeNormals(){const n=this.attributes.normal;for(let e=0,t=n.count;e<t;e++)Lr.fromBufferAttribute(n,e),Lr.normalize(),n.setXYZ(e,Lr.x,Lr.y,Lr.z)}toNonIndexed(){function n(n,r){const i=n.array;var s=n.itemSize,e=n.normalized;const a=new i.constructor(r.length*s);let o=0,l=0;for(let e=0,t=r.length;e<t;e++){o=n.isInterleavedBufferAttribute?r[e]*n.data.stride+n.offset:r[e]*s;for(let e=0;e<s;e++)a[l++]=i[o++]}return new vr(a,s,e)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const r=new Ar;var i=this.index.array,e=this.attributes;for(const u in e){var t=n(e[u],i);r.setAttribute(u,t)}var s=this.morphAttributes;for(const h in s){const d=[];var a=s[h];for(let e=0,t=a.length;e<t;e++){var o=n(a[e],i);d.push(o)}r.morphAttributes[h]=d}r.morphTargetsRelative=this.morphTargetsRelative;var l=this.groups;for(let e=0,t=l.length;e<t;e++){var c=l[e];r.addGroup(c.start,c.count,c.materialIndex)}return r}toJSON(){const n={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),0<Object.keys(this.userData).length&&(n.userData=this.userData),void 0!==this.parameters){var e=this.parameters;for(const l in e)void 0!==e[l]&&(n[l]=e[l]);return n}n.data={attributes:{}};var t=this.index;null!==t&&(n.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});var r=this.attributes;for(const c in r){const u=r[c];n.data.attributes[c]=u.toJSON(n.data)}const i={};let s=!1;for(const h in this.morphAttributes){var a=this.morphAttributes[h];const d=[];for(let e=0,t=a.length;e<t;e++){const p=a[e];d.push(p.toJSON(n.data))}0<d.length&&(i[h]=d,s=!0)}s&&(n.data.morphAttributes=i,n.data.morphTargetsRelative=this.morphTargetsRelative);t=this.groups;0<t.length&&(n.data.groups=JSON.parse(JSON.stringify(t)));const o=this.boundingSphere;return null!==o&&(n.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),n}clone(){return(new Ar).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;var n={};this.name=e.name;const t=e.index;null!==t&&this.setIndex(t.clone(n));var r=e.attributes;for(const c in r){const u=r[c];this.setAttribute(c,u.clone(n))}var i=e.morphAttributes;for(const h in i){const d=[],p=i[h];for(let e=0,t=p.length;e<t;e++)d.push(p[e].clone(n));this.morphAttributes[h]=d}this.morphTargetsRelative=e.morphTargetsRelative;var s=e.groups;for(let e=0,t=s.length;e<t;e++){var a=s[e];this.addGroup(a.start,a.count,a.materialIndex)}const o=e.boundingBox;null!==o&&(this.boundingBox=o.clone());const l=e.boundingSphere;return null!==l&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}Ar.prototype.isBufferGeometry=!0;const Pr=new wn,Rr=new _n,Dr=new pn,Nr=new Wt,Ir=new Wt,kr=new Wt,Or=new Wt,zr=new Wt,Ur=new Wt,Vr=new Wt,Fr=new Wt,Hr=new Wt,Br=new Nt,Gr=new Nt,Wr=new Nt,jr=new Wt,qr=new Wt;class Xr extends Xn{constructor(e=new Ar,t=new fr){super(),this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){var e=this.geometry;if(e.isBufferGeometry){var t=e.morphAttributes,n=Object.keys(t);if(0<n.length){var r=t[n[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=r.length;e<t;e++){var i=r[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}}}else{e=e.morphTargets;void 0!==e&&0<e.length&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(r,i){const e=this.geometry;var s=this.material,t=this.matrixWorld;if(void 0!==s&&(null===e.boundingSphere&&e.computeBoundingSphere(),Dr.copy(e.boundingSphere),Dr.applyMatrix4(t),!1!==r.ray.intersectsSphere(Dr)&&(Pr.copy(t).invert(),Rr.copy(r.ray).applyMatrix4(Pr),null===e.boundingBox||!1!==Rr.intersectsBox(e.boundingBox)))){let n;if(e.isBufferGeometry){const A=e.index;var a=e.attributes.position,o=e.morphAttributes.position,l=e.morphTargetsRelative,c=e.attributes.uv,u=e.attributes.uv2,h=e.groups,d=e.drawRange;if(null!==A)if(Array.isArray(s))for(let e=0,t=h.length;e<t;e++){var p=h[e],f=s[p.materialIndex];for(let e=Math.max(p.start,d.start),t=Math.min(p.start+p.count,d.start+d.count);e<t;e+=3){var m=A.getX(e),g=A.getX(e+1),v=A.getX(e+2);n=Yr(this,f,r,Rr,a,o,l,c,u,m,g,v),n&&(n.faceIndex=Math.floor(e/3),n.face.materialIndex=p.materialIndex,i.push(n))}}else for(let e=Math.max(0,d.start),t=Math.min(A.count,d.start+d.count);e<t;e+=3){var y=A.getX(e),x=A.getX(e+1),b=A.getX(e+2);n=Yr(this,s,r,Rr,a,o,l,c,u,y,x,b),n&&(n.faceIndex=Math.floor(e/3),i.push(n))}else if(void 0!==a)if(Array.isArray(s))for(let e=0,t=h.length;e<t;e++){var _=h[e],w=s[_.materialIndex];for(let e=Math.max(_.start,d.start),t=Math.min(_.start+_.count,d.start+d.count);e<t;e+=3){var M=e,S=e+1,E=e+2;n=Yr(this,w,r,Rr,a,o,l,c,u,M,S,E),n&&(n.faceIndex=Math.floor(e/3),n.face.materialIndex=_.materialIndex,i.push(n))}}else for(let e=Math.max(0,d.start),t=Math.min(a.count,d.start+d.count);e<t;e+=3){var T=e,C=e+1,L=e+2;n=Yr(this,s,r,Rr,a,o,l,c,u,T,C,L),n&&(n.faceIndex=Math.floor(e/3),i.push(n))}}else e.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}}function Yr(e,t,n,r,i,s,a,o,l,c,u,h){Nr.fromBufferAttribute(i,c),Ir.fromBufferAttribute(i,u),kr.fromBufferAttribute(i,h);var d=e.morphTargetInfluences;if(s&&d){Vr.set(0,0,0),Fr.set(0,0,0),Hr.set(0,0,0);for(let e=0,t=s.length;e<t;e++){var p=d[e],f=s[e];0!==p&&(Or.fromBufferAttribute(f,c),zr.fromBufferAttribute(f,u),Ur.fromBufferAttribute(f,h),a?(Vr.addScaledVector(Or,p),Fr.addScaledVector(zr,p),Hr.addScaledVector(Ur,p)):(Vr.addScaledVector(Or.sub(Nr),p),Fr.addScaledVector(zr.sub(Ir),p),Hr.addScaledVector(Ur.sub(kr),p)))}Nr.add(Vr),Ir.add(Fr),kr.add(Hr)}e.isSkinnedMesh&&(e.boneTransform(c,Nr),e.boneTransform(u,Ir),e.boneTransform(h,kr));const m=function(e,t,n,r,i,s,a,o){let l;return l=t.side===Pe?r.intersectTriangle(a,s,i,!0,o):r.intersectTriangle(i,s,a,t.side!==Re,o),null===l?null:(qr.copy(o),qr.applyMatrix4(e.matrixWorld),(o=n.ray.origin.distanceTo(qr))<n.near||o>n.far?null:{distance:o,point:qr.clone(),object:e})}(e,t,n,r,Nr,Ir,kr,jr);return m&&(o&&(Br.fromBufferAttribute(o,c),Gr.fromBufferAttribute(o,u),Wr.fromBufferAttribute(o,h),m.uv=ir.getUV(jr,Nr,Ir,kr,Br,Gr,Wr,new Nt)),l&&(Br.fromBufferAttribute(l,c),Gr.fromBufferAttribute(l,u),Wr.fromBufferAttribute(l,h),m.uv2=ir.getUV(jr,Nr,Ir,kr,Br,Gr,Wr,new Nt)),l={a:c,b:u,c:h,normal:new Wt,materialIndex:0},ir.getNormal(Nr,Ir,kr,l.normal),m.face=l),m}Xr.prototype.isMesh=!0;class Kr extends Ar{constructor(e=1,t=1,n=1,r=1,i=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:i,depthSegments:s};const C=this;r=Math.floor(r),i=Math.floor(i),s=Math.floor(s);const L=[],A=[],P=[],R=[];let D=0,N=0;function a(n,r,i,s,a,e,t,o,l,c,u){var h=e/l,d=t/c,p=e/2,f=t/2,m=o/2,g=l+1,v=c+1;let y=0,x=0;const b=new Wt;for(let t=0;t<v;t++){var _=t*d-f;for(let e=0;e<g;e++){var w=e*h-p;b[n]=w*s,b[r]=_*a,b[i]=m,A.push(b.x,b.y,b.z),b[n]=0,b[r]=0,b[i]=0<o?1:-1,P.push(b.x,b.y,b.z),R.push(e/l),R.push(1-t/c),y+=1}}for(let t=0;t<c;t++)for(let e=0;e<l;e++){var M=D+e+g*t,S=D+e+g*(t+1),E=D+(e+1)+g*(t+1),T=D+(e+1)+g*t;L.push(M,S,T),L.push(S,E,T),x+=6}C.addGroup(N,x,u),N+=x,D+=y}a("z","y","x",-1,-1,n,t,e,s,i,0),a("z","y","x",1,-1,n,t,-e,s,i,1),a("x","z","y",1,1,e,n,t,r,s,2),a("x","z","y",1,-1,e,n,-t,r,s,3),a("x","y","z",1,-1,e,t,n,r,i,4),a("x","y","z",-1,-1,e,t,-n,r,i,5),this.setIndex(L),this.setAttribute("position",new br(A,3)),this.setAttribute("normal",new br(P,3)),this.setAttribute("uv",new br(R,2))}static fromJSON(e){return new Kr(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Jr(e){const t={};for(const n in e){t[n]={};for(const r in e[n]){const i=e[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?t[n][r]=i.clone():Array.isArray(i)?t[n][r]=i.slice():t[n][r]=i}}return t}function Zr(t){const n={};for(let e=0;e<t.length;e++){var r=Jr(t[e]);for(const i in r)n[i]=r[i]}return n}const $r={clone:Jr,merge:Zr};class Qr extends ar{constructor(e){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Jr(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const r in this.uniforms){const i=this.uniforms[r].value;i&&i.isTexture?t.uniforms[r]={type:"t",value:i.toJSON(e).uuid}:i&&i.isColor?t.uniforms[r]={type:"c",value:i.getHex()}:i&&i.isVector2?t.uniforms[r]={type:"v2",value:i.toArray()}:i&&i.isVector3?t.uniforms[r]={type:"v3",value:i.toArray()}:i&&i.isVector4?t.uniforms[r]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?t.uniforms[r]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?t.uniforms[r]={type:"m4",value:i.toArray()}:t.uniforms[r]={value:i}}0<Object.keys(this.defines).length&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const n={};for(const s in this.extensions)!0===this.extensions[s]&&(n[s]=!0);return 0<Object.keys(n).length&&(t.extensions=n),t}}Qr.prototype.isShaderMaterial=!0;class ei extends Xn{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new wn,this.projectionMatrix=new wn,this.projectionMatrixInverse=new wn}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);var t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}ei.prototype.isCamera=!0;class ti extends ei{constructor(e=50,t=1,n=.1,r=2e3){super(),this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){e=.5*this.getFilmHeight()/e;this.fov=2*St*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){var e=Math.tan(.5*Mt*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*St*Math.atan(Math.tan(.5*Mt*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,n,r,i,s){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){var e=this.near;let t=e*Math.tan(.5*Mt*this.fov)/this.zoom,n=2*t,r=this.aspect*n,i=-.5*r;var s,a=this.view;null!==this.view&&this.view.enabled&&(s=a.fullWidth,o=a.fullHeight,i+=a.offsetX*r/s,t-=a.offsetY*n/o,r*=a.width/s,n*=a.height/o);var o=this.filmOffset;0!==o&&(i+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,t,t-n,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}ti.prototype.isPerspectiveCamera=!0;class ni extends Xn{constructor(e,t,n){if(super(),this.type="CubeCamera",!0===n.isWebGLCubeRenderTarget){this.renderTarget=n;const r=new ti(90,1,e,t);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new Wt(1,0,0)),this.add(r);const i=new ti(90,1,e,t);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new Wt(-1,0,0)),this.add(i);const s=new ti(90,1,e,t);s.layers=this.layers,s.up.set(0,0,1),s.lookAt(new Wt(0,1,0)),this.add(s);const a=new ti(90,1,e,t);a.layers=this.layers,a.up.set(0,0,-1),a.lookAt(new Wt(0,-1,0)),this.add(a);const o=new ti(90,1,e,t);o.layers=this.layers,o.up.set(0,-1,0),o.lookAt(new Wt(0,0,1)),this.add(o);const l=new ti(90,1,e,t);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new Wt(0,0,-1)),this.add(l)}else console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.")}update(e,t){null===this.parent&&this.updateMatrixWorld();const n=this.renderTarget;var[r,i,s,a,o,l]=this.children,c=e.xr.enabled,u=e.getRenderTarget();e.xr.enabled=!1;var h=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,r),e.setRenderTarget(n,1),e.render(t,i),e.setRenderTarget(n,2),e.render(t,s),e.setRenderTarget(n,3),e.render(t,a),e.setRenderTarget(n,4),e.render(t,o),n.texture.generateMipmaps=h,e.setRenderTarget(n,5),e.render(t,l),e.setRenderTarget(u),e.xr.enabled=c}}class ri extends Ut{constructor(e,t,n,r,i,s,a,o,l,c){super(e=void 0!==e?e:[],t=void 0!==t?t:M,n,r,i,s,a=void 0!==a?a:Ce,o,l,c),this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}ri.prototype.isCubeTexture=!0;class ii extends Ht{constructor(e,t,n){Number.isInteger(t)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),t=n),super(e,e,t),t=t||{},this.texture=new ri(void 0,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:G,this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.format=Ve,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;var n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new Kr(5,5,5);const i=new Qr({name:"CubemapFromEquirect",uniforms:Jr(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:Pe,blending:Y});i.uniforms.tEquirect.value=t;const s=new Xr(r,i);r=t.minFilter;t.minFilter===ke&&(t.minFilter=G);const a=new ni(1,10,this);return a.update(e,s),t.minFilter=r,s.geometry.dispose(),s.material.dispose(),this}clear(t,n,r,i){var e=t.getRenderTarget();for(let e=0;e<6;e++)t.setRenderTarget(this,e),t.clear(n,r,i);t.setRenderTarget(e)}}ii.prototype.isWebGLCubeRenderTarget=!0;const si=new Wt,ai=new Wt,oi=new It;class li{constructor(e=new Wt(1,0,0),t=0){this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){t=si.subVectors(n,t).cross(ai.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(t,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){var n=e.delta(si),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;r=-(e.start.dot(this.normal)+this.constant)/r;return r<0||1<r?null:t.copy(n).multiplyScalar(r).add(e.start)}intersectsLine(e){var t=this.distanceToPoint(e.start),e=this.distanceToPoint(e.end);return t<0&&0<e||e<0&&0<t}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){t=t||oi.getNormalMatrix(e);const n=this.coplanarPoint(si).applyMatrix4(e);t=this.normal.applyMatrix3(t).normalize();return this.constant=-n.dot(t),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}li.prototype.isPlane=!0;const ci=new pn,ui=new Wt;class hi{constructor(e=new li,t=new li,n=new li,r=new li,i=new li,s=new li){this.planes=[e,t,n,r,i,s]}set(e,t,n,r,i,s){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(n),a[3].copy(r),a[4].copy(i),a[5].copy(s),this}copy(t){const n=this.planes;for(let e=0;e<6;e++)n[e].copy(t.planes[e]);return this}setFromProjectionMatrix(e){const t=this.planes;var n=e.elements,r=n[0],i=n[1],s=n[2],a=n[3],o=n[4],l=n[5],c=n[6],u=n[7],h=n[8],d=n[9],p=n[10],f=n[11],m=n[12],g=n[13],e=n[14],n=n[15];return t[0].setComponents(a-r,u-o,f-h,n-m).normalize(),t[1].setComponents(a+r,u+o,f+h,n+m).normalize(),t[2].setComponents(a+i,u+l,f+d,n+g).normalize(),t[3].setComponents(a-i,u-l,f-d,n-g).normalize(),t[4].setComponents(a-s,u-c,f-p,n-e).normalize(),t[5].setComponents(a+s,u+c,f+p,n+e).normalize(),this}intersectsObject(e){const t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),ci.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(ci)}intersectsSprite(e){return ci.center.set(0,0,0),ci.radius=.7071067811865476,ci.applyMatrix4(e.matrixWorld),this.intersectsSphere(ci)}intersectsSphere(e){const t=this.planes;var n=e.center,r=-e.radius;for(let e=0;e<6;e++)if(t[e].distanceToPoint(n)<r)return!1;return!0}intersectsBox(t){var n=this.planes;for(let e=0;e<6;e++){const r=n[e];if(ui.x=(0<r.normal.x?t.max:t.min).x,ui.y=(0<r.normal.y?t.max:t.min).y,ui.z=(0<r.normal.z?t.max:t.min).z,r.distanceToPoint(ui)<0)return!1}return!0}containsPoint(t){const n=this.planes;for(let e=0;e<6;e++)if(n[e].distanceToPoint(t)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function di(){let n=null,e=!1,r=null,i=null;function s(e,t){r(e,t),i=n.requestAnimationFrame(s)}return{start:function(){!0!==e&&null!==r&&(i=n.requestAnimationFrame(s),e=!0)},stop:function(){n.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(e){r=e},setContext:function(e){n=e}}}function pi(a,e){const o=e.isWebGL2,i=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),i.get(e)},remove:function(e){e.isInterleavedBufferAttribute&&(e=e.data);var t=i.get(e);t&&(a.deleteBuffer(t.buffer),i.delete(e))},update:function(e,t){if(e.isGLBufferAttribute){var n=i.get(e);(!n||n.version<e.version)&&i.set(e,{buffer:e.buffer,type:e.type,bytesPerElement:e.elementSize,version:e.version})}else{e.isInterleavedBufferAttribute&&(e=e.data);const r=i.get(e);void 0===r?i.set(e,function(e,t){var n=e.array,r=e.usage,i=a.createBuffer();a.bindBuffer(t,i),a.bufferData(t,n,r),e.onUploadCallback();let s=5126;return n instanceof Float32Array?s=5126:n instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):n instanceof Uint16Array?e.isFloat16BufferAttribute?o?s=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):s=5123:n instanceof Int16Array?s=5122:n instanceof Uint32Array?s=5125:n instanceof Int32Array?s=5124:n instanceof Int8Array?s=5120:(n instanceof Uint8Array||n instanceof Uint8ClampedArray)&&(s=5121),{buffer:i,type:s,bytesPerElement:n.BYTES_PER_ELEMENT,version:e.version}}(e,t)):r.version<e.version&&(function(e,t,n){const r=t.array,i=t.updateRange;a.bindBuffer(n,e),-1===i.count?a.bufferSubData(n,0,r):(o?a.bufferSubData(n,i.offset*r.BYTES_PER_ELEMENT,r,i.offset,i.count):a.bufferSubData(n,i.offset*r.BYTES_PER_ELEMENT,r.subarray(i.offset,i.offset+i.count)),i.count=-1)}(r.buffer,e,t),r.version=e.version)}}}}class fi extends Ar{constructor(e=1,t=1,n=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r};var i=e/2,s=t/2,a=Math.floor(n),o=Math.floor(r),l=a+1,c=o+1,u=e/a,h=t/o;const d=[],p=[],f=[],m=[];for(let t=0;t<c;t++){var g=t*h-s;for(let e=0;e<l;e++){var v=e*u-i;p.push(v,-g,0),f.push(0,0,1),m.push(e/a),m.push(1-t/o)}}for(let t=0;t<o;t++)for(let e=0;e<a;e++){var y=e+l*t,x=e+l*(t+1),b=e+1+l*(t+1),_=e+1+l*t;d.push(y,x,_),d.push(x,b,_)}this.setIndex(d),this.setAttribute("position",new br(p,3)),this.setAttribute("normal",new br(f,3)),this.setAttribute("uv",new br(m,2))}static fromJSON(e){return new fi(e.width,e.height,e.widthSegments,e.heightSegments)}}const mi={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotVH = saturate( dot( geometry.viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float NoH ) {\n\tfloat invAlpha = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float NoV, float NoL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( NoL + NoV - NoL * NoV ) ) );\n}\nvec3 BRDF_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n\t\tvec2 f = fract( uv );\n\t\tuv += 0.5 - f;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t}\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\t\tuv *= texelSize;\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x += texelSize;\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.y += texelSize;\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x -= texelSize;\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tvec3 tm = mix( tl, tr, f.x );\n\t\tvec3 bm = mix( bl, br, f.x );\n\t\treturn mix( tm, bm, f.y );\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value ) {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getIBLIrradiance( const in GeometricContext geometry ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec;\n\t\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\t\treflectVec = reflect( - viewDir, normal );\n\t\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\t#else\n\t\t\t\treflectVec = refract( - viewDir, normal, refractionRatio );\n\t\t\t#endif\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tlightMapIrradiance *= PI;\n\t#endif\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularTintFactor = specularTint;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARTINTMAP\n\t\t\tspecularTintFactor *= specularTintMapTexelToLinear( texture2D( specularTintMap, vUv ) ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularTintFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularTintFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenTint = sheenTint;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenTint;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\tvec3 FssEss = specularColor * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += irradiance * BRDF_Sheen( material.roughness, directLight.direction, geometry, material.sheenTint );\n\t#else\n\t\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\t\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\t\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tfloat transmissionAlpha = 1.0;\n\tfloat transmissionFactor = transmission;\n\tfloat thicknessFactor = thickness;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\ttransmissionFactor *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tthicknessFactor *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\n\t\tattenuationTint, attenuationDistance );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );\n\ttransmissionAlpha = transmission.a;\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationTint;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( float roughness, float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( vec2 fragCoord, float roughness, float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( vec3 radiance, float transmissionDistance, vec3 attenuationColor, float attenuationDistance ) {\n\t\tif ( attenuationDistance == 0.0 ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 diffuseColor, vec3 specularColor, float specularF90,\n\t\tvec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness,\n\t\tvec3 attenuationColor, float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularTint;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARTINTMAP\n\t\tuniform sampler2D specularTintMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenTint;\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - clearcoat * Fcc ) + clearcoatSpecular * clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},gi={common:{diffuse:{value:new pr(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new It},uv2Transform:{value:new It},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Nt(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new pr(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new pr(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new It}},sprite:{diffuse:{value:new pr(16777215)},opacity:{value:1},center:{value:new Nt(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new It}}},vi={basic:{uniforms:Zr([gi.common,gi.specularmap,gi.envmap,gi.aomap,gi.lightmap,gi.fog]),vertexShader:mi.meshbasic_vert,fragmentShader:mi.meshbasic_frag},lambert:{uniforms:Zr([gi.common,gi.specularmap,gi.envmap,gi.aomap,gi.lightmap,gi.emissivemap,gi.fog,gi.lights,{emissive:{value:new pr(0)}}]),vertexShader:mi.meshlambert_vert,fragmentShader:mi.meshlambert_frag},phong:{uniforms:Zr([gi.common,gi.specularmap,gi.envmap,gi.aomap,gi.lightmap,gi.emissivemap,gi.bumpmap,gi.normalmap,gi.displacementmap,gi.fog,gi.lights,{emissive:{value:new pr(0)},specular:{value:new pr(1118481)},shininess:{value:30}}]),vertexShader:mi.meshphong_vert,fragmentShader:mi.meshphong_frag},standard:{uniforms:Zr([gi.common,gi.envmap,gi.aomap,gi.lightmap,gi.emissivemap,gi.bumpmap,gi.normalmap,gi.displacementmap,gi.roughnessmap,gi.metalnessmap,gi.fog,gi.lights,{emissive:{value:new pr(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:mi.meshphysical_vert,fragmentShader:mi.meshphysical_frag},toon:{uniforms:Zr([gi.common,gi.aomap,gi.lightmap,gi.emissivemap,gi.bumpmap,gi.normalmap,gi.displacementmap,gi.gradientmap,gi.fog,gi.lights,{emissive:{value:new pr(0)}}]),vertexShader:mi.meshtoon_vert,fragmentShader:mi.meshtoon_frag},matcap:{uniforms:Zr([gi.common,gi.bumpmap,gi.normalmap,gi.displacementmap,gi.fog,{matcap:{value:null}}]),vertexShader:mi.meshmatcap_vert,fragmentShader:mi.meshmatcap_frag},points:{uniforms:Zr([gi.points,gi.fog]),vertexShader:mi.points_vert,fragmentShader:mi.points_frag},dashed:{uniforms:Zr([gi.common,gi.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:mi.linedashed_vert,fragmentShader:mi.linedashed_frag},depth:{uniforms:Zr([gi.common,gi.displacementmap]),vertexShader:mi.depth_vert,fragmentShader:mi.depth_frag},normal:{uniforms:Zr([gi.common,gi.bumpmap,gi.normalmap,gi.displacementmap,{opacity:{value:1}}]),vertexShader:mi.meshnormal_vert,fragmentShader:mi.meshnormal_frag},sprite:{uniforms:Zr([gi.sprite,gi.fog]),vertexShader:mi.sprite_vert,fragmentShader:mi.sprite_frag},background:{uniforms:{uvTransform:{value:new It},t2D:{value:null}},vertexShader:mi.background_vert,fragmentShader:mi.background_frag},cube:{uniforms:Zr([gi.envmap,{opacity:{value:1}}]),vertexShader:mi.cube_vert,fragmentShader:mi.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:mi.equirect_vert,fragmentShader:mi.equirect_frag},distanceRGBA:{uniforms:Zr([gi.common,gi.displacementmap,{referencePosition:{value:new Wt},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:mi.distanceRGBA_vert,fragmentShader:mi.distanceRGBA_frag},shadow:{uniforms:Zr([gi.lights,gi.fog,{color:{value:new pr(0)},opacity:{value:1}}]),vertexShader:mi.shadow_vert,fragmentShader:mi.shadow_frag}};function yi(s,a,n,o,r){const l=new pr(0);let c=0,u,h,d=null,p=0,f=null;function m(e,t){n.buffers.color.setClear(e.r,e.g,e.b,t,r)}return{getClearColor:function(){return l},setClearColor:function(e,t=1){l.set(e),c=t,m(l,c)},getClearAlpha:function(){return c},setClearAlpha:function(e){c=e,m(l,c)},render:function(e,t){let n=!1,r=!0===t.isScene?t.background:null;r&&r.isTexture&&(r=a.get(r));const i=s.xr;(t=i.getSession&&i.getSession())&&"additive"===t.environmentBlendMode&&(r=null),null===r?m(l,c):r&&r.isColor&&(m(r,1),n=!0),(s.autoClear||n)&&s.clear(s.autoClearColor,s.autoClearDepth,s.autoClearStencil),r&&(r.isCubeTexture||r.mapping===L)?(void 0===h&&(h=new Xr(new Kr(1,1,1),new Qr({name:"BackgroundCubeMaterial",uniforms:Jr(vi.cube.uniforms),vertexShader:vi.cube.vertexShader,fragmentShader:vi.cube.fragmentShader,side:Pe,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),h.geometry.deleteAttribute("uv"),h.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(h.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),o.update(h)),h.material.uniforms.envMap.value=r,h.material.uniforms.flipEnvMap.value=r.isCubeTexture&&!1===r.isRenderTargetTexture?-1:1,d===r&&p===r.version&&f===s.toneMapping||(h.material.needsUpdate=!0,d=r,p=r.version,f=s.toneMapping),e.unshift(h,h.geometry,h.material,0,0,null)):r&&r.isTexture&&(void 0===u&&(u=new Xr(new fi(2,2),new Qr({name:"BackgroundMaterial",uniforms:Jr(vi.background.uniforms),vertexShader:vi.background.vertexShader,fragmentShader:vi.background.fragmentShader,side:Ae,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),Object.defineProperty(u.material,"map",{get:function(){return this.uniforms.t2D.value}}),o.update(u)),u.material.uniforms.t2D.value=r,!0===r.matrixAutoUpdate&&r.updateMatrix(),u.material.uniforms.uvTransform.value.copy(r.matrix),d===r&&p===r.version&&f===s.toneMapping||(u.material.needsUpdate=!0,d=r,p=r.version,f=s.toneMapping),e.unshift(u,u.geometry,u.material,0,0,null))}}}function xi(x,b,_,w){const i=x.getParameter(34921),o=w.isWebGL2?null:b.get("OES_vertex_array_object"),l=w.isWebGL2||null!==o,c={},e=d(null);let u=e;function h(e){return w.isWebGL2?x.bindVertexArray(e):o.bindVertexArrayOES(e)}function s(e){return w.isWebGL2?x.deleteVertexArray(e):o.deleteVertexArrayOES(e)}function d(e){const t=[],n=[],r=[];for(let e=0;e<i;e++)t[e]=0,n[e]=0,r[e]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:n,attributeDivisors:r,object:e,attributes:{},index:null}}function M(){const n=u.newAttributes;for(let e=0,t=n.length;e<t;e++)n[e]=0}function S(e){E(e,0)}function E(e,t){const n=u.newAttributes,r=u.enabledAttributes,i=u.attributeDivisors;if(n[e]=1,0===r[e]&&(x.enableVertexAttribArray(e),r[e]=1),i[e]!==t){const s=w.isWebGL2?x:b.get("ANGLE_instanced_arrays");s[w.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](e,t),i[e]=t}}function T(){var n=u.newAttributes;const r=u.enabledAttributes;for(let e=0,t=r.length;e<t;e++)r[e]!==n[e]&&(x.disableVertexAttribArray(e),r[e]=0)}function C(e,t,n,r,i,s){!0!==w.isWebGL2||5124!==n&&5125!==n?x.vertexAttribPointer(e,t,n,r,i,s):x.vertexAttribIPointer(e,t,n,i,s)}function a(){t(),u!==e&&(u=e,h(u.object))}function t(){e.geometry=null,e.program=null,e.wireframe=!1}return{setup:function(e,t,n,r,i){let s=!1;var a;l?(a=function(e,t,n){n=!0===n.wireframe;let r=c[e.id];void 0===r&&(r={},c[e.id]=r);let i=r[t.id];void 0===i&&(i={},r[t.id]=i);let s=i[n];void 0===s&&(s=d(w.isWebGL2?x.createVertexArray():o.createVertexArrayOES()),i[n]=s);return s}(r,n,t),u!==a&&(u=a,h(u.object)),s=function(e,t){var n=u.attributes,r=e.attributes;let i=0;for(const o in r){var s=n[o],a=r[o];if(void 0===s)return!0;if(s.attribute!==a)return!0;if(s.data!==a.data)return!0;i++}return u.attributesNum!==i||u.index!==t}(r,i),s&&function(e,t){const n={},r=e.attributes;let i=0;for(const a in r){var s=r[a];const o={};(o.attribute=s).data&&(o.data=s.data),n[a]=o,i++}u.attributes=n,u.attributesNum=i,u.index=t}(r,i)):(a=!0===t.wireframe,u.geometry===r.id&&u.program===n.id&&u.wireframe===a||(u.geometry=r.id,u.program=n.id,u.wireframe=a,s=!0)),!0===e.isInstancedMesh&&(s=!0),null!==i&&_.update(i,34963),s&&(function(e,t,n,r){if(!1===w.isWebGL2&&(e.isInstancedMesh||r.isInstancedBufferGeometry)&&null===b.get("ANGLE_instanced_arrays"))return;M();var i=r.attributes,s=n.getAttributes(),a=t.defaultAttributeValues;for(const y in s){var o=s[y];if(0<=o.location){let t=i[y];if(void 0===t&&("instanceMatrix"===y&&e.instanceMatrix&&(t=e.instanceMatrix),"instanceColor"===y&&e.instanceColor&&(t=e.instanceColor)),void 0!==t){var l=t.normalized,c=t.itemSize,u=_.get(t);if(void 0!==u){var h=u.buffer,d=u.type,p=u.bytesPerElement;if(t.isInterleavedBufferAttribute){var f=t.data,m=f.stride,g=t.offset;if(f&&f.isInstancedInterleavedBuffer){for(let e=0;e<o.locationSize;e++)E(o.location+e,f.meshPerAttribute);!0!==e.isInstancedMesh&&void 0===r._maxInstanceCount&&(r._maxInstanceCount=f.meshPerAttribute*f.count)}else for(let e=0;e<o.locationSize;e++)S(o.location+e);x.bindBuffer(34962,h);for(let e=0;e<o.locationSize;e++)C(o.location+e,c/o.locationSize,d,l,m*p,(g+c/o.locationSize*e)*p)}else{if(t.isInstancedBufferAttribute){for(let e=0;e<o.locationSize;e++)E(o.location+e,t.meshPerAttribute);!0!==e.isInstancedMesh&&void 0===r._maxInstanceCount&&(r._maxInstanceCount=t.meshPerAttribute*t.count)}else for(let e=0;e<o.locationSize;e++)S(o.location+e);x.bindBuffer(34962,h);for(let e=0;e<o.locationSize;e++)C(o.location+e,c/o.locationSize,d,l,c*p,c/o.locationSize*e*p)}}}else if(void 0!==a){var v=a[y];if(void 0!==v)switch(v.length){case 2:x.vertexAttrib2fv(o.location,v);break;case 3:x.vertexAttrib3fv(o.location,v);break;case 4:x.vertexAttrib4fv(o.location,v);break;default:x.vertexAttrib1fv(o.location,v)}}}}T()}(e,t,n,r),null!==i&&x.bindBuffer(34963,_.get(i).buffer))},reset:a,resetDefaultState:t,dispose:function(){a();for(const e in c){const t=c[e];for(const n in t){const r=t[n];for(const i in r)s(r[i].object),delete r[i];delete t[n]}delete c[e]}},releaseStatesOfGeometry:function(e){if(void 0!==c[e.id]){const t=c[e.id];for(const n in t){const r=t[n];for(const i in r)s(r[i].object),delete r[i];delete t[n]}delete c[e.id]}},releaseStatesOfProgram:function(e){for(const t in c){const n=c[t];if(void 0!==n[e.id]){const r=n[e.id];for(const i in r)s(r[i].object),delete r[i];delete n[e.id]}}},initAttributes:M,enableAttribute:S,disableUnusedAttributes:T}}function bi(s,a,o,e){const l=e.isWebGL2;let c;this.setMode=function(e){c=e},this.render=function(e,t){s.drawArrays(c,e,t),o.update(t,c,1)},this.renderInstances=function(n,r,i){if(0!==i){let e,t;if(l)e=s,t="drawArraysInstanced";else if(e=a.get("ANGLE_instanced_arrays"),t="drawArraysInstancedANGLE",null===e)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");e[t](c,n,r,i),o.update(r,c,i)}}}function _i(t,n,e){let r;function i(e){if("highp"===e){if(0<t.getShaderPrecisionFormat(35633,36338).precision&&0<t.getShaderPrecisionFormat(35632,36338).precision)return"highp";e="mediump"}return"mediump"===e&&0<t.getShaderPrecisionFormat(35633,36337).precision&&0<t.getShaderPrecisionFormat(35632,36337).precision?"mediump":"lowp"}var s="undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&t instanceof WebGL2ComputeRenderingContext;let a=void 0!==e.precision?e.precision:"highp";var o=i(a);o!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",o,"instead."),a=o);var l=s||n.has("WEBGL_draw_buffers"),c=!0===e.logarithmicDepthBuffer,u=t.getParameter(34930),h=t.getParameter(35660),d=t.getParameter(3379),p=t.getParameter(34076),f=t.getParameter(34921),m=t.getParameter(36347),g=t.getParameter(36348),v=t.getParameter(36349),y=0<h,x=s||n.has("OES_texture_float"),o=y&&x,e=s?t.getParameter(36183):0;return{isWebGL2:s,drawBuffers:l,getMaxAnisotropy:function(){return void 0!==r||(r=!0===n.has("EXT_texture_filter_anisotropic")?(e=n.get("EXT_texture_filter_anisotropic"),t.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT)):0),r;var e},getMaxPrecision:i,precision:a,logarithmicDepthBuffer:c,maxTextures:u,maxVertexTextures:h,maxTextureSize:d,maxCubemapSize:p,maxAttributes:f,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:v,vertexTextures:y,floatFragmentTextures:x,floatVertexTextures:o,maxSamples:e}}function wi(t){const o=this;let c=null,u=0,h=!1,d=!1;const l=new li,p=new It,f={value:null,needsUpdate:!1};function m(){f.value!==c&&(f.value=c,f.needsUpdate=0<u),o.numPlanes=u,o.numIntersection=0}function g(n,e,r,t){var i=null!==n?n.length:0;let s=null;if(0!==i){if(s=f.value,!0!==t||null===s){var t=r+4*i,a=e.matrixWorldInverse;p.getNormalMatrix(a),(null===s||s.length<t)&&(s=new Float32Array(t));for(let e=0,t=r;e!==i;++e,t+=4)l.copy(n[e]).applyMatrix4(a,p),l.normal.toArray(s,t),s[t+3]=l.constant}f.value=s,f.needsUpdate=!0}return o.numPlanes=i,o.numIntersection=0,s}this.uniform=f,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t,n){var r=0!==e.length||t||0!==u||h;return h=t,c=g(e,n,0),u=e.length,r},this.beginShadows=function(){d=!0,g(null)},this.endShadows=function(){d=!1,m()},this.setState=function(e,n,r){var i=e.clippingPlanes,s=e.clipIntersection,a=e.clipShadows;const o=t.get(e);if(!h||null===i||0===i.length||d&&!a)d?g(null):m();else{var a=d?0:u,l=4*a;let t=o.clippingState||null;f.value=t,t=g(i,n,l,r);for(let e=0;e!==l;++e)t[e]=c[e];o.clippingState=t,this.numIntersection=s?this.numPlanes:0,this.numPlanes+=a}}}function Mi(i){let s=new WeakMap;function a(e,t){return t===l?e.mapping=M:t===c&&(e.mapping=S),e}function o(e){const t=e.target;t.removeEventListener("dispose",o);const n=s.get(t);void 0!==n&&(s.delete(t),n.dispose())}return{get:function(e){if(e&&e.isTexture&&!1===e.isRenderTargetTexture){var t=e.mapping;if(t===l||t===c){if(s.has(e))return a(s.get(e).texture,e.mapping);var n=e.image;if(n&&0<n.height){t=i.getRenderTarget();const r=new ii(n.height/2);return r.fromEquirectangularTexture(i,e),s.set(e,r),i.setRenderTarget(t),e.addEventListener("dispose",o),a(r.texture,e.mapping)}return null}}return e},dispose:function(){s=new WeakMap}}}vi.physical={uniforms:Zr([vi.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Nt(1,1)},clearcoatNormalMap:{value:null},sheenTint:{value:new pr(0)},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Nt},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationTint:{value:new pr(0)},specularIntensity:{value:0},specularIntensityMap:{value:null},specularTint:{value:new pr(1,1,1)},specularTintMap:{value:null}}]),vertexShader:mi.meshphysical_vert,fragmentShader:mi.meshphysical_frag};class Si extends ei{constructor(e=-1,t=1,n=1,r=-1,i=.1,s=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=r,this.near=i,this.far=s,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,n,r,i,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let i=n-e,s=n+e,a=r+t,o=r-t;null!==this.view&&this.view.enabled&&(r=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom,i+=r*this.view.offsetX,s=i+r*this.view.width,a-=t*this.view.offsetY,o=a-t*this.view.height),this.projectionMatrix.makeOrthographic(i,s,a,o,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}Si.prototype.isOrthographicCamera=!0;class Ei extends Qr{constructor(e){super(e),this.type="RawShaderMaterial"}}Ei.prototype.isRawShaderMaterial=!0;const Ti=Math.pow(2,8),Ci=[.125,.215,.35,.446,.526,.582],Li=5+Ci.length,Ai={[gt]:0,3001:1,3002:2,3004:3,3005:4,3006:5,3007:6},Pi=new Si,{_lodPlanes:Ri,_sizeLods:Di,_sigmas:Ni}=Fi(),Ii=new pr;let ki=null;var Oi=(1+Math.sqrt(5))/2,zi=1/Oi;const Ui=[new Wt(1,1,1),new Wt(-1,1,1),new Wt(1,1,-1),new Wt(-1,1,-1),new Wt(0,Oi,zi),new Wt(0,Oi,-zi),new Wt(zi,0,Oi),new Wt(-zi,0,Oi),new Wt(Oi,zi,0),new Wt(-Oi,zi,0)];class Vi{constructor(e){var t,n;this._renderer=e,this._pingPongRenderTarget=null,this._blurMaterial=(t=20,n=new Float32Array(t),e=new Wt(0,1,0),e=new Ei({name:"SphericalGaussianBlur",defines:{n:t},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:e},inputEncoding:{value:Ai[gt]},outputEncoding:{value:Ai[gt]}},vertexShader:ji(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			${qi()}

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:Y,depthTest:!1,depthWrite:!1})),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,r=100){ki=this._renderer.getRenderTarget();var i=this._allocateTargets();return this._sceneToCubeUV(e,n,r,i),0<t&&this._blur(i,0,0,t),this._applyPMREM(i),this._cleanup(i),i}fromEquirectangular(e){return this._fromTexture(e)}fromCubemap(e){return this._fromTexture(e)}compileCubemapShader(){null===this._cubemapShader&&(this._cubemapShader=Wi(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){null===this._equirectShader&&(this._equirectShader=Gi(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(let e=0;e<Ri.length;e++)Ri[e].dispose()}_cleanup(e){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(ki),e.scissorTest=!1,Bi(e,0,0,e.width,e.height)}_fromTexture(e){ki=this._renderer.getRenderTarget();var t=this._allocateTargets(e);return this._textureToCubeUV(e,t),this._applyPMREM(t),this._cleanup(t),t}_allocateTargets(e){var t,t={magFilter:Ie,minFilter:Ie,generateMipmaps:!1,type:Oe,format:r,encoding:void 0===(t=e)||t.type!==Oe||t.encoding!==gt&&3001!==t.encoding&&3007!==t.encoding?3002:e.encoding,depthBuffer:!1};const n=Hi(t);return n.depthBuffer=!e,this._pingPongRenderTarget=Hi(t),n}_compileMaterial(e){e=new Xr(Ri[0],e);this._renderer.compile(e,Pi)}_sceneToCubeUV(t,e,n,r){const i=new ti(90,1,e,n);var s=[1,-1,1,1,1,1],a=[1,1,1,-1,-1,-1];const o=this._renderer;var l=o.autoClear,c=o.outputEncoding,e=o.toneMapping;o.getClearColor(Ii),o.toneMapping=De,o.outputEncoding=gt,o.autoClear=!1;const u=new fr({name:"PMREM.Background",side:Pe,depthWrite:!1,depthTest:!1}),h=new Xr(new Kr,u);let d=!1;n=t.background;n?n.isColor&&(u.color.copy(n),t.background=null,d=!0):(u.color.copy(Ii),d=!0);for(let e=0;e<6;e++){var p=e%3;0==p?(i.up.set(0,s[e],0),i.lookAt(a[e],0,0)):1==p?(i.up.set(0,0,s[e]),i.lookAt(0,a[e],0)):(i.up.set(0,s[e],0),i.lookAt(0,0,a[e])),Bi(r,p*Ti,2<e?Ti:0,Ti,Ti),o.setRenderTarget(r),d&&o.render(h,i),o.render(t,i)}h.geometry.dispose(),h.material.dispose(),o.toneMapping=e,o.outputEncoding=c,o.autoClear=l,t.background=n}_textureToCubeUV(e,t){const n=this._renderer;e.isCubeTexture?null==this._cubemapShader&&(this._cubemapShader=Wi()):null==this._equirectShader&&(this._equirectShader=Gi());var r=e.isCubeTexture?this._cubemapShader:this._equirectShader,i=new Xr(Ri[0],r);const s=r.uniforms;(s.envMap.value=e).isCubeTexture||s.texelSize.value.set(1/e.image.width,1/e.image.height),s.inputEncoding.value=Ai[e.encoding],s.outputEncoding.value=Ai[t.texture.encoding],Bi(t,0,0,3*Ti,2*Ti),n.setRenderTarget(t),n.render(i,Pi)}_applyPMREM(t){const e=this._renderer;var n=e.autoClear;e.autoClear=!1;for(let e=1;e<Li;e++){var r=Math.sqrt(Ni[e]*Ni[e]-Ni[e-1]*Ni[e-1]),i=Ui[(e-1)%Ui.length];this._blur(t,e-1,e,r,i)}e.autoClear=n}_blur(e,t,n,r,i){var s=this._pingPongRenderTarget;this._halfBlur(e,s,t,n,r,"latitudinal",i),this._halfBlur(s,e,n,n,r,"longitudinal",i)}_halfBlur(e,t,n,r,i,s,a){const o=this._renderer;var l=this._blurMaterial;"latitudinal"!==s&&"longitudinal"!==s&&console.error("blur direction must be either latitudinal or longitudinal!");var c=new Xr(Ri[r],l);const u=l.uniforms;var l=Di[n]-1,l=isFinite(i)?Math.PI/(2*l):2*Math.PI/39,h=i/l,d=isFinite(i)?1+Math.floor(3*h):20;20<d&&console.warn(`sigmaRadians, ${i}, is too large and will clip, as it requested ${d} samples when the maximum is set to 20`);const p=[];let f=0;for(let e=0;e<20;++e){const g=e/h;var m=Math.exp(-g*g/2);p.push(m),0==e?f+=m:e<d&&(f+=2*m)}for(let e=0;e<p.length;e++)p[e]=p[e]/f;u.envMap.value=e.texture,u.samples.value=d,u.weights.value=p,u.latitudinal.value="latitudinal"===s,a&&(u.poleAxis.value=a),u.dTheta.value=l,u.mipInt.value=8-n,u.inputEncoding.value=Ai[e.texture.encoding],u.outputEncoding.value=Ai[e.texture.encoding];e=Di[r];const g=3*Math.max(0,Ti-2*e);r=(0===r?0:2*Ti)+2*e*(4<r?r-8+4:0);Bi(t,g,r,3*e,2*e),o.setRenderTarget(t),o.render(c,Pi)}}function Fi(){const n=[],r=[],i=[];let s=8;for(let t=0;t<Li;t++){var a=Math.pow(2,s);r.push(a);let e=1/a;4<t?e=Ci[t-8+4-1]:0==t&&(e=0),i.push(e);var o=1/(a-1),a=-o/2,o=1+o/2,l=[a,a,o,a,o,o,a,a,o,o,a,o];const h=new Float32Array(108),d=new Float32Array(72),p=new Float32Array(36);for(let e=0;e<6;e++){var c=e%3*2/3-1,u=2<e?0:-1;h.set([c,u,0,c+2/3,u,0,c+2/3,1+u,0,c,u,0,c+2/3,1+u,0,c,1+u,0],18*e),d.set(l,12*e);u=[e,e,e,e,e,e];p.set(u,6*e)}const f=new Ar;f.setAttribute("position",new vr(h,3)),f.setAttribute("uv",new vr(d,2)),f.setAttribute("faceIndex",new vr(p,1)),n.push(f),4<s&&s--}return{_lodPlanes:n,_sizeLods:r,_sigmas:i}}function Hi(e){const t=new Ht(3*Ti,3*Ti,e);return t.texture.mapping=L,t.texture.name="PMREM.cubeUv",t.scissorTest=!0,t}function Bi(e,t,n,r,i){e.viewport.set(t,n,r,i),e.scissor.set(t,n,r,i)}function Gi(){var e=new Nt(1,1);return new Ei({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:e},inputEncoding:{value:Ai[gt]},outputEncoding:{value:Ai[gt]}},vertexShader:ji(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform vec2 texelSize;

			${qi()}

			#include <common>

			void main() {

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				vec2 f = fract( uv / texelSize - 0.5 );
				uv -= f * texelSize;
				vec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.x += texelSize.x;
				vec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.y += texelSize.y;
				vec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.x -= texelSize.x;
				vec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;

				vec3 tm = mix( tl, tr, f.x );
				vec3 bm = mix( bl, br, f.x );
				gl_FragColor.rgb = mix( tm, bm, f.y );

				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:Y,depthTest:!1,depthWrite:!1})}function Wi(){return new Ei({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:Ai[gt]},outputEncoding:{value:Ai[gt]}},vertexShader:ji(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			${qi()}

			void main() {

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;
				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:Y,depthTest:!1,depthWrite:!1})}function ji(){return`

		precision mediump float;
		precision mediump int;

		attribute vec3 position;
		attribute vec2 uv;
		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function qi(){return`

		uniform int inputEncoding;
		uniform int outputEncoding;

		#include <encodings_pars_fragment>

		vec4 inputTexelToLinear( vec4 value ) {

			if ( inputEncoding == 0 ) {

				return value;

			} else if ( inputEncoding == 1 ) {

				return sRGBToLinear( value );

			} else if ( inputEncoding == 2 ) {

				return RGBEToLinear( value );

			} else if ( inputEncoding == 3 ) {

				return RGBMToLinear( value, 7.0 );

			} else if ( inputEncoding == 4 ) {

				return RGBMToLinear( value, 16.0 );

			} else if ( inputEncoding == 5 ) {

				return RGBDToLinear( value, 256.0 );

			} else {

				return GammaToLinear( value, 2.2 );

			}

		}

		vec4 linearToOutputTexel( vec4 value ) {

			if ( outputEncoding == 0 ) {

				return value;

			} else if ( outputEncoding == 1 ) {

				return LinearTosRGB( value );

			} else if ( outputEncoding == 2 ) {

				return LinearToRGBE( value );

			} else if ( outputEncoding == 3 ) {

				return LinearToRGBM( value, 7.0 );

			} else if ( outputEncoding == 4 ) {

				return LinearToRGBM( value, 16.0 );

			} else if ( outputEncoding == 5 ) {

				return LinearToRGBD( value, 256.0 );

			} else {

				return LinearToGamma( value, 2.2 );

			}

		}

		vec4 envMapTexelToLinear( vec4 color ) {

			return inputTexelToLinear( color );

		}
	`}function Xi(i){let s=new WeakMap,a=null;function o(e){const t=e.target;t.removeEventListener("dispose",o);const n=s.get(t);void 0!==n&&(s.delete(t),n.dispose())}return{get:function(e){if(e&&e.isTexture&&!1===e.isRenderTargetTexture){var t=e.mapping,n=t===l||t===c,r=t===M||t===S;if(n||r){if(s.has(e))return s.get(e).texture;t=e.image;if(n&&t&&0<t.height||r&&t&&function(t){let n=0;for(let e=0;e<6;e++)void 0!==t[e]&&n++;return 6===n}(t)){t=i.getRenderTarget();null===a&&(a=new Vi(i));n=n?a.fromEquirectangular(e):a.fromCubemap(e);return s.set(e,n),i.setRenderTarget(t),e.addEventListener("dispose",o),n.texture}return null}}return e},dispose:function(){s=new WeakMap,null!==a&&(a.dispose(),a=null)}}}function Yi(n){const r={};function i(e){if(void 0!==r[e])return r[e];let t;switch(e){case"WEBGL_depth_texture":t=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":t=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":t=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":t=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:t=n.getExtension(e)}return r[e]=t,t}return{has:function(e){return null!==i(e)},init:function(e){e.isWebGL2?i("EXT_color_buffer_float"):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float")},get:function(e){var t=i(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function Ki(e,f,r,i){const s={},m=new WeakMap;function a(e){const t=e.target;null!==t.index&&f.remove(t.index);for(const n in t.attributes)f.remove(t.attributes[n]);t.removeEventListener("dispose",a),delete s[t.id];e=m.get(t);e&&(f.remove(e),m.delete(t)),i.releaseStatesOfGeometry(t),!0===t.isInstancedBufferGeometry&&delete t._maxInstanceCount,r.memory.geometries--}function o(e){const n=[];var t=e.index,r=e.attributes.position;let i=0;if(null!==t){var s=t.array;i=t.version;for(let e=0,t=s.length;e<t;e+=3){var a=s[e+0],o=s[e+1],l=s[e+2];n.push(a,o,o,l,l,a)}}else{var c=r.array;i=r.version;for(let e=0,t=c.length/3-1;e<t;e+=3){var u=e+0,h=e+1,d=e+2;n.push(u,h,h,d,d,u)}}const p=new(65535<_r(n)?xr:yr)(n,1);p.version=i;c=m.get(e);c&&f.remove(c),m.set(e,p)}return{get:function(e,t){return!0===s[t.id]||(t.addEventListener("dispose",a),s[t.id]=!0,r.memory.geometries++),t},update:function(e){var t=e.attributes;for(const i in t)f.update(t[i],34962);var n=e.morphAttributes;for(const s in n){var r=n[s];for(let e=0,t=r.length;e<t;e++)f.update(r[e],34962)}},getWireframeAttribute:function(e){var t,n=m.get(e);return(!n||null!==(t=e.index)&&n.version<t.version)&&o(e),m.get(e)}}}function Ji(s,a,o,e){const l=e.isWebGL2;let c;let u,h;this.setMode=function(e){c=e},this.setIndex=function(e){u=e.type,h=e.bytesPerElement},this.render=function(e,t){s.drawElements(c,t,u,e*h),o.update(t,c,1)},this.renderInstances=function(n,r,i){if(0!==i){let e,t;if(l)e=s,t="drawElementsInstanced";else if(e=a.get("ANGLE_instanced_arrays"),t="drawElementsInstancedANGLE",null===e)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");e[t](c,r,u,n*h,i),o.update(r,c,i)}}}function Zi(e){const r={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:r,programs:null,autoReset:!0,reset:function(){r.frame++,r.calls=0,r.triangles=0,r.points=0,r.lines=0},update:function(e,t,n){switch(r.calls++,t){case 4:r.triangles+=n*(e/3);break;case 1:r.lines+=n*(e/2);break;case 3:r.lines+=n*(e-1);break;case 2:r.lines+=n*e;break;case 0:r.points+=n*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",t)}}}}function $i(e,t){return e[0]-t[0]}function Qi(e,t){return Math.abs(t[1])-Math.abs(e[1])}function es(p){const f={},m=new Float32Array(8),g=[];for(let e=0;e<8;e++)g[e]=[e,0];return{update:function(e,t,n,r){var i=e.morphTargetInfluences,s=void 0===i?0:i.length;let a=f[t.id];if(void 0===a||a.length!==s){a=[];for(let e=0;e<s;e++)a[e]=[e,0];f[t.id]=a}for(let e=0;e<s;e++){const d=a[e];d[0]=e,d[1]=i[e]}a.sort(Qi);for(let e=0;e<8;e++)e<s&&a[e][1]?(g[e][0]=a[e][0],g[e][1]=a[e][1]):(g[e][0]=Number.MAX_SAFE_INTEGER,g[e][1]=0);g.sort($i);var o=t.morphAttributes.position,l=t.morphAttributes.normal;let c=0;for(let e=0;e<8;e++){var u=g[e],h=u[0],u=u[1];h!==Number.MAX_SAFE_INTEGER&&u?(o&&t.getAttribute("morphTarget"+e)!==o[h]&&t.setAttribute("morphTarget"+e,o[h]),l&&t.getAttribute("morphNormal"+e)!==l[h]&&t.setAttribute("morphNormal"+e,l[h]),m[e]=u,c+=u):(o&&!0===t.hasAttribute("morphTarget"+e)&&t.deleteAttribute("morphTarget"+e),l&&!0===t.hasAttribute("morphNormal"+e)&&t.deleteAttribute("morphNormal"+e),m[e]=0)}e=t.morphTargetsRelative?1:1-c,r.getUniforms().setValue(p,"morphTargetBaseInfluence",e),r.getUniforms().setValue(p,"morphTargetInfluences",m)}}}function ts(e,r,i,s){let a=new WeakMap;function o(e){const t=e.target;t.removeEventListener("dispose",o),i.remove(t.instanceMatrix),null!==t.instanceColor&&i.remove(t.instanceColor)}return{update:function(e){var t=s.render.frame,n=e.geometry,n=r.get(e,n);return a.get(n)!==t&&(r.update(n),a.set(n,t)),e.isInstancedMesh&&(!1===e.hasEventListener("dispose",o)&&e.addEventListener("dispose",o),i.update(e.instanceMatrix,34962),null!==e.instanceColor&&i.update(e.instanceColor,34962)),n},dispose:function(){a=new WeakMap}}}class ns extends Ut{constructor(e=null,t=1,n=1,r=1){super(null),this.image={data:e,width:t,height:n,depth:r},this.magFilter=Ie,this.minFilter=Ie,this.wrapR=Ne,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}class rs extends Ut{constructor(e=null,t=1,n=1,r=1){super(null),this.image={data:e,width:t,height:n,depth:r},this.magFilter=Ie,this.minFilter=Ie,this.wrapR=Ne,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}rs.prototype.isDataTexture3D=ns.prototype.isDataTexture2DArray=!0;const is=new Ut,ss=new ns,as=new rs,os=new ri,ls=[],cs=[],us=new Float32Array(16),hs=new Float32Array(9),ds=new Float32Array(4);function ps(n,r,i){const e=n[0];if(e<=0||0<e)return n;var t=r*i;let s=ls[t];if(void 0===s&&(s=new Float32Array(t),ls[t]=s),0!==r){e.toArray(s,0);for(let e=1,t=0;e!==r;++e)t+=i,n[e].toArray(s,t)}return s}function fs(n,r){if(n.length===r.length){for(let e=0,t=n.length;e<t;e++)if(n[e]!==r[e])return;return 1}}function ms(n,r){for(let e=0,t=r.length;e<t;e++)n[e]=r[e]}function gs(t,n){let r=cs[n];void 0===r&&(r=new Int32Array(n),cs[n]=r);for(let e=0;e!==n;++e)r[e]=t.allocateTextureUnit();return r}function vs(e,t){const n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function ys(e,t){const n=this.cache;void 0!==t.x?n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y):fs(n,t)||(e.uniform2fv(this.addr,t),ms(n,t))}function xs(e,t){const n=this.cache;void 0!==t.x?n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z):void 0!==t.r?n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b):fs(n,t)||(e.uniform3fv(this.addr,t),ms(n,t))}function bs(e,t){const n=this.cache;void 0!==t.x?n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w):fs(n,t)||(e.uniform4fv(this.addr,t),ms(n,t))}function _s(e,t){var n=this.cache,r=t.elements;void 0===r?fs(n,t)||(e.uniformMatrix2fv(this.addr,!1,t),ms(n,t)):fs(n,r)||(ds.set(r),e.uniformMatrix2fv(this.addr,!1,ds),ms(n,r))}function ws(e,t){var n=this.cache,r=t.elements;void 0===r?fs(n,t)||(e.uniformMatrix3fv(this.addr,!1,t),ms(n,t)):fs(n,r)||(hs.set(r),e.uniformMatrix3fv(this.addr,!1,hs),ms(n,r))}function Ms(e,t){var n=this.cache,r=t.elements;void 0===r?fs(n,t)||(e.uniformMatrix4fv(this.addr,!1,t),ms(n,t)):fs(n,r)||(us.set(r),e.uniformMatrix4fv(this.addr,!1,us),ms(n,r))}function Ss(e,t){const n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function Es(e,t){var n=this.cache;fs(n,t)||(e.uniform2iv(this.addr,t),ms(n,t))}function Ts(e,t){var n=this.cache;fs(n,t)||(e.uniform3iv(this.addr,t),ms(n,t))}function Cs(e,t){var n=this.cache;fs(n,t)||(e.uniform4iv(this.addr,t),ms(n,t))}function Ls(e,t){const n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function As(e,t){var n=this.cache;fs(n,t)||(e.uniform2uiv(this.addr,t),ms(n,t))}function Ps(e,t){var n=this.cache;fs(n,t)||(e.uniform3uiv(this.addr,t),ms(n,t))}function Rs(e,t){var n=this.cache;fs(n,t)||(e.uniform4uiv(this.addr,t),ms(n,t))}function Ds(e,t,n){const r=this.cache;var i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.safeSetTexture2D(t||is,i)}function Ns(e,t,n){const r=this.cache;var i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture3D(t||as,i)}function Is(e,t,n){const r=this.cache;var i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.safeSetTextureCube(t||os,i)}function ks(e,t,n){const r=this.cache;var i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture2DArray(t||ss,i)}function Os(e,t){e.uniform1fv(this.addr,t)}function zs(e,t){t=ps(t,this.size,2);e.uniform2fv(this.addr,t)}function Us(e,t){t=ps(t,this.size,3);e.uniform3fv(this.addr,t)}function Vs(e,t){t=ps(t,this.size,4);e.uniform4fv(this.addr,t)}function Fs(e,t){t=ps(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,t)}function Hs(e,t){t=ps(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,t)}function Bs(e,t){t=ps(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,t)}function Gs(e,t){e.uniform1iv(this.addr,t)}function Ws(e,t){e.uniform2iv(this.addr,t)}function js(e,t){e.uniform3iv(this.addr,t)}function qs(e,t){e.uniform4iv(this.addr,t)}function Xs(e,t){e.uniform1uiv(this.addr,t)}function Ys(e,t){e.uniform2uiv(this.addr,t)}function Ks(e,t){e.uniform3uiv(this.addr,t)}function Js(e,t){e.uniform4uiv(this.addr,t)}function Zs(e,t,n){var r=t.length,i=gs(n,r);e.uniform1iv(this.addr,i);for(let e=0;e!==r;++e)n.safeSetTexture2D(t[e]||is,i[e])}function $s(e,t,n){var r=t.length,i=gs(n,r);e.uniform1iv(this.addr,i);for(let e=0;e!==r;++e)n.safeSetTextureCube(t[e]||os,i[e])}function Qs(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=function(e){switch(e){case 5126:return vs;case 35664:return ys;case 35665:return xs;case 35666:return bs;case 35674:return _s;case 35675:return ws;case 35676:return Ms;case 5124:case 35670:return Ss;case 35667:case 35671:return Es;case 35668:case 35672:return Ts;case 35669:case 35673:return Cs;case 5125:return Ls;case 36294:return As;case 36295:return Ps;case 36296:return Rs;case 35678:case 36198:case 36298:case 36306:case 35682:return Ds;case 35679:case 36299:case 36307:return Ns;case 35680:case 36300:case 36308:case 36293:return Is;case 36289:case 36303:case 36311:case 36292:return ks}}(t.type)}function ea(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return Os;case 35664:return zs;case 35665:return Us;case 35666:return Vs;case 35674:return Fs;case 35675:return Hs;case 35676:return Bs;case 5124:case 35670:return Gs;case 35667:case 35671:return Ws;case 35668:case 35672:return js;case 35669:case 35673:return qs;case 5125:return Xs;case 36294:return Ys;case 36295:return Ks;case 36296:return Js;case 35678:case 36198:case 36298:case 36306:case 35682:return Zs;case 35680:case 36300:case 36308:case 36293:return $s}}(t.type)}function ta(e){this.id=e,this.seq=[],this.map={}}ea.prototype.updateCache=function(e){var t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),ms(t,e)},ta.prototype.setValue=function(n,r,i){var s=this.seq;for(let e=0,t=s.length;e!==t;++e){const a=s[e];a.setValue(n,r[a.id],i)}};const na=/(\w+)(\])?(\[|\.)?/g;function ra(e,t){e.seq.push(t),e.map[t.id]=t}function ia(t,n){this.seq=[],this.map={};var r=t.getProgramParameter(n,35718);for(let e=0;e<r;++e){var i=t.getActiveUniform(n,e);!function(e,n,r){var i=e.name,s=i.length;for(na.lastIndex=0;;){var a=na.exec(i),o=na.lastIndex;let t=a[1];var l="]"===a[2],a=a[3];if(l&&(t|=0),void 0===a||"["===a&&o+2===s){ra(r,new(void 0===a?Qs:ea)(t,e,n));break}{let e=r.map[t];void 0===e&&(e=new ta(t),ra(r,e)),r=e}}}(i,t.getUniformLocation(n,i.name),this)}}function sa(e,t,n){t=e.createShader(t);return e.shaderSource(t,n),e.compileShader(t),t}ia.prototype.setValue=function(e,t,n,r){const i=this.map[t];void 0!==i&&i.setValue(e,n,r)},ia.prototype.setOptional=function(e,t,n){t=t[n];void 0!==t&&this.setValue(e,n,t)},ia.upload=function(n,r,i,s){for(let e=0,t=r.length;e!==t;++e){const a=r[e],o=i[a.id];!1!==o.needsUpdate&&a.setValue(n,o.value,s)}},ia.seqWithValue=function(n,r){const i=[];for(let e=0,t=n.length;e!==t;++e){var s=n[e];s.id in r&&i.push(s)}return i};let aa=0;function oa(e){switch(e){case gt:return["Linear","( value )"];case 3001:return["sRGB","( value )"];case 3002:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case 3007:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case 3003:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}function la(e,t,n){var r=e.getShaderParameter(t,35713),i=e.getShaderInfoLog(t).trim();return r&&""===i?"":n.toUpperCase()+"\n\n"+i+"\n\n"+function(e){const t=e.split("\n");for(let e=0;e<t.length;e++)t[e]=e+1+": "+t[e];return t.join("\n")}(e.getShaderSource(t))}function ca(e,t){t=oa(t);return"vec4 "+e+"( vec4 value ) { return "+t[0]+"ToLinear"+t[1]+"; }"}function ua(e){return""!==e}function ha(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function da(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const pa=/^[ \t]*#include +<([\w\d./]+)>/gm;function fa(e){return e.replace(pa,ma)}function ma(e,t){var n=mi[t];if(void 0===n)throw new Error("Can not resolve #include <"+t+">");return fa(n)}const ga=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,va=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function ya(e){return e.replace(va,ba).replace(ga,xa)}function xa(e,t,n,r){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),ba(0,t,n,r)}function ba(e,t,n,r){let i="";for(let e=parseInt(t);e<parseInt(n);e++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+e+" ]").replace(/UNROLLED_LOOP_INDEX/g,e);return i}function _a(e){let t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function wa(n,e,t,r){const i=n.getContext();var s=t.defines,a=t.vertexShader,o=t.fragmentShader,l=function(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===T?t="SHADOWMAP_TYPE_PCF":2===e.shadowMapType?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===C&&(t="SHADOWMAP_TYPE_VSM"),t}(t),c=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case M:case S:t="ENVMAP_TYPE_CUBE";break;case L:case A:t="ENVMAP_TYPE_CUBE_UV"}return t}(t),u=function(e){let t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case S:case A:t="ENVMAP_MODE_REFRACTION"}return t}(t),h=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case 0:t="ENVMAP_BLENDING_MULTIPLY";break;case 1:t="ENVMAP_BLENDING_MIX";break;case 2:t="ENVMAP_BLENDING_ADD"}return t}(t),d=0<n.gammaFactor?n.gammaFactor:1;const p=t.isWebGL2?"":function(e){const t=[e.extensionDerivatives||e.envMapCubeUV||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""];return t.filter(ua).join("\n")}(t),f=function(e){const t=[];for(const r in e){var n=e[r];!1!==n&&t.push("#define "+r+" "+n)}return t.join("\n")}(s),m=i.createProgram();let g,v,y=t.glslVersion?"#version "+t.glslVersion+"\n":"";t.isRawShaderMaterial?(g=[f].filter(ua).join("\n"),0<g.length&&(g+="\n"),v=[p,f].filter(ua).join("\n"),0<v.length&&(v+="\n")):(g=[_a(t),"#define SHADER_NAME "+t.shaderName,f,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+d,"#define MAX_BONES "+t.maxBones,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.displacementMap&&t.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularTintMap?"#define USE_SPECULARTINTMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.useVertexTexture?"#define BONE_TEXTURE":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&!1===t.flatShading?"#define USE_MORPHNORMALS":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(ua).join("\n"),v=[p,_a(t),"#define SHADER_NAME "+t.shaderName,f,"#define GAMMA_FACTOR "+d,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.envMap?"#define "+u:"",t.envMap?"#define "+h:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularTintMap?"#define USE_SPECULARTINTMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.sheenTint?"#define USE_SHEEN":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(t.extensionShaderTextureLOD||t.envMap)&&t.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==De?"#define TONE_MAPPING":"",t.toneMapping!==De?mi.tonemapping_pars_fragment:"",t.toneMapping!==De?function(e,t){let n;switch(t){case 1:n="Linear";break;case 2:n="Reinhard";break;case 3:n="OptimizedCineon";break;case 4:n="ACESFilmic";break;case 5:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.format===Ce?"#define OPAQUE":"",mi.encodings_pars_fragment,t.map?ca("mapTexelToLinear",t.mapEncoding):"",t.matcap?ca("matcapTexelToLinear",t.matcapEncoding):"",t.envMap?ca("envMapTexelToLinear",t.envMapEncoding):"",t.emissiveMap?ca("emissiveMapTexelToLinear",t.emissiveMapEncoding):"",t.specularTintMap?ca("specularTintMapTexelToLinear",t.specularTintMapEncoding):"",t.lightMap?ca("lightMapTexelToLinear",t.lightMapEncoding):"",(x="linearToOutputTexel",b=oa(b=t.outputEncoding),"vec4 "+x+"( vec4 value ) { return LinearTo"+b[0]+b[1]+"; }"),t.depthPacking?"#define DEPTH_PACKING "+t.depthPacking:"","\n"].filter(ua).join("\n")),a=da(ha(fa(a),t),t),o=da(ha(fa(o),t),t),a=ya(a),o=ya(o),t.isWebGL2&&!0!==t.isRawShaderMaterial&&(y="#version 300 es\n",g=["#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,v=["#define varying in",t.glslVersion===xt?"":"out highp vec4 pc_fragColor;",t.glslVersion===xt?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+v);var h=y+g+a,l=y+v+o,x=sa(i,35633,h),b=sa(i,35632,l);if(i.attachShader(m,x),i.attachShader(m,b),void 0!==t.index0AttributeName?i.bindAttribLocation(m,0,t.index0AttributeName):!0===t.morphTargets&&i.bindAttribLocation(m,0,"position"),i.linkProgram(m),n.debug.checkShaderErrors){a=i.getProgramInfoLog(m).trim(),o=i.getShaderInfoLog(x).trim(),h=i.getShaderInfoLog(b).trim();let e=!0,t=!0;!1===i.getProgramParameter(m,35714)?(e=!1,l=la(i,x,"vertex"),n=la(i,b,"fragment"),console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(m,35715)+"\n\nProgram Info Log: "+a+"\n"+l+"\n"+n)):""!==a?console.warn("THREE.WebGLProgram: Program Info Log:",a):""!==o&&""!==h||(t=!1),t&&(this.diagnostics={runnable:e,programLog:a,vertexShader:{log:o,prefix:g},fragmentShader:{log:h,prefix:v}})}i.deleteShader(x),i.deleteShader(b);let _;this.getUniforms=function(){return void 0===_&&(_=new ia(i,m)),_};let w;return this.getAttributes=function(){return void 0===w&&(w=function(n,r){const i={};var e=n.getProgramParameter(r,35721);for(let t=0;t<e;t++){var s=n.getActiveAttrib(r,t),a=s.name;let e=1;35674===s.type&&(e=2),35675===s.type&&(e=3),35676===s.type&&(e=4),i[a]={type:s.type,location:n.getAttribLocation(r,a),locationSize:e}}return i}(i,m)),w},this.destroy=function(){r.releaseStatesOfProgram(this),i.deleteProgram(m),this.program=void 0},this.name=t.shaderName,this.id=aa++,this.cacheKey=e,this.usedTimes=1,this.program=m,this.vertexShader=x,this.fragmentShader=b,this}function Ma(p,f,m,g,v,t,y){const s=[],x=v.isWebGL2,b=v.logarithmicDepthBuffer,_=v.floatVertexTextures,w=v.maxVertexUniforms,M=v.vertexTextures;let S=v.precision;const E={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},r=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoat","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","specularIntensityMap","specularTintMap","specularTintMapEncoding","roughnessMap","metalnessMap","gradientMap","alphaMap","alphaTest","combine","vertexColors","vertexAlphas","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","format","sheenTint","transmission","transmissionMap","thicknessMap"];function T(e){let t;return t=e&&e.isTexture?e.encoding:e&&e.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),e.texture.encoding):gt,t}return{getParameters:function(e,t,n,r,i){var s=r.fog,a=e.isMeshStandardMaterial?r.environment:null,o=(e.isMeshStandardMaterial?m:f).get(e.envMap||a),r=E[e.type],a=i.isSkinnedMesh?(u=(h=i).skeleton.bones,_?1024:(h=w,h=Math.floor((h-20)/4),(h=Math.min(h,u.length))<u.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+u.length+" bones. This GPU supports "+h+"."),0):h)):0;null!==e.precision&&(S=v.getMaxPrecision(e.precision),S!==e.precision&&console.warn("THREE.WebGLProgram.getParameters:",e.precision,"not supported, using",S,"instead."));let l,c;c=r?(d=vi[r],l=d.vertexShader,d.fragmentShader):(l=e.vertexShader,e.fragmentShader);var u=p.getRenderTarget(),h=0<e.alphaTest,d=0<e.clearcoat;return{isWebGL2:x,shaderID:r,shaderName:e.type,vertexShader:l,fragmentShader:c,defines:e.defines,isRawShaderMaterial:!0===e.isRawShaderMaterial,glslVersion:e.glslVersion,precision:S,instancing:!0===i.isInstancedMesh,instancingColor:!0===i.isInstancedMesh&&null!==i.instanceColor,supportsVertexTextures:M,outputEncoding:null!==u?T(u.texture):p.outputEncoding,map:!!e.map,mapEncoding:T(e.map),matcap:!!e.matcap,matcapEncoding:T(e.matcap),envMap:!!o,envMapMode:o&&o.mapping,envMapEncoding:T(o),envMapCubeUV:!!o&&(o.mapping===L||o.mapping===A),lightMap:!!e.lightMap,lightMapEncoding:T(e.lightMap),aoMap:!!e.aoMap,emissiveMap:!!e.emissiveMap,emissiveMapEncoding:T(e.emissiveMap),bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,objectSpaceNormalMap:e.normalMapType===yt,tangentSpaceNormalMap:e.normalMapType===vt,clearcoat:d,clearcoatMap:d&&!!e.clearcoatMap,clearcoatRoughnessMap:d&&!!e.clearcoatRoughnessMap,clearcoatNormalMap:d&&!!e.clearcoatNormalMap,displacementMap:!!e.displacementMap,roughnessMap:!!e.roughnessMap,metalnessMap:!!e.metalnessMap,specularMap:!!e.specularMap,specularIntensityMap:!!e.specularIntensityMap,specularTintMap:!!e.specularTintMap,specularTintMapEncoding:T(e.specularTintMap),alphaMap:!!e.alphaMap,alphaTest:h,gradientMap:!!e.gradientMap,sheenTint:!!e.sheenTint&&(0<e.sheenTint.r||0<e.sheenTint.g||0<e.sheenTint.b),transmission:0<e.transmission,transmissionMap:!!e.transmissionMap,thicknessMap:!!e.thicknessMap,combine:e.combine,vertexTangents:!!e.normalMap&&!!i.geometry&&!!i.geometry.attributes.tangent,vertexColors:e.vertexColors,vertexAlphas:!0===e.vertexColors&&!!i.geometry&&!!i.geometry.attributes.color&&4===i.geometry.attributes.color.itemSize,vertexUvs:!!(e.map||e.bumpMap||e.normalMap||e.specularMap||e.alphaMap||e.emissiveMap||e.roughnessMap||e.metalnessMap||e.clearcoatMap||e.clearcoatRoughnessMap||e.clearcoatNormalMap||e.displacementMap||e.transmissionMap||e.thicknessMap||e.specularIntensityMap||e.specularTintMap),uvsVertexOnly:!(e.map||e.bumpMap||e.normalMap||e.specularMap||e.alphaMap||e.emissiveMap||e.roughnessMap||e.metalnessMap||e.clearcoatNormalMap||0<e.transmission||e.transmissionMap||e.thicknessMap||e.specularIntensityMap||e.specularTintMap||!e.displacementMap),fog:!!s,useFog:e.fog,fogExp2:s&&s.isFogExp2,flatShading:!!e.flatShading,sizeAttenuation:e.sizeAttenuation,logarithmicDepthBuffer:b,skinning:!0===i.isSkinnedMesh&&0<a,maxBones:a,useVertexTexture:_,morphTargets:!!i.geometry&&!!i.geometry.morphAttributes.position,morphNormals:!!i.geometry&&!!i.geometry.morphAttributes.normal,numDirLights:t.directional.length,numPointLights:t.point.length,numSpotLights:t.spot.length,numRectAreaLights:t.rectArea.length,numHemiLights:t.hemi.length,numDirLightShadows:t.directionalShadowMap.length,numPointLightShadows:t.pointShadowMap.length,numSpotLightShadows:t.spotShadowMap.length,numClippingPlanes:y.numPlanes,numClipIntersection:y.numIntersection,format:e.format,dithering:e.dithering,shadowMapEnabled:p.shadowMap.enabled&&0<n.length,shadowMapType:p.shadowMap.type,toneMapping:e.toneMapped?p.toneMapping:De,physicallyCorrectLights:p.physicallyCorrectLights,premultipliedAlpha:e.premultipliedAlpha,doubleSided:e.side===Re,flipSided:e.side===Pe,depthPacking:void 0!==e.depthPacking&&e.depthPacking,index0AttributeName:e.index0AttributeName,extensionDerivatives:e.extensions&&e.extensions.derivatives,extensionFragDepth:e.extensions&&e.extensions.fragDepth,extensionDrawBuffers:e.extensions&&e.extensions.drawBuffers,extensionShaderTextureLOD:e.extensions&&e.extensions.shaderTextureLOD,rendererExtensionFragDepth:x||g.has("EXT_frag_depth"),rendererExtensionDrawBuffers:x||g.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:x||g.has("EXT_shader_texture_lod"),customProgramCacheKey:e.customProgramCacheKey()}},getProgramCacheKey:function(t){const n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.fragmentShader),n.push(t.vertexShader)),void 0!==t.defines)for(const e in t.defines)n.push(e),n.push(t.defines[e]);if(!1===t.isRawShaderMaterial){for(let e=0;e<r.length;e++)n.push(t[r[e]]);n.push(p.outputEncoding),n.push(p.gammaFactor)}return n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){var t=E[e.type];let n;return n=t?(t=vi[t],$r.clone(t.uniforms)):e.uniforms,n},acquireProgram:function(e,n){let r;for(let e=0,t=s.length;e<t;e++){var i=s[e];if(i.cacheKey===n){r=i,++r.usedTimes;break}}return void 0===r&&(r=new wa(p,n,e,t),s.push(r)),r},releaseProgram:function(e){var t;0==--e.usedTimes&&(t=s.indexOf(e),s[t]=s[s.length-1],s.pop(),e.destroy())},programs:s}}function Sa(){let r=new WeakMap;return{get:function(e){let t=r.get(e);return void 0===t&&(t={},r.set(e,t)),t},remove:function(e){r.delete(e)},update:function(e,t,n){r.get(e)[t]=n},dispose:function(){r=new WeakMap}}}function Ea(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function Ta(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function Ca(l){const c=[];let u=0;const a=[],o=[],h=[],d={id:-1};function p(e,t,n,r,i,s){let a=c[u];var o=l.get(n);return void 0===a?(a={id:e.id,object:e,geometry:t,material:n,program:o.program||d,groupOrder:r,renderOrder:e.renderOrder,z:i,group:s},c[u]=a):(a.id=e.id,a.object=e,a.geometry=t,a.material=n,a.program=o.program||d,a.groupOrder=r,a.renderOrder=e.renderOrder,a.z=i,a.group=s),u++,a}return{opaque:a,transmissive:o,transparent:h,init:function(){u=0,a.length=0,o.length=0,h.length=0},push:function(e,t,n,r,i,s){s=p(e,t,n,r,i,s),(0<n.transmission?o:!0===n.transparent?h:a).push(s)},unshift:function(e,t,n,r,i,s){s=p(e,t,n,r,i,s),(0<n.transmission?o:!0===n.transparent?h:a).unshift(s)},finish:function(){for(let e=u,t=c.length;e<t;e++){const n=c[e];if(null===n.id)break;n.id=null,n.object=null,n.geometry=null,n.material=null,n.program=null,n.group=null}},sort:function(e,t){1<a.length&&a.sort(e||Ea),1<o.length&&o.sort(t||Ta),1<h.length&&h.sort(t||Ta)}}}function La(r){let i=new WeakMap;return{get:function(e,t){let n;return!1===i.has(e)?(n=new Ca(r),i.set(e,[n])):t>=i.get(e).length?(n=new Ca(r),i.get(e).push(n)):n=i.get(e)[t],n},dispose:function(){i=new WeakMap}}}function Aa(){const n={};return{get:function(e){if(void 0!==n[e.id])return n[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new Wt,color:new pr};break;case"SpotLight":t={position:new Wt,direction:new Wt,color:new pr,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new Wt,color:new pr,distance:0,decay:0};break;case"HemisphereLight":t={direction:new Wt,skyColor:new pr,groundColor:new pr};break;case"RectAreaLight":t={color:new pr,position:new Wt,halfWidth:new Wt,halfHeight:new Wt}}return n[e.id]=t,t}}}let Pa=0;function Ra(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function Da(A,P){const R=new Aa,D=function(){const n={};return{get:function(e){if(void 0!==n[e.id])return n[e.id];let t;switch(e.type){case"DirectionalLight":case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Nt};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Nt,shadowCameraNear:1,shadowCameraFar:1e3}}return n[e.id]=t,t}}}(),N={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let e=0;e<9;e++)N.probe.push(new Wt);const m=new Wt,g=new wn,v=new wn;return{setup:function(n,e){let r=0,i=0,s=0;for(let e=0;e<9;e++)N.probe[e].set(0,0,0);let a=0,o=0,l=0,c=0,u=0,h=0,d=0,p=0;n.sort(Ra);var f=!0!==e?Math.PI:1;for(let e=0,t=n.length;e<t;e++){var m=n[e],g=m.color,v=m.intensity,y=m.distance,x=m.shadow&&m.shadow.map?m.shadow.map.texture:null;if(m.isAmbientLight)r+=g.r*v*f,i+=g.g*v*f,s+=g.b*v*f;else if(m.isLightProbe)for(let e=0;e<9;e++)N.probe[e].addScaledVector(m.sh.coefficients[e],v);else if(m.isDirectionalLight){const _=R.get(m);if(_.color.copy(m.color).multiplyScalar(m.intensity*f),m.castShadow){var b=m.shadow;const w=D.get(m);w.shadowBias=b.bias,w.shadowNormalBias=b.normalBias,w.shadowRadius=b.radius,w.shadowMapSize=b.mapSize,N.directionalShadow[a]=w,N.directionalShadowMap[a]=x,N.directionalShadowMatrix[a]=m.shadow.matrix,h++}N.directional[a]=_,a++}else if(m.isSpotLight){const M=R.get(m);if(M.position.setFromMatrixPosition(m.matrixWorld),M.color.copy(g).multiplyScalar(v*f),M.distance=y,M.coneCos=Math.cos(m.angle),M.penumbraCos=Math.cos(m.angle*(1-m.penumbra)),M.decay=m.decay,m.castShadow){y=m.shadow;const S=D.get(m);S.shadowBias=y.bias,S.shadowNormalBias=y.normalBias,S.shadowRadius=y.radius,S.shadowMapSize=y.mapSize,N.spotShadow[l]=S,N.spotShadowMap[l]=x,N.spotShadowMatrix[l]=m.shadow.matrix,p++}N.spot[l]=M,l++}else if(m.isRectAreaLight){const E=R.get(m);E.color.copy(g).multiplyScalar(v),E.halfWidth.set(.5*m.width,0,0),E.halfHeight.set(0,.5*m.height,0),N.rectArea[c]=E,c++}else if(m.isPointLight){const T=R.get(m);if(T.color.copy(m.color).multiplyScalar(m.intensity*f),T.distance=m.distance,T.decay=m.decay,m.castShadow){g=m.shadow;const C=D.get(m);C.shadowBias=g.bias,C.shadowNormalBias=g.normalBias,C.shadowRadius=g.radius,C.shadowMapSize=g.mapSize,C.shadowCameraNear=g.camera.near,C.shadowCameraFar=g.camera.far,N.pointShadow[o]=C,N.pointShadowMap[o]=x,N.pointShadowMatrix[o]=m.shadow.matrix,d++}N.point[o]=T,o++}else if(m.isHemisphereLight){const L=R.get(m);L.skyColor.copy(m.color).multiplyScalar(v*f),L.groundColor.copy(m.groundColor).multiplyScalar(v*f),N.hemi[u]=L,u++}}0<c&&(P.isWebGL2||!0===A.has("OES_texture_float_linear")?(N.rectAreaLTC1=gi.LTC_FLOAT_1,N.rectAreaLTC2=gi.LTC_FLOAT_2):!0===A.has("OES_texture_half_float_linear")?(N.rectAreaLTC1=gi.LTC_HALF_1,N.rectAreaLTC2=gi.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),N.ambient[0]=r,N.ambient[1]=i,N.ambient[2]=s;const t=N.hash;t.directionalLength===a&&t.pointLength===o&&t.spotLength===l&&t.rectAreaLength===c&&t.hemiLength===u&&t.numDirectionalShadows===h&&t.numPointShadows===d&&t.numSpotShadows===p||(N.directional.length=a,N.spot.length=l,N.rectArea.length=c,N.point.length=o,N.hemi.length=u,N.directionalShadow.length=h,N.directionalShadowMap.length=h,N.pointShadow.length=d,N.pointShadowMap.length=d,N.spotShadow.length=p,N.spotShadowMap.length=p,N.directionalShadowMatrix.length=h,N.pointShadowMatrix.length=d,N.spotShadowMatrix.length=p,t.directionalLength=a,t.pointLength=o,t.spotLength=l,t.rectAreaLength=c,t.hemiLength=u,t.numDirectionalShadows=h,t.numPointShadows=d,t.numSpotShadows=p,N.version=Pa++)},setupView:function(n,e){let r=0,i=0,s=0,a=0,o=0;var l=e.matrixWorldInverse;for(let e=0,t=n.length;e<t;e++){var c=n[e];if(c.isDirectionalLight){const u=N.directional[r];u.direction.setFromMatrixPosition(c.matrixWorld),m.setFromMatrixPosition(c.target.matrixWorld),u.direction.sub(m),u.direction.transformDirection(l),r++}else if(c.isSpotLight){const h=N.spot[s];h.position.setFromMatrixPosition(c.matrixWorld),h.position.applyMatrix4(l),h.direction.setFromMatrixPosition(c.matrixWorld),m.setFromMatrixPosition(c.target.matrixWorld),h.direction.sub(m),h.direction.transformDirection(l),s++}else if(c.isRectAreaLight){const d=N.rectArea[a];d.position.setFromMatrixPosition(c.matrixWorld),d.position.applyMatrix4(l),v.identity(),g.copy(c.matrixWorld),g.premultiply(l),v.extractRotation(g),d.halfWidth.set(.5*c.width,0,0),d.halfHeight.set(0,.5*c.height,0),d.halfWidth.applyMatrix4(v),d.halfHeight.applyMatrix4(v),a++}else if(c.isPointLight){const p=N.point[i];p.position.setFromMatrixPosition(c.matrixWorld),p.position.applyMatrix4(l),i++}else if(c.isHemisphereLight){const f=N.hemi[o];f.direction.setFromMatrixPosition(c.matrixWorld),f.direction.transformDirection(l),f.direction.normalize(),o++}}},state:N}}function Na(e,t){const n=new Da(e,t),r=[],i=[];return{init:function(){r.length=0,i.length=0},state:{lightsArray:r,shadowsArray:i,lights:n},setupLights:function(e){n.setup(r,e)},setupLightsView:function(e){n.setupView(r,e)},pushLight:function(e){r.push(e)},pushShadow:function(e){i.push(e)}}}function Ia(r,i){let s=new WeakMap;return{get:function(e,t=0){let n;return!1===s.has(e)?(n=new Na(r,i),s.set(e,[n])):t>=s.get(e).length?(n=new Na(r,i),s.get(e).push(n)):n=s.get(e)[t],n},dispose:function(){s=new WeakMap}}}class ka extends ar{constructor(e){super(),this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}ka.prototype.isMeshDepthMaterial=!0;class Oa extends ar{constructor(e){super(),this.type="MeshDistanceMaterial",this.referencePosition=new Wt,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}Oa.prototype.isMeshDistanceMaterial=!0;var za="uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\nuniform float samples;\n#include <packing>\nvoid main() {\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}",Ua="void main() {\n\tgl_Position = vec4( position, 1.0 );\n}";function Va(m,g,e){let v=new hi;const f=new Nt,y=new Nt,x=new Ft,c=new ka({depthPacking:n}),u=new Oa,h={},b=e.maxTextureSize,d={0:Pe,1:Ae,2:Re},_=new Qr({uniforms:{shadow_pass:{value:null},resolution:{value:new Nt},radius:{value:4},samples:{value:8}},vertexShader:Ua,fragmentShader:za}),w=_.clone();w.defines.HORIZONTAL_PASS=1;const t=new Ar;t.setAttribute("position",new vr(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const M=new Xr(t,_),S=this;function E(n,e,r,t,i,s,a){let o=null;var l=!0===t.isPointLight?n.customDistanceMaterial:n.customDepthMaterial;if(o=void 0!==l?l:!0===t.isPointLight?u:c,m.localClippingEnabled&&!0===r.clipShadows&&0!==r.clippingPlanes.length||r.displacementMap&&0!==r.displacementScale||r.alphaMap&&0<r.alphaTest){n=o.uuid,l=r.uuid;let e=h[n];void 0===e&&(e={},h[n]=e);let t=e[l];void 0===t&&(t=o.clone(),e[l]=t),o=t}return o.visible=r.visible,o.wireframe=r.wireframe,a===C?o.side=null!==r.shadowSide?r.shadowSide:r.side:o.side=null!==r.shadowSide?r.shadowSide:d[r.side],o.alphaMap=r.alphaMap,o.alphaTest=r.alphaTest,o.clipShadows=r.clipShadows,o.clippingPlanes=r.clippingPlanes,o.clipIntersection=r.clipIntersection,o.displacementMap=r.displacementMap,o.displacementScale=r.displacementScale,o.displacementBias=r.displacementBias,o.wireframeLinewidth=r.wireframeLinewidth,o.linewidth=r.linewidth,!0===t.isPointLight&&!0===o.isMeshDistanceMaterial&&(o.referencePosition.setFromMatrixPosition(t.matrixWorld),o.nearDistance=i,o.farDistance=s),o}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=T,this.render=function(n,r,i){if(!1!==S.enabled&&(!1!==S.autoUpdate||!1!==S.needsUpdate)&&0!==n.length){var e=m.getRenderTarget(),t=m.getActiveCubeFace(),s=m.getActiveMipmapLevel();const d=m.state;d.setBlending(Y),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);for(let e=0,t=n.length;e<t;e++){var a=n[e];const p=a.shadow;if(void 0!==p){if(!1!==p.autoUpdate||!1!==p.needsUpdate){f.copy(p.mapSize);var o,l,c=p.getFrameExtents();f.multiply(c),y.copy(p.mapSize),(f.x>b||f.y>b)&&(f.x>b&&(y.x=Math.floor(b/c.x),f.x=y.x*c.x,p.mapSize.x=y.x),f.y>b&&(y.y=Math.floor(b/c.y),f.y=y.y*c.y,p.mapSize.y=y.y)),null!==p.map||p.isPointLightShadow||this.type!==C||(o={minFilter:G,magFilter:G,format:Ve},p.map=new Ht(f.x,f.y,o),p.map.texture.name=a.name+".shadowMap",p.mapPass=new Ht(f.x,f.y,o),p.camera.updateProjectionMatrix()),null===p.map&&(l={minFilter:Ie,magFilter:Ie,format:Ve},p.map=new Ht(f.x,f.y,l),p.map.texture.name=a.name+".shadowMap",p.camera.updateProjectionMatrix()),m.setRenderTarget(p.map),m.clear();var u=p.getViewportCount();for(let e=0;e<u;e++){var h=p.getViewport(e);x.set(y.x*h.x,y.y*h.y,y.x*h.z,y.y*h.w),d.viewport(x),p.updateMatrices(a,e),v=p.getFrustum(),function n(r,i,s,a,o){if(!1===r.visible)return;const e=r.layers.test(i.layers);if(e&&(r.isMesh||r.isLine||r.isPoints)&&(r.castShadow||r.receiveShadow&&o===C)&&(!r.frustumCulled||v.intersectsObject(r))){r.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,r.matrixWorld);const c=g.update(r),u=r.material;if(Array.isArray(u)){const h=c.groups;for(let e=0,t=h.length;e<t;e++){const d=h[e],p=u[d.materialIndex];if(p&&p.visible){const f=E(r,c,p,a,s.near,s.far,o);m.renderBufferDirect(s,null,c,f,r,d)}}}else if(u.visible){const t=E(r,c,u,a,s.near,s.far,o);m.renderBufferDirect(s,null,c,t,r,null)}}const l=r.children;for(let e=0,t=l.length;e<t;e++)n(l[e],i,s,a,o)}(r,i,p.camera,a,this.type)}p.isPointLightShadow||this.type!==C||(c=p,o=i,l=void 0,l=g.update(M),_.uniforms.shadow_pass.value=c.map.texture,_.uniforms.resolution.value=c.mapSize,_.uniforms.radius.value=c.radius,_.uniforms.samples.value=c.blurSamples,m.setRenderTarget(c.mapPass),m.clear(),m.renderBufferDirect(o,null,l,_,M,null),w.uniforms.shadow_pass.value=c.mapPass.texture,w.uniforms.resolution.value=c.mapSize,w.uniforms.radius.value=c.radius,w.uniforms.samples.value=c.blurSamples,m.setRenderTarget(c.map),m.clear(),m.renderBufferDirect(o,null,l,w,M,null)),p.needsUpdate=!1}}else console.warn("THREE.WebGLShadowMap:",a,"has no shadow.")}S.needsUpdate=!1,m.setRenderTarget(e,t,s)}}}function Fa(u,e,t){const n=t.isWebGL2;const r=new function(){let t=!1;const s=new Ft;let n=null;const a=new Ft(0,0,0,0);return{setMask:function(e){n===e||t||(u.colorMask(e,e,e,e),n=e)},setLocked:function(e){t=e},setClear:function(e,t,n,r,i){!0===i&&(e*=r,t*=r,n*=r),s.set(e,t,n,r),!1===a.equals(s)&&(u.clearColor(e,t,n,r),a.copy(s))},reset:function(){t=!1,n=null,a.set(-1,0,0,0)}}},i=new function(){let t=!1,n=null,r=null,i=null;return{setTest:function(e){(e?O:z)(2929)},setMask:function(e){n===e||t||(u.depthMask(e),n=e)},setFunc:function(e){if(r!==e){if(e)switch(e){case ge:u.depthFunc(512);break;case ve:u.depthFunc(519);break;case ye:u.depthFunc(513);break;case xe:u.depthFunc(515);break;case be:u.depthFunc(514);break;case _e:u.depthFunc(518);break;case we:u.depthFunc(516);break;case Me:u.depthFunc(517);break;default:u.depthFunc(515)}else u.depthFunc(515);r=e}},setLocked:function(e){t=e},setClear:function(e){i!==e&&(u.clearDepth(e),i=e)},reset:function(){t=!1,n=null,r=null,i=null}}},s=new function(){let t=!1,n=null,r=null,i=null,s=null,a=null,o=null,l=null,c=null;return{setTest:function(e){t||(e?O:z)(2960)},setMask:function(e){n===e||t||(u.stencilMask(e),n=e)},setFunc:function(e,t,n){r===e&&i===t&&s===n||(u.stencilFunc(e,t,n),r=e,i=t,s=n)},setOp:function(e,t,n){a===e&&o===t&&l===n||(u.stencilOp(e,t,n),a=e,o=t,l=n)},setLocked:function(e){t=e},setClear:function(e){c!==e&&(u.clearStencil(e),c=e)},reset:function(){t=!1,n=null,r=null,i=null,s=null,a=null,o=null,l=null,c=null}}};let a={},o=null,l={},c=null,h=!1,d=null,p=null,f=null,m=null,g=null,v=null,y=null,x=!1,b=null,_=null,w=null,M=null,S=null;const E=u.getParameter(35661);let T=!1,C=0;const L=u.getParameter(7938);-1!==L.indexOf("WebGL")?(C=parseFloat(/^WebGL (\d)/.exec(L)[1]),T=1<=C):-1!==L.indexOf("OpenGL ES")&&(C=parseFloat(/^OpenGL ES (\d)/.exec(L)[1]),T=2<=C);let A=null,P={};var R=u.getParameter(3088),t=u.getParameter(2978);const D=(new Ft).fromArray(R),N=(new Ft).fromArray(t);function I(e,t,n){var r=new Uint8Array(4),i=u.createTexture();u.bindTexture(e,i),u.texParameteri(e,10241,9728),u.texParameteri(e,10240,9728);for(let e=0;e<n;e++)u.texImage2D(t+e,0,6408,1,1,0,6408,5121,r);return i}const k={};function O(e){!0!==a[e]&&(u.enable(e),a[e]=!0)}function z(e){!1!==a[e]&&(u.disable(e),a[e]=!1)}k[3553]=I(3553,3553,1),k[34067]=I(34067,34069,6),r.setClear(0,0,0,1),i.setClear(1),s.setClear(0),O(2929),i.setFunc(xe),H(!1),B(q),O(2884),F(Y);const U={[ee]:32774,[te]:32778,[ne]:32779};n?(U[re]=32775,U[ie]=32776):null!==(e=e.get("EXT_blend_minmax"))&&(U[re]=e.MIN_EXT,U[ie]=e.MAX_EXT);const V={[se]:0,[ae]:1,[oe]:768,[ce]:770,[me]:776,[pe]:774,[he]:772,[le]:769,[ue]:771,[fe]:775,[de]:773};function F(e,t,n,r,i,s,a,o){if(e!==Y){if(!1===h&&(O(3042),h=!0),e===Q)i=i||t,s=s||n,a=a||r,t===p&&i===g||(u.blendEquationSeparate(U[t],U[i]),p=t,g=i),n===f&&r===m&&s===v&&a===y||(u.blendFuncSeparate(V[n],V[r],V[s],V[a]),f=n,m=r,v=s,y=a),d=e,x=null;else if(e!==d||o!==x){if(p===ee&&g===ee||(u.blendEquation(32774),p=ee,g=ee),o)switch(e){case K:u.blendFuncSeparate(1,771,1,771);break;case J:u.blendFunc(1,1);break;case Z:u.blendFuncSeparate(0,0,769,771);break;case $:u.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case K:u.blendFuncSeparate(770,771,1,771);break;case J:u.blendFunc(770,1);break;case Z:u.blendFunc(0,769);break;case $:u.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}f=null,m=null,v=null,y=null,d=e,x=o}}else!0===h&&(z(3042),h=!1)}function H(e){b!==e&&(e?u.frontFace(2304):u.frontFace(2305),b=e)}function B(e){e!==j?(O(2884),e!==_&&(e===q?u.cullFace(1029):e===X?u.cullFace(1028):u.cullFace(1032))):z(2884),_=e}function G(e,t,n){e?(O(32823),M===t&&S===n||(u.polygonOffset(t,n),M=t,S=n)):z(32823)}function W(e){void 0===e&&(e=33984+E-1),A!==e&&(u.activeTexture(e),A=e)}return{buffers:{color:r,depth:i,stencil:s},enable:O,disable:z,bindFramebuffer:function(e,t){return null===t&&null!==o&&(t=o),l[e]!==t&&(u.bindFramebuffer(e,t),l[e]=t,n&&(36009===e&&(l[36160]=t),36160===e&&(l[36009]=t)),!0)},bindXRFramebuffer:function(e){e!==o&&(u.bindFramebuffer(36160,e),o=e)},useProgram:function(e){return c!==e&&(u.useProgram(e),c=e,!0)},setBlending:F,setMaterial:function(e,t){(e.side===Re?z:O)(2884);let n=e.side===Pe;t&&(n=!n),H(n),e.blending===K&&!1===e.transparent?F(Y):F(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),i.setFunc(e.depthFunc),i.setTest(e.depthTest),i.setMask(e.depthWrite),r.setMask(e.colorWrite),t=e.stencilWrite,s.setTest(t),t&&(s.setMask(e.stencilWriteMask),s.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),s.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),G(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),(!0===e.alphaToCoverage?O:z)(32926)},setFlipSided:H,setCullFace:B,setLineWidth:function(e){e!==w&&(T&&u.lineWidth(e),w=e)},setPolygonOffset:G,setScissorTest:function(e){(e?O:z)(3089)},activeTexture:W,bindTexture:function(e,t){null===A&&W();let n=P[A];void 0===n&&(n={type:void 0,texture:void 0},P[A]=n),n.type===e&&n.texture===t||(u.bindTexture(e,t||k[e]),n.type=e,n.texture=t)},unbindTexture:function(){const e=P[A];void 0!==e&&void 0!==e.type&&(u.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{u.compressedTexImage2D.apply(u,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{u.texImage2D.apply(u,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{u.texImage3D.apply(u,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(e){!1===D.equals(e)&&(u.scissor(e.x,e.y,e.z,e.w),D.copy(e))},viewport:function(e){!1===N.equals(e)&&(u.viewport(e.x,e.y,e.z,e.w),N.copy(e))},reset:function(){u.disable(3042),u.disable(2884),u.disable(2929),u.disable(32823),u.disable(3089),u.disable(2960),u.disable(32926),u.blendEquation(32774),u.blendFunc(1,0),u.blendFuncSeparate(1,0,1,0),u.colorMask(!0,!0,!0,!0),u.clearColor(0,0,0,0),u.depthMask(!0),u.depthFunc(513),u.clearDepth(1),u.stencilMask(4294967295),u.stencilFunc(519,0,4294967295),u.stencilOp(7680,7680,7680),u.clearStencil(0),u.cullFace(1029),u.frontFace(2305),u.polygonOffset(0,0),u.activeTexture(33984),u.bindFramebuffer(36160,null),!0===n&&(u.bindFramebuffer(36009,null),u.bindFramebuffer(36008,null)),u.useProgram(null),u.lineWidth(1),u.scissor(0,0,u.canvas.width,u.canvas.height),u.viewport(0,0,u.canvas.width,u.canvas.height),a={},A=null,P={},o=null,l={},c=null,h=!1,d=null,p=null,f=null,m=null,g=null,v=null,y=null,x=!1,b=null,_=null,w=null,M=null,S=null,D.set(0,0,u.canvas.width,u.canvas.height),N.set(0,0,u.canvas.width,u.canvas.height),r.reset(),i.reset(),s.reset()}}}function Ha(m,i,g,v,y,x,b){const _=y.isWebGL2,t=y.maxTextures,f=y.maxCubemapSize,u=y.maxTextureSize,n=y.maxSamples,s=new WeakMap;let l,r=!1;try{r="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function c(e,t){return r?new OffscreenCanvas(e,t):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function w(e,t,n,r){let i=1;if((e.width>r||e.height>r)&&(i=r/Math.max(e.width,e.height)),i<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const s=t?Rt:Math.floor;r=s(i*e.width),t=s(i*e.height);void 0===l&&(l=c(r,t));const a=n?c(r,t):l;a.width=r,a.height=t;const o=a.getContext("2d");return o.drawImage(e,0,0,r,t),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+r+"x"+t+")."),a}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function M(e){return At(e.width)&&At(e.height)}function S(e,t){return e.generateMipmaps&&t&&e.minFilter!==Ie&&e.minFilter!==G}function E(e,t,n,r,i=1){m.generateMipmap(e);const s=v.get(t);s.__maxMipLevel=Math.log2(Math.max(n,r,i))}function T(e,t,n){if(!1===_)return t;if(null!==e){if(void 0!==m[e])return m[e];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+e+"'")}let r=t;return 6403===t&&(5126===n&&(r=33326),5131===n&&(r=33325),5121===n&&(r=33321)),6407===t&&(5126===n&&(r=34837),5131===n&&(r=34843),5121===n&&(r=32849)),6408===t&&(5126===n&&(r=34836),5131===n&&(r=34842),5121===n&&(r=32856)),33325!==r&&33326!==r&&34842!==r&&34836!==r||i.get("EXT_color_buffer_float"),r}function a(e){return e===Ie||e===H||e===B?9728:9729}function o(e){const t=e.target;var n;t.removeEventListener("dispose",o),n=t,void 0!==(e=v.get(n)).__webglInit&&(m.deleteTexture(e.__webglTexture),v.remove(n)),t.isVideoTexture&&s.delete(t),b.memory.textures--}function C(e){const t=e.target;t.removeEventListener("dispose",C),function(e){var n=e.texture,t=v.get(e),r=v.get(n);if(e){if(void 0!==r.__webglTexture&&(m.deleteTexture(r.__webglTexture),b.memory.textures--),e.depthTexture&&e.depthTexture.dispose(),e.isWebGLCubeRenderTarget)for(let e=0;e<6;e++)m.deleteFramebuffer(t.__webglFramebuffer[e]),t.__webglDepthbuffer&&m.deleteRenderbuffer(t.__webglDepthbuffer[e]);else m.deleteFramebuffer(t.__webglFramebuffer),t.__webglDepthbuffer&&m.deleteRenderbuffer(t.__webglDepthbuffer),t.__webglMultisampledFramebuffer&&m.deleteFramebuffer(t.__webglMultisampledFramebuffer),t.__webglColorRenderbuffer&&m.deleteRenderbuffer(t.__webglColorRenderbuffer),t.__webglDepthRenderbuffer&&m.deleteRenderbuffer(t.__webglDepthRenderbuffer);if(e.isWebGLMultipleRenderTargets)for(let e=0,t=n.length;e<t;e++){var i=v.get(n[e]);i.__webglTexture&&(m.deleteTexture(i.__webglTexture),b.memory.textures--),v.remove(n[e])}v.remove(n),v.remove(e)}}(t)}let h=0;function d(e,t){var n,r=v.get(e);if(e.isVideoTexture&&(i=e,n=b.render.frame,s.get(i)!==n&&(s.set(i,n),i.update())),0<e.version&&r.__version!==e.version){var i=e.image;if(void 0===i)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==i.complete)return void D(r,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}g.activeTexture(33984+t),g.bindTexture(3553,r.__webglTexture)}function p(e,t){var n=v.get(e);0<e.version&&n.__version!==e.version?function(e,r,t){if(6===r.image.length){R(e,r),g.activeTexture(33984+t),g.bindTexture(34067,e.__webglTexture),m.pixelStorei(37440,r.flipY),m.pixelStorei(37441,r.premultiplyAlpha),m.pixelStorei(3317,r.unpackAlignment),m.pixelStorei(37443,0);var i=r&&(r.isCompressedTexture||r.image[0].isCompressedTexture),s=r.image[0]&&r.image[0].isDataTexture;const p=[];for(let e=0;e<6;e++)p[e]=i||s?s?r.image[e].image:r.image[e]:w(r.image[e],!1,!0,f);var a=p[0],t=M(a)||_,o=x.convert(r.format),l=x.convert(r.type),c=T(r.internalFormat,o,l);P(34067,r,t);let n;if(i){for(let t=0;t<6;t++){n=p[t].mipmaps;for(let e=0;e<n.length;e++){var u=n[e];r.format!==Ve&&r.format!==Ce?null!==o?g.compressedTexImage2D(34069+t,e,c,u.width,u.height,0,u.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):g.texImage2D(34069+t,e,c,u.width,u.height,0,o,l,u.data)}}e.__maxMipLevel=n.length-1}else{n=r.mipmaps;for(let t=0;t<6;t++)if(s){g.texImage2D(34069+t,0,c,p[t].width,p[t].height,0,o,l,p[t].data);for(let e=0;e<n.length;e++){var h=n[e].image[t].image;g.texImage2D(34069+t,e+1,c,h.width,h.height,0,o,l,h.data)}}else{g.texImage2D(34069+t,0,c,o,l,p[t]);for(let e=0;e<n.length;e++){var d=n[e];g.texImage2D(34069+t,e+1,c,o,l,d.image[t])}}e.__maxMipLevel=n.length}S(r,t)&&E(34067,r,a.width,a.height),e.__version=r.version,r.onUpdate&&r.onUpdate(r)}}(n,e,t):(g.activeTexture(33984+t),g.bindTexture(34067,n.__webglTexture))}const L={[V]:10497,[Ne]:33071,[F]:33648},A={[Ie]:9728,[H]:9984,[B]:9986,[G]:9729,[W]:9985,[ke]:9987};function P(e,t,n){n?(m.texParameteri(e,10242,L[t.wrapS]),m.texParameteri(e,10243,L[t.wrapT]),32879!==e&&35866!==e||m.texParameteri(e,32882,L[t.wrapR]),m.texParameteri(e,10240,A[t.magFilter]),m.texParameteri(e,10241,A[t.minFilter])):(m.texParameteri(e,10242,33071),m.texParameteri(e,10243,33071),32879!==e&&35866!==e||m.texParameteri(e,32882,33071),t.wrapS===Ne&&t.wrapT===Ne||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),m.texParameteri(e,10240,a(t.magFilter)),m.texParameteri(e,10241,a(t.minFilter)),t.minFilter!==Ie&&t.minFilter!==G&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===i.has("EXT_texture_filter_anisotropic")&&(n=i.get("EXT_texture_filter_anisotropic"),t.type===ze&&!1===i.has("OES_texture_float_linear")||!1===_&&t.type===Ue&&!1===i.has("OES_texture_half_float_linear")||(1<t.anisotropy||v.get(t).__currentAnisotropy)&&(m.texParameterf(e,n.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,y.getMaxAnisotropy())),v.get(t).__currentAnisotropy=t.anisotropy))}function R(e,t){void 0===e.__webglInit&&(e.__webglInit=!0,t.addEventListener("dispose",o),e.__webglTexture=m.createTexture(),b.memory.textures++)}function D(e,n,t){let r=3553;n.isDataTexture2DArray&&(r=35866),n.isDataTexture3D&&(r=32879),R(e,n),g.activeTexture(33984+t),g.bindTexture(r,e.__webglTexture),m.pixelStorei(37440,n.flipY),m.pixelStorei(37441,n.premultiplyAlpha),m.pixelStorei(3317,n.unpackAlignment),m.pixelStorei(37443,0);var t=(i=n,!_&&(i.wrapS!==Ne||i.wrapT!==Ne||i.minFilter!==Ie&&i.minFilter!==G)&&!1===M(n.image)),i=w(n.image,t,!1,u),t=M(i)||_,s=x.convert(n.format);let a=x.convert(n.type),o=T(n.internalFormat,s,a);P(r,n,t);let l;var c=n.mipmaps;if(n.isDepthTexture)o=6402,_?o=n.type===ze?36012:n.type===Ee?33190:n.type===Te?35056:33189:n.type===ze&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),n.format===Le&&6402===o&&n.type!==Se&&n.type!==Ee&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),n.type=Se,a=x.convert(n.type)),n.format===Fe&&6402===o&&(o=34041,n.type!==Te&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),n.type=Te,a=x.convert(n.type))),g.texImage2D(3553,0,o,i.width,i.height,0,s,a,null);else if(n.isDataTexture)if(0<c.length&&t){for(let e=0,t=c.length;e<t;e++)l=c[e],g.texImage2D(3553,e,o,l.width,l.height,0,s,a,l.data);n.generateMipmaps=!1,e.__maxMipLevel=c.length-1}else g.texImage2D(3553,0,o,i.width,i.height,0,s,a,i.data),e.__maxMipLevel=0;else if(n.isCompressedTexture){for(let e=0,t=c.length;e<t;e++)l=c[e],n.format!==Ve&&n.format!==Ce?null!==s?g.compressedTexImage2D(3553,e,o,l.width,l.height,0,l.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):g.texImage2D(3553,e,o,l.width,l.height,0,s,a,l.data);e.__maxMipLevel=c.length-1}else if(n.isDataTexture2DArray)g.texImage3D(35866,0,o,i.width,i.height,i.depth,0,s,a,i.data),e.__maxMipLevel=0;else if(n.isDataTexture3D)g.texImage3D(32879,0,o,i.width,i.height,i.depth,0,s,a,i.data),e.__maxMipLevel=0;else if(0<c.length&&t){for(let e=0,t=c.length;e<t;e++)l=c[e],g.texImage2D(3553,e,o,s,a,l);n.generateMipmaps=!1,e.__maxMipLevel=c.length-1}else g.texImage2D(3553,0,o,s,a,i),e.__maxMipLevel=0;S(n,t)&&E(r,n,i.width,i.height),e.__version=n.version,n.onUpdate&&n.onUpdate(n)}function N(e,t,n,r,i){var s=x.convert(n.format),a=x.convert(n.type),o=T(n.internalFormat,s,a);32879===i||35866===i?g.texImage3D(i,0,o,t.width,t.height,t.depth,0,s,a,null):g.texImage2D(i,0,o,t.width,t.height,0,s,a,null),g.bindFramebuffer(36160,e),m.framebufferTexture2D(36160,r,i,v.get(n).__webglTexture,0),g.bindFramebuffer(36160,null)}function I(t,n,r){if(m.bindRenderbuffer(36161,t),n.depthBuffer&&!n.stencilBuffer){let e=33189;r?((i=n.depthTexture)&&i.isDepthTexture&&(i.type===ze?e=36012:i.type===Ee&&(e=33190)),i=O(n),m.renderbufferStorageMultisample(36161,i,e,n.width,n.height)):m.renderbufferStorage(36161,e,n.width,n.height),m.framebufferRenderbuffer(36160,36096,36161,t)}else{var i,e;n.depthBuffer&&n.stencilBuffer?(r?(e=O(n),m.renderbufferStorageMultisample(36161,e,35056,n.width,n.height)):m.renderbufferStorage(36161,34041,n.width,n.height),m.framebufferRenderbuffer(36160,33306,36161,t)):(i=!0===n.isWebGLMultipleRenderTargets?n.texture[0]:n.texture,e=x.convert(i.format),t=x.convert(i.type),t=T(i.internalFormat,e,t),r?(r=O(n),m.renderbufferStorageMultisample(36161,r,t,n.width,n.height)):m.renderbufferStorage(36161,t,n.width,n.height))}m.bindRenderbuffer(36161,null)}function k(t){const n=v.get(t);var e=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture){if(e)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,t){if(t&&t.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(g.bindFramebuffer(36160,e),!t.depthTexture||!t.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");if(v.get(t.depthTexture).__webglTexture&&t.depthTexture.image.width===t.width&&t.depthTexture.image.height===t.height||(t.depthTexture.image.width=t.width,t.depthTexture.image.height=t.height,t.depthTexture.needsUpdate=!0),d(t.depthTexture,0),e=v.get(t.depthTexture).__webglTexture,t.depthTexture.format===Le)m.framebufferTexture2D(36160,36096,3553,e,0);else{if(t.depthTexture.format!==Fe)throw new Error("Unknown depthTexture format");m.framebufferTexture2D(36160,33306,3553,e,0)}}(n.__webglFramebuffer,t)}else if(e){n.__webglDepthbuffer=[];for(let e=0;e<6;e++)g.bindFramebuffer(36160,n.__webglFramebuffer[e]),n.__webglDepthbuffer[e]=m.createRenderbuffer(),I(n.__webglDepthbuffer[e],t,!1)}else g.bindFramebuffer(36160,n.__webglFramebuffer),n.__webglDepthbuffer=m.createRenderbuffer(),I(n.__webglDepthbuffer,t,!1);g.bindFramebuffer(36160,null)}function O(e){return _&&e.isWebGLMultisampleRenderTarget?Math.min(n,e.samples):0}let z=!1,U=!1;this.allocateTextureUnit=function(){var e=h;return e>=t&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+t),h+=1,e},this.resetTextureUnits=function(){h=0},this.setTexture2D=d,this.setTexture2DArray=function(e,t){var n=v.get(e);0<e.version&&n.__version!==e.version?D(n,e,t):(g.activeTexture(33984+t),g.bindTexture(35866,n.__webglTexture))},this.setTexture3D=function(e,t){var n=v.get(e);0<e.version&&n.__version!==e.version?D(n,e,t):(g.activeTexture(33984+t),g.bindTexture(32879,n.__webglTexture))},this.setTextureCube=p,this.setupRenderTarget=function(n){const t=n.texture,r=v.get(n),i=v.get(t);n.addEventListener("dispose",C),!0!==n.isWebGLMultipleRenderTargets&&(i.__webglTexture=m.createTexture(),i.__version=t.version,b.memory.textures++);var e,s=!0===n.isWebGLCubeRenderTarget,a=!0===n.isWebGLMultipleRenderTargets,o=!0===n.isWebGLMultisampleRenderTarget,l=t.isDataTexture3D||t.isDataTexture2DArray,c=M(n)||_;if(!_||t.format!==Ce||t.type!==ze&&t.type!==Ue||(t.format=Ve,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),s){r.__webglFramebuffer=[];for(let e=0;e<6;e++)r.__webglFramebuffer[e]=m.createFramebuffer()}else if(r.__webglFramebuffer=m.createFramebuffer(),a)if(y.drawBuffers){var u=n.texture;for(let e=0,t=u.length;e<t;e++){const f=v.get(u[e]);void 0===f.__webglTexture&&(f.__webglTexture=m.createTexture(),b.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else o&&(_?(r.__webglMultisampledFramebuffer=m.createFramebuffer(),r.__webglColorRenderbuffer=m.createRenderbuffer(),m.bindRenderbuffer(36161,r.__webglColorRenderbuffer),e=x.convert(t.format),o=x.convert(t.type),e=T(t.internalFormat,e,o),o=O(n),m.renderbufferStorageMultisample(36161,o,e,n.width,n.height),g.bindFramebuffer(36160,r.__webglMultisampledFramebuffer),m.framebufferRenderbuffer(36160,36064,36161,r.__webglColorRenderbuffer),m.bindRenderbuffer(36161,null),n.depthBuffer&&(r.__webglDepthRenderbuffer=m.createRenderbuffer(),I(r.__webglDepthRenderbuffer,n,!0)),g.bindFramebuffer(36160,null)):console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2."));if(s){g.bindTexture(34067,i.__webglTexture),P(34067,t,c);for(let e=0;e<6;e++)N(r.__webglFramebuffer[e],n,t,36064,34069+e);S(t,c)&&E(34067,t,n.width,n.height),g.unbindTexture()}else if(a){var h=n.texture;for(let e=0,t=h.length;e<t;e++){var d=h[e],p=v.get(d);g.bindTexture(3553,p.__webglTexture),P(3553,d,c),N(r.__webglFramebuffer,n,d,36064+e,3553),S(d,c)&&E(3553,d,n.width,n.height)}g.unbindTexture()}else{let e=3553;l&&(_?(l=t.isDataTexture3D,e=l?32879:35866):console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.")),g.bindTexture(e,i.__webglTexture),P(e,t,c),N(r.__webglFramebuffer,n,t,36064,e),S(t,c)&&E(e,t,n.width,n.height,n.depth),g.unbindTexture()}n.depthBuffer&&k(n)},this.updateRenderTargetMipmap=function(n){var r=M(n)||_,i=!0===n.isWebGLMultipleRenderTargets?n.texture:[n.texture];for(let e=0,t=i.length;e<t;e++){var s,a,o=i[e];S(o,r)&&(s=n.isWebGLCubeRenderTarget?34067:3553,a=v.get(o).__webglTexture,g.bindTexture(s,a),E(s,o,n.width,n.height),g.unbindTexture())}},this.updateMultisampleRenderTarget=function(t){if(t.isWebGLMultisampleRenderTarget)if(_){var n=t.width,r=t.height;let e=16384;t.depthBuffer&&(e|=256),t.stencilBuffer&&(e|=1024);t=v.get(t);g.bindFramebuffer(36008,t.__webglMultisampledFramebuffer),g.bindFramebuffer(36009,t.__webglFramebuffer),m.blitFramebuffer(0,0,n,r,0,0,n,r,e,9728),g.bindFramebuffer(36008,null),g.bindFramebuffer(36009,t.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(e,t){e&&e.isWebGLRenderTarget&&(!1===z&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),z=!0),e=e.texture),d(e,t)},this.safeSetTextureCube=function(e,t){e&&e.isWebGLCubeRenderTarget&&(!1===U&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),U=!0),e=e.texture),p(e,t)}}function Ba(e,n,t){const r=t.isWebGL2;return{convert:function(e){let t;if(e===Oe)return 5121;if(e===o)return 32819;if(e===u)return 32820;if(e===h)return 33635;if(e===i)return 5120;if(e===s)return 5122;if(e===Se)return 5123;if(e===a)return 5124;if(e===Ee)return 5125;if(e===ze)return 5126;if(e===Ue)return r?5131:(t=n.get("OES_texture_half_float"),null!==t?t.HALF_FLOAT_OES:null);if(e===d)return 6406;if(e===Ce)return 6407;if(e===Ve)return 6408;if(e===p)return 6409;if(e===f)return 6410;if(e===Le)return 6402;if(e===Fe)return 34041;if(e===m)return 6403;if(e===g)return 36244;if(e===v)return 33319;if(e===y)return 33320;if(e===x)return 36248;if(e===b)return 36249;if(e===_||e===w||e===E||e===P){if(t=n.get("WEBGL_compressed_texture_s3tc"),null===t)return null;if(e===_)return t.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===w)return t.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===E)return t.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===P)return t.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(e===R||e===D||e===I||e===k){if(t=n.get("WEBGL_compressed_texture_pvrtc"),null===t)return null;if(e===R)return t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===D)return t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===I)return t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===k)return t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(e===O)return t=n.get("WEBGL_compressed_texture_etc1"),null!==t?t.COMPRESSED_RGB_ETC1_WEBGL:null;if((e===z||e===U)&&(t=n.get("WEBGL_compressed_texture_etc"),null!==t)){if(e===z)return t.COMPRESSED_RGB8_ETC2;if(e===U)return t.COMPRESSED_RGBA8_ETC2_EAC}return e===He||e===Be||e===Ge||e===We||e===je||e===qe||e===Xe||e===Ye||e===Ke||e===Je||e===Ze||e===$e||e===Qe||e===et||e===nt||e===rt||e===it||e===st||e===at||e===ot||e===lt||e===ct||e===ut||e===ht||e===dt||e===pt||e===ft||e===mt?(t=n.get("WEBGL_compressed_texture_astc"),null!==t?e:null):e===tt?(t=n.get("EXT_texture_compression_bptc"),null!==t?e:null):e===Te?r?34042:(t=n.get("WEBGL_depth_texture"),null!==t?t.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}class Ga extends ti{constructor(e=[]){super(),this.cameras=e}}Ga.prototype.isArrayCamera=!0;class Wa extends Xn{constructor(){super(),this.type="Group"}}Wa.prototype.isGroup=!0;const ja={type:"move"};class qa{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Wa,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Wa,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Wt,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Wt),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Wa,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Wt,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Wt),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,n){let r=null,i=null,s=null;const a=this._targetRay,o=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState)if(null!==a&&(r=t.getPose(e.targetRaySpace,n),null!==r&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(ja))),l&&e.hand){s=!0;for(const d of e.hand.values()){var c=t.getJointPose(d,n);if(void 0===l.joints[d.jointName]){const f=new Wa;f.matrixAutoUpdate=!1,f.visible=!1,l.joints[d.jointName]=f,l.add(f)}const p=l.joints[d.jointName];null!==c&&(p.matrix.fromArray(c.transform.matrix),p.matrix.decompose(p.position,p.rotation,p.scale),p.jointRadius=c.radius),p.visible=null!==c}const h=l.joints["index-finger-tip"];var u=l.joints["thumb-tip"],u=h.position.distanceTo(u.position);l.inputState.pinching&&.025<u?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&u<=.015&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==o&&e.gripSpace&&(i=t.getPose(e.gripSpace,n),null!==i&&(o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),i.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(i.linearVelocity)):o.hasLinearVelocity=!1,i.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(i.angularVelocity)):o.hasAngularVelocity=!1));return null!==a&&(a.visible=null!==r),null!==o&&(o.visible=null!==i),null!==l&&(l.visible=null!==s),this}}class Xa extends bt{constructor(e,u){super();const n=this,h=e.state;let d=null,r=1,p=null,i="local-floor",f=null,m=null,g=null,v=null,y=null,x=!1,b=null,s=null,a=null,_=null,w=null,M=null;const S=[],o=new Map,l=new ti;l.layers.enable(1),l.viewport=new Ft;const c=new ti;c.layers.enable(2),c.viewport=new Ft;const E=[l,c],T=new Ga;T.layers.enable(1),T.layers.enable(2);let C=null,L=null;function A(e){const t=o.get(e.inputSource);t&&t.dispatchEvent({type:e.type,data:e.inputSource})}function P(){o.forEach(function(e,t){e.disconnect(t)}),o.clear(),C=null,L=null,h.bindXRFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),g&&u.deleteFramebuffer(g),b&&u.deleteFramebuffer(b),s&&u.deleteRenderbuffer(s),a&&u.deleteRenderbuffer(a),g=null,b=null,s=null,a=null,y=null,v=null,m=null,d=null,O.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function R(t){var n=d.inputSources;for(let e=0;e<S.length;e++)o.set(n[e],S[e]);for(let e=0;e<t.removed.length;e++){var r=t.removed[e];const s=o.get(r);s&&(s.dispatchEvent({type:"disconnected",data:r}),o.delete(r))}for(let e=0;e<t.added.length;e++){var i=t.added[e];const a=o.get(i);a&&a.dispatchEvent({type:"connected",data:i})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=S[e];return void 0===t&&(t=new qa,S[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=S[e];return void 0===t&&(t=new qa,S[e]=t),t.getGripSpace()},this.getHand=function(e){let t=S[e];return void 0===t&&(t=new qa,S[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){r=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){i=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return p},this.getBaseLayer=function(){return null!==v?v:y},this.getBinding=function(){return m},this.getFrame=function(){return _},this.getSession=function(){return d},this.setSession=async function(t){if(d=t,null!==d){d.addEventListener("select",A),d.addEventListener("selectstart",A),d.addEventListener("selectend",A),d.addEventListener("squeeze",A),d.addEventListener("squeezestart",A),d.addEventListener("squeezeend",A),d.addEventListener("end",P),d.addEventListener("inputsourceschange",R);t=u.getContextAttributes();if(!0!==t.xrCompatible&&await u.makeXRCompatible(),void 0===d.renderState.layers){var e={antialias:t.antialias,alpha:t.alpha,depth:t.depth,stencil:t.stencil,framebufferScaleFactor:r};y=new XRWebGLLayer(d,u,e),d.updateRenderState({baseLayer:y})}else if(u instanceof WebGLRenderingContext){e={antialias:!0,alpha:t.alpha,depth:t.depth,stencil:t.stencil,framebufferScaleFactor:r};y=new XRWebGLLayer(d,u,e),d.updateRenderState({layers:[y]})}else{x=t.antialias;let e=null;t.depth&&(M=256,t.stencil&&(M|=1024),w=t.stencil?33306:36096,e=t.stencil?35056:33190);t={colorFormat:t.alpha?32856:32849,depthFormat:e,scaleFactor:r};m=new XRWebGLBinding(d,u),v=m.createProjectionLayer(t),g=u.createFramebuffer(),d.updateRenderState({layers:[v]}),x&&(b=u.createFramebuffer(),s=u.createRenderbuffer(),u.bindRenderbuffer(36161,s),u.renderbufferStorageMultisample(36161,4,32856,v.textureWidth,v.textureHeight),h.bindFramebuffer(36160,b),u.framebufferRenderbuffer(36160,36064,36161,s),u.bindRenderbuffer(36161,null),null!==e&&(a=u.createRenderbuffer(),u.bindRenderbuffer(36161,a),u.renderbufferStorageMultisample(36161,4,e,v.textureWidth,v.textureHeight),u.framebufferRenderbuffer(36160,w,36161,a),u.bindRenderbuffer(36161,null)),h.bindFramebuffer(36160,null))}p=await d.requestReferenceSpace(i),O.setContext(d),O.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}};const D=new Wt,N=new Wt;function I(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null!==d){T.near=c.near=l.near=e.near,T.far=c.far=l.far=e.far,C===T.near&&L===T.far||(d.updateRenderState({depthNear:T.near,depthFar:T.far}),C=T.near,L=T.far);var t=e.parent,n=T.cameras;I(T,t);for(let e=0;e<n.length;e++)I(n[e],t);T.matrixWorld.decompose(T.position,T.quaternion,T.scale),e.position.copy(T.position),e.quaternion.copy(T.quaternion),e.scale.copy(T.scale),e.matrix.copy(T.matrix),e.matrixWorld.copy(T.matrixWorld);const r=e.children;for(let e=0,t=r.length;e<t;e++)r[e].updateMatrixWorld(!0);2===n.length?function(e,t,n){D.setFromMatrixPosition(t.matrixWorld),N.setFromMatrixPosition(n.matrixWorld);var r=D.distanceTo(N),i=t.projectionMatrix.elements,s=n.projectionMatrix.elements,a=i[14]/(i[10]-1),o=i[14]/(i[10]+1),l=(i[9]+1)/i[5],c=(i[9]-1)/i[5],u=(i[8]-1)/i[0],n=(s[8]+1)/s[0],i=a*u,s=a*n,u=(n=r/(n-u))*-u;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(u),e.translateZ(n),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert(),a+=n,n=o+n,e.projectionMatrix.makePerspective(i-u,r-u+s,l*o/n*a,c*o/n*a,a,n)}(T,l,c):T.projectionMatrix.copy(l.projectionMatrix)}},this.getCamera=function(){return T},this.getFoveation=function(){return null!==v?v.fixedFoveation:null!==y?y.fixedFoveation:void 0},this.setFoveation=function(e){null!==v&&(v.fixedFoveation=e),null!==y&&void 0!==y.fixedFoveation&&(y.fixedFoveation=e)};let k=null;const O=new di;O.setAnimationLoop(function(e,t){if(f=t.getViewerPose(p),_=t,null!==f){var r=f.views;null!==y&&h.bindXRFramebuffer(y.framebuffer);let n=!1;r.length!==T.cameras.length&&(T.cameras.length=0,n=!0);for(let t=0;t<r.length;t++){var i,s=r[t];let e=null;e=null!==y?y.getViewport(s):(i=m.getViewSubImage(v,s),h.bindXRFramebuffer(g),void 0!==i.depthStencilTexture&&u.framebufferTexture2D(36160,w,3553,i.depthStencilTexture,0),u.framebufferTexture2D(36160,36064,3553,i.colorTexture,0),i.viewport);const l=E[t];l.matrix.fromArray(s.transform.matrix),l.projectionMatrix.fromArray(s.projectionMatrix),l.viewport.set(e.x,e.y,e.width,e.height),0===t&&T.matrix.copy(l.matrix),!0===n&&T.cameras.push(l)}x&&(h.bindXRFramebuffer(b),null!==M&&u.clear(M))}var n,a=d.inputSources;for(let e=0;e<S.length;e++){const c=S[e];var o=a[e];c.update(o,t,p)}k&&k(e,t),x&&(n=v.textureWidth,e=v.textureHeight,h.bindFramebuffer(36008,b),h.bindFramebuffer(36009,g),u.invalidateFramebuffer(36008,[w]),u.invalidateFramebuffer(36009,[w]),u.blitFramebuffer(0,0,n,e,0,0,n,e,16384,9728),u.invalidateFramebuffer(36008,[36064]),h.bindFramebuffer(36008,null),h.bindFramebuffer(36009,null),h.bindFramebuffer(36160,b)),_=null}),this.setAnimationLoop=function(e){k=e},this.dispose=function(){}}}function Ya(s){function c(e,t){e.opacity.value=t.opacity,t.color&&e.diffuse.value.copy(t.color),t.emissive&&e.emissive.value.copy(t.emissive).multiplyScalar(t.emissiveIntensity),t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.specularMap&&(e.specularMap.value=t.specularMap),0<t.alphaTest&&(e.alphaTest.value=t.alphaTest);var n=s.get(t).envMap;n&&(e.envMap.value=n,e.flipEnvMap.value=n.isCubeTexture&&!1===n.isRenderTargetTexture?-1:1,e.reflectivity.value=t.reflectivity,e.ior.value=t.ior,e.refractionRatio.value=t.refractionRatio,void 0!==(n=s.get(n).__maxMipLevel)&&(e.maxMipLevel.value=n)),t.lightMap&&(e.lightMap.value=t.lightMap,e.lightMapIntensity.value=t.lightMapIntensity),t.aoMap&&(e.aoMap.value=t.aoMap,e.aoMapIntensity.value=t.aoMapIntensity);let r;t.map?r=t.map:t.specularMap?r=t.specularMap:t.displacementMap?r=t.displacementMap:t.normalMap?r=t.normalMap:t.bumpMap?r=t.bumpMap:t.roughnessMap?r=t.roughnessMap:t.metalnessMap?r=t.metalnessMap:t.alphaMap?r=t.alphaMap:t.emissiveMap?r=t.emissiveMap:t.clearcoatMap?r=t.clearcoatMap:t.clearcoatNormalMap?r=t.clearcoatNormalMap:t.clearcoatRoughnessMap?r=t.clearcoatRoughnessMap:t.specularIntensityMap?r=t.specularIntensityMap:t.specularTintMap?r=t.specularTintMap:t.transmissionMap?r=t.transmissionMap:t.thicknessMap&&(r=t.thicknessMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix));let i;t.aoMap?i=t.aoMap:t.lightMap&&(i=t.lightMap),void 0!==i&&(i.isWebGLRenderTarget&&(i=i.texture),!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uv2Transform.value.copy(i.matrix))}function u(e,t){e.roughness.value=t.roughness,e.metalness.value=t.metalness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap),t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===Pe&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===Pe&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),s.get(t).envMap&&(e.envMapIntensity.value=t.envMapIntensity)}return{refreshFogUniforms:function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)},refreshMaterialUniforms:function(e,t,n,r,i){var s,a,o,l;t.isMeshBasicMaterial?c(e,t):t.isMeshLambertMaterial?(c(e,t),o=e,(l=t).emissiveMap&&(o.emissiveMap.value=l.emissiveMap)):t.isMeshToonMaterial?(c(e,t),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap);t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===Pe&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===Pe&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,t)):t.isMeshPhongMaterial?(c(e,t),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===Pe&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===Pe&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,t)):t.isMeshStandardMaterial?(c(e,t),t.isMeshPhysicalMaterial?function(e,t,n){u(e,t),e.ior.value=t.ior,t.sheenTint&&e.sheenTint.value.copy(t.sheenTint);0<t.clearcoat&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap),t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,t.side===Pe&&e.clearcoatNormalScale.value.negate()));0<t.transmission&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=n.texture,e.transmissionSamplerSize.value.set(n.width,n.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap),e.attenuationDistance.value=t.attenuationDistance,e.attenuationTint.value.copy(t.attenuationTint));e.specularIntensity.value=t.specularIntensity,e.specularTint.value.copy(t.specularTint),t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap);t.specularTintMap&&(e.specularTintMap.value=t.specularTintMap)}(e,t,i):u(e,t)):t.isMeshMatcapMaterial?(c(e,t),function(e,t){t.matcap&&(e.matcap.value=t.matcap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===Pe&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===Pe&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,t)):t.isMeshDepthMaterial?(c(e,t),s=e,(a=t).displacementMap&&(s.displacementMap.value=a.displacementMap,s.displacementScale.value=a.displacementScale,s.displacementBias.value=a.displacementBias)):t.isMeshDistanceMaterial?(c(e,t),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias);e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(e,t)):t.isMeshNormalMaterial?(c(e,t),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===Pe&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===Pe&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,t)):t.isLineBasicMaterial?(s=t,(a=e).diffuse.value.copy(s.color),a.opacity.value=s.opacity,t.isLineDashedMaterial&&(a=t,(s=e).dashSize.value=a.dashSize,s.totalSize.value=a.dashSize+a.gapSize,s.scale.value=a.scale)):t.isPointsMaterial?function(e,t,n,r){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*n,e.scale.value=.5*r,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);0<t.alphaTest&&(e.alphaTest.value=t.alphaTest);let i;t.map?i=t.map:t.alphaMap&&(i=t.alphaMap);void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uvTransform.value.copy(i.matrix))}(e,t,n,r):t.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);0<t.alphaTest&&(e.alphaTest.value=t.alphaTest);let n;t.map?n=t.map:t.alphaMap&&(n=t.alphaMap);void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}(e,t):t.isShadowMaterial?(e.color.value.copy(t.color),e.opacity.value=t.opacity):t.isShaderMaterial&&(t.uniformsNeedUpdate=!1)}}}function Ka(e={}){const i=void 0!==e.canvas?e.canvas:function(){const e=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return e.style.display="block",e}(),t=void 0!==e.context?e.context:null,n=void 0!==e.alpha&&e.alpha,r=void 0===e.depth||e.depth,s=void 0===e.stencil||e.stencil,a=void 0!==e.antialias&&e.antialias,o=void 0===e.premultipliedAlpha||e.premultipliedAlpha,l=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,c=void 0!==e.powerPreference?e.powerPreference:"default",u=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat;let f=null,M=null;const h=[],d=[];this.domElement=i,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=gt,this.physicallyCorrectLights=!1,this.toneMapping=De,this.toneMappingExposure=1;const S=this;let p=!1,m=0,g=0,E=null,T=-1,C=null;const v=new Ft,y=new Ft;let x=null,b=i.width,L=i.height,A=1,_=null,w=null;const P=new Ft(0,0,b,L),R=new Ft(0,0,b,L);let D=!1;const N=[],I=new hi;let k=!1,O=!1,z=null;const U=new wn,V=new Wt,F={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function H(){return null===E?A:1}let B=t;function G(t,n){for(let e=0;e<t.length;e++){var r=t[e],r=i.getContext(r,n);if(null!==r)return r}return null}try{var W={alpha:n,depth:r,stencil:s,antialias:a,premultipliedAlpha:o,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:u};if(i.addEventListener("webglcontextlost",ge,!1),i.addEventListener("webglcontextrestored",ve,!1),null===B){const Le=["webgl2","webgl","experimental-webgl"];if(!0===S.isWebGL1Renderer&&Le.shift(),B=G(Le,W),null===B)throw G(Le)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===B.getShaderPrecisionFormat&&(B.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}let j,q,X,Y,K,J,Z,$,Q,ee,te,ne,re,ie,se,ae,oe,le,ce,ue,he,de,pe;function fe(){j=new Yi(B),q=new _i(B,j,e),j.init(q),de=new Ba(B,j,q),X=new Fa(B,j,q),N[0]=1029,Y=new Zi(B),K=new Sa,J=new Ha(B,j,X,K,q,de,Y),Z=new Mi(S),$=new Xi(S),Q=new pi(B,q),pe=new xi(B,j,Q,q),ee=new Ki(B,Q,Y,pe),te=new ts(B,ee,Q,Y),ce=new es(B),ae=new wi(K),ne=new Ma(S,Z,$,j,q,pe,ae),re=new Ya(K),ie=new La(K),se=new Ia(j,q),le=new yi(S,Z,X,te,o),oe=new Va(S,te,q),ue=new bi(B,j,Y,q),he=new Ji(B,j,Y,q),Y.programs=ne.programs,S.capabilities=q,S.extensions=j,S.properties=K,S.renderLists=ie,S.shadowMap=oe,S.state=X,S.info=Y}fe();const me=new Xa(S,B);function ge(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),p=!0}function ve(){console.log("THREE.WebGLRenderer: Context Restored."),p=!1;var e=Y.autoReset,t=oe.enabled,n=oe.autoUpdate,r=oe.needsUpdate,i=oe.type;fe(),Y.autoReset=e,oe.enabled=t,oe.autoUpdate=n,oe.needsUpdate=r,oe.type=i}function ye(e){const t=e.target;t.removeEventListener("dispose",ye),function(e){const t=K.get(e).programs;void 0!==t&&t.forEach(function(e){ne.releaseProgram(e)})}(e=t),K.remove(e)}this.xr=me,this.getContext=function(){return B},this.getContextAttributes=function(){return B.getContextAttributes()},this.forceContextLoss=function(){const e=j.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=j.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return A},this.setPixelRatio=function(e){void 0!==e&&(A=e,this.setSize(b,L,!1))},this.getSize=function(e){return e.set(b,L)},this.setSize=function(e,t,n){me.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(b=e,L=t,i.width=Math.floor(e*A),i.height=Math.floor(t*A),!1!==n&&(i.style.width=e+"px",i.style.height=t+"px"),this.setViewport(0,0,e,t))},this.getDrawingBufferSize=function(e){return e.set(b*A,L*A).floor()},this.setDrawingBufferSize=function(e,t,n){b=e,L=t,A=n,i.width=Math.floor(e*n),i.height=Math.floor(t*n),this.setViewport(0,0,e,t)},this.getCurrentViewport=function(e){return e.copy(v)},this.getViewport=function(e){return e.copy(P)},this.setViewport=function(e,t,n,r){e.isVector4?P.set(e.x,e.y,e.z,e.w):P.set(e,t,n,r),X.viewport(v.copy(P).multiplyScalar(A).floor())},this.getScissor=function(e){return e.copy(R)},this.setScissor=function(e,t,n,r){e.isVector4?R.set(e.x,e.y,e.z,e.w):R.set(e,t,n,r),X.scissor(y.copy(R).multiplyScalar(A).floor())},this.getScissorTest=function(){return D},this.setScissorTest=function(e){X.setScissorTest(D=e)},this.setOpaqueSort=function(e){_=e},this.setTransparentSort=function(e){w=e},this.getClearColor=function(e){return e.copy(le.getClearColor())},this.setClearColor=function(){le.setClearColor.apply(le,arguments)},this.getClearAlpha=function(){return le.getClearAlpha()},this.setClearAlpha=function(){le.setClearAlpha.apply(le,arguments)},this.clear=function(e,t,n){let r=0;void 0!==e&&!e||(r|=16384),void 0!==t&&!t||(r|=256),void 0!==n&&!n||(r|=1024),B.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){i.removeEventListener("webglcontextlost",ge,!1),i.removeEventListener("webglcontextrestored",ve,!1),ie.dispose(),se.dispose(),K.dispose(),Z.dispose(),$.dispose(),te.dispose(),pe.dispose(),me.dispose(),me.removeEventListener("sessionstart",be),me.removeEventListener("sessionend",_e),z&&(z.dispose(),z=null),we.stop()},this.renderBufferImmediate=function(e,t){pe.initAttributes();const n=K.get(e);e.hasPositions&&!n.position&&(n.position=B.createBuffer()),e.hasNormals&&!n.normal&&(n.normal=B.createBuffer()),e.hasUvs&&!n.uv&&(n.uv=B.createBuffer()),e.hasColors&&!n.color&&(n.color=B.createBuffer());t=t.getAttributes();e.hasPositions&&(B.bindBuffer(34962,n.position),B.bufferData(34962,e.positionArray,35048),pe.enableAttribute(t.position.location),B.vertexAttribPointer(t.position.location,3,5126,!1,0,0)),e.hasNormals&&(B.bindBuffer(34962,n.normal),B.bufferData(34962,e.normalArray,35048),pe.enableAttribute(t.normal.location),B.vertexAttribPointer(t.normal.location,3,5126,!1,0,0)),e.hasUvs&&(B.bindBuffer(34962,n.uv),B.bufferData(34962,e.uvArray,35048),pe.enableAttribute(t.uv.location),B.vertexAttribPointer(t.uv.location,2,5126,!1,0,0)),e.hasColors&&(B.bindBuffer(34962,n.color),B.bufferData(34962,e.colorArray,35048),pe.enableAttribute(t.color.location),B.vertexAttribPointer(t.color.location,3,5126,!1,0,0)),pe.disableUnusedAttributes(),B.drawArrays(4,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,n,r,i,s){null===t&&(t=F);var a=i.isMesh&&i.matrixWorld.determinant()<0,o=Ce(e,t,r,i);X.setMaterial(r,a);let l=n.index;e=n.attributes.position;if(null===l){if(void 0===e||0===e.count)return}else if(0===l.count)return;let c=1;!0===r.wireframe&&(l=ee.getWireframeAttribute(n),c=2),void 0===n.morphAttributes.position&&void 0===n.morphAttributes.normal||ce.update(i,n,r,o),pe.setup(i,r,o,n,l);let u=ue;null!==l&&(h=Q.get(l),u=he,u.setIndex(h));var t=(null!==l?l:e).count,a=n.drawRange.start*c,o=n.drawRange.count*c,h=null!==s?s.start*c:0,e=null!==s?s.count*c:1/0,s=Math.max(a,h),e=Math.min(t,a+o,h+e)-1,e=Math.max(0,e-s+1);if(0!==e){if(i.isMesh)!0===r.wireframe?(X.setLineWidth(r.wireframeLinewidth*H()),u.setMode(1)):u.setMode(4);else if(i.isLine){let e=r.linewidth;void 0===e&&(e=1),X.setLineWidth(e*H()),i.isLineSegments?u.setMode(1):i.isLineLoop?u.setMode(2):u.setMode(3)}else i.isPoints?u.setMode(0):i.isSprite&&u.setMode(4);i.isInstancedMesh?u.renderInstances(s,e,i.count):n.isInstancedBufferGeometry?(n=Math.min(n.instanceCount,n._maxInstanceCount),u.renderInstances(s,e,n)):u.render(s,e)}},this.compile=function(r,t){M=se.get(r),M.init(),d.push(M),r.traverseVisible(function(e){e.isLight&&e.layers.test(t.layers)&&(M.pushLight(e),e.castShadow&&M.pushShadow(e))}),M.setupLights(S.physicallyCorrectLights),r.traverse(function(t){var n=t.material;if(n)if(Array.isArray(n))for(let e=0;e<n.length;e++)Ee(n[e],r,t);else Ee(n,r,t)}),d.pop(),M=null};let xe=null;function be(){we.stop()}function _e(){we.start()}const we=new di;function Me(e,t,n,r){var i=e.opaque,s=e.transmissive,e=e.transparent;M.setupLightsView(n),0<s.length&&function(e,t,n){if(null===z){const s=!0===a&&!0===q.isWebGL2?Bt:Ht;z=new s(1024,1024,{generateMipmaps:!0,type:null!==de.convert(Ue)?Ue:Oe,minFilter:ke,magFilter:Ie,wrapS:Ne,wrapT:Ne})}var r=S.getRenderTarget();S.setRenderTarget(z),S.clear();var i=S.toneMapping;S.toneMapping=De,Se(e,t,n),S.toneMapping=i,J.updateMultisampleRenderTarget(z),J.updateRenderTargetMipmap(z),S.setRenderTarget(r)}(i,t,n),r&&X.viewport(v.copy(r)),0<i.length&&Se(i,t,n),0<s.length&&Se(s,t,n),0<e.length&&Se(e,t,n)}function Se(n,r,i){var s=!0===r.isScene?r.overrideMaterial:null;for(let e=0,t=n.length;e<t;e++){var a=n[e];const c=a.object;var o=a.geometry,l=null===s?a.material:s,a=a.group;c.layers.test(i.layers)&&function(e,t,n,r,i,s){{var a;e.onBeforeRender(S,t,n,r,i,s),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject?(a=Ce(n,t,i,e),X.setMaterial(i),pe.reset(),function(e,t){e.render(function(e){S.renderBufferImmediate(e,t)})}(e,a)):!0===i.transparent&&i.side===Re?(i.side=Pe,i.needsUpdate=!0,S.renderBufferDirect(n,t,r,i,e,s),i.side=Ae,i.needsUpdate=!0,S.renderBufferDirect(n,t,r,i,e,s),i.side=Re):S.renderBufferDirect(n,t,r,i,e,s)}e.onAfterRender(S,t,n,r,i,s)}(c,r,i,o,l,a)}}function Ee(e,t,n){!0!==t.isScene&&(t=F);const r=K.get(e);var i=M.state.lights,s=M.state.shadowsArray,a=i.state.version;const o=ne.getParameters(e,i.state,s,t,n);n=ne.getProgramCacheKey(o);let l=r.programs;r.environment=e.isMeshStandardMaterial?t.environment:null,r.fog=t.fog,r.envMap=(e.isMeshStandardMaterial?$:Z).get(e.envMap||r.environment),void 0===l&&(e.addEventListener("dispose",ye),l=new Map,r.programs=l);let c=l.get(n);if(void 0!==c){if(r.currentProgram===c&&r.lightsStateVersion===a)return Te(e,o),c}else o.uniforms=ne.getUniforms(e),e.onBuild(o,S),e.onBeforeCompile(o,S),c=ne.acquireProgram(o,n),l.set(n,c),r.uniforms=o.uniforms;const u=r.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(u.clippingPlanes=ae.uniform),Te(e,o),r.needsLights=(e=e).isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights,r.lightsStateVersion=a,r.needsLights&&(u.ambientLightColor.value=i.state.ambient,u.lightProbe.value=i.state.probe,u.directionalLights.value=i.state.directional,u.directionalLightShadows.value=i.state.directionalShadow,u.spotLights.value=i.state.spot,u.spotLightShadows.value=i.state.spotShadow,u.rectAreaLights.value=i.state.rectArea,u.ltc_1.value=i.state.rectAreaLTC1,u.ltc_2.value=i.state.rectAreaLTC2,u.pointLights.value=i.state.point,u.pointLightShadows.value=i.state.pointShadow,u.hemisphereLights.value=i.state.hemi,u.directionalShadowMap.value=i.state.directionalShadowMap,u.directionalShadowMatrix.value=i.state.directionalShadowMatrix,u.spotShadowMap.value=i.state.spotShadowMap,u.spotShadowMatrix.value=i.state.spotShadowMatrix,u.pointShadowMap.value=i.state.pointShadowMap,u.pointShadowMatrix.value=i.state.pointShadowMatrix);i=c.getUniforms(),i=ia.seqWithValue(i.seq,u);return r.currentProgram=c,r.uniformsList=i,c}function Te(e,t){const n=K.get(e);n.outputEncoding=t.outputEncoding,n.instancing=t.instancing,n.skinning=t.skinning,n.morphTargets=t.morphTargets,n.morphNormals=t.morphNormals,n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas,n.vertexTangents=t.vertexTangents}function Ce(e,t,n,r){!0!==t.isScene&&(t=F),J.resetTextureUnits();var i=t.fog,s=n.isMeshStandardMaterial?t.environment:null,a=null===E?S.outputEncoding:E.texture.encoding,o=(n.isMeshStandardMaterial?$:Z).get(n.envMap||s),l=!0===n.vertexColors&&!!r.geometry&&!!r.geometry.attributes.color&&4===r.geometry.attributes.color.itemSize,c=!!r.geometry&&!!r.geometry.attributes.tangent,u=!!r.geometry&&!!r.geometry.morphAttributes.position,h=!!r.geometry&&!!r.geometry.morphAttributes.normal;const d=K.get(n);var p=M.state.lights;!0===k&&(!0!==O&&e===C||(s=e===C&&n.id===T,ae.setState(n,e,s)));let f=!1;n.version===d.__version?(d.needsLights&&d.lightsStateVersion!==p.state.version||d.outputEncoding!==a||r.isInstancedMesh&&!1===d.instancing||!r.isInstancedMesh&&!0===d.instancing||r.isSkinnedMesh&&!1===d.skinning||!r.isSkinnedMesh&&!0===d.skinning||d.envMap!==o||n.fog&&d.fog!==i||void 0!==d.numClippingPlanes&&(d.numClippingPlanes!==ae.numPlanes||d.numIntersection!==ae.numIntersection)||d.vertexAlphas!==l||d.vertexTangents!==c||d.morphTargets!==u||d.morphNormals!==h)&&(f=!0):(f=!0,d.__version=n.version);let m=d.currentProgram;!0===f&&(m=Ee(n,t,r));let g=!1,v=!1,y=!1;const x=m.getUniforms(),b=d.uniforms;if(X.useProgram(m.program)&&(g=!0,v=!0,y=!0),n.id!==T&&(T=n.id,v=!0),g||C!==e){if(x.setValue(B,"projectionMatrix",e.projectionMatrix),q.logarithmicDepthBuffer&&x.setValue(B,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),C!==e&&(C=e,v=!0,y=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshStandardMaterial||n.envMap){const _=x.map.cameraPosition;void 0!==_&&_.setValue(B,V.setFromMatrixPosition(e.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&x.setValue(B,"isOrthographic",!0===e.isOrthographicCamera),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.isShadowMaterial||r.isSkinnedMesh)&&x.setValue(B,"viewMatrix",e.matrixWorldInverse)}if(r.isSkinnedMesh){x.setOptional(B,r,"bindMatrix"),x.setOptional(B,r,"bindMatrixInverse");const w=r.skeleton;w&&(q.floatVertexTextures?(null===w.boneTexture&&w.computeBoneTexture(),x.setValue(B,"boneTexture",w.boneTexture,J),x.setValue(B,"boneTextureSize",w.boneTextureSize)):x.setOptional(B,w,"boneMatrices"))}return!v&&d.receiveShadow===r.receiveShadow||(d.receiveShadow=r.receiveShadow,x.setValue(B,"receiveShadow",r.receiveShadow)),v&&(x.setValue(B,"toneMappingExposure",S.toneMappingExposure),d.needsLights&&(t=b,e=y,t.ambientLightColor.needsUpdate=e,t.lightProbe.needsUpdate=e,t.directionalLights.needsUpdate=e,t.directionalLightShadows.needsUpdate=e,t.pointLights.needsUpdate=e,t.pointLightShadows.needsUpdate=e,t.spotLights.needsUpdate=e,t.spotLightShadows.needsUpdate=e,t.rectAreaLights.needsUpdate=e,t.hemisphereLights.needsUpdate=e),i&&n.fog&&re.refreshFogUniforms(b,i),re.refreshMaterialUniforms(b,n,A,L,z),ia.upload(B,d.uniformsList,b,J)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(ia.upload(B,d.uniformsList,b,J),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&x.setValue(B,"center",r.center),x.setValue(B,"modelViewMatrix",r.modelViewMatrix),x.setValue(B,"normalMatrix",r.normalMatrix),x.setValue(B,"modelMatrix",r.matrixWorld),m}we.setAnimationLoop(function(e){xe&&xe(e)}),"undefined"!=typeof window&&we.setContext(window),this.setAnimationLoop=function(e){xe=e,me.setAnimationLoop(e),null===e?we.stop():we.start()},me.addEventListener("sessionstart",be),me.addEventListener("sessionend",_e),this.render=function(n,e){if(void 0===e||!0===e.isCamera){if(!0!==p){!0===n.autoUpdate&&n.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),!0===me.enabled&&!0===me.isPresenting&&(!0===me.cameraAutoUpdate&&me.updateCamera(e),e=me.getCamera()),!0===n.isScene&&n.onBeforeRender(S,n,e,E),M=se.get(n,d.length),M.init(),d.push(M),U.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),I.setFromProjectionMatrix(U),O=this.localClippingEnabled,k=ae.init(this.clippingPlanes,O,e),f=ie.get(n,h.length),f.init(),h.push(f),function n(r,i,s,a){if(!1===r.visible)return;const e=r.layers.test(i.layers);if(e)if(r.isGroup)s=r.renderOrder;else if(r.isLOD)!0===r.autoUpdate&&r.update(i);else if(r.isLight)M.pushLight(r),r.castShadow&&M.pushShadow(r);else if(r.isSprite){if(!r.frustumCulled||I.intersectsSprite(r)){a&&V.setFromMatrixPosition(r.matrixWorld).applyMatrix4(U);const t=te.update(r),l=r.material;l.visible&&f.push(r,t,l,s,V.z,null)}}else if(r.isImmediateRenderObject)a&&V.setFromMatrixPosition(r.matrixWorld).applyMatrix4(U),f.push(r,null,r.material,s,V.z,null);else if((r.isMesh||r.isLine||r.isPoints)&&(r.isSkinnedMesh&&r.skeleton.frame!==Y.render.frame&&(r.skeleton.update(),r.skeleton.frame=Y.render.frame),!r.frustumCulled||I.intersectsObject(r))){a&&V.setFromMatrixPosition(r.matrixWorld).applyMatrix4(U);const c=te.update(r),u=r.material;if(Array.isArray(u)){const h=c.groups;for(let e=0,t=h.length;e<t;e++){const d=h[e],p=u[d.materialIndex];p&&p.visible&&f.push(r,c,p,s,V.z,d)}}else u.visible&&f.push(r,c,u,s,V.z,null)}const o=r.children;for(let e=0,t=o.length;e<t;e++)n(o[e],i,s,a)}(n,e,0,S.sortObjects),f.finish(),!0===S.sortObjects&&f.sort(_,w),!0===k&&ae.beginShadows();var t=M.state.shadowsArray;if(oe.render(t,n,e),!0===k&&ae.endShadows(),!0===this.info.autoReset&&this.info.reset(),le.render(f,n),M.setupLights(S.physicallyCorrectLights),e.isArrayCamera){var r=e.cameras;for(let e=0,t=r.length;e<t;e++){var i=r[e];Me(f,n,i,i.viewport)}}else Me(f,n,e);null!==E&&(J.updateMultisampleRenderTarget(E),J.updateRenderTargetMipmap(E)),!0===n.isScene&&n.onAfterRender(S,n,e),X.buffers.depth.setTest(!0),X.buffers.depth.setMask(!0),X.buffers.color.setMask(!0),X.setPolygonOffset(!1),pe.resetDefaultState(),T=-1,C=null,d.pop(),M=0<d.length?d[d.length-1]:null,h.pop(),f=0<h.length?h[h.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.getActiveCubeFace=function(){return m},this.getActiveMipmapLevel=function(){return g},this.getRenderTarget=function(){return E},this.setRenderTarget=function(t,e=0,n=0){E=t,m=e,g=n,t&&void 0===K.get(t).__webglFramebuffer&&J.setupRenderTarget(t);let r=null,i=!1,s=!1;var a;if(x=t?(((a=t.texture).isDataTexture3D||a.isDataTexture2DArray)&&(s=!0),a=K.get(t).__webglFramebuffer,t.isWebGLCubeRenderTarget?(r=a[e],i=!0):r=t.isWebGLMultisampleRenderTarget?K.get(t).__webglMultisampledFramebuffer:a,v.copy(t.viewport),y.copy(t.scissor),t.scissorTest):(v.copy(P).multiplyScalar(A).floor(),y.copy(R).multiplyScalar(A).floor(),D),X.bindFramebuffer(36160,r)&&q.drawBuffers){let e=!1;if(t)if(t.isWebGLMultipleRenderTargets){const J=t.texture;if(N.length!==J.length||36064!==N[0]){for(let e=0,t=J.length;e<t;e++)N[e]=36064+e;N.length=J.length,e=!0}}else 1===N.length&&36064===N[0]||(N[0]=36064,N.length=1,e=!0);else 1===N.length&&1029===N[0]||(N[0]=1029,N.length=1,e=!0);e&&(q.isWebGL2?B.drawBuffers(N):j.get("WEBGL_draw_buffers").drawBuffersWEBGL(N))}X.viewport(v),X.scissor(y),X.setScissorTest(x),i?(a=K.get(t.texture),B.framebufferTexture2D(36160,36064,34069+e,a.__webglTexture,n)):s&&(t=K.get(t.texture),e=e||0,B.framebufferTextureLayer(36160,36064,t.__webglTexture,n||0,e)),T=-1},this.readRenderTargetPixels=function(t,n,r,i,s,a,o){if(t&&t.isWebGLRenderTarget){let e=K.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==o&&(e=e[o]),e){X.bindFramebuffer(36160,e);try{var l=t.texture,c=l.format,u=l.type;if(c!==Ve&&de.convert(c)!==B.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");var h=u===Ue&&(j.has("EXT_color_buffer_half_float")||q.isWebGL2&&j.has("EXT_color_buffer_float"));if(!(u===Oe||de.convert(u)===B.getParameter(35738)||u===ze&&(q.isWebGL2||j.has("OES_texture_float")||j.has("WEBGL_color_buffer_float"))||h))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===B.checkFramebufferStatus(36160)?0<=n&&n<=t.width-i&&0<=r&&r<=t.height-s&&B.readPixels(n,r,i,s,de.convert(c),de.convert(u),a):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{const e=null!==E?K.get(E).__webglFramebuffer:null;X.bindFramebuffer(36160,e)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(e,t,n=0){var r=Math.pow(2,-n),i=Math.floor(t.image.width*r),r=Math.floor(t.image.height*r);let s=de.convert(t.format);q.isWebGL2&&(6407===s&&(s=32849),6408===s&&(s=32856)),J.setTexture2D(t,0),B.copyTexImage2D(3553,n,s,e.x,e.y,i,r,0),X.unbindTexture()},this.copyTextureToTexture=function(e,t,n,r=0){var i=t.image.width,s=t.image.height,a=de.convert(n.format),o=de.convert(n.type);J.setTexture2D(n,0),B.pixelStorei(37440,n.flipY),B.pixelStorei(37441,n.premultiplyAlpha),B.pixelStorei(3317,n.unpackAlignment),t.isDataTexture?B.texSubImage2D(3553,r,e.x,e.y,i,s,a,o,t.image.data):t.isCompressedTexture?B.compressedTexSubImage2D(3553,r,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,a,t.mipmaps[0].data):B.texSubImage2D(3553,r,e.x,e.y,a,o,t.image),0===r&&n.generateMipmaps&&B.generateMipmap(3553),X.unbindTexture()},this.copyTextureToTexture3D=function(t,n,r,i,s=0){if(S.isWebGL1Renderer)console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");else{var a=t.max.x-t.min.x+1,o=t.max.y-t.min.y+1,l=t.max.z-t.min.z+1,c=de.convert(i.format),u=de.convert(i.type);let e;if(i.isDataTexture3D)J.setTexture3D(i,0),e=32879;else{if(!i.isDataTexture2DArray)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");J.setTexture2DArray(i,0),e=35866}B.pixelStorei(37440,i.flipY),B.pixelStorei(37441,i.premultiplyAlpha),B.pixelStorei(3317,i.unpackAlignment);var h=B.getParameter(3314),d=B.getParameter(32878),p=B.getParameter(3316),f=B.getParameter(3315),m=B.getParameter(32877),g=r.isCompressedTexture?r.mipmaps[0]:r.image;B.pixelStorei(3314,g.width),B.pixelStorei(32878,g.height),B.pixelStorei(3316,t.min.x),B.pixelStorei(3315,t.min.y),B.pixelStorei(32877,t.min.z),r.isDataTexture||r.isDataTexture3D?B.texSubImage3D(e,s,n.x,n.y,n.z,a,o,l,c,u,g.data):r.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),B.compressedTexSubImage3D(e,s,n.x,n.y,n.z,a,o,l,c,g.data)):B.texSubImage3D(e,s,n.x,n.y,n.z,a,o,l,c,u,g),B.pixelStorei(3314,h),B.pixelStorei(32878,d),B.pixelStorei(3316,p),B.pixelStorei(3315,f),B.pixelStorei(32877,m),0===s&&i.generateMipmaps&&B.generateMipmap(e),X.unbindTexture()}},this.initTexture=function(e){J.setTexture2D(e,0),X.unbindTexture()},this.resetState=function(){m=0,g=0,E=null,X.reset(),pe.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}class Ja{constructor(e,t=25e-5){this.name="",this.color=new pr(e),this.density=t}clone(){return new Ja(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}Ja.prototype.isFogExp2=class extends Ka{}.prototype.isWebGL1Renderer=!0;class Za{constructor(e,t=1,n=1e3){this.name="",this.color=new pr(e),this.near=t,this.far=n}clone(){return new Za(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}Za.prototype.isFog=!0;class $a extends Xn{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}}$a.prototype.isScene=!0;class Qa{constructor(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Et()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(n,r,i){n*=this.stride,i*=r.stride;for(let e=0,t=this.stride;e<t;e++)this.array[n+e]=r.array[i+e];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Et()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);e=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]);const t=new this.constructor(e,this.stride);return t.setUsage(this.usage),t}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Et()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}Qa.prototype.isInterleavedBuffer=!0;const eo=new Wt;class to{constructor(e,t,n,r=!1){this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=!0===r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(n){for(let e=0,t=this.data.count;e<t;e++)eo.x=this.getX(e),eo.y=this.getY(e),eo.z=this.getZ(e),eo.applyMatrix4(n),this.setXYZ(e,eo.x,eo.y,eo.z);return this}applyNormalMatrix(n){for(let e=0,t=this.count;e<t;e++)eo.x=this.getX(e),eo.y=this.getY(e),eo.z=this.getZ(e),eo.applyNormalMatrix(n),this.setXYZ(e,eo.x,eo.y,eo.z);return this}transformDirection(n){for(let e=0,t=this.count;e<t;e++)eo.x=this.getX(e),eo.y=this.getY(e),eo.z=this.getZ(e),eo.transformDirection(n),this.setXYZ(e,eo.x,eo.y,eo.z);return this}setX(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){return this.data.array[e*this.data.stride+this.offset]}getY(e){return this.data.array[e*this.data.stride+this.offset+1]}getZ(e){return this.data.array[e*this.data.stride+this.offset+2]}getW(e){return this.data.array[e*this.data.stride+this.offset+3]}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this}setXYZW(e,t,n,r,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this.data.array[e+3]=i,this}clone(e){if(void 0!==e)return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new to(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized);{console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const n=[];for(let e=0;e<this.count;e++){var t=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)n.push(this.data.array[t+e])}return new vr(new this.array.constructor(n),this.itemSize,this.normalized)}}toJSON(e){if(void 0!==e)return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized};{console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const n=[];for(let e=0;e<this.count;e++){var t=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)n.push(this.data.array[t+e])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:n,normalized:this.normalized}}}}to.prototype.isInterleavedBufferAttribute=!0;class no extends ar{constructor(e){super(),this.type="SpriteMaterial",this.color=new pr(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this}}no.prototype.isSpriteMaterial=!0;let ro;const io=new Wt,so=new Wt,ao=new Wt,oo=new Nt,lo=new Nt,co=new wn,uo=new Wt,ho=new Wt,po=new Wt,fo=new Nt,mo=new Nt,go=new Nt;class vo extends Xn{constructor(e){var t;super(),this.type="Sprite",void 0===ro&&(ro=new Ar,t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),t=new Qa(t,5),ro.setIndex([0,1,2,0,2,3]),ro.setAttribute("position",new to(t,3,0,!1)),ro.setAttribute("uv",new to(t,2,3,!1))),this.geometry=ro,this.material=void 0!==e?e:new no,this.center=new Nt(.5,.5)}raycast(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),so.setFromMatrixScale(this.matrixWorld),co.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),ao.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&so.multiplyScalar(-ao.z);var n=this.material.rotation;let r,i;0!==n&&(i=Math.cos(n),r=Math.sin(n));n=this.center;yo(uo.set(-.5,-.5,0),ao,n,so,r,i),yo(ho.set(.5,-.5,0),ao,n,so,r,i),yo(po.set(.5,.5,0),ao,n,so,r,i),fo.set(0,0),mo.set(1,0),go.set(1,1),null===e.ray.intersectTriangle(uo,ho,po,!1,io)&&(yo(ho.set(-.5,.5,0),ao,n,so,r,i),mo.set(0,1),null===e.ray.intersectTriangle(uo,po,ho,!1,io))||((n=e.ray.origin.distanceTo(io))<e.near||n>e.far||t.push({distance:n,point:io.clone(),uv:ir.getUV(io,uo,ho,po,fo,mo,go,new Nt),face:null,object:this}))}copy(e){return super.copy(e),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}function yo(e,t,n,r,i,s){oo.subVectors(e,n).addScalar(.5).multiply(r),void 0!==i?(lo.x=s*oo.x-i*oo.y,lo.y=i*oo.x+s*oo.y):lo.copy(oo),e.copy(t),e.x+=lo.x,e.y+=lo.y,e.applyMatrix4(co)}vo.prototype.isSprite=!0;(class extends null{});const xo=new Wt,bo=new Ft,_o=new Ft,wo=new Wt,Mo=new wn;class So extends Xr{constructor(e,t){super(e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new wn,this.bindMatrixInverse=new wn}copy(e){return super.copy(e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const n=new Ft,r=this.geometry.attributes.skinWeight;for(let e=0,t=r.count;e<t;e++){n.x=r.getX(e),n.y=r.getY(e),n.z=r.getZ(e),n.w=r.getW(e);var i=1/n.manhattanLength();i!=1/0?n.multiplyScalar(i):n.set(1,0,0,0),r.setXYZW(e,n.x,n.y,n.z,n.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,t){var n=this.skeleton,r=this.geometry;bo.fromBufferAttribute(r.attributes.skinIndex,e),_o.fromBufferAttribute(r.attributes.skinWeight,e),xo.fromBufferAttribute(r.attributes.position,e).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let e=0;e<4;e++){var i,s=_o.getComponent(e);0!==s&&(i=bo.getComponent(e),Mo.multiplyMatrices(n.bones[i].matrixWorld,n.boneInverses[i]),t.addScaledVector(wo.copy(xo).applyMatrix4(Mo),s))}return t.applyMatrix4(this.bindMatrixInverse)}}So.prototype.isSkinnedMesh=!0;class Eo extends Xn{constructor(){super(),this.type="Bone"}}Eo.prototype.isBone=!0;class To extends Ut{constructor(e=null,t=1,n=1,r,i,s,a,o,l=Ie,c=Ie,u,h){super(null,s,a,o,l,c,r,i,u,h),this.image={data:e,width:t,height:n},this.magFilter=l,this.minFilter=c,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}To.prototype.isDataTexture=!0;const Co=new wn,Lo=new wn;class Ao{constructor(e=[],t=[]){this.uuid=Et(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){var e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new wn)}}calculateInverses(){for(let e=this.boneInverses.length=0,t=this.bones.length;e<t;e++){const n=new wn;this.bones[e]&&n.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(n)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];n&&n.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const r=this.bones[e];r&&(r.parent&&r.parent.isBone?(r.matrix.copy(r.parent.matrixWorld).invert(),r.matrix.multiply(r.matrixWorld)):r.matrix.copy(r.matrixWorld),r.matrix.decompose(r.position,r.quaternion,r.scale))}}update(){var n=this.bones,r=this.boneInverses,i=this.boneMatrices;const e=this.boneTexture;for(let e=0,t=n.length;e<t;e++){var s=n[e]?n[e].matrixWorld:Lo;Co.multiplyMatrices(s,r[e]),Co.toArray(i,16*e)}null!==e&&(e.needsUpdate=!0)}clone(){return new Ao(this.bones,this.boneInverses)}computeBoneTexture(){var e=Pt(e=Math.sqrt(4*this.bones.length));e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);var n=new To(t,e,e,Ve,ze);return this.boneMatrices=t,this.boneTexture=n,this.boneTextureSize=e,this}getBoneByName(n){for(let e=0,t=this.bones.length;e<t;e++){var r=this.bones[e];if(r.name===n)return r}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(n,r){this.uuid=n.uuid;for(let t=0,e=n.bones.length;t<e;t++){var i=n.bones[t];let e=r[i];void 0===e&&(console.warn("THREE.Skeleton: No bone found with UUID:",i),e=new Eo),this.bones.push(e),this.boneInverses.push((new wn).fromArray(n.boneInverses[t]))}return this.init(),this}toJSON(){const n={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};n.uuid=this.uuid;var r=this.bones,i=this.boneInverses;for(let e=0,t=r.length;e<t;e++){var s=r[e];n.bones.push(s.uuid);const a=i[e];n.boneInverses.push(a.toArray())}return n}}class Po extends vr{constructor(e,t,n,r=1){"number"==typeof n&&(r=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(e,t,n),this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}Po.prototype.isInstancedBufferAttribute=!0;const Ro=new wn,Do=new wn,No=[],Io=new Xr;class ko extends Xr{constructor(e,t,n){super(e,t),this.instanceMatrix=new Po(new Float32Array(16*n),16),this.instanceColor=null,this.count=n,this.frustumCulled=!1}copy(e){return super.copy(e),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}raycast(e,r){var t=this.matrixWorld,i=this.count;if(Io.geometry=this.geometry,Io.material=this.material,void 0!==Io.material)for(let n=0;n<i;n++){this.getMatrixAt(n,Ro),Do.multiplyMatrices(t,Ro),Io.matrixWorld=Do,Io.raycast(e,No);for(let e=0,t=No.length;e<t;e++){const s=No[e];s.instanceId=n,s.object=this,r.push(s)}No.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new Po(new Float32Array(3*this.instanceMatrix.count),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}ko.prototype.isInstancedMesh=!0;class Oo extends ar{constructor(e){super(),this.type="LineBasicMaterial",this.color=new pr(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this}}Oo.prototype.isLineBasicMaterial=!0;const zo=new Wt,Uo=new Wt,Vo=new wn,Fo=new _n,Ho=new pn;class Bo extends Xn{constructor(e=new Ar,t=new Oo){super(),this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){var n=e.attributes.position;const r=[0];for(let e=1,t=n.count;e<t;e++)zo.fromBufferAttribute(n,e-1),Uo.fromBufferAttribute(n,e),r[e]=r[e-1],r[e]+=zo.distanceTo(Uo);e.setAttribute("lineDistance",new br(r,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(n,r){const e=this.geometry;var t=this.matrixWorld,i=n.params.Line.threshold,s=e.drawRange;if(null===e.boundingSphere&&e.computeBoundingSphere(),Ho.copy(e.boundingSphere),Ho.applyMatrix4(t),Ho.radius+=i,!1!==n.ray.intersectsSphere(Ho)){Vo.copy(t).invert(),Fo.copy(n.ray).applyMatrix4(Vo);var i=i/((this.scale.x+this.scale.y+this.scale.z)/3),a=i*i;const d=new Wt,p=new Wt,f=new Wt,m=new Wt;var o=this.isLineSegments?2:1;if(e.isBufferGeometry){const g=e.index;var l,c=e.attributes.position;if(null!==g)for(let e=Math.max(0,s.start),t=Math.min(g.count,s.start+s.count)-1;e<t;e+=o){var u=g.getX(e),h=g.getX(e+1);d.fromBufferAttribute(c,u),p.fromBufferAttribute(c,h),a<Fo.distanceSqToSegment(d,p,m,f)||(m.applyMatrix4(this.matrixWorld),(h=n.ray.origin.distanceTo(m))<n.near||h>n.far||r.push({distance:h,point:f.clone().applyMatrix4(this.matrixWorld),index:e,face:null,faceIndex:null,object:this}))}else for(let e=Math.max(0,s.start),t=Math.min(c.count,s.start+s.count)-1;e<t;e+=o)d.fromBufferAttribute(c,e),p.fromBufferAttribute(c,e+1),a<Fo.distanceSqToSegment(d,p,m,f)||(m.applyMatrix4(this.matrixWorld),(l=n.ray.origin.distanceTo(m))<n.near||l>n.far||r.push({distance:l,point:f.clone().applyMatrix4(this.matrixWorld),index:e,face:null,faceIndex:null,object:this}))}else e.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}updateMorphTargets(){var e=this.geometry;if(e.isBufferGeometry){var t=e.morphAttributes,n=Object.keys(t);if(0<n.length){var r=t[n[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=r.length;e<t;e++){var i=r[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}}}else{e=e.morphTargets;void 0!==e&&0<e.length&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}Bo.prototype.isLine=!0;const Go=new Wt,Wo=new Wt;class jo extends Bo{constructor(e,t){super(e,t),this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){var n=e.attributes.position;const r=[];for(let e=0,t=n.count;e<t;e+=2)Go.fromBufferAttribute(n,e),Wo.fromBufferAttribute(n,e+1),r[e]=0===e?0:r[e-1],r[e+1]=r[e]+Go.distanceTo(Wo);e.setAttribute("lineDistance",new br(r,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}jo.prototype.isLineSegments=!0;class qo extends Bo{constructor(e,t){super(e,t),this.type="LineLoop"}}qo.prototype.isLineLoop=!0;class Xo extends ar{constructor(e){super(),this.type="PointsMaterial",this.color=new pr(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this}}Xo.prototype.isPointsMaterial=!0;const Yo=new wn,Ko=new _n,Jo=new pn,Zo=new Wt;class $o extends Xn{constructor(e=new Ar,t=new Xo){super(),this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}raycast(n,r){const e=this.geometry;var i=this.matrixWorld,t=n.params.Points.threshold,s=e.drawRange;if(null===e.boundingSphere&&e.computeBoundingSphere(),Jo.copy(e.boundingSphere),Jo.applyMatrix4(i),Jo.radius+=t,!1!==n.ray.intersectsSphere(Jo)){Yo.copy(i).invert(),Ko.copy(n.ray).applyMatrix4(Yo);var t=t/((this.scale.x+this.scale.y+this.scale.z)/3),a=t*t;if(e.isBufferGeometry){const c=e.index;var o=e.attributes.position;if(null!==c)for(let e=Math.max(0,s.start),t=Math.min(c.count,s.start+s.count);e<t;e++){var l=c.getX(e);Zo.fromBufferAttribute(o,l),Qo(Zo,l,a,i,n,r,this)}else for(let e=Math.max(0,s.start),t=Math.min(o.count,s.start+s.count);e<t;e++)Zo.fromBufferAttribute(o,e),Qo(Zo,e,a,i,n,r,this)}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}updateMorphTargets(){var e=this.geometry;if(e.isBufferGeometry){var t=e.morphAttributes,n=Object.keys(t);if(0<n.length){var r=t[n[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=r.length;e<t;e++){var i=r[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}}}else{e=e.morphTargets;void 0!==e&&0<e.length&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}function Qo(e,t,n,r,i,s,a){var o=Ko.distanceSqToPoint(e);if(o<n){const l=new Wt;Ko.closestPointToPoint(e,l),l.applyMatrix4(r);r=i.ray.origin.distanceTo(l);r<i.near||r>i.far||s.push({distance:r,distanceToRay:Math.sqrt(o),point:l,index:t,face:null,object:a})}}$o.prototype.isPoints=!0;Ut;(class extends Ut{constructor(t,e,n,r,i,s,a,o,l){super(t,e,n,r,i,s,a,o,l),this.format=void 0!==a?a:Ce,this.minFilter=void 0!==s?s:G,this.magFilter=void 0!==i?i:G,this.generateMipmaps=!1;const c=this;"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback(function e(){c.needsUpdate=!0,t.requestVideoFrameCallback(e)})}clone(){return new this.constructor(this.image).copy(this)}update(){var e=this.image;!1=="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}).prototype.isVideoTexture=!0;class el extends Ut{constructor(e,t,n,r,i,s,a,o,l,c,u,h){super(null,s,a,o,l,c,r,i,u,h),this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}el.prototype.isCompressedTexture=!0;Ut;Ut;(class extends Ut{constructor(e,t,n,r,i,s,a,o,l,c){if((c=void 0!==c?c:Le)!==Le&&c!==Fe)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");super(null,r,i,s,a,o,c,n=void 0===(n=void 0===n&&c===Le?Se:n)&&c===Fe?Te:n,l),this.image={width:e,height:t},this.magFilter=void 0!==a?a:Ie,this.minFilter=void 0!==o?o:Ie,this.flipY=!1,this.generateMipmaps=!1}}).prototype.isDepthTexture=class extends Ut{constructor(e,t,n,r,i,s,a,o,l){super(e,t,n,r,i,s,a,o,l),this.needsUpdate=!0}}.prototype.isCanvasTexture=!0;class tl extends Ar{constructor(n=1,r=8,i=0,s=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:n,segments:r,thetaStart:i,thetaLength:s},r=Math.max(3,r);const t=[],a=[],o=[],l=[],c=new Wt,u=new Nt;a.push(0,0,0),o.push(0,0,1),l.push(.5,.5);for(let e=0,t=3;e<=r;e++,t+=3){var h=i+e/r*s;c.x=n*Math.cos(h),c.y=n*Math.sin(h),a.push(c.x,c.y,c.z),o.push(0,0,1),u.x=(a[t]/n+1)/2,u.y=(a[t+1]/n+1)/2,l.push(u.x,u.y)}for(let e=1;e<=r;e++)t.push(e,e+1,0);this.setIndex(t),this.setAttribute("position",new br(a,3)),this.setAttribute("normal",new br(o,3)),this.setAttribute("uv",new br(l,2))}static fromJSON(e){return new tl(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class nl extends Ar{constructor(m=1,g=1,v=1,y=8,x=1,e=!1,b=0,_=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:m,radiusBottom:g,height:v,radialSegments:y,heightSegments:x,openEnded:e,thetaStart:b,thetaLength:_};const w=this;y=Math.floor(y),x=Math.floor(x);const M=[],S=[],E=[],T=[];let C=0;const L=[],A=v/2;let P=0;function t(t){var n=C;const r=new Nt,i=new Wt;let s=0;var a=!0===t?m:g,o=!0===t?1:-1;for(let e=1;e<=y;e++)S.push(0,A*o,0),E.push(0,o,0),T.push(.5,.5),C++;var l=C;for(let e=0;e<=y;e++){var c=e/y*_+b,u=Math.cos(c),c=Math.sin(c);i.x=a*c,i.y=A*o,i.z=a*u,S.push(i.x,i.y,i.z),E.push(0,o,0),r.x=.5*u+.5,r.y=.5*c*o+.5,T.push(r.x,r.y),C++}for(let e=0;e<y;e++){var h=n+e,d=l+e;!0===t?M.push(d,d+1,h):M.push(d+1,d,h),s+=3}w.addGroup(P,s,!0===t?1:2),P+=s}!function(){const t=new Wt,n=new Wt;let r=0;var i=(g-m)/v;for(let e=0;e<=x;e++){const f=[];var s=e/x,a=s*(g-m)+m;for(let e=0;e<=y;e++){var o=e/y,l=o*_+b,c=Math.sin(l),l=Math.cos(l);n.x=a*c,n.y=-s*v+A,n.z=a*l,S.push(n.x,n.y,n.z),t.set(c,i,l).normalize(),E.push(t.x,t.y,t.z),T.push(o,1-s),f.push(C++)}L.push(f)}for(let t=0;t<y;t++)for(let e=0;e<x;e++){var u=L[e][t],h=L[e+1][t],d=L[e+1][t+1],p=L[e][t+1];M.push(u,h,p),M.push(h,d,p),r+=6}w.addGroup(P,r,0),P+=r}(),!1===e&&(0<m&&t(!0),0<g&&t(!1)),this.setIndex(M),this.setAttribute("position",new br(S,3)),this.setAttribute("normal",new br(E,3)),this.setAttribute("uv",new br(T,2))}static fromJSON(e){return new nl(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class rl extends nl{constructor(e=1,t=1,n=8,r=1,i=!1,s=0,a=2*Math.PI){super(0,e,t,n,r,i,s,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:r,openEnded:i,thetaStart:s,thetaLength:a}}static fromJSON(e){return new rl(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class il extends Ar{constructor(n,s,e=1,t=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:n,indices:s,radius:e,detail:t};const u=[],h=[];function d(e){u.push(e.x,e.y,e.z)}function a(e,t){e*=3;t.x=n[0+e],t.y=n[1+e],t.z=n[2+e]}function p(e,t,n,r){r<0&&1===e.x&&(h[t]=e.x-1),0===n.x&&0===n.z&&(h[t]=r/2/Math.PI+.5)}function f(e){return Math.atan2(e.z,-e.x)}!function(t){var n=new Wt,r=new Wt,i=new Wt;for(let e=0;e<s.length;e+=3)a(s[e+0],n),a(s[e+1],r),a(s[e+2],i),function(e,n,r,t){const i=t+1,s=[];for(let t=0;t<=i;t++){s[t]=[];const c=e.clone().lerp(r,t/i);var a=n.clone().lerp(r,t/i),o=i-t;for(let e=0;e<=o;e++)0===e&&t===i?s[t][e]=c:s[t][e]=c.clone().lerp(a,e/o)}for(let t=0;t<i;t++)for(let e=0;e<2*(i-t)-1;e++){var l=Math.floor(e/2);e%2==0?(d(s[t][l+1]),d(s[t+1][l]),d(s[t][l])):(d(s[t][l+1]),d(s[t+1][l+1]),d(s[t+1][l]))}}(n,r,i,t)}(t),function(t){const n=new Wt;for(let e=0;e<u.length;e+=3)n.x=u[e+0],n.y=u[e+1],n.z=u[e+2],n.normalize().multiplyScalar(t),u[e+0]=n.x,u[e+1]=n.y,u[e+2]=n.z}(e),function(){const t=new Wt;for(let e=0;e<u.length;e+=3){t.x=u[e+0],t.y=u[e+1],t.z=u[e+2];var n=f(t)/2/Math.PI+.5,r=function(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}(t)/Math.PI+.5;h.push(n,1-r)}(function(){const n=new Wt,r=new Wt,i=new Wt,s=new Wt,a=new Nt,o=new Nt,l=new Nt;for(let e=0,t=0;e<u.length;e+=9,t+=6){n.set(u[e+0],u[e+1],u[e+2]),r.set(u[e+3],u[e+4],u[e+5]),i.set(u[e+6],u[e+7],u[e+8]),a.set(h[t+0],h[t+1]),o.set(h[t+2],h[t+3]),l.set(h[t+4],h[t+5]),s.copy(n).add(r).add(i).divideScalar(3);var c=f(s);p(a,t+0,n,c),p(o,t+2,r,c),p(l,t+4,i,c)}})(),function(){for(let e=0;e<h.length;e+=6){var t=h[e+0],n=h[e+2],r=h[e+4],i=Math.max(t,n,r),s=Math.min(t,n,r);.9<i&&s<.1&&(t<.2&&(h[e+0]+=1),n<.2&&(h[e+2]+=1),r<.2&&(h[e+4]+=1))}}()}(),this.setAttribute("position",new br(u,3)),this.setAttribute("normal",new br(u.slice(),3)),this.setAttribute("uv",new br(h,2)),0===t?this.computeVertexNormals():this.normalizeNormals()}static fromJSON(e){return new il(e.vertices,e.indices,e.radius,e.details)}}class sl extends il{constructor(e=1,t=0){var n=(1+Math.sqrt(5))/2,r=1/n;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-n,0,-r,n,0,r,-n,0,r,n,-r,-n,0,-r,n,0,r,-n,0,r,n,0,-n,0,-r,n,0,-r,-n,0,r,n,0,r],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new sl(e.radius,e.detail)}}const al=new Wt,ol=new Wt,ll=new Wt,cl=new ir;class ul extends Ar{constructor(e,t){if(super(),this.type="EdgesGeometry",this.parameters={thresholdAngle:t},t=void 0!==t?t:1,!0!==e.isGeometry){var n=Math.pow(10,4),r=Math.cos(Mt*t);const m=e.getIndex();var i=e.getAttribute("position"),s=(m||i).count;const g=[0,0,0];var a,o,l=["a","b","c"];const v=new Array(3),y={},x=[];for(let e=0;e<s;e+=3){m?(g[0]=m.getX(e),g[1]=m.getX(e+1),g[2]=m.getX(e+2)):(g[0]=e,g[1]=e+1,g[2]=e+2);const{a:b,b:_,c:w}=cl;if(b.fromBufferAttribute(i,g[0]),_.fromBufferAttribute(i,g[1]),w.fromBufferAttribute(i,g[2]),cl.getNormal(ll),v[0]=`${Math.round(b.x*n)},${Math.round(b.y*n)},${Math.round(b.z*n)}`,v[1]=`${Math.round(_.x*n)},${Math.round(_.y*n)},${Math.round(_.z*n)}`,v[2]=`${Math.round(w.x*n)},${Math.round(w.y*n)},${Math.round(w.z*n)}`,v[0]!==v[1]&&v[1]!==v[2]&&v[2]!==v[0])for(let e=0;e<3;e++){var c=(e+1)%3,u=v[e],h=v[c],d=cl[l[e]],p=cl[l[c]],f=`${u}_${h}`,u=`${h}_${u}`;u in y&&y[u]?(ll.dot(y[u].normal)<=r&&(x.push(d.x,d.y,d.z),x.push(p.x,p.y,p.z)),y[u]=null):f in y||(y[f]={index0:g[e],index1:g[c],normal:ll.clone()})}}for(const M in y)y[M]&&({index0:a,index1:o}=y[M],al.fromBufferAttribute(i,a),ol.fromBufferAttribute(i,o),x.push(al.x,al.y,al.z),x.push(ol.x,ol.y,ol.z));this.setAttribute("position",new br(x,3))}else console.error("THREE.EdgesGeometry no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}class hl{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){e=this.getUtoTmapping(e);return this.getPoint(e,t)}getPoints(t=5){const n=[];for(let e=0;e<=t;e++)n.push(this.getPoint(e/t));return n}getSpacedPoints(t=5){const n=[];for(let e=0;e<=t;e++)n.push(this.getPointAt(e/t));return n}getLength(){var e=this.getLengths();return e[e.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const n=[];let r,i=this.getPoint(0),s=0;n.push(0);for(let e=1;e<=t;e++)r=this.getPoint(e/t),s+=r.distanceTo(i),n.push(s),i=r;return this.cacheArcLengths=n,n}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){var n=this.getLengths();let r=0;var i=n.length;let s;s=t||e*n[i-1];let a=0,o=i-1,l;for(;a<=o;)if(r=Math.floor(a+(o-a)/2),(l=n[r]-s)<0)a=r+1;else{if(!(0<l)){o=r;break}o=r-1}if(r=o,n[r]===s)return r/(i-1);t=n[r],e=n[r+1],t=(s-t)/(e-t);return(r+t)/(i-1)}getTangent(e,t){let n=e-1e-4,r=e+1e-4;n<0&&(n=0),1<r&&(r=1);var i=this.getPoint(n),e=this.getPoint(r);const s=t||new(i.isVector2?Nt:Wt);return s.copy(e).sub(i).normalize(),s}getTangentAt(e,t){e=this.getUtoTmapping(e);return this.getTangent(e,t)}computeFrenetFrames(n,e){const t=new Wt,r=[],i=[],s=[],a=new Wt,o=new wn;for(let e=0;e<=n;e++){var l=e/n;r[e]=this.getTangentAt(l,new Wt),r[e].normalize()}i[0]=new Wt,s[0]=new Wt;let c=Number.MAX_VALUE;var u,h=Math.abs(r[0].x),d=Math.abs(r[0].y),p=Math.abs(r[0].z);h<=c&&(c=h,t.set(1,0,0)),d<=c&&(c=d,t.set(0,1,0)),p<=c&&t.set(0,0,1),a.crossVectors(r[0],t).normalize(),i[0].crossVectors(r[0],a),s[0].crossVectors(r[0],i[0]);for(let e=1;e<=n;e++)i[e]=i[e-1].clone(),s[e]=s[e-1].clone(),a.crossVectors(r[e-1],r[e]),a.length()>Number.EPSILON&&(a.normalize(),u=Math.acos(Tt(r[e-1].dot(r[e]),-1,1)),i[e].applyMatrix4(o.makeRotationAxis(a,u))),s[e].crossVectors(r[e],i[e]);if(!0===e){let t=Math.acos(Tt(i[0].dot(i[n]),-1,1));t/=n,0<r[0].dot(a.crossVectors(i[0],i[n]))&&(t=-t);for(let e=1;e<=n;e++)i[e].applyMatrix4(o.makeRotationAxis(r[e],t*e)),s[e].crossVectors(r[e],i[e])}return{tangents:r,normals:i,binormals:s}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class dl extends hl{constructor(e=0,t=0,n=1,r=1,i=0,s=2*Math.PI,a=!1,o=0){super(),this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=r,this.aStartAngle=i,this.aEndAngle=s,this.aClockwise=a,this.aRotation=o}getPoint(e,t){const n=t||new Nt;var r=2*Math.PI;let i=this.aEndAngle-this.aStartAngle;for(var s=Math.abs(i)<Number.EPSILON;i<0;)i+=r;for(;i>r;)i-=r;i<Number.EPSILON&&(i=s?0:r),!0!==this.aClockwise||s||(i===r?i=-r:i-=r);var a=this.aStartAngle+e*i;let o=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);return 0!==this.aRotation&&(t=Math.cos(this.aRotation),s=Math.sin(this.aRotation),e=o-this.aX,a=l-this.aY,o=e*t-a*s+this.aX,l=e*s+a*t+this.aY),n.set(o,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}dl.prototype.isEllipseCurve=!0;class pl extends dl{constructor(e,t,n,r,i,s){super(e,t,n,n,r,i,s),this.type="ArcCurve"}}function fl(){let i=0,s=0,a=0,o=0;function l(e,t,n,r){i=e,s=n,a=-3*e+3*t-2*n-r,o=2*e-2*t+n+r}return{initCatmullRom:function(e,t,n,r,i){l(t,n,i*(n-e),i*(r-t))},initNonuniformCatmullRom:function(e,t,n,r,i,s,a){i=(t-e)/i-(n-e)/(i+s)+(n-t)/s,a=(n-t)/s-(r-t)/(s+a)+(r-n)/a;l(t,n,i*=s,a*=s)},calc:function(e){var t=e*e,n=t*e;return i+s*e+a*t+o*n}}}pl.prototype.isArcCurve=!0;const ml=new Wt,gl=new fl,vl=new fl,yl=new fl;class xl extends hl{constructor(e=[],t=!1,n="centripetal",r=.5){super(),this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=r}getPoint(e,r=new Wt){const t=r;var n=this.points,r=n.length,e=(r-(this.closed?0:1))*e;let i=Math.floor(e),s=e-i;this.closed?i+=0<i?0:(Math.floor(Math.abs(i)/r)+1)*r:0===s&&i===r-1&&(i=r-2,s=1);let a,o;a=this.closed||0<i?n[(i-1)%r]:(ml.subVectors(n[0],n[1]).add(n[0]),ml);const l=n[i%r],c=n[(i+1)%r];if(o=this.closed||i+2<r?n[(i+2)%r]:(ml.subVectors(n[r-1],n[r-2]).add(n[r-1]),ml),"centripetal"===this.curveType||"chordal"===this.curveType){r="chordal"===this.curveType?.5:.25;let e=Math.pow(a.distanceToSquared(l),r),t=Math.pow(l.distanceToSquared(c),r),n=Math.pow(c.distanceToSquared(o),r);t<1e-4&&(t=1),e<1e-4&&(e=t),n<1e-4&&(n=t),gl.initNonuniformCatmullRom(a.x,l.x,c.x,o.x,e,t,n),vl.initNonuniformCatmullRom(a.y,l.y,c.y,o.y,e,t,n),yl.initNonuniformCatmullRom(a.z,l.z,c.z,o.z,e,t,n)}else"catmullrom"===this.curveType&&(gl.initCatmullRom(a.x,l.x,c.x,o.x,this.tension),vl.initCatmullRom(a.y,l.y,c.y,o.y,this.tension),yl.initCatmullRom(a.z,l.z,c.z,o.z,this.tension));return t.set(gl.calc(s),vl.calc(s),yl.calc(s)),t}copy(n){super.copy(n),this.points=[];for(let e=0,t=n.points.length;e<t;e++){const r=n.points[e];this.points.push(r.clone())}return this.closed=n.closed,this.curveType=n.curveType,this.tension=n.tension,this}toJSON(){const n=super.toJSON();n.points=[];for(let e=0,t=this.points.length;e<t;e++){const r=this.points[e];n.points.push(r.toArray())}return n.closed=this.closed,n.curveType=this.curveType,n.tension=this.tension,n}fromJSON(n){super.fromJSON(n),this.points=[];for(let e=0,t=n.points.length;e<t;e++){var r=n.points[e];this.points.push((new Wt).fromArray(r))}return this.closed=n.closed,this.curveType=n.curveType,this.tension=n.tension,this}}function bl(e,t,n,r,i){var s=.5*(r-t),t=.5*(i-n),i=e*e;return(2*n-2*r+s+t)*(e*i)+(-3*n+3*r-2*s-t)*i+s*e+n}function _l(e,t,n,r){return(i=1-(i=e))*i*t+2*(1-e)*e*n+e*e*r;var i}function wl(e,t,n,r,i){return(s=1-(s=e))*s*s*t+3*(t=1-e)*t*e*n+3*(1-e)*e*e*r+e*e*e*i;var s}class Ml extends hl{constructor(e=new Nt,t=new Nt,n=new Nt,r=new Nt){super(),this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=r}getPoint(e,t=new Nt){const n=t;var r=this.v0,i=this.v1,s=this.v2,t=this.v3;return n.set(wl(e,r.x,i.x,s.x,t.x),wl(e,r.y,i.y,s.y,t.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}Ml.prototype.isCubicBezierCurve=xl.prototype.isCatmullRomCurve3=!0;class Sl extends hl{constructor(e=new Wt,t=new Wt,n=new Wt,r=new Wt){super(),this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=r}getPoint(e,t=new Wt){const n=t;var r=this.v0,i=this.v1,s=this.v2,t=this.v3;return n.set(wl(e,r.x,i.x,s.x,t.x),wl(e,r.y,i.y,s.y,t.y),wl(e,r.z,i.z,s.z,t.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class El extends hl{constructor(e=new Nt,t=new Nt){super(),this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new Nt){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){const n=t||new Nt;return n.copy(this.v2).sub(this.v1).normalize(),n}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}El.prototype.isLineCurve=Sl.prototype.isCubicBezierCurve3=!0;hl;class Tl extends hl{constructor(e=new Nt,t=new Nt,n=new Nt){super(),this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new Nt){const n=t;var r=this.v0,i=this.v1,t=this.v2;return n.set(_l(e,r.x,i.x,t.x),_l(e,r.y,i.y,t.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}Tl.prototype.isQuadraticBezierCurve=!0;class Cl extends hl{constructor(e=new Wt,t=new Wt,n=new Wt){super(),this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new Wt){const n=t;var r=this.v0,i=this.v1,t=this.v2;return n.set(_l(e,r.x,i.x,t.x),_l(e,r.y,i.y,t.y),_l(e,r.z,i.z,t.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Ll extends hl{constructor(e=[]){super(),this.type="SplineCurve",this.points=e}getPoint(e,t=new Nt){const n=t;var r=this.points,i=(r.length-1)*e,s=Math.floor(i),a=i-s,t=r[0===s?s:s-1],e=r[s],i=r[s>r.length-2?r.length-1:s+1],s=r[s>r.length-3?r.length-1:s+2];return n.set(bl(a,t.x,e.x,i.x,s.x),bl(a,t.y,e.y,i.y,s.y)),n}copy(n){super.copy(n),this.points=[];for(let e=0,t=n.points.length;e<t;e++){const r=n.points[e];this.points.push(r.clone())}return this}toJSON(){const n=super.toJSON();n.points=[];for(let e=0,t=this.points.length;e<t;e++){const r=this.points[e];n.points.push(r.toArray())}return n}fromJSON(n){super.fromJSON(n),this.points=[];for(let e=0,t=n.points.length;e<t;e++){var r=n.points[e];this.points.push((new Nt).fromArray(r))}return this}}Ll.prototype.isSplineCurve=Cl.prototype.isQuadraticBezierCurve3=!0;var Al=Object.freeze({__proto__:null,ArcCurve:pl,CatmullRomCurve3:xl,CubicBezierCurve:Ml,CubicBezierCurve3:Sl,EllipseCurve:dl,LineCurve:El,LineCurve3:class extends hl{constructor(e=new Wt,t=new Wt){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=e,this.v2=t}getPoint(e,t=new Wt){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},QuadraticBezierCurve:Tl,QuadraticBezierCurve3:Cl,SplineCurve:Ll});const Pl={triangulate:function(t,e,n=2){var r=e&&e.length,i=r?e[0]*n:t.length;let s=Rl(t,0,i,n,!0);var a=[];if(!s||s.next===s.prev)return a;let o,l,c,u,h,d,p;if(r&&(s=function(e,t,n,r){const i=[];let s,a,o,l,c;for(s=0,a=t.length;s<a;s++)o=t[s]*r,l=s<a-1?t[s+1]*r:e.length,c=Rl(e,o,l,r,!1),c===c.next&&(c.steiner=!0),i.push(function(e){let t=e,n=e;for(;(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next,t!==e;);return n}(c));for(i.sort(Il),s=0;s<i.length;s++)!function(e,t){(t=function(e,t){let n=t;var r=e.x,i=e.y;let s=-1/0,a;do{if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){var o=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(o<=r&&o>s){if((s=o)===r){if(i===n.y)return n;if(i===n.next.y)return n.next}a=n.x<n.next.x?n:n.next}}}while(n=n.next,n!==t);if(!a)return null;if(r===s)return a;var l=a,c=a.x,u=a.y;let h=1/0,d;n=a;for(;r>=n.x&&n.x>=c&&r!==n.x&&Ol(i<u?r:s,i,c,u,i<u?s:r,i,n.x,n.y)&&(d=Math.abs(i-n.y)/(r-n.x),Bl(n,e)&&(d<h||d===h&&(n.x>a.x||n.x===a.x&&function(e,t){return zl(e.prev,e,t.prev)<0&&zl(t.next,e,e.next)<0}(a,n)))&&(a=n,h=d)),n=n.next,n!==l;);return a}(e,t))&&(e=Gl(t,e),Dl(t,t.next),Dl(e,e.next))}(i[s],n),n=Dl(n,n.next);return n}(t,e,s,n)),t.length>80*n){o=c=t[0],l=u=t[1];for(let e=n;e<i;e+=n)h=t[e],d=t[e+1],h<o&&(o=h),d<l&&(l=d),h>c&&(c=h),d>u&&(u=d);p=Math.max(c-o,u-l),p=0!==p?1/p:0}return Nl(s,a,n,o,l,p),a}};function Rl(e,t,n,r,i){let s,a;if(i===0<function(n,r,i,s){let a=0;for(let e=r,t=i-s;e<i;e+=s)a+=(n[t]-n[e])*(n[e+1]+n[t+1]),t=e;return a}(e,t,n,r))for(s=t;s<n;s+=r)a=Wl(s,e[s],e[s+1],a);else for(s=n-r;s>=t;s-=r)a=Wl(s,e[s],e[s+1],a);return a&&Ul(a,a.next)&&(jl(a),a=a.next),a}function Dl(e,t){if(!e)return e;t=t||e;let n=e,r;do{if(r=!1,n.steiner||!Ul(n,n.next)&&0!==zl(n.prev,n,n.next))n=n.next;else{if(jl(n),n=t=n.prev,n===n.next)break;r=!0}}while(r||n!==t);return t}function Nl(r,i,s,a,o,l,c){if(r){!c&&l&&function(e,t,n,r){let i=e;for(;null===i.z&&(i.z=kl(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next,i!==e;);i.prevZ.nextZ=null,i.prevZ=null,function(e){let t,n,r,i,s,a,o,l,c=1;do{for(n=e,e=null,s=null,a=0;n;){for(a++,r=n,o=0,t=0;t<c&&(o++,r=r.nextZ,r);t++);for(l=c;0<o||0<l&&r;)0!==o&&(0===l||!r||n.z<=r.z)?(i=n,n=n.nextZ,o--):(i=r,r=r.nextZ,l--),s?s.nextZ=i:e=i,i.prevZ=s,s=i;n=r}}while(s.nextZ=null,c*=2,1<a)}(i)}(r,a,o,l);let e=r,t,n;for(;r.prev!==r.next;)if(t=r.prev,n=r.next,l?function(e,t,n,r){var i=e.prev,s=e,a=e.next;if(0<=zl(i,s,a))return!1;var o=(i.x<s.x?i.x<a.x?i:a:s.x<a.x?s:a).x,l=(i.y<s.y?i.y<a.y?i:a:s.y<a.y?s:a).y,c=(i.x>s.x?i.x>a.x?i:a:s.x>a.x?s:a).x,u=(i.y>s.y?i.y>a.y?i:a:s.y>a.y?s:a).y,h=kl(o,l,t,n,r),d=kl(c,u,t,n,r);let p=e.prevZ,f=e.nextZ;for(;p&&p.z>=h&&f&&f.z<=d;){if(p!==e.prev&&p!==e.next&&Ol(i.x,i.y,s.x,s.y,a.x,a.y,p.x,p.y)&&0<=zl(p.prev,p,p.next))return!1;if(p=p.prevZ,f!==e.prev&&f!==e.next&&Ol(i.x,i.y,s.x,s.y,a.x,a.y,f.x,f.y)&&0<=zl(f.prev,f,f.next))return!1;f=f.nextZ}for(;p&&p.z>=h;){if(p!==e.prev&&p!==e.next&&Ol(i.x,i.y,s.x,s.y,a.x,a.y,p.x,p.y)&&0<=zl(p.prev,p,p.next))return!1;p=p.prevZ}for(;f&&f.z<=d;){if(f!==e.prev&&f!==e.next&&Ol(i.x,i.y,s.x,s.y,a.x,a.y,f.x,f.y)&&0<=zl(f.prev,f,f.next))return!1;f=f.nextZ}return!0}(r,a,o,l):function(e){var t=e.prev,n=e,r=e.next;if(0<=zl(t,n,r))return!1;let i=e.next.next;for(;i!==e.prev;){if(Ol(t.x,t.y,n.x,n.y,r.x,r.y,i.x,i.y)&&0<=zl(i.prev,i,i.next))return!1;i=i.next}return!0}(r))i.push(t.i/s),i.push(r.i/s),i.push(n.i/s),jl(r),r=n.next,e=n.next;else if((r=n)===e){c?1===c?Nl(r=function(e,t,n){let r=e;do{var i=r.prev,s=r.next.next;!Ul(i,s)&&Vl(i,r,r.next,s)&&Bl(i,s)&&Bl(s,i)&&(t.push(i.i/n),t.push(r.i/n),t.push(s.i/n),jl(r),jl(r.next),r=e=s),r=r.next}while(r!==e);return Dl(r)}(Dl(r),i,s),i,s,a,o,l,2):2===c&&function(e,t,n,r,i,s){let a=e;do{let e=a.next.next;for(;e!==a.prev;){if(a.i!==e.i&&function(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&Vl(n,n.next,e,t))return!0}while(n=n.next,n!==e);return!1}(e,t)&&(Bl(e,t)&&Bl(t,e)&&function(e,t){let n=e,r=!1;var i=(e.x+t.x)/2,s=(e.y+t.y)/2;for(;n.y>s!=n.next.y>s&&n.next.y!==n.y&&i<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next,n!==e;);return r}(e,t)&&(zl(e.prev,e,t.prev)||zl(e,t.prev,t))||Ul(e,t)&&0<zl(e.prev,e,e.next)&&0<zl(t.prev,t,t.next))}(a,e)){var o=Gl(a,e);return a=Dl(a,a.next),o=Dl(o,o.next),Nl(a,t,n,r,i,s),Nl(o,t,n,r,i,s)}e=e.next}}while(a=a.next,a!==e)}(r,i,s,a,o,l):Nl(Dl(r),i,s,a,o,l,1);break}}}function Il(e,t){return e.x-t.x}function kl(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Ol(e,t,n,r,i,s,a,o){return 0<=(i-a)*(t-o)-(e-a)*(s-o)&&0<=(e-a)*(r-o)-(n-a)*(t-o)&&0<=(n-a)*(s-o)-(i-a)*(r-o)}function zl(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function Ul(e,t){return e.x===t.x&&e.y===t.y}function Vl(e,t,n,r){var i=Hl(zl(e,t,n)),s=Hl(zl(e,t,r)),a=Hl(zl(n,r,e)),o=Hl(zl(n,r,t));return i!==s&&a!==o||(0===i&&Fl(e,n,t)||(0===s&&Fl(e,r,t)||(0===a&&Fl(n,e,r)||!(0!==o||!Fl(n,t,r)))))}function Fl(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function Hl(e){return 0<e?1:e<0?-1:0}function Bl(e,t){return zl(e.prev,e,e.next)<0?0<=zl(e,t,e.next)&&0<=zl(e,e.prev,t):zl(e,t,e.prev)<0||zl(e,e.next,t)<0}function Gl(e,t){const n=new ql(e.i,e.x,e.y),r=new ql(t.i,t.x,t.y),i=e.next,s=t.prev;return(e.next=t).prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,s.next=r,r.prev=s,r}function Wl(e,t,n,r){const i=new ql(e,t,n);return r?(i.next=r.next,(i.prev=r).next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function jl(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function ql(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class Xl{static area(n){var r=n.length;let i=0;for(let e=r-1,t=0;t<r;e=t++)i+=n[e].x*n[t].y-n[t].x*n[e].y;return.5*i}static isClockWise(e){return Xl.area(e)<0}static triangulateShape(e,t){var n=[];const r=[],i=[];Yl(e),Kl(n,e);let s=e.length;t.forEach(Yl);for(let e=0;e<t.length;e++)r.push(s),s+=t[e].length,Kl(n,t[e]);const a=Pl.triangulate(n,r);for(let e=0;e<a.length;e+=3)i.push(a.slice(e,e+3));return i}}function Yl(e){var t=e.length;2<t&&e[t-1].equals(e[0])&&e.pop()}function Kl(t,n){for(let e=0;e<n.length;e++)t.push(n[e].x),t.push(n[e].y)}class Jl extends Ar{constructor(n,$){super(),this.type="ExtrudeGeometry",this.parameters={shapes:n,options:$},n=Array.isArray(n)?n:[n];const Q=this,ee=[],te=[];for(let e=0,t=n.length;e<t;e++)!function(e){const r=[],t=void 0!==$.curveSegments?$.curveSegments:12,o=void 0!==$.steps?$.steps:1;let n=void 0!==$.depth?$.depth:100,a=void 0===$.bevelEnabled||$.bevelEnabled,i=void 0!==$.bevelThickness?$.bevelThickness:6,s=void 0!==$.bevelSize?$.bevelSize:i-2,l=void 0!==$.bevelOffset?$.bevelOffset:0,c=void 0!==$.bevelSegments?$.bevelSegments:3;const u=$.extrudePath,h=void 0!==$.UVGenerator?$.UVGenerator:Zl;void 0!==$.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),n=$.amount);let d,p=!1,f,m,g,v;u&&(d=u.getSpacedPoints(o),p=!0,a=!1,f=u.computeFrenetFrames(o,!1),m=new Wt,g=new Wt,v=new Wt);a||(c=0,i=0,s=0,l=0);e=e.extractPoints(t);let y=e.shape;const x=e.holes,b=!Xl.isClockWise(y);if(b){y=y.reverse();for(let e=0,t=x.length;e<t;e++){const Z=x[e];Xl.isClockWise(Z)&&(x[e]=Z.reverse())}}const _=Xl.triangulateShape(y,x),w=y;for(let e=0,t=x.length;e<t;e++){var M=x[e];y=y.concat(M)}function S(e,t,n){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(n).add(e)}const E=y.length,T=_.length;function C(e,t,n){let r,i,s;var a=e.x-t.x,o=e.y-t.y,l=n.x-e.x,c=n.y-e.y,u=a*a+o*o;if(Math.abs(a*c-o*l)>Number.EPSILON){var h=Math.sqrt(u),d=Math.sqrt(l*l+c*c),p=t.x-o/h,h=t.y+a/h,d=((n.x-c/d-p)*c-(n.y+l/d-h)*l)/(a*c-o*l);r=p+a*d-e.x,i=h+o*d-e.y;e=r*r+i*i;if(e<=2)return new Nt(r,i);s=Math.sqrt(e/2)}else{let e=!1;a>Number.EPSILON?l>Number.EPSILON&&(e=!0):a<-Number.EPSILON?l<-Number.EPSILON&&(e=!0):Math.sign(o)===Math.sign(c)&&(e=!0),s=e?(r=-o,i=a,Math.sqrt(u)):(r=a,i=o,Math.sqrt(u/2))}return new Nt(r/s,i/s)}const L=[];for(let e=0,t=w.length,n=t-1,r=e+1;e<t;e++,n++,r++)n===t&&(n=0),r===t&&(r=0),L[e]=C(w[e],w[n],w[r]);const A=[];let P,R=L.concat();for(let e=0,t=x.length;e<t;e++){var D=x[e];P=[];for(let e=0,t=D.length,n=t-1,r=e+1;e<t;e++,n++,r++)n===t&&(n=0),r===t&&(r=0),P[e]=C(D[e],D[n],D[r]);A.push(P),R=R.concat(P)}for(let e=0;e<c;e++){var N=e/c,I=i*Math.cos(N*Math.PI/2);const U=s*Math.sin(N*Math.PI/2)+l;for(let e=0,t=w.length;e<t;e++){var k=S(w[e],L[e],U);X(k.x,k.y,-I)}for(let e=0,t=x.length;e<t;e++){var O=x[e];P=A[e];for(let e=0,t=O.length;e<t;e++){var z=S(O[e],P[e],U);X(z.x,z.y,-I)}}}const U=s+l;for(let e=0;e<E;e++){var V=a?S(y[e],R[e],U):y[e];p?(g.copy(f.normals[0]).multiplyScalar(V.x),m.copy(f.binormals[0]).multiplyScalar(V.y),v.copy(d[0]).add(g).add(m),X(v.x,v.y,v.z)):X(V.x,V.y,0)}for(let t=1;t<=o;t++)for(let e=0;e<E;e++){var F=a?S(y[e],R[e],U):y[e];p?(g.copy(f.normals[t]).multiplyScalar(F.x),m.copy(f.binormals[t]).multiplyScalar(F.y),v.copy(d[t]).add(g).add(m),X(v.x,v.y,v.z)):X(F.x,F.y,n/o*t)}for(let e=c-1;0<=e;e--){var H=e/c,B=i*Math.cos(H*Math.PI/2);const U=s*Math.sin(H*Math.PI/2)+l;for(let e=0,t=w.length;e<t;e++){var G=S(w[e],L[e],U);X(G.x,G.y,n+B)}for(let e=0,t=x.length;e<t;e++){var W=x[e];P=A[e];for(let e=0,t=W.length;e<t;e++){var j=S(W[e],P[e],U);p?X(j.x,j.y+d[o-1].y,d[o-1].x+B):X(j.x,j.y,n+B)}}}function q(e,r){let t=e.length;for(;0<=--t;){var i=t;let n=t-1;n<0&&(n=e.length-1);for(let e=0,t=o+2*c;e<t;e++){var s=E*e,a=E*(e+1);!function(e,t,n,r){K(e),K(t),K(r),K(t),K(n),K(r);r=ee.length/3,r=h.generateSideWallUV(Q,ee,r-6,r-3,r-2,r-1);J(r[0]),J(r[1]),J(r[3]),J(r[1]),J(r[2]),J(r[3])}(r+i+s,r+n+s,r+n+a,r+i+a)}}}function X(e,t,n){r.push(e),r.push(t),r.push(n)}function Y(e,t,n){K(e),K(t),K(n);n=ee.length/3,n=h.generateTopUV(Q,ee,n-3,n-2,n-1);J(n[0]),J(n[1]),J(n[2])}function K(e){ee.push(r[3*e+0]),ee.push(r[3*e+1]),ee.push(r[3*e+2])}function J(e){te.push(e.x),te.push(e.y)}(function(){var e,t=ee.length/3;if(a){let t=0*E;for(let e=0;e<T;e++){var n=_[e];Y(n[2]+t,n[1]+t,n[0]+t)}e=o+2*c,t=E*e;for(let e=0;e<T;e++){var r=_[e];Y(r[0]+t,r[1]+t,r[2]+t)}}else{for(let e=0;e<T;e++){var i=_[e];Y(i[2],i[1],i[0])}for(let e=0;e<T;e++){var s=_[e];Y(s[0]+E*o,s[1]+E*o,s[2]+E*o)}}Q.addGroup(t,ee.length/3-t,0)})(),function(){var e=ee.length/3;let n=0;q(w,n),n+=w.length;for(let e=0,t=x.length;e<t;e++){var r=x[e];q(r,n),n+=r.length}Q.addGroup(e,ee.length/3-e,1)}()}(n[e]);this.setAttribute("position",new br(ee,3)),this.setAttribute("uv",new br(te,2)),this.computeVertexNormals()}toJSON(){var e=super.toJSON();return function(n,e,r){if(r.shapes=[],Array.isArray(n))for(let e=0,t=n.length;e<t;e++){var i=n[e];r.shapes.push(i.uuid)}else r.shapes.push(n.uuid);void 0!==e.extrudePath&&(r.options.extrudePath=e.extrudePath.toJSON());return r}(this.parameters.shapes,this.parameters.options,e)}static fromJSON(n,r){const i=[];for(let e=0,t=n.shapes.length;e<t;e++){var s=r[n.shapes[e]];i.push(s)}var e=n.options.extrudePath;return void 0!==e&&(n.options.extrudePath=(new Al[e.type]).fromJSON(e)),new Jl(i,n.options)}}const Zl={generateTopUV:function(e,t,n,r,i){var s=t[3*n],a=t[3*n+1],o=t[3*r],n=t[3*r+1],r=t[3*i],i=t[3*i+1];return[new Nt(s,a),new Nt(o,n),new Nt(r,i)]},generateSideWallUV:function(e,t,n,r,i,s){var a=t[3*n],o=t[3*n+1],l=t[3*n+2],c=t[3*r],u=t[3*r+1],h=t[3*r+2],d=t[3*i],p=t[3*i+1],n=t[3*i+2],r=t[3*s],i=t[3*s+1],s=t[3*s+2];return Math.abs(o-u)<Math.abs(a-c)?[new Nt(a,1-l),new Nt(c,1-h),new Nt(d,1-n),new Nt(r,1-s)]:[new Nt(o,1-l),new Nt(u,1-h),new Nt(p,1-n),new Nt(i,1-s)]}};class $l extends il{constructor(e=1,t=0){var n=(1+Math.sqrt(5))/2;super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new $l(e.radius,e.detail)}}class Ql extends Ar{constructor(n,r=12,e=0,i=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:n,segments:r,phiStart:e,phiLength:i},r=Math.floor(r),i=Tt(i,0,2*Math.PI);const s=[],a=[],o=[];var l=1/r;const c=new Wt,u=new Nt;for(let t=0;t<=r;t++){var h=e+t*l*i,d=Math.sin(h),p=Math.cos(h);for(let e=0;e<=n.length-1;e++)c.x=n[e].x*d,c.y=n[e].y,c.z=n[e].x*p,a.push(c.x,c.y,c.z),u.x=t/r,u.y=e/(n.length-1),o.push(u.x,u.y)}for(let t=0;t<r;t++)for(let e=0;e<n.length-1;e++){var f=e+t*n.length,m=f+n.length,g=f+n.length+1,v=f+1;s.push(f,m,v),s.push(m,g,v)}if(this.setIndex(s),this.setAttribute("position",new br(a,3)),this.setAttribute("uv",new br(o,2)),this.computeVertexNormals(),i===2*Math.PI){const x=this.attributes.normal.array,b=new Wt,_=new Wt,w=new Wt;var y=r*n.length*3;for(let e=0,t=0;e<n.length;e++,t+=3)b.x=x[t+0],b.y=x[t+1],b.z=x[t+2],_.x=x[y+t+0],_.y=x[y+t+1],_.z=x[y+t+2],w.addVectors(b,_).normalize(),x[t+0]=x[y+t+0]=w.x,x[t+1]=x[y+t+1]=w.y,x[t+2]=x[y+t+2]=w.z}}static fromJSON(e){return new Ql(e.points,e.segments,e.phiStart,e.phiLength)}}class ec extends il{constructor(e=1,t=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new ec(e.radius,e.detail)}}class tc extends Ar{constructor(t,n,r){super(),this.type="ParametricGeometry",this.parameters={func:t,slices:n,stacks:r};const i=[],s=[],a=[],o=[];const l=new Wt;var c=new Wt,u=new Wt;const h=new Wt,d=new Wt;t.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");var p=n+1;for(let e=0;e<=r;e++){var f=e/r;for(let e=0;e<=n;e++){var m=e/n;t(m,f,c),s.push(c.x,c.y,c.z),0<=m-1e-5?(t(m-1e-5,f,u),h.subVectors(c,u)):(t(1e-5+m,f,u),h.subVectors(u,c)),0<=f-1e-5?(t(m,f-1e-5,u),d.subVectors(c,u)):(t(m,1e-5+f,u),d.subVectors(u,c)),l.crossVectors(h,d).normalize(),a.push(l.x,l.y,l.z),o.push(m,f)}}for(let t=0;t<r;t++)for(let e=0;e<n;e++){var g=t*p+e,v=t*p+e+1,y=(t+1)*p+e+1,x=(t+1)*p+e;i.push(g,v,x),i.push(v,y,x)}this.setIndex(i),this.setAttribute("position",new br(s,3)),this.setAttribute("normal",new br(a,3)),this.setAttribute("uv",new br(o,2))}}class nc extends Ar{constructor(e=.5,t=1,n=8,r=1,i=0,s=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:r,thetaStart:i,thetaLength:s},n=Math.max(3,n);const a=[],o=[],l=[],c=[];let u=e;var h=(t-e)/(r=Math.max(1,r));const d=new Wt,p=new Nt;for(let e=0;e<=r;e++){for(let e=0;e<=n;e++){var f=i+e/n*s;d.x=u*Math.cos(f),d.y=u*Math.sin(f),o.push(d.x,d.y,d.z),l.push(0,0,1),p.x=(d.x/t+1)/2,p.y=(d.y/t+1)/2,c.push(p.x,p.y)}u+=h}for(let e=0;e<r;e++){var m=e*(n+1);for(let e=0;e<n;e++){var g=e+m,v=g+n+1,y=g+n+2,x=g+1;a.push(g,v,x),a.push(v,y,x)}}this.setIndex(a),this.setAttribute("position",new br(o,3)),this.setAttribute("normal",new br(l,3)),this.setAttribute("uv",new br(c,2))}static fromJSON(e){return new nc(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class rc extends Ar{constructor(t,d=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:d};const p=[],f=[],m=[],g=[];let n=0,v=0;if(!1===Array.isArray(t))r(t);else for(let e=0;e<t.length;e++)r(t[e]),this.addGroup(n,v,e),n+=v,v=0;function r(e){var n=f.length/3,e=e.extractPoints(d);let r=e.shape;const i=e.holes;!1===Xl.isClockWise(r)&&(r=r.reverse());for(let e=0,t=i.length;e<t;e++){const h=i[e];!0===Xl.isClockWise(h)&&(i[e]=h.reverse())}var s=Xl.triangulateShape(r,i);for(let e=0,t=i.length;e<t;e++){var a=i[e];r=r.concat(a)}for(let e=0,t=r.length;e<t;e++){var o=r[e];f.push(o.x,o.y,0),m.push(0,0,1),g.push(o.x,o.y)}for(let e=0,t=s.length;e<t;e++){var l=s[e],c=l[0]+n,u=l[1]+n,l=l[2]+n;p.push(c,u,l),v+=3}}this.setIndex(p),this.setAttribute("position",new br(f,3)),this.setAttribute("normal",new br(m,3)),this.setAttribute("uv",new br(g,2))}toJSON(){var e=super.toJSON();return function(n,r){if(r.shapes=[],Array.isArray(n))for(let e=0,t=n.length;e<t;e++){var i=n[e];r.shapes.push(i.uuid)}else r.shapes.push(n.uuid);return r}(this.parameters.shapes,e)}static fromJSON(n,r){const i=[];for(let e=0,t=n.shapes.length;e<t;e++){var s=r[n.shapes[e]];i.push(s)}return new rc(i,n.curveSegments)}}class ic extends Ar{constructor(n=1,r=32,i=16,s=0,a=2*Math.PI,o=0,l=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:n,widthSegments:r,heightSegments:i,phiStart:s,phiLength:a,thetaStart:o,thetaLength:l},r=Math.max(3,Math.floor(r)),i=Math.max(2,Math.floor(i));var c=Math.min(o+l,Math.PI);let u=0;const h=[],d=new Wt,p=new Wt,f=[],m=[],g=[],v=[];for(let e=0;e<=i;e++){const S=[];var y=e/i;let t=0;0==e&&0==o?t=.5/r:e==i&&c==Math.PI&&(t=-.5/r);for(let e=0;e<=r;e++){var x=e/r;d.x=-n*Math.cos(s+x*a)*Math.sin(o+y*l),d.y=n*Math.cos(o+y*l),d.z=n*Math.sin(s+x*a)*Math.sin(o+y*l),m.push(d.x,d.y,d.z),p.copy(d).normalize(),g.push(p.x,p.y,p.z),v.push(x+t,1-y),S.push(u++)}h.push(S)}for(let t=0;t<i;t++)for(let e=0;e<r;e++){var b=h[t][e+1],_=h[t][e],w=h[t+1][e],M=h[t+1][e+1];(0!==t||0<o)&&f.push(b,_,M),(t!==i-1||c<Math.PI)&&f.push(_,w,M)}this.setIndex(f),this.setAttribute("position",new br(m,3)),this.setAttribute("normal",new br(g,3)),this.setAttribute("uv",new br(v,2))}static fromJSON(e){return new ic(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class sc extends il{constructor(e=1,t=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new sc(e.radius,e.detail)}}class ac extends Jl{constructor(e,t={}){const n=t.font;if(!n||!n.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new Ar;e=n.generateShapes(e,t.size);t.depth=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),super(e,t),this.type="TextGeometry"}}class oc extends Ar{constructor(n=1,r=.4,i=8,s=6,a=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:n,tube:r,radialSegments:i,tubularSegments:s,arc:a},i=Math.floor(i),s=Math.floor(s);const o=[],l=[],c=[],u=[],h=new Wt,d=new Wt,p=new Wt;for(let t=0;t<=i;t++)for(let e=0;e<=s;e++){var f=e/s*a,m=t/i*Math.PI*2;d.x=(n+r*Math.cos(m))*Math.cos(f),d.y=(n+r*Math.cos(m))*Math.sin(f),d.z=r*Math.sin(m),l.push(d.x,d.y,d.z),h.x=n*Math.cos(f),h.y=n*Math.sin(f),p.subVectors(d,h).normalize(),c.push(p.x,p.y,p.z),u.push(e/s),u.push(t/i)}for(let t=1;t<=i;t++)for(let e=1;e<=s;e++){var g=(s+1)*t+e-1,v=(s+1)*(t-1)+e-1,y=(s+1)*(t-1)+e,x=(s+1)*t+e;o.push(g,v,x),o.push(v,y,x)}this.setIndex(o),this.setAttribute("position",new br(l,3)),this.setAttribute("normal",new br(c,3)),this.setAttribute("uv",new br(u,2))}static fromJSON(e){return new oc(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class lc extends Ar{constructor(e=1,n=.4,r=64,i=8,s=2,a=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:n,tubularSegments:r,radialSegments:i,p:s,q:a},r=Math.floor(r),i=Math.floor(i);const o=[],l=[],c=[],u=[],h=new Wt,d=new Wt;var p=new Wt,f=new Wt;const m=new Wt,g=new Wt,v=new Wt;for(let t=0;t<=r;++t){var y=t/r*s*Math.PI*2;E(y,s,a,e,p),E(.01+y,s,a,e,f),g.subVectors(f,p),v.addVectors(f,p),m.crossVectors(g,v),v.crossVectors(m,g),m.normalize(),v.normalize();for(let e=0;e<=i;++e){var x=e/i*Math.PI*2,b=-n*Math.cos(x),x=n*Math.sin(x);h.x=p.x+(b*v.x+x*m.x),h.y=p.y+(b*v.y+x*m.y),h.z=p.z+(b*v.z+x*m.z),l.push(h.x,h.y,h.z),d.subVectors(h,p).normalize(),c.push(d.x,d.y,d.z),u.push(t/r),u.push(e/i)}}for(let t=1;t<=r;t++)for(let e=1;e<=i;e++){var _=(i+1)*(t-1)+(e-1),w=(i+1)*t+(e-1),M=(i+1)*t+e,S=(i+1)*(t-1)+e;o.push(_,w,S),o.push(w,M,S)}function E(e,t,n,r,i){var s=Math.cos(e),a=Math.sin(e),t=n/t*e,e=Math.cos(t);i.x=r*(2+e)*.5*s,i.y=r*(2+e)*a*.5,i.z=r*Math.sin(t)*.5}this.setIndex(o),this.setAttribute("position",new br(l,3)),this.setAttribute("normal",new br(c,3)),this.setAttribute("uv",new br(u,2))}static fromJSON(e){return new lc(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class cc extends Ar{constructor(s,a=64,o=1,l=8,e=!1){super(),this.type="TubeGeometry",this.parameters={path:s,tubularSegments:a,radius:o,radialSegments:l,closed:e};const c=s.computeFrenetFrames(a,e);this.tangents=c.tangents,this.normals=c.normals,this.binormals=c.binormals;const u=new Wt,h=new Wt,n=new Nt;let d=new Wt;const p=[],f=[],r=[],m=[];function t(e){d=s.getPointAt(e/a,d);var t=c.normals[e],n=c.binormals[e];for(let e=0;e<=l;e++){var r=e/l*Math.PI*2,i=Math.sin(r),r=-Math.cos(r);h.x=r*t.x+i*n.x,h.y=r*t.y+i*n.y,h.z=r*t.z+i*n.z,h.normalize(),f.push(h.x,h.y,h.z),u.x=d.x+o*h.x,u.y=d.y+o*h.y,u.z=d.z+o*h.z,p.push(u.x,u.y,u.z)}}!function(){for(let e=0;e<a;e++)t(e);t(!1===e?a:0),function(){for(let t=0;t<=a;t++)for(let e=0;e<=l;e++)n.x=t/a,n.y=e/l,r.push(n.x,n.y)}(),function(){for(let t=1;t<=a;t++)for(let e=1;e<=l;e++){var n=(l+1)*(t-1)+(e-1),r=(l+1)*t+(e-1),i=(l+1)*t+e,s=(l+1)*(t-1)+e;m.push(n,r,s),m.push(r,i,s)}}()}(),this.setIndex(m),this.setAttribute("position",new br(p,3)),this.setAttribute("normal",new br(f,3)),this.setAttribute("uv",new br(r,2))}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new cc((new Al[e.path.type]).fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class uc extends Ar{constructor(e){if(super(),this.type="WireframeGeometry",!0!==e.isGeometry){const h=[];var r=new Set;const d=new Wt,p=new Wt;if(null!==e.index){var i=e.attributes.position;const f=e.index;let n=e.groups;0===n.length&&(n=[{start:0,count:f.count,materialIndex:0}]);for(let e=0,t=n.length;e<t;++e){var s=n[e],a=s.start;for(let t=a,e=a+s.count;t<e;t+=3)for(let e=0;e<3;e++){var o=f.getX(t+e),l=f.getX(t+(e+1)%3);d.fromBufferAttribute(i,o),p.fromBufferAttribute(i,l),!0===hc(d,p,r)&&(h.push(d.x,d.y,d.z),h.push(p.x,p.y,p.z))}}}else{var n=e.attributes.position;for(let t=0,e=n.count/3;t<e;t++)for(let e=0;e<3;e++){var c=3*t+e,u=3*t+(e+1)%3;d.fromBufferAttribute(n,c),p.fromBufferAttribute(n,u),!0===hc(d,p,r)&&(h.push(d.x,d.y,d.z),h.push(p.x,p.y,p.z))}}this.setAttribute("position",new br(h,3))}else console.error("THREE.WireframeGeometry no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}function hc(e,t,n){var r=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`,e=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`;return!0!==n.has(r)&&!0!==n.has(e)&&(n.add(r,e),!0)}Kr,Kr,tl,tl,rl,rl,nl,nl,sl,sl,ul,Jl,Jl,$l,$l,Ql,Ql,ec,ec,fi,fi,il,il,nc,nc,rc,rc,ic,ic,sc,sc,oc,oc,lc,lc,cc,cc,uc;class dc extends ar{constructor(e){super(),this.type="ShadowMaterial",this.color=new pr(0),this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this}}class pc extends ar{constructor(e){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new pr(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new pr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=vt,this.normalScale=new Nt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}pc.prototype.isMeshStandardMaterial=dc.prototype.isShadowMaterial=!0;class fc extends pc{constructor(e){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Nt(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Tt(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.sheenTint=new pr(0),this.transmission=0,this.transmissionMap=null,this.thickness=.01,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationTint=new pr(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularTint=new pr(1,1,1),this.specularTintMap=null,this._clearcoat=0,this._transmission=0,this.setValues(e)}get clearcoat(){return this._clearcoat}set clearcoat(e){0<this._clearcoat!=0<e&&this.version++,this._clearcoat=e}get transmission(){return this._transmission}set transmission(e){0<this._transmission!=0<e&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.sheenTint.copy(e.sheenTint),this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationTint.copy(e.attenuationTint),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularTint.copy(e.specularTint),this.specularTintMap=e.specularTintMap,this}}fc.prototype.isMeshPhysicalMaterial=!0;class mc extends ar{constructor(e){super(),this.type="MeshPhongMaterial",this.color=new pr(16777215),this.specular=new pr(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new pr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=vt,this.normalScale=new Nt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}class gc extends ar{constructor(e){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new pr(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new pr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=vt,this.normalScale=new Nt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}class vc extends ar{constructor(e){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=vt,this.normalScale=new Nt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class yc extends ar{constructor(e){super(),this.type="MeshLambertMaterial",this.color=new pr(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new pr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}class xc extends ar{constructor(e){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new pr(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=vt,this.normalScale=new Nt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this}}class bc extends Oo{constructor(e){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}bc.prototype.isLineDashedMaterial=xc.prototype.isMeshMatcapMaterial=yc.prototype.isMeshLambertMaterial=vc.prototype.isMeshNormalMaterial=gc.prototype.isMeshToonMaterial=mc.prototype.isMeshPhongMaterial=!0;no,Ei,Qr,Xo,fc,pc,ka,Oa,fr,Oo,ar;const _c={arraySlice:function(e,t,n){return _c.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==n?n:e.length)):e.slice(t,n)},convertArray:function(e,t,n){return!e||!n&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(n){var t=n.length;const r=new Array(t);for(let e=0;e!==t;++e)r[e]=e;return r.sort(function(e,t){return n[e]-n[t]}),r},sortedArray:function(n,r,i){var s=n.length;const a=new n.constructor(s);for(let e=0,t=0;t!==s;++e){var o=i[e]*r;for(let e=0;e!==r;++e)a[t++]=n[o+e]}return a},flattenJSON:function(t,n,r,i){let s=1,a=t[0];for(;void 0!==a&&void 0===a[i];)a=t[s++];if(void 0!==a){let e=a[i];if(void 0!==e)if(Array.isArray(e))for(;e=a[i],void 0!==e&&(n.push(a.time),r.push.apply(r,e)),a=t[s++],void 0!==a;);else if(void 0!==e.toArray)for(;e=a[i],void 0!==e&&(n.push(a.time),e.toArray(r,r.length)),a=t[s++],void 0!==a;);else for(;e=a[i],void 0!==e&&(n.push(a.time),r.push(e)),a=t[s++],void 0!==a;);}},subclip:function(e,t,n,r,i=30){const s=e.clone();s.name=t;const a=[];for(let e=0;e<s.tracks.length;++e){const u=s.tracks[e];var o=u.getValueSize();const h=[],d=[];for(let t=0;t<u.times.length;++t){var l=u.times[t]*i;if(!(l<n||r<=l)){h.push(u.times[t]);for(let e=0;e<o;++e)d.push(u.values[t*o+e])}}0!==h.length&&(u.times=_c.convertArray(h,u.times.constructor),u.values=_c.convertArray(d,u.values.constructor),a.push(u))}s.tracks=a;let c=1/0;for(let e=0;e<s.tracks.length;++e)c>s.tracks[e].times[0]&&(c=s.tracks[e].times[0]);for(let e=0;e<s.tracks.length;++e)s.tracks[e].shift(-1*c);return s.resetDuration(),s},makeClipAdditive:function(t,e=0,n=t,r=30){var i=n.tracks.length,s=e/(r=r<=0?30:r);for(let e=0;e<i;++e){const m=n.tracks[e],g=m.ValueTypeName;if("bool"!==g&&"string"!==g){const v=t.tracks.find(function(e){return e.name===m.name&&e.ValueTypeName===g});if(void 0!==v){let e=0;var a=m.getValueSize();m.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(e=a/3);let t=0;var o=v.getValueSize();v.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(t=o/3);var l=m.times.length-1;let n;if(s<=m.times[0]){var c=e,u=a-e;n=_c.arraySlice(m.values,c,u)}else if(s>=m.times[l]){var l=l*a+e,h=l+a-e;n=_c.arraySlice(m.values,l,h)}else{const y=m.createInterpolant();h=e,a=a-e;y.evaluate(s),n=_c.arraySlice(y.resultBuffer,h,a)}if("quaternion"===g){const x=(new Gt).fromArray(n).normalize().conjugate();x.toArray(n)}var d=v.times.length;for(let e=0;e<d;++e){var p=e*o+t;if("quaternion"===g)Gt.multiplyQuaternionsFlat(v.values,p,n,0,v.values,p);else{var f=o-2*t;for(let e=0;e<f;++e)v.values[p+e]-=n[e]}}}}}return t.blendMode=2501,t}};class wc{constructor(e,t,n,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(t){var n=this.parameterPositions;let r=this._cachedIndex,i=n[r],s=n[r-1];e:{t:{let e;n:{r:if(!(t<i)){for(var a=r+2;;){if(void 0===i){if(t<s)break r;return r=n.length,this._cachedIndex=r,this.afterEnd_(r-1,t,s)}if(r===a)break;if(s=i,i=n[++r],t<i)break t}e=n.length;break n}if(t>=s)break e;var o=n[1];t<o&&(r=2,s=o);for(var l=r-2;;){if(void 0===s)return this._cachedIndex=0,this.beforeStart_(0,t,i);if(r===l)break;if(i=s,s=n[--r-1],t>=s)break t}e=r,r=0}for(;r<e;){var c=r+e>>>1;t<n[c]?e=c:r=1+c}if(i=n[r],s=n[r-1],void 0===s)return this._cachedIndex=0,this.beforeStart_(0,t,i);if(void 0===i)return r=n.length,this._cachedIndex=r,this.afterEnd_(r-1,s,t)}this._cachedIndex=r,this.intervalChanged_(r,s,i)}return this.interpolate_(r,s,t,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=e*r;for(let e=0;e!==r;++e)t[e]=n[i+e];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}wc.prototype.beforeStart_=wc.prototype.copySampleValue_,wc.prototype.afterEnd_=wc.prototype.copySampleValue_;class Mc extends wc{constructor(e,t,n,r){super(e,t,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:2400,endingEnd:2400}}intervalChanged_(e,t,n){var r=this.parameterPositions;let i=e-2,s=e+1,a=r[i],o=r[s];if(void 0===a)switch(this.getSettings_().endingStart){case 2401:i=e,a=2*t-n;break;case 2402:i=r.length-2,a=t+r[i]-r[i+1];break;default:i=e,a=n}if(void 0===o)switch(this.getSettings_().endingEnd){case 2401:s=e,o=2*n-t;break;case 2402:s=1,o=n+r[1]-r[0];break;default:s=e-1,o=t}var l=.5*(n-t),c=this.valueSize;this._weightPrev=l/(t-a),this._weightNext=l/(o-n),this._offsetPrev=i*c,this._offsetNext=s*c}interpolate_(e,t,n,r){const i=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=e*a,l=o-a,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,d=this._weightNext,p=(n-t)/(r-t),f=p*p,m=f*p;var g=-h*m+2*h*f-h*p,v=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*p+1,y=(-1-d)*m+(1.5+d)*f+.5*p,x=d*m-d*f;for(let e=0;e!==a;++e)i[e]=g*s[c+e]+v*s[l+e]+y*s[o+e]+x*s[u+e];return i}}class Sc extends wc{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){const i=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=e*a,l=o-a,c=(n-t)/(r-t),u=1-c;for(let e=0;e!==a;++e)i[e]=s[l+e]*u+s[o+e]*c;return i}}class Ec extends wc{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e){return this.copySampleValue_(e-1)}}class Tc{constructor(e,t,n,r){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=_c.convertArray(t,this.TimeBufferType),this.values=_c.convertArray(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;var r;return t.toJSON!==this.toJSON?n=t.toJSON(e):(n={name:e.name,times:_c.convertArray(e.times,Array),values:_c.convertArray(e.values,Array)},(r=e.getInterpolation())!==e.DefaultInterpolation&&(n.interpolation=r)),n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new Ec(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new Sc(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new Mc(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case 2300:t=this.InterpolantFactoryMethodDiscrete;break;case 2301:t=this.InterpolantFactoryMethodLinear;break;case 2302:t=this.InterpolantFactoryMethodSmooth}if(void 0!==t)return this.createInterpolant=t,this;var n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(n);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",n),this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}}getValueSize(){return this.values.length/this.times.length}shift(n){if(0!==n){const r=this.times;for(let e=0,t=r.length;e!==t;++e)r[e]+=n}return this}scale(n){if(1!==n){const r=this.times;for(let e=0,t=r.length;e!==t;++e)r[e]*=n}return this}trim(e,t){var n,r=this.times,i=r.length;let s=0,a=i-1;for(;s!==i&&r[s]<e;)++s;for(;-1!==a&&r[a]>t;)--a;return++a,0===s&&a===i||(s>=a&&(a=Math.max(a,1),s=a-1),n=this.getValueSize(),this.times=_c.arraySlice(r,s,a),this.values=_c.arraySlice(this.values,s*n,a*n)),this}validate(){let n=!0;var e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),n=!1);var t=this.times,r=this.values,i=t.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),n=!1);let s=null;for(let e=0;e!==i;e++){var a=t[e];if("number"==typeof a&&isNaN(a)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,e,a),n=!1;break}if(null!==s&&s>a){console.error("THREE.KeyframeTrack: Out of order keys.",this,e,a,s),n=!1;break}s=a}if(void 0!==r&&_c.isTypedArray(r))for(let e=0,t=r.length;e!==t;++e){var o=r[e];if(isNaN(o)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,e,o),n=!1;break}}return n}optimize(){const n=_c.arraySlice(this.times),r=_c.arraySlice(this.values),i=this.getValueSize(),s=2302===this.getInterpolation(),a=n.length-1;let o=1;for(let e=1;e<a;++e){let t=!1;var l=n[e];if(l!==n[e+1]&&(1!==e||l!==n[0]))if(s)t=!0;else{var c=e*i,u=c-i,h=c+i;for(let e=0;e!==i;++e){var d=r[c+e];if(d!==r[u+e]||d!==r[h+e]){t=!0;break}}}if(t){if(e!==o){n[o]=n[e];var p=e*i,f=o*i;for(let e=0;e!==i;++e)r[f+e]=r[p+e]}++o}}if(0<a){n[o]=n[a];for(let e=a*i,t=o*i,n=0;n!==i;++n)r[t+n]=r[e+n];++o}return o!==n.length?(this.times=_c.arraySlice(n,0,o),this.values=_c.arraySlice(r,0,o*i)):(this.times=n,this.values=r),this}clone(){var e=_c.arraySlice(this.times,0),t=_c.arraySlice(this.values,0);const n=this.constructor,r=new n(this.name,e,t);return r.createInterpolant=this.createInterpolant,r}}Tc.prototype.TimeBufferType=Float32Array,Tc.prototype.ValueBufferType=Float32Array,Tc.prototype.DefaultInterpolation=2301;class Cc extends Tc{}Cc.prototype.ValueTypeName="bool",Cc.prototype.ValueBufferType=Array,Cc.prototype.DefaultInterpolation=2300,Cc.prototype.InterpolantFactoryMethodLinear=void 0,Cc.prototype.InterpolantFactoryMethodSmooth=void 0;class Lc extends Tc{}Lc.prototype.ValueTypeName="color";class Ac extends Tc{}Ac.prototype.ValueTypeName="number";class Pc extends wc{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){var i=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=(n-t)/(r-t);let l=e*a;for(var c=l+a;l!==c;l+=4)Gt.slerpFlat(i,0,s,l-a,s,l,o);return i}}class Rc extends Tc{InterpolantFactoryMethodLinear(e){return new Pc(this.times,this.values,this.getValueSize(),e)}}Rc.prototype.ValueTypeName="quaternion",Rc.prototype.DefaultInterpolation=2301,Rc.prototype.InterpolantFactoryMethodSmooth=void 0;class Dc extends Tc{}Dc.prototype.ValueTypeName="string",Dc.prototype.ValueBufferType=Array,Dc.prototype.DefaultInterpolation=2300,Dc.prototype.InterpolantFactoryMethodLinear=void 0,Dc.prototype.InterpolantFactoryMethodSmooth=void 0;class Nc extends Tc{}class Ic{constructor(e,t=-1,n,r=2500){this.name=e,this.tracks=n,this.duration=t,this.blendMode=r,this.uuid=Et(),this.duration<0&&this.resetDuration()}static parse(e){const n=[],r=e.tracks,i=1/(e.fps||1);for(let e=0,t=r.length;e!==t;++e)n.push(function(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Ac;case"vector":case"vector2":case"vector3":case"vector4":return Nc;case"color":return Lc;case"quaternion":return Rc;case"bool":case"boolean":return Cc;case"string":return Dc}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);{var n,r;void 0===e.times&&(n=[],r=[],_c.flattenJSON(e.keys,n,r,"value"),e.times=n,e.values=r)}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}(r[e]).scale(i));const t=new this(e.name,e.duration,n,e.blendMode);return t.uuid=e.uuid,t}static toJSON(e){const n=[],r=e.tracks;e={name:e.name,duration:e.duration,tracks:n,uuid:e.uuid,blendMode:e.blendMode};for(let e=0,t=r.length;e!==t;++e)n.push(Tc.toJSON(r[e]));return e}static CreateFromMorphTargetSequence(e,r,i,s){var a=r.length;const o=[];for(let n=0;n<a;n++){let e=[],t=[];e.push((n+a-1)%a,n,(n+1)%a),t.push(0,1,0);var l=_c.getKeyframeOrder(e);e=_c.sortedArray(e,1,l),t=_c.sortedArray(t,1,l),s||0!==e[0]||(e.push(a),t.push(t[0])),o.push(new Ac(".morphTargetInfluences["+r[n].name+"]",e,t).scale(1/i))}return new this(e,-1,o)}static findByName(e,t){let n=e;Array.isArray(e)||(n=e.geometry&&e.geometry.animations||e.animations);for(let e=0;e<n.length;e++)if(n[e].name===t)return n[e];return null}static CreateClipsFromMorphTargetSequences(n,e,t){const r={};var i=/^([\w-]*?)([\d]+)$/;for(let e=0,t=n.length;e<t;e++){const o=n[e];var s=o.name.match(i);if(s&&1<s.length){s=s[1];let e=r[s];e||(r[s]=e=[]),e.push(o)}}const a=[];for(const l in r)a.push(this.CreateFromMorphTargetSequence(l,r[l],e,t));return a}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;function n(e,t,n,r,i){var s,a;0!==n.length&&(s=[],a=[],_c.flattenJSON(n,s,a,r),0!==s.length&&i.push(new e(t,s,a)))}const r=[];var i=e.name||"default",s=e.fps||30,a=e.blendMode;let o=e.length||-1;var l=e.hierarchy||[];for(let e=0;e<l.length;e++){var c=l[e].keys;if(c&&0!==c.length)if(c[0].morphTargets){const d={};let t;for(t=0;t<c.length;t++)if(c[t].morphTargets)for(let e=0;e<c[t].morphTargets.length;e++)d[c[t].morphTargets[e]]=-1;for(const p in d){const f=[],m=[];for(let e=0;e!==c[t].morphTargets.length;++e){var u=c[t];f.push(u.time),m.push(u.morphTarget===p?1:0)}r.push(new Ac(".morphTargetInfluence["+p+"]",f,m))}o=d.length*(s||1)}else{var h=".bones["+t[e].name+"]";n(Nc,h+".position",c,"pos",r),n(Rc,h+".quaternion",c,"rot",r),n(Nc,h+".scale",c,"scl",r)}}return 0===r.length?null:new this(i,o,r,a)}resetDuration(){let n=0;for(let e=0,t=this.tracks.length;e!==t;++e){var r=this.tracks[e];n=Math.max(n,r.times[r.times.length-1])}return this.duration=n,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}const kc={enabled:!(Nc.prototype.ValueTypeName="vector"),files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class Oc{constructor(e,t,n){const r=this;let i=!1,s=0,a=0,o=void 0;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){a++,!1===i&&void 0!==r.onStart&&r.onStart(e,s,a),i=!0},this.itemEnd=function(e){s++,void 0!==r.onProgress&&r.onProgress(e,s,a),s===a&&(i=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(e){void 0!==r.onError&&r.onError(e)},this.resolveURL=function(e){return o?o(e):e},this.setURLModifier=function(e){return o=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){e=l.indexOf(e);return-1!==e&&l.splice(e,2),this},this.getHandler=function(n){for(let e=0,t=l.length;e<t;e+=2){const i=l[e];var r=l[e+1];if(i.global&&(i.lastIndex=0),i.test(n))return r}return null}}}const zc=new Oc;class Uc{constructor(e){this.manager=void 0!==e?e:zc,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(n,r){const i=this;return new Promise(function(e,t){i.load(n,e,r,t)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const Vc={};class Fc extends Uc{constructor(e){super(e)}load(o,n,t,r){void 0===o&&(o=""),void 0!==this.path&&(o=this.path+o),o=this.manager.resolveURL(o);const l=this,e=kc.get(o);if(void 0!==e)return l.manager.itemStart(o),setTimeout(function(){n&&n(e),l.manager.itemEnd(o)},0),e;if(void 0===Vc[o]){var i=o.match(/^data:(.*?)(;base64)?,(.*)$/);let e;if(i){var s=i[1],a=!!i[2];let t=i[3];t=decodeURIComponent(t),a&&(t=atob(t));try{let e;var c=(this.responseType||"").toLowerCase();switch(c){case"arraybuffer":case"blob":const u=new Uint8Array(t.length);for(let e=0;e<t.length;e++)u[e]=t.charCodeAt(e);e="blob"===c?new Blob([u.buffer],{type:s}):u.buffer;break;case"document":const h=new DOMParser;e=h.parseFromString(t,s);break;case"json":e=JSON.parse(t);break;default:e=t}setTimeout(function(){n&&n(e),l.manager.itemEnd(o)},0)}catch(e){setTimeout(function(){r&&r(e),l.manager.itemError(o),l.manager.itemEnd(o)},0)}}else{Vc[o]=[],Vc[o].push({onLoad:n,onProgress:t,onError:r}),e=new XMLHttpRequest,e.open("GET",o,!0),e.addEventListener("load",function(n){var r=this.response,i=Vc[o];if(delete Vc[o],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),kc.add(o,r);for(let e=0,t=i.length;e<t;e++){const s=i[e];s.onLoad&&s.onLoad(r)}l.manager.itemEnd(o)}else{for(let e=0,t=i.length;e<t;e++){const a=i[e];a.onError&&a.onError(n)}l.manager.itemError(o),l.manager.itemEnd(o)}},!1),e.addEventListener("progress",function(n){var r=Vc[o];for(let e=0,t=r.length;e<t;e++){const i=r[e];i.onProgress&&i.onProgress(n)}},!1),e.addEventListener("error",function(n){var r=Vc[o];delete Vc[o];for(let e=0,t=r.length;e<t;e++){const i=r[e];i.onError&&i.onError(n)}l.manager.itemError(o),l.manager.itemEnd(o)},!1),e.addEventListener("abort",function(n){var r=Vc[o];delete Vc[o];for(let e=0,t=r.length;e<t;e++){const i=r[e];i.onError&&i.onError(n)}l.manager.itemError(o),l.manager.itemEnd(o)},!1),void 0!==this.responseType&&(e.responseType=this.responseType),void 0!==this.withCredentials&&(e.withCredentials=this.withCredentials),e.overrideMimeType&&e.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain");for(const d in this.requestHeader)e.setRequestHeader(d,this.requestHeader[d]);e.send(null)}return l.manager.itemStart(o),e}Vc[o].push({onLoad:n,onProgress:t,onError:r})}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}(class extends null{});(class extends null{});class Hc extends Uc{constructor(e){super(e)}load(t,e,n,r){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const i=this,s=kc.get(t);if(void 0!==s)return i.manager.itemStart(t),setTimeout(function(){e&&e(s),i.manager.itemEnd(t)},0),s;const a=document.createElementNS("http://www.w3.org/1999/xhtml","img");function o(){a.removeEventListener("load",o,!1),a.removeEventListener("error",l,!1),kc.add(t,this),e&&e(this),i.manager.itemEnd(t)}function l(e){a.removeEventListener("load",o,!1),a.removeEventListener("error",l,!1),r&&r(e),i.manager.itemError(t),i.manager.itemEnd(t)}return a.addEventListener("load",o,!1),a.addEventListener("error",l,!1),"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),i.manager.itemStart(t),a.src=t,a}}class Bc extends Uc{constructor(e){super(e)}load(n,r,e,i){const s=new ri,a=new Hc(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);let o=0;for(let e=0;e<n.length;++e)!function(t){a.load(n[t],function(e){s.images[t]=e,o++,6===o&&(s.needsUpdate=!0,r&&r(s))},void 0,i)}(e);return s}}(class extends null{});class Gc extends Uc{constructor(e){super(e)}load(t,n,e,r){const i=new Ut,s=new Hc(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(t,function(e){i.image=e;e=0<t.search(/\.jpe?g($|\?)/i)||0===t.search(/^data\:image\/jpeg/);i.format=e?Ce:Ve,i.needsUpdate=!0,void 0!==n&&n(i)},e,r),i}}class Wc extends hl{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0);var t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new El(t,e))}getPoint(e){var t=e*this.getLength(),n=this.getCurveLengths();let r=0;for(;r<n.length;){if(n[r]>=t){var i=n[r]-t;const a=this.curves[r];var s=a.getLength();return a.getPointAt(0===s?0:1-i/s)}r++}return null}getLength(){var e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const n=[];let r=0;for(let e=0,t=this.curves.length;e<t;e++)r+=this.curves[e].getLength(),n.push(r);return this.cacheLengths=n,n}getSpacedPoints(t=40){const n=[];for(let e=0;e<=t;e++)n.push(this.getPoint(e/t));return this.autoClose&&n.push(n[0]),n}getPoints(n=12){const r=[];let i;for(let e=0,t=this.curves;e<t.length;e++){const l=t[e];var s=l&&l.isEllipseCurve?2*n:l&&(l.isLineCurve||l.isLineCurve3)?1:l&&l.isSplineCurve?n*l.points.length:n,a=l.getPoints(s);for(let e=0;e<a.length;e++){var o=a[e];i&&i.equals(o)||(r.push(o),i=o)}}return this.autoClose&&1<r.length&&!r[r.length-1].equals(r[0])&&r.push(r[0]),r}copy(n){super.copy(n),this.curves=[];for(let e=0,t=n.curves.length;e<t;e++){const r=n.curves[e];this.curves.push(r.clone())}return this.autoClose=n.autoClose,this}toJSON(){const n=super.toJSON();n.autoClose=this.autoClose,n.curves=[];for(let e=0,t=this.curves.length;e<t;e++){const r=this.curves[e];n.curves.push(r.toJSON())}return n}fromJSON(n){super.fromJSON(n),this.autoClose=n.autoClose,this.curves=[];for(let e=0,t=n.curves.length;e<t;e++){var r=n.curves[e];this.curves.push((new Al[r.type]).fromJSON(r))}return this}}class jc extends Wc{constructor(e){super(),this.type="Path",this.currentPoint=new Nt,e&&this.setFromPoints(e)}setFromPoints(n){this.moveTo(n[0].x,n[0].y);for(let e=1,t=n.length;e<t;e++)this.lineTo(n[e].x,n[e].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){var n=new El(this.currentPoint.clone(),new Nt(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,r){t=new Tl(this.currentPoint.clone(),new Nt(e,t),new Nt(n,r));return this.curves.push(t),this.currentPoint.set(n,r),this}bezierCurveTo(e,t,n,r,i,s){r=new Ml(this.currentPoint.clone(),new Nt(e,t),new Nt(n,r),new Nt(i,s));return this.curves.push(r),this.currentPoint.set(i,s),this}splineThru(e){var t=[this.currentPoint.clone()].concat(e),t=new Ll(t);return this.curves.push(t),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,r,i,s){var a=this.currentPoint.x,o=this.currentPoint.y;return this.absarc(e+a,t+o,n,r,i,s),this}absarc(e,t,n,r,i,s){return this.absellipse(e,t,n,n,r,i,s),this}ellipse(e,t,n,r,i,s,a,o){var l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+l,t+c,n,r,i,s,a,o),this}absellipse(e,t,n,r,i,s,a,o){const l=new dl(e,t,n,r,i,s,a,o);if(0<this.curves.length){const c=l.getPoint(0);c.equals(this.currentPoint)||this.lineTo(c.x,c.y)}this.curves.push(l);o=l.getPoint(1);return this.currentPoint.copy(o),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class qc extends jc{constructor(e){super(e),this.uuid=Et(),this.type="Shape",this.holes=[]}getPointsHoles(n){const r=[];for(let e=0,t=this.holes.length;e<t;e++)r[e]=this.holes[e].getPoints(n);return r}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(n){super.copy(n),this.holes=[];for(let e=0,t=n.holes.length;e<t;e++){const r=n.holes[e];this.holes.push(r.clone())}return this}toJSON(){const n=super.toJSON();n.uuid=this.uuid,n.holes=[];for(let e=0,t=this.holes.length;e<t;e++){const r=this.holes[e];n.holes.push(r.toJSON())}return n}fromJSON(n){super.fromJSON(n),this.uuid=n.uuid,this.holes=[];for(let e=0,t=n.holes.length;e<t;e++){var r=n.holes[e];this.holes.push((new jc).fromJSON(r))}return this}}class Xc extends Xn{constructor(e,t=1){super(),this.type="Light",this.color=new pr(e),this.intensity=t}dispose(){}copy(e){return super.copy(e),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}Xc.prototype.isLight=!0;class Yc extends Xc{constructor(e,t,n){super(e,n),this.type="HemisphereLight",this.position.copy(Xn.DefaultUp),this.updateMatrix(),this.groundColor=new pr(t)}copy(e){return Xc.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}Yc.prototype.isHemisphereLight=!0;const Kc=new wn,Jc=new Wt,Zc=new Wt;class $c{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Nt(512,512),this.map=null,this.mapPass=null,this.matrix=new wn,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new hi,this._frameExtents=new Nt(1,1),this._viewportCount=1,this._viewports=[new Ft(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;Jc.setFromMatrixPosition(e.matrixWorld),t.position.copy(Jc),Zc.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(Zc),t.updateMatrixWorld(),Kc.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Kc),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(t.projectionMatrix),n.multiply(t.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class Qc extends $c{constructor(){super(new ti(50,1,.5,500)),this.focus=1}updateMatrices(e){const t=this.camera;var n=2*St*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,i=e.distance||t.far;n===t.fov&&r===t.aspect&&i===t.far||(t.fov=n,t.aspect=r,t.far=i,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}Qc.prototype.isSpotLightShadow=!0;class eu extends Xc{constructor(e,t,n=0,r=Math.PI/3,i=0,s=1){super(e,t),this.type="SpotLight",this.position.copy(Xn.DefaultUp),this.updateMatrix(),this.target=new Xn,this.distance=n,this.angle=r,this.penumbra=i,this.decay=s,this.shadow=new Qc}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}eu.prototype.isSpotLight=!0;const tu=new wn,nu=new Wt,ru=new Wt;class iu extends $c{constructor(){super(new ti(90,1,.5,500)),this._frameExtents=new Nt(4,2),this._viewportCount=6,this._viewports=[new Ft(2,1,1,1),new Ft(0,1,1,1),new Ft(3,1,1,1),new Ft(1,1,1,1),new Ft(3,0,1,1),new Ft(1,0,1,1)],this._cubeDirections=[new Wt(1,0,0),new Wt(-1,0,0),new Wt(0,0,1),new Wt(0,0,-1),new Wt(0,1,0),new Wt(0,-1,0)],this._cubeUps=[new Wt(0,1,0),new Wt(0,1,0),new Wt(0,1,0),new Wt(0,1,0),new Wt(0,0,1),new Wt(0,0,-1)]}updateMatrices(e,t=0){const n=this.camera,r=this.matrix;var i=e.distance||n.far;i!==n.far&&(n.far=i,n.updateProjectionMatrix()),nu.setFromMatrixPosition(e.matrixWorld),n.position.copy(nu),ru.copy(n.position),ru.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(ru),n.updateMatrixWorld(),r.makeTranslation(-nu.x,-nu.y,-nu.z),tu.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(tu)}}iu.prototype.isPointLightShadow=!0;class su extends Xc{constructor(e,t,n=0,r=1){super(e,t),this.type="PointLight",this.distance=n,this.decay=r,this.shadow=new iu}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}su.prototype.isPointLight=!0;class au extends $c{constructor(){super(new Si(-5,5,5,-5,.5,500))}}au.prototype.isDirectionalLightShadow=!0;class ou extends Xc{constructor(e,t){super(e,t),this.type="DirectionalLight",this.position.copy(Xn.DefaultUp),this.updateMatrix(),this.target=new Xn,this.shadow=new au}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}ou.prototype.isDirectionalLight=!0;class lu extends Xc{constructor(e,t){super(e,t),this.type="AmbientLight"}}lu.prototype.isAmbientLight=!0;class cu extends Xc{constructor(e,t,n=10,r=10){super(e,t),this.type="RectAreaLight",this.width=n,this.height=r}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}cu.prototype.isRectAreaLight=!0;class uu{constructor(){this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new Wt)}set(t){for(let e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){var n=e.x,r=e.y,i=e.z,e=this.coefficients;return t.copy(e[0]).multiplyScalar(.282095),t.addScaledVector(e[1],.488603*r),t.addScaledVector(e[2],.488603*i),t.addScaledVector(e[3],.488603*n),t.addScaledVector(e[4],n*r*1.092548),t.addScaledVector(e[5],r*i*1.092548),t.addScaledVector(e[6],.315392*(3*i*i-1)),t.addScaledVector(e[7],n*i*1.092548),t.addScaledVector(e[8],.546274*(n*n-r*r)),t}getIrradianceAt(e,t){var n=e.x,r=e.y,i=e.z,e=this.coefficients;return t.copy(e[0]).multiplyScalar(.886227),t.addScaledVector(e[1],1.023328*r),t.addScaledVector(e[2],1.023328*i),t.addScaledVector(e[3],1.023328*n),t.addScaledVector(e[4],.858086*n*r),t.addScaledVector(e[5],.858086*r*i),t.addScaledVector(e[6],.743125*i*i-.247708),t.addScaledVector(e[7],.858086*n*i),t.addScaledVector(e[8],.429043*(n*n-r*r)),t}add(t){for(let e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this}addScaledSH(t,n){for(let e=0;e<9;e++)this.coefficients[e].addScaledVector(t.coefficients[e],n);return this}scale(t){for(let e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this}lerp(t,n){for(let e=0;e<9;e++)this.coefficients[e].lerp(t.coefficients[e],n);return this}equals(t){for(let e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(t,n=0){const r=this.coefficients;for(let e=0;e<9;e++)r[e].fromArray(t,n+3*e);return this}toArray(t=[],n=0){const r=this.coefficients;for(let e=0;e<9;e++)r[e].toArray(t,n+3*e);return t}static getBasisAt(e,t){var n=e.x,r=e.y,e=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*e,t[3]=.488603*n,t[4]=1.092548*n*r,t[5]=1.092548*r*e,t[6]=.315392*(3*e*e-1),t[7]=1.092548*n*e,t[8]=.546274*(n*n-r*r)}}uu.prototype.isSphericalHarmonics3=!0;class hu extends Xc{constructor(e=new uu,t=1){super(void 0,t),this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}hu.prototype.isLightProbe=!0;(class extends null{});class du{static decodeText(n){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(n);let r="";for(let e=0,t=n.length;e<t;e++)r+=String.fromCharCode(n[e]);try{return decodeURIComponent(escape(r))}catch(e){return r}}static extractUrlBase(e){var t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}}class pu extends Ar{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}clone(){return(new this.constructor).copy(this)}toJSON(){const e=super.toJSON(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}pu.prototype.isInstancedBufferGeometry=!0;(class extends null{});(class extends null{});M,S,l,c,L,A,V,Ne,F,Ie,H,B,G,W,ke;class fu extends Uc{constructor(e){super(e),"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(t,n,e,r){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const i=this,s=kc.get(t);if(void 0!==s)return i.manager.itemStart(t),setTimeout(function(){n&&n(s),i.manager.itemEnd(t)},0),s;const a={};a.credentials="anonymous"===this.crossOrigin?"same-origin":"include",a.headers=this.requestHeader,fetch(t,a).then(function(e){return e.blob()}).then(function(e){return createImageBitmap(e,Object.assign(i.options,{colorSpaceConversion:"none"}))}).then(function(e){kc.add(t,e),n&&n(e),i.manager.itemEnd(t)}).catch(function(e){r&&r(e),i.manager.itemError(t),i.manager.itemEnd(t)}),i.manager.itemStart(t)}}fu.prototype.isImageBitmapLoader=!0;class mu{constructor(){this.type="ShapePath",this.color=new pr,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new jc,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,n,r){return this.currentPath.quadraticCurveTo(e,t,n,r),this}bezierCurveTo(e,t,n,r,i,s){return this.currentPath.bezierCurveTo(e,t,n,r,i,s),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(n,e){function t(n){const r=[];for(let e=0,t=n.length;e<t;e++){var i=n[e];const s=new qc;s.curves=i.curves,r.push(s)}return r}const r=Xl.isClockWise,i=this.subPaths;if(0===i.length)return[];if(!0===e)return t(i);let s,a,o;const l=[];if(1===i.length)return a=i[0],o=new qc,o.curves=a.curves,l.push(o),l;let c=!r(i[0].getPoints());c=n?!c:c;const u=[],h=[];let d=[],p=0;var f,m;h[p]=void 0,d[p]=[];for(let e=0,t=i.length;e<t;e++)a=i[e],f=a.getPoints(),s=r(f),s=n?!s:s,s?(!c&&h[p]&&p++,h[p]={s:new qc,p:f},h[p].s.curves=a.curves,c&&p++,d[p]=[]):d[p].push({h:a,p:f[0]});if(!h[0])return t(i);if(1<h.length){let i=!1;const y=[];for(let e=0,t=h.length;e<t;e++)u[e]=[];for(let r=0,e=h.length;r<e;r++){var g=d[r];for(let n=0;n<g.length;n++){var v=g[n];let t=!0;for(let e=0;e<h.length;e++)!function(a,o){var e=o.length;let l=!1;for(let i=e-1,s=0;s<e;i=s++){let e=o[i],t=o[s],n=t.x-e.x,r=t.y-e.y;if(Math.abs(r)>Number.EPSILON){if(r<0&&(e=o[s],n=-n,t=o[i],r=-r),!(a.y<e.y||a.y>t.y))if(a.y===e.y){if(a.x===e.x)return 1}else{var c=r*(a.x-e.x)-n*(a.y-e.y);if(0==c)return 1;c<0||(l=!l)}}else if(a.y===e.y&&(t.x<=a.x&&a.x<=e.x||e.x<=a.x&&a.x<=t.x))return 1}return l}(v.p,h[e].p)||(r!==e&&y.push({froms:r,tos:e,hole:n}),t?(t=!1,u[e].push(v)):i=!0);t&&u[r].push(v)}}0<y.length&&(i||(d=u))}for(let n=0,e=h.length;n<e;n++){o=h[n].s,l.push(o);for(let e=0,t=(m=d[n]).length;e<t;e++)o.holes.push(m[e].h)}return l}}class gu{constructor(e){this.type="Font",this.data=e}generateShapes(e,t=100){var n=[];const r=function(e,t,n){const r=Array.from(e),i=t/n.resolution,s=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*i,a=[];let o=0,l=0;for(let e=0;e<r.length;e++){var c=r[e];"\n"===c?(o=0,l-=s):(c=function(e,u,h,d,t){const p=t.glyphs[e]||t.glyphs["?"];if(p){const m=new mu;let n,r,i,s,a,o,l,c;if(p.o){var f=p._cachedOutline||(p._cachedOutline=p.o.split(" "));for(let e=0,t=f.length;e<t;)switch(f[e++]){case"m":n=f[e++]*u+h,r=f[e++]*u+d,m.moveTo(n,r);break;case"l":n=f[e++]*u+h,r=f[e++]*u+d,m.lineTo(n,r);break;case"q":i=f[e++]*u+h,s=f[e++]*u+d,a=f[e++]*u+h,o=f[e++]*u+d,m.quadraticCurveTo(a,o,i,s);break;case"b":i=f[e++]*u+h,s=f[e++]*u+d,a=f[e++]*u+h,o=f[e++]*u+d,l=f[e++]*u+h,c=f[e++]*u+d,m.bezierCurveTo(a,o,l,c,i,s)}}return{offsetX:p.ha*u,path:m}}console.error('THREE.Font: character "'+e+'" does not exists in font family '+t.familyName+".")}(c,i,o,l,n),o+=c.offsetX,a.push(c.path))}return a}(e,t,this.data);for(let e=0,t=r.length;e<t;e++)Array.prototype.push.apply(n,r[e].toShapes());return n}}gu.prototype.isFont=!0;class vu extends Uc{constructor(e){super(e)}load(e,r,t,n){const i=this,s=new Fc(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(i.withCredentials),s.load(e,function(t){let n;try{n=JSON.parse(t)}catch(e){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),n=JSON.parse(t.substring(65,t.length-2))}t=i.parse(n);r&&r(t)},t,n)}parse(e){return new gu(e)}}hu;(class extends hu{constructor(e,t,n=1){super(void 0,n);var r=(new pr).set(e),n=(new pr).set(t),e=new Wt(r.r,r.g,r.b),t=new Wt(n.r,n.g,n.b),r=Math.sqrt(Math.PI),n=r*Math.sqrt(.75);this.sh.coefficients[0].copy(e).add(t).multiplyScalar(r),this.sh.coefficients[1].copy(e).sub(t).multiplyScalar(n)}}).prototype.isHemisphereLightProbe=!0;hu;(class extends hu{constructor(e,t=1){super(void 0,t);e=(new pr).set(e);this.sh.coefficients[0].set(e.r,e.g,e.b).multiplyScalar(2*Math.sqrt(Math.PI))}}).prototype.isAmbientLightProbe=!0;class yu{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=xu(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;return this.autoStart&&!this.running?(this.start(),0):(this.running&&(t=xu(),e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e),e);var t}}function xu(){return("undefined"==typeof performance?Date:performance).now()}(class extends null{});(class extends Xn{});(class extends null{});var bu="\\[\\]\\.:\\/";const _u=new RegExp("["+bu+"]","g");e="[^"+bu+"]",Oi="[^"+bu.replace("\\.","")+"]",zi=/((?:WC+[\/:])*)/.source.replace("WC",e),bu=/(WCOD+)?/.source.replace("WCOD",Oi),Oi=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",e),e=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",e);const wu=new RegExp("^"+zi+bu+Oi+e+"$"),Mu=["material","materials","bones"];class Su{constructor(e,t,n){this.path=t,this.parsedPath=n||Su.parseTrackName(t),this.node=Su.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return new(e&&e.isAnimationObjectGroup?Su.Composite:Su)(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(_u,"")}static parseTrackName(e){var t=wu.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]};var r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r&&(t=n.nodeName.substring(r+1),-1!==Mu.indexOf(t)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=t)),null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,r){if(!r||""===r||"."===r||-1===r||r===e.name||r===e.uuid)return e;if(e.skeleton){var t=e.skeleton.getBoneByName(r);if(void 0!==t)return t}if(e.children){const i=function(t){for(let e=0;e<t.length;e++){var n=t[e];if(n.name===r||n.uuid===r)return n;n=i(n.children);if(n)return n}return null};e=i(e.children);if(e)return e}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(n,r){var i=this.resolvedProperty;for(let e=0,t=i.length;e!==t;++e)n[r++]=i[e]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(n,r){const i=this.resolvedProperty;for(let e=0,t=i.length;e!==t;++e)i[e]=n[r++]}_setValue_array_setNeedsUpdate(n,r){const i=this.resolvedProperty;for(let e=0,t=i.length;e!==t;++e)i[e]=n[r++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(n,r){const i=this.resolvedProperty;for(let e=0,t=i.length;e!==t;++e)i[e]=n[r++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let n=this.node;var e=this.parsedPath,r=e.objectName,i=e.propertyName;let s=e.propertyIndex;if(n||(n=Su.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=n),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,n){if(r){let t=e.objectIndex;switch(r){case"materials":if(!n.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!n.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);n=n.material.materials;break;case"bones":if(!n.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);n=n.skeleton.bones;for(let e=0;e<n.length;e++)if(n[e].name===t){t=e;break}break;default:if(void 0===n[r])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);n=n[r]}if(void 0!==t){if(void 0===n[t])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,n);n=n[t]}}var a=n[i];if(void 0!==a){let e=this.Versioning.None;this.targetObject=n,void 0!==n.needsUpdate?e=this.Versioning.NeedsUpdate:void 0!==n.matrixWorldNeedsUpdate&&(e=this.Versioning.MatrixWorldNeedsUpdate);let t=this.BindingType.Direct;if(void 0!==s){if("morphTargetInfluences"===i){if(!n.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!n.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!n.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==n.morphTargetDictionary[s]&&(s=n.morphTargetDictionary[s])}t=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=s}else void 0!==a.fromArray&&void 0!==a.toArray?(t=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(t=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=i;this.getValue=this.GetterByBindingType[t],this.setValue=this.SetterByBindingTypeAndVersioning[t][e]}else{e=e.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+e+"."+i+" but it wasn't found.",n)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Su.Composite=class{constructor(e,t,n){n=n||Su.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,n)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(e,t)}setValue(n,r){const i=this._bindings;for(let e=this._targetGroup.nCachedObjects_,t=i.length;e!==t;++e)i[e].setValue(n,r)}bind(){const n=this._bindings;for(let e=this._targetGroup.nCachedObjects_,t=n.length;e!==t;++e)n[e].bind()}unbind(){const n=this._bindings;for(let e=this._targetGroup.nCachedObjects_,t=n.length;e!==t;++e)n[e].unbind()}},Su.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Su.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Su.prototype.GetterByBindingType=[Su.prototype._getValue_direct,Su.prototype._getValue_array,Su.prototype._getValue_arrayElement,Su.prototype._getValue_toArray],Su.prototype.SetterByBindingTypeAndVersioning=[[Su.prototype._setValue_direct,Su.prototype._setValue_direct_setNeedsUpdate,Su.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Su.prototype._setValue_array,Su.prototype._setValue_array_setNeedsUpdate,Su.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Su.prototype._setValue_arrayElement,Su.prototype._setValue_arrayElement_setNeedsUpdate,Su.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Su.prototype._setValue_fromArray,Su.prototype._setValue_fromArray_setNeedsUpdate,Su.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];(class extends bt{});new Float32Array(1);Qa;(class extends Qa{constructor(e,t,n=1){super(e,t),this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}).prototype.isInstancedInterleavedBuffer=!0;(class extends Xn{});(class extends null{});const Eu=new Wt,Tu=new wn,Cu=new wn;jo;(class extends null{});(class extends null{});jo;(class extends null{});(class extends null{});(class extends null{});(class extends null{});(class extends null{});(class extends null{});(class extends null{});(class extends null{});const Lu=new Float32Array(1);new Int32Array(Lu.buffer);hl.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(hl.prototype),(e.prototype.constructor=e).prototype.getPoint=t,e},jc.prototype.fromPoints=function(e){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)},class extends jo{constructor(e=10,r=10,i=4473924,s=8947848){i=new pr(i),s=new pr(s);var a=r/2,o=e/r,l=e/2;const c=[],u=[];for(let e=0,t=0,n=-l;e<=r;e++,n+=o){c.push(-l,0,n,l,0,n),c.push(n,0,-l,n,0,l);const h=e===a?i:s;h.toArray(u,t),t+=3,h.toArray(u,t),t+=3,h.toArray(u,t),t+=3,h.toArray(u,t),t+=3}const t=new Ar;t.setAttribute("position",new br(c,3)),t.setAttribute("color",new br(u,3));e=new Oo({vertexColors:!0,toneMapped:!1});super(t,e),this.type="GridHelper"}}.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},class extends jo{constructor(e){var t=function t(n){const r=[];n&&n.isBone&&r.push(n);for(let e=0;e<n.children.length;e++)r.push.apply(r,t(n.children[e]));return r}(e);const n=new Ar,r=[],i=[];var s=new pr(0,0,1),a=new pr(0,1,0);for(let e=0;e<t.length;e++){var o=t[e];o.parent&&o.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),i.push(s.r,s.g,s.b),i.push(a.r,a.g,a.b))}n.setAttribute("position",new br(r,3)),n.setAttribute("color",new br(i,3));var l=new Oo({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(n,l),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){var n=this.bones;const t=this.geometry,r=t.getAttribute("position");Cu.copy(this.root.matrixWorld).invert();for(let e=0,t=0;e<n.length;e++){var i=n[e];i.parent&&i.parent.isBone&&(Tu.multiplyMatrices(Cu,i.matrixWorld),Eu.setFromMatrixPosition(Tu),r.setXYZ(t,Eu.x,Eu.y,Eu.z),Tu.multiplyMatrices(Cu,i.parent.matrixWorld),Eu.setFromMatrixPosition(Tu),r.setXYZ(t+1,Eu.x,Eu.y,Eu.z),t+=2)}t.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}}.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Uc.prototype.extractUrlBase=function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),du.extractUrlBase(e)},Uc.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Xt.prototype.center=function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Xt.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Xt.prototype.isIntersectionBox=function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},Xt.prototype.isIntersectionSphere=function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},Xt.prototype.size=function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)},pn.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()},hi.prototype.setFromMatrix=function(e){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(e)},It.prototype.flattenToArrayOffset=function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},It.prototype.multiplyVector3=function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},It.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},It.prototype.applyToBufferAttribute=function(e){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},It.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},It.prototype.getInverse=function(e){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()},wn.prototype.extractPosition=function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},wn.prototype.flattenToArrayOffset=function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},wn.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new Wt).setFromMatrixColumn(this,3)},wn.prototype.setRotationFromQuaternion=function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},wn.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},wn.prototype.multiplyVector3=function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},wn.prototype.multiplyVector4=function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},wn.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},wn.prototype.rotateAxis=function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},wn.prototype.crossVector=function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},wn.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},wn.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},wn.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},wn.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},wn.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},wn.prototype.applyToBufferAttribute=function(e){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},wn.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},wn.prototype.makeFrustum=function(e,t,n,r,i,s){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,r,n,i,s)},wn.prototype.getInverse=function(e){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()},li.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},Gt.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},Gt.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()},_n.prototype.isIntersectionBox=function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},_n.prototype.isIntersectionPlane=function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},_n.prototype.isIntersectionSphere=function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},ir.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},ir.prototype.barycoordFromPoint=function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},ir.prototype.midpoint=function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},ir.prototypenormal=function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},ir.prototype.plane=function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)},ir.barycoordFromPoint=function(e,t,n,r,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),ir.getBarycoord(e,t,n,r,i)},ir.normal=function(e,t,n,r){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),ir.getNormal(e,t,n,r)},qc.prototype.extractAllPoints=function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},qc.prototype.extrude=function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new Jl(this,e)},qc.prototype.makeGeometry=function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new rc(this,e)},Nt.prototype.fromAttribute=function(e,t,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},Nt.prototype.distanceToManhattan=function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},Nt.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Wt.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},Wt.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},Wt.prototype.getPositionFromMatrix=function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},Wt.prototype.getScaleFromMatrix=function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},Wt.prototype.getColumnFromMatrix=function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},Wt.prototype.applyProjection=function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},Wt.prototype.fromAttribute=function(e,t,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},Wt.prototype.distanceToManhattan=function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},Wt.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Ft.prototype.fromAttribute=function(e,t,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},Ft.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Xn.prototype.getChildByName=function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},Xn.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},Xn.prototype.translate=function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},Xn.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},Xn.prototype.applyMatrix=function(e){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)},Object.defineProperties(Xn.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Xr.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties(Xr.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),So.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},ti.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(Xc.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(vr.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),35048===this.usage},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(35048)}}}),vr.prototype.setDynamic=function(e){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?35048:35044),this},vr.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},vr.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},Ar.prototype.addIndex=function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},Ar.prototype.addAttribute=function(e,t){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(e,t):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(e,new vr(t,arguments[2])))},Ar.prototype.addDrawCall=function(e,t,n){void 0!==n&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},Ar.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},Ar.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},Ar.prototype.removeAttribute=function(e){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(e)},Ar.prototype.applyMatrix=function(e){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)},Object.defineProperties(Ar.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Qa.prototype.setDynamic=function(e){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?35048:35044),this},Qa.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},Jl.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},Jl.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},Jl.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},$a.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},class Th{constructor(e){"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}clone(){return new Th(void 0===this.value.clone?this.value:this.value.clone())}}.prototype.onUpdate=function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this},Object.defineProperties(ar.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new pr}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===e}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(e){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=e}},vertexTangents:{get:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}}),Object.defineProperties(Qr.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),Ka.prototype.clearTarget=function(e,t,n,r){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,n,r)},Ka.prototype.animate=function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},Ka.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},Ka.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},Ka.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},Ka.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},Ka.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},Ka.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},Ka.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},Ka.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},Ka.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},Ka.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},Ka.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},Ka.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},Ka.prototype.enableScissorTest=function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},Ka.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},Ka.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},Ka.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},Ka.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},Ka.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},Ka.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},Ka.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},Ka.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},Ka.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},Ka.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()},Object.defineProperties(Ka.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(e){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===e?3001:gt}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(Va.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(Ht.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),ni.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)},ni.prototype.clear=function(e,t,n,r){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(e,t,n,r)},Ot.crossOrigin=void 0,Ot.loadTexture=function(e,t,n,r){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const i=new Gc;i.setCrossOrigin(this.crossOrigin);const s=i.load(e,n,void 0,r);return t&&(s.mapping=t),s},Ot.loadTextureCube=function(e,t,n,r){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const i=new Bc;i.setCrossOrigin(this.crossOrigin);const s=i.load(e,n,void 0,r);return t&&(s.mapping=t),s},Ot.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},Ot.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"132"}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="132");const Au={type:"change"},Pu={type:"start"},Ru={type:"end"};class Du extends bt{constructor(e,t){super(),void 0===t&&console.warn('THREE.TrackballControls: The second parameter "domElement" is now mandatory.'),t===document&&console.error('THREE.TrackballControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.');const o=this,n={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=["KeyA","KeyS","KeyD"],this.mouseButtons={LEFT:N.ROTATE,MIDDLE:N.DOLLY,RIGHT:N.PAN},this.target=new Wt;const r=new Wt;let i=1,s=n.NONE,a=n.NONE,l=0,c=0,u=0;const h=new Wt,d=new Nt,p=new Nt,f=new Wt,m=new Nt,g=new Nt,v=new Nt,y=new Nt,x=[],b={};this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone(),this.zoom0=this.object.zoom,this.handleResize=function(){var e=o.domElement.getBoundingClientRect(),t=o.domElement.ownerDocument.documentElement;o.screen.left=e.left+window.pageXOffset-t.clientLeft,o.screen.top=e.top+window.pageYOffset-t.clientTop,o.screen.width=e.width,o.screen.height=e.height};const _=function(){const n=new Nt;return function(e,t){return n.set((e-o.screen.left)/o.screen.width,(t-o.screen.top)/o.screen.height),n}}(),w=function(){const n=new Nt;return function(e,t){return n.set((e-.5*o.screen.width-o.screen.left)/(.5*o.screen.width),(o.screen.height+2*(o.screen.top-t))/o.screen.width),n}}();function M(e){var t;!1!==o.enabled&&(0===x.length&&(o.domElement.setPointerCapture(e.pointerId),o.domElement.addEventListener("pointermove",S),o.domElement.addEventListener("pointerup",E)),t=e,x.push(t),("touch"===e.pointerType?function(e){{var t;1===(D(e),x.length)?(s=n.TOUCH_ROTATE,p.copy(w(x[0].pageX,x[0].pageY)),d.copy(p)):(s=n.TOUCH_ZOOM_PAN,t=x[0].pageX-x[1].pageX,e=x[0].pageY-x[1].pageY,c=l=Math.sqrt(t*t+e*e),t=(x[0].pageX+x[1].pageX)/2,e=(x[0].pageY+x[1].pageY)/2,v.copy(_(t,e)),y.copy(v))}o.dispatchEvent(Pu)}:function(e){if(s===n.NONE)switch(e.button){case o.mouseButtons.LEFT:s=n.ROTATE;break;case o.mouseButtons.MIDDLE:s=n.ZOOM;break;case o.mouseButtons.RIGHT:s=n.PAN;break;default:s=n.NONE}var t=a!==n.NONE?a:s;t!==n.ROTATE||o.noRotate?t!==n.ZOOM||o.noZoom?t!==n.PAN||o.noPan||(v.copy(_(e.pageX,e.pageY)),y.copy(v)):(m.copy(_(e.pageX,e.pageY)),g.copy(m)):(p.copy(w(e.pageX,e.pageY)),d.copy(p));o.dispatchEvent(Pu)})(e))}function S(e){var t;!1!==o.enabled&&("touch"===e.pointerType?function(e){{var t,n,r;1===(D(e),x.length)?(d.copy(p),p.copy(w(e.pageX,e.pageY))):(r=function(e){e=e.pointerId===x[0].pointerId?x[1]:x[0];return b[e.pointerId]}(e),t=e.pageX-r.x,n=e.pageY-r.y,c=Math.sqrt(t*t+n*n),n=(e.pageX+r.x)/2,r=(e.pageY+r.y)/2,y.copy(_(n,r)))}}(e):(t=e,(e=a!==n.NONE?a:s)!==n.ROTATE||o.noRotate?e!==n.ZOOM||o.noZoom?e!==n.PAN||o.noPan||y.copy(_(t.pageX,t.pageY)):g.copy(_(t.pageX,t.pageY)):(d.copy(p),p.copy(w(t.pageX,t.pageY)))))}function E(e){!1!==o.enabled&&("touch"===e.pointerType?function(e){switch(x.length){case 0:s=n.NONE;break;case 1:s=n.TOUCH_ROTATE,p.copy(w(e.pageX,e.pageY)),d.copy(p);break;case 2:s=n.TOUCH_ZOOM_PAN,p.copy(w(e.pageX-d.pageX,e.pageY-d.pageY)),d.copy(p)}o.dispatchEvent(Ru)}(e):(s=n.NONE,o.dispatchEvent(Ru)),R(e),0===x.length&&(o.domElement.releasePointerCapture(e.pointerId),o.domElement.removeEventListener("pointermove",S),o.domElement.removeEventListener("pointerup",E)))}function T(e){R(e)}function C(e){!1!==o.enabled&&(window.removeEventListener("keydown",C),a!==n.NONE||(e.code!==o.keys[n.ROTATE]||o.noRotate?e.code!==o.keys[n.ZOOM]||o.noZoom?e.code!==o.keys[n.PAN]||o.noPan||(a=n.PAN):a=n.ZOOM:a=n.ROTATE))}function L(){!1!==o.enabled&&(a=n.NONE,window.addEventListener("keydown",C))}function A(e){if(!1!==o.enabled&&!0!==o.noZoom){switch(e.preventDefault(),e.deltaMode){case 2:m.y-=.025*e.deltaY;break;case 1:m.y-=.01*e.deltaY;break;default:m.y-=25e-5*e.deltaY}o.dispatchEvent(Pu),o.dispatchEvent(Ru)}}function P(e){!1!==o.enabled&&e.preventDefault()}function R(t){delete b[t.pointerId];for(let e=0;e<x.length;e++)if(x[e].pointerId==t.pointerId)return void x.splice(e,1)}function D(e){let t=b[e.pointerId];void 0===t&&(t=new Nt,b[e.pointerId]=t),t.set(e.pageX,e.pageY)}this.rotateCamera=function(){const t=new Wt,n=new Gt,r=new Wt,i=new Wt,s=new Wt,a=new Wt;return function(){a.set(p.x-d.x,p.y-d.y,0);var e=a.length();e?(h.copy(o.object.position).sub(o.target),r.copy(h).normalize(),i.copy(o.object.up).normalize(),s.crossVectors(i,r).normalize(),i.setLength(p.y-d.y),s.setLength(p.x-d.x),a.copy(i.add(s)),t.crossVectors(a,h).normalize(),e*=o.rotateSpeed,n.setFromAxisAngle(t,e),h.applyQuaternion(n),o.object.up.applyQuaternion(n),f.copy(t),u=e):!o.staticMoving&&u&&(u*=Math.sqrt(1-o.dynamicDampingFactor),h.copy(o.object.position).sub(o.target),n.setFromAxisAngle(f,u),h.applyQuaternion(n),o.object.up.applyQuaternion(n)),d.copy(p)}}(),this.zoomCamera=function(){let e;s===n.TOUCH_ZOOM_PAN?(e=l/c,l=c,o.object.isPerspectiveCamera?h.multiplyScalar(e):o.object.isOrthographicCamera?(o.object.zoom*=e,o.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")):(e=1+(g.y-m.y)*o.zoomSpeed,1!==e&&0<e&&(o.object.isPerspectiveCamera?h.multiplyScalar(e):o.object.isOrthographicCamera?(o.object.zoom/=e,o.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")),o.staticMoving?m.copy(g):m.y+=(g.y-m.y)*this.dynamicDampingFactor)},this.panCamera=function(){const n=new Nt,r=new Wt,i=new Wt;return function(){var e,t;n.copy(y).sub(v),n.lengthSq()&&(o.object.isOrthographicCamera&&(e=(o.object.right-o.object.left)/o.object.zoom/o.domElement.clientWidth,t=(o.object.top-o.object.bottom)/o.object.zoom/o.domElement.clientWidth,n.x*=e,n.y*=t),n.multiplyScalar(h.length()*o.panSpeed),i.copy(h).cross(o.object.up).setLength(n.x),i.add(r.copy(o.object.up).setLength(n.y)),o.object.position.add(i),o.target.add(i),o.staticMoving?v.copy(y):v.add(n.subVectors(y,v).multiplyScalar(o.dynamicDampingFactor)))}}(),this.checkDistances=function(){o.noZoom&&o.noPan||(h.lengthSq()>o.maxDistance*o.maxDistance&&(o.object.position.addVectors(o.target,h.setLength(o.maxDistance)),m.copy(g)),h.lengthSq()<o.minDistance*o.minDistance&&(o.object.position.addVectors(o.target,h.setLength(o.minDistance)),m.copy(g)))},this.update=function(){h.subVectors(o.object.position,o.target),o.noRotate||o.rotateCamera(),o.noZoom||o.zoomCamera(),o.noPan||o.panCamera(),o.object.position.addVectors(o.target,h),o.object.isPerspectiveCamera?(o.checkDistances(),o.object.lookAt(o.target),1e-6<r.distanceToSquared(o.object.position)&&(o.dispatchEvent(Au),r.copy(o.object.position))):o.object.isOrthographicCamera?(o.object.lookAt(o.target),(1e-6<r.distanceToSquared(o.object.position)||i!==o.object.zoom)&&(o.dispatchEvent(Au),r.copy(o.object.position),i=o.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type")},this.reset=function(){s=n.NONE,a=n.NONE,o.target.copy(o.target0),o.object.position.copy(o.position0),o.object.up.copy(o.up0),o.object.zoom=o.zoom0,o.object.updateProjectionMatrix(),h.subVectors(o.object.position,o.target),o.object.lookAt(o.target),o.dispatchEvent(Au),r.copy(o.object.position),i=o.object.zoom},this.dispose=function(){o.domElement.removeEventListener("contextmenu",P),o.domElement.removeEventListener("pointerdown",M),o.domElement.removeEventListener("pointercancel",T),o.domElement.removeEventListener("wheel",A),o.domElement.removeEventListener("pointermove",S),o.domElement.removeEventListener("pointerup",E),window.removeEventListener("keydown",C),window.removeEventListener("keyup",L)},this.domElement.addEventListener("contextmenu",P),this.domElement.addEventListener("pointerdown",M),this.domElement.addEventListener("pointercancel",T),this.domElement.addEventListener("wheel",A,{passive:!1}),window.addEventListener("keydown",C),window.addEventListener("keyup",L),this.handleResize(),this.update()}}class Nu extends Uc{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(e){return new Uu(e)}),this.register(function(e){return new Gu(e)}),this.register(function(e){return new Wu(e)}),this.register(function(e){return new Vu(e)}),this.register(function(e){return new Fu(e)}),this.register(function(e){return new Hu(e)}),this.register(function(e){return new Bu(e)}),this.register(function(e){return new Ou(e)}),this.register(function(e){return new ju(e)})}load(t,n,e,r){const i=this;let s;s=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:du.extractUrlBase(t),this.manager.itemStart(t);function a(e){r?r(e):console.error(e),i.manager.itemError(t),i.manager.itemEnd(t)}const o=new Fc(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,function(e){try{i.parse(e,s,function(e){n(e),i.manager.itemEnd(t)},a)}catch(e){a(e)}},e,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,r){let i;const s={},a={};if("string"==typeof e)i=e;else if(du.decodeText(new Uint8Array(e,0,4))===qu){try{s[ku.KHR_BINARY_GLTF]=new Yu(e)}catch(e){return void(r&&r(e))}i=s[ku.KHR_BINARY_GLTF].content}else i=du.decodeText(new Uint8Array(e));var o=JSON.parse(i);if(void 0===o.asset||o.asset.version[0]<2)r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{const u=new vh(o,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});u.fileLoader.setRequestHeader(this.requestHeader);for(let e=0;e<this.pluginCallbacks.length;e++){var l=this.pluginCallbacks[e](u);a[l.name]=l,s[l.name]=!0}if(o.extensionsUsed)for(let e=0;e<o.extensionsUsed.length;++e){var c=o.extensionsUsed[e];const h=o.extensionsRequired||[];switch(c){case ku.KHR_MATERIALS_UNLIT:s[c]=new zu;break;case ku.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:s[c]=new $u;break;case ku.KHR_DRACO_MESH_COMPRESSION:s[c]=new Ku(o,this.dracoLoader);break;case ku.KHR_TEXTURE_TRANSFORM:s[c]=new Ju;break;case ku.KHR_MESH_QUANTIZATION:s[c]=new Qu;break;default:0<=h.indexOf(c)&&void 0===a[c]&&console.warn('THREE.GLTFLoader: Unknown extension "'+c+'".')}}u.setExtensions(s),u.setPlugins(a),u.parse(n,r)}}}function Iu(){let n={};return{get:function(e){return n[e]},add:function(e,t){n[e]=t},remove:function(e){delete n[e]},removeAll:function(){n={}}}}const ku={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class Ou{constructor(e){this.parser=e,this.name=ku.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const n=this.parser;var r=this.parser.json.nodes||[];for(let e=0,t=r.length;e<t;e++){var i=r[e];i.extensions&&i.extensions[this.name]&&void 0!==i.extensions[this.name].light&&n._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(e){const t=this.parser;var n="light:"+e;let r=t.cache.get(n);if(r)return r;var i=t.json;const s=((i.extensions&&i.extensions[this.name]||{}).lights||[])[e];let a;const o=new pr(16777215);void 0!==s.color&&o.fromArray(s.color);var l=void 0!==s.range?s.range:0;switch(s.type){case"directional":a=new ou(o),a.target.position.set(0,0,-1),a.add(a.target);break;case"point":a=new su(o),a.distance=l;break;case"spot":a=new eu(o),a.distance=l,s.spot=s.spot||{},s.spot.innerConeAngle=void 0!==s.spot.innerConeAngle?s.spot.innerConeAngle:0,s.spot.outerConeAngle=void 0!==s.spot.outerConeAngle?s.spot.outerConeAngle:Math.PI/4,a.angle=s.spot.outerConeAngle,a.penumbra=1-s.spot.innerConeAngle/s.spot.outerConeAngle,a.target.position.set(0,0,-1),a.add(a.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+s.type)}return a.position.set(0,0,0),a.decay=2,void 0!==s.intensity&&(a.intensity=s.intensity),a.name=t.createUniqueName(s.name||"light_"+e),r=Promise.resolve(a),t.cache.add(n,r),r}createNodeAttachment(e){const t=this,n=this.parser;e=n.json.nodes[e];const r=(e.extensions&&e.extensions[this.name]||{}).light;return void 0===r?null:this._loadLight(r).then(function(e){return n._getNodeRef(t.cache,r,e)})}}class zu{constructor(){this.name=ku.KHR_MATERIALS_UNLIT}getMaterialType(){return fr}extendParams(e,t,n){const r=[];e.color=new pr(1,1,1),e.opacity=1;var i=t.pbrMetallicRoughness;return i&&(Array.isArray(i.baseColorFactor)&&(t=i.baseColorFactor,e.color.fromArray(t),e.opacity=t[3]),void 0!==i.baseColorTexture&&r.push(n.assignTexture(e,"map",i.baseColorTexture))),Promise.all(r)}}class Uu{constructor(e){this.parser=e,this.name=ku.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){e=this.parser.json.materials[e];return e.extensions&&e.extensions[this.name]?fc:null}extendMaterialParams(e,t){const n=this.parser;e=n.json.materials[e];if(!e.extensions||!e.extensions[this.name])return Promise.resolve();const r=[];e=e.extensions[this.name];return void 0!==e.clearcoatFactor&&(t.clearcoat=e.clearcoatFactor),void 0!==e.clearcoatTexture&&r.push(n.assignTexture(t,"clearcoatMap",e.clearcoatTexture)),void 0!==e.clearcoatRoughnessFactor&&(t.clearcoatRoughness=e.clearcoatRoughnessFactor),void 0!==e.clearcoatRoughnessTexture&&r.push(n.assignTexture(t,"clearcoatRoughnessMap",e.clearcoatRoughnessTexture)),void 0!==e.clearcoatNormalTexture&&(r.push(n.assignTexture(t,"clearcoatNormalMap",e.clearcoatNormalTexture)),void 0!==e.clearcoatNormalTexture.scale&&(e=e.clearcoatNormalTexture.scale,t.clearcoatNormalScale=new Nt(e,-e))),Promise.all(r)}}class Vu{constructor(e){this.parser=e,this.name=ku.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){e=this.parser.json.materials[e];return e.extensions&&e.extensions[this.name]?fc:null}extendMaterialParams(e,t){const n=this.parser;e=n.json.materials[e];if(!e.extensions||!e.extensions[this.name])return Promise.resolve();const r=[];e=e.extensions[this.name];return void 0!==e.transmissionFactor&&(t.transmission=e.transmissionFactor),void 0!==e.transmissionTexture&&r.push(n.assignTexture(t,"transmissionMap",e.transmissionTexture)),Promise.all(r)}}class Fu{constructor(e){this.parser=e,this.name=ku.KHR_MATERIALS_VOLUME}getMaterialType(e){e=this.parser.json.materials[e];return e.extensions&&e.extensions[this.name]?fc:null}extendMaterialParams(e,t){const n=this.parser;e=n.json.materials[e];if(!e.extensions||!e.extensions[this.name])return Promise.resolve();const r=[];e=e.extensions[this.name];t.thickness=void 0!==e.thicknessFactor?e.thicknessFactor:0,void 0!==e.thicknessTexture&&r.push(n.assignTexture(t,"thicknessMap",e.thicknessTexture)),t.attenuationDistance=e.attenuationDistance||0;e=e.attenuationColor||[1,1,1];return t.attenuationTint=new pr(e[0],e[1],e[2]),Promise.all(r)}}class Hu{constructor(e){this.parser=e,this.name=ku.KHR_MATERIALS_IOR}getMaterialType(e){e=this.parser.json.materials[e];return e.extensions&&e.extensions[this.name]?fc:null}extendMaterialParams(e,t){e=this.parser.json.materials[e];if(!e.extensions||!e.extensions[this.name])return Promise.resolve();e=e.extensions[this.name];return t.ior=void 0!==e.ior?e.ior:1.5,Promise.resolve()}}class Bu{constructor(e){this.parser=e,this.name=ku.KHR_MATERIALS_SPECULAR}getMaterialType(e){e=this.parser.json.materials[e];return e.extensions&&e.extensions[this.name]?fc:null}extendMaterialParams(e,t){const n=this.parser;var r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const i=[];e=r.extensions[this.name];t.specularIntensity=void 0!==e.specularFactor?e.specularFactor:1,void 0!==e.specularTexture&&i.push(n.assignTexture(t,"specularIntensityMap",e.specularTexture));r=e.specularColorFactor||[1,1,1];return t.specularTint=new pr(r[0],r[1],r[2]),void 0!==e.specularColorTexture&&i.push(n.assignTexture(t,"specularTintMap",e.specularColorTexture).then(function(e){e.encoding=3001})),Promise.all(i)}}class Gu{constructor(e){this.parser=e,this.name=ku.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json;var r=n.textures[e];if(!r.extensions||!r.extensions[this.name])return null;var i=r.extensions[this.name],r=n.images[i.source],i=t.options.ktx2Loader;if(i)return t.loadTextureImage(e,r,i);if(n.extensionsRequired&&0<=n.extensionsRequired.indexOf(this.name))throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}}class Wu{constructor(e){this.parser=e,this.name=ku.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(t){const n=this.name,r=this.parser,i=r.json;var e=i.textures[t];if(!e.extensions||!e.extensions[n])return null;e=e.extensions[n];const s=i.images[e.source];let a=r.textureLoader;return!s.uri||null!==(e=r.options.manager.getHandler(s.uri))&&(a=e),this.detectSupport().then(function(e){if(e)return r.loadTextureImage(t,s,a);if(i.extensionsRequired&&0<=i.extensionsRequired.indexOf(n))throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return r.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}}class ju{constructor(e){this.name=ku.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json;e=t.bufferViews[e];if(e.extensions&&e.extensions[this.name]){const a=e.extensions[this.name];e=this.parser.getDependency("buffer",a.buffer);const o=this.parser.options.meshoptDecoder;if(o&&o.supported)return Promise.all([e,o.ready]).then(function(e){var t=a.byteOffset||0,n=a.byteLength||0,r=a.count,i=a.byteStride,s=new ArrayBuffer(r*i),n=new Uint8Array(e[0],t,n);return o.decodeGltfBuffer(new Uint8Array(s),r,i,n,a.mode,a.filter),s});if(t.extensionsRequired&&0<=t.extensionsRequired.indexOf(this.name))throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return null}}const qu="glTF",Xu={JSON:1313821514,BIN:5130562};class Yu{constructor(e){this.name=ku.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12);if(this.header={magic:du.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==qu)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");var n=this.header.length-12;const r=new DataView(e,12);let i=0;for(;i<n;){var s=r.getUint32(i,!0);i+=4;var a,o=r.getUint32(i,!0);i+=4,o===Xu.JSON?(a=new Uint8Array(e,12+i,s),this.content=du.decodeText(a)):o===Xu.BIN&&(o=12+i,this.body=e.slice(o,o+s)),i+=s}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Ku{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=ku.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){var n=this.json;const r=this.dracoLoader;var i=e.extensions[this.name].bufferView,s=e.extensions[this.name].attributes;const a={},o={},l={};for(const p in s){var c=lh[p]||p.toLowerCase();a[c]=s[p]}for(const f in e.attributes){var u,h,d=lh[f]||f.toLowerCase();void 0!==s[f]&&(u=n.accessors[e.attributes[f]],h=ih[u.componentType],l[d]=h,o[d]=!0===u.normalized)}return t.getDependency("bufferView",i).then(function(e){return new Promise(function(i){r.decodeDracoFile(e,function(e){for(const n in e.attributes){const r=e.attributes[n];var t=o[n];void 0!==t&&(r.normalized=t)}i(e)},a,l)})})}}class Ju{constructor(){this.name=ku.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),void 0===t.offset&&void 0===t.rotation&&void 0===t.scale||(e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class Zu extends pc{constructor(e){super(),this.isGLTFSpecularGlossinessMaterial=!0;const n=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),r=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),i=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),s=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),a=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),o={specular:{value:(new pr).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=o,this.onBeforeCompile=function(e){for(const t in o)e.uniforms[t]=o[t];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",n).replace("#include <metalnessmap_pars_fragment>",r).replace("#include <roughnessmap_fragment>",i).replace("#include <metalnessmap_fragment>",s).replace("#include <lights_physical_fragment>",a)},Object.defineProperties(this,{specular:{get:function(){return o.specular.value},set:function(e){o.specular.value=e}},specularMap:{get:function(){return o.specularMap.value},set:function(e){(o.specularMap.value=e)?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return o.glossiness.value},set:function(e){o.glossiness.value=e}},glossinessMap:{get:function(){return o.glossinessMap.value},set:function(e){(o.glossinessMap.value=e)?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class $u{constructor(){this.name=ku.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"]}getMaterialType(){return Zu}extendParams(e,t,n){var r=t.extensions[this.name];e.color=new pr(1,1,1),e.opacity=1;const i=[];return Array.isArray(r.diffuseFactor)&&(t=r.diffuseFactor,e.color.fromArray(t),e.opacity=t[3]),void 0!==r.diffuseTexture&&i.push(n.assignTexture(e,"map",r.diffuseTexture)),e.emissive=new pr(0,0,0),e.glossiness=void 0!==r.glossinessFactor?r.glossinessFactor:1,e.specular=new pr(1,1,1),Array.isArray(r.specularFactor)&&e.specular.fromArray(r.specularFactor),void 0!==r.specularGlossinessTexture&&(r=r.specularGlossinessTexture,i.push(n.assignTexture(e,"glossinessMap",r)),i.push(n.assignTexture(e,"specularMap",r))),Promise.all(i)}createMaterial(e){const t=new Zu(e);return t.fog=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,t.normalMapType=vt,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t}}class Qu{constructor(){this.name=ku.KHR_MESH_QUANTIZATION}}class eh extends wc{constructor(e,t,n,r){super(e,t,n,r)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=e*r*3+r;for(let e=0;e!==r;e++)t[e]=n[i+e];return t}}eh.prototype.beforeStart_=eh.prototype.copySampleValue_,eh.prototype.afterEnd_=eh.prototype.copySampleValue_,eh.prototype.interpolate_=function(e,t,n,r){const i=this.resultBuffer;var s=this.sampleValues,a=this.valueSize,o=2*a,l=3*a,c=r-t,r=(n-t)/c,n=r*r,t=n*r,u=e*l,h=u-l,d=-2*t+3*n,p=t-n,f=1-d,m=p-n+r;for(let e=0;e!==a;e++){var g=s[h+e+a],v=s[h+e+o]*c,y=s[u+e+a],x=s[u+e]*c;i[e]=f*g+m*v+d*y+p*x}return i};const th=new Gt;class nh extends eh{interpolate_(e,t,n,r){r=super.interpolate_(e,t,n,r);return th.fromArray(r).normalize().toArray(r),r}}const rh={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},ih={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},sh={9728:Ie,9729:G,9984:H,9985:W,9986:B,9987:ke},ah={33071:Ne,33648:F,10497:V},oh={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},lh={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},ch={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},uh={CUBICSPLINE:void 0,LINEAR:2301,STEP:2300},hh={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function dh(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}function ph(e,t,n){for(const r in n.extensions)void 0===e[r]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[r]=n.extensions[r])}function fh(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function mh(n){let r="";var i=Object.keys(n).sort();for(let e=0,t=i.length;e<t;e++)r+=i[e]+":"+n[i[e]]+";";return r}function gh(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}class vh{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new Iu,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.textureCache={},this.nodeNamesUsed={},"undefined"!=typeof createImageBitmap&&!1===/Firefox/.test(navigator.userAgent)?this.textureLoader=new fu(this.options.manager):this.textureLoader=new Gc(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Fc(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(n,e){const r=this,i=this.json,s=this.extensions;this.cache.removeAll(),this._invokeAll(function(e){return e._markDefs&&e._markDefs()}),Promise.all(this._invokeAll(function(e){return e.beforeRoot&&e.beforeRoot()})).then(function(){return Promise.all([r.getDependencies("scene"),r.getDependencies("animation"),r.getDependencies("camera")])}).then(function(e){const t={scene:e[0][i.scene||0],scenes:e[0],animations:e[1],cameras:e[2],asset:i.asset,parser:r,userData:{}};ph(s,t,i),fh(t,i),Promise.all(r._invokeAll(function(e){return e.afterRoot&&e.afterRoot(t)})).then(function(){n(t)})}).catch(e)}_markDefs(){const n=this.json.nodes||[];var r=this.json.skins||[];const i=this.json.meshes||[];for(let e=0,t=r.length;e<t;e++){var s=r[e].joints;for(let e=0,t=s.length;e<t;e++)n[s[e]].isBone=!0}for(let e=0,t=n.length;e<t;e++){var a=n[e];void 0!==a.mesh&&(this._addNodeRef(this.meshCache,a.mesh),void 0!==a.skin&&(i[a.mesh].isSkinnedMesh=!0)),void 0!==a.camera&&this._addNodeRef(this.cameraCache,a.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const r=n.clone();return r.name+="_instance_"+e.uses[t]++,r}_invokeOne(t){const n=Object.values(this.plugins);n.push(this);for(let e=0;e<n.length;e++){var r=t(n[e]);if(r)return r}return null}_invokeAll(t){const n=Object.values(this.plugins);n.unshift(this);const r=[];for(let e=0;e<n.length;e++){var i=t(n[e]);i&&r.push(i)}return r}getDependency(e,t){var n=e+":"+t;let r=this.cache.get(n);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this.loadNode(t);break;case"mesh":r=this._invokeOne(function(e){return e.loadMesh&&e.loadMesh(t)});break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne(function(e){return e.loadBufferView&&e.loadBufferView(t)});break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne(function(e){return e.loadMaterial&&e.loadMaterial(t)});break;case"texture":r=this._invokeOne(function(e){return e.loadTexture&&e.loadTexture(t)});break;case"skin":r=this.loadSkin(t);break;case"animation":r=this.loadAnimation(t);break;case"camera":r=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(n,r)}return r}getDependencies(n){let e=this.cache.get(n);if(!e){const r=this,t=this.json[n+("mesh"===n?"es":"s")]||[];e=Promise.all(t.map(function(e,t){return r.getDependency(n,t)})),this.cache.add(n,e)}return e}loadBuffer(e){const n=this.json.buffers[e],r=this.fileLoader;if(n.type&&"arraybuffer"!==n.type)throw new Error("THREE.GLTFLoader: "+n.type+" buffer type is not supported.");if(void 0===n.uri&&0===e)return Promise.resolve(this.extensions[ku.KHR_BINARY_GLTF].body);const i=this.options;return new Promise(function(e,t){r.load(dh(n.uri,i.path),e,void 0,function(){t(new Error('THREE.GLTFLoader: Failed to load buffer "'+n.uri+'".'))})})}loadBufferView(e){const r=this.json.bufferViews[e];return this.getDependency("buffer",r.buffer).then(function(e){var t=r.byteLength||0,n=r.byteOffset||0;return e.slice(n,n+t)})}loadAccessor(e){const g=this,v=this.json,y=this.json.accessors[e];if(void 0===y.bufferView&&void 0===y.sparse)return Promise.resolve(null);const t=[];return void 0!==y.bufferView?t.push(this.getDependency("bufferView",y.bufferView)):t.push(null),void 0!==y.sparse&&(t.push(this.getDependency("bufferView",y.sparse.indices.bufferView)),t.push(this.getDependency("bufferView",y.sparse.values.bufferView))),Promise.all(t).then(function(e){var t=e[0],n=oh[y.type];const r=ih[y.componentType];var i=r.BYTES_PER_ELEMENT,s=i*n,a=y.byteOffset||0,o=void 0!==y.bufferView?v.bufferViews[y.bufferView].byteStride:void 0,l=!0===y.normalized;let c,u;if(o&&o!==s){var h=Math.floor(a/o),s="InterleavedBuffer:"+y.bufferView+":"+y.componentType+":"+h+":"+y.count;let e=g.cache.get(s);e||(c=new r(t,h*o,y.count*o/i),e=new Qa(c,o/i),g.cache.add(s,e)),u=new to(e,n,a%o/i,l)}else c=null===t?new r(y.count*n):new r(t,a,y.count*n),u=new vr(c,n,l);if(void 0!==y.sparse){i=oh.SCALAR;const m=ih[y.sparse.indices.componentType];var a=y.sparse.indices.byteOffset||0,l=y.sparse.values.byteOffset||0,d=new m(e[1],a,y.sparse.count*i),p=new r(e[2],l,y.sparse.count*n);null!==t&&(u=new vr(u.array.slice(),u.itemSize,u.normalized));for(let e=0,t=d.length;e<t;e++){var f=d[e];if(u.setX(f,p[e*n]),2<=n&&u.setY(f,p[e*n+1]),3<=n&&u.setZ(f,p[e*n+2]),4<=n&&u.setW(f,p[e*n+3]),5<=n)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return u})}loadTexture(e){var t=this.json;const n=this.options;var r=t.textures[e],t=t.images[r.source];let i=this.textureLoader;return!t.uri||null!==(r=n.manager.getHandler(t.uri))&&(i=r),this.loadTextureImage(e,t,i)}loadTextureImage(n,r,i){const s=this,a=this.json,o=this.options,l=a.textures[n];var e=(r.uri||r.bufferView)+":"+l.sampler;if(this.textureCache[e])return this.textureCache[e];const c=self.URL||self.webkitURL;let u=r.uri||"",h=!1,d=!0;var t=0<u.search(/\.jpe?g($|\?)/i)||0===u.search(/^data\:image\/jpeg/);if("image/jpeg"!==r.mimeType&&!t||(d=!1),void 0!==r.bufferView)u=s.getDependency("bufferView",r.bufferView).then(function(e){var t;"image/png"===r.mimeType&&(t=new DataView(e,25,1).getUint8(0,!1),d=6===t||4===t||3===t),h=!0;e=new Blob([e],{type:r.mimeType});return u=c.createObjectURL(e),u});else if(void 0===r.uri)throw new Error("THREE.GLTFLoader: Image "+n+" is missing URI and bufferView");t=Promise.resolve(u).then(function(r){return new Promise(function(n,e){let t=n;!0===i.isImageBitmapLoader&&(t=function(e){const t=new Ut(e);t.needsUpdate=!0,n(t)}),i.load(dh(r,o.path),t,void 0,e)})}).then(function(e){!0===h&&c.revokeObjectURL(u),e.flipY=!1,l.name&&(e.name=l.name),d||(e.format=Ce);var t=(a.samplers||{})[l.sampler]||{};return e.magFilter=sh[t.magFilter]||G,e.minFilter=sh[t.minFilter]||ke,e.wrapS=ah[t.wrapS]||V,e.wrapT=ah[t.wrapT]||V,s.associations.set(e,{type:"textures",index:n}),e}).catch(function(){return console.error("THREE.GLTFLoader: Couldn't load texture",u),null});return this.textureCache[e]=t}assignTexture(r,i,s){const a=this;return this.getDependency("texture",s.index).then(function(e){var t,n;return void 0===s.texCoord||0==s.texCoord||"aoMap"===i&&1==s.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+s.texCoord+" for texture "+i+" not yet supported."),!a.extensions[ku.KHR_TEXTURE_TRANSFORM]||(t=void 0!==s.extensions?s.extensions[ku.KHR_TEXTURE_TRANSFORM]:void 0)&&(n=a.associations.get(e),e=a.extensions[ku.KHR_TEXTURE_TRANSFORM].extendTexture(e,t),a.associations.set(e,n)),r[i]=e})}assignFinalMaterial(e){const t=e.geometry;let n=e.material;var r=void 0!==t.attributes.tangent,i=void 0!==t.attributes.color,s=void 0===t.attributes.normal;if(e.isPoints){var a="PointsMaterial:"+n.uuid;let e=this.cache.get(a);e||(e=new Xo,ar.prototype.copy.call(e,n),e.color.copy(n.color),e.map=n.map,e.sizeAttenuation=!1,this.cache.add(a,e)),n=e}else if(e.isLine){a="LineBasicMaterial:"+n.uuid;let e=this.cache.get(a);e||(e=new Oo,ar.prototype.copy.call(e,n),e.color.copy(n.color),this.cache.add(a,e)),n=e}if(r||i||s){let e="ClonedMaterial:"+n.uuid+":";n.isGLTFSpecularGlossinessMaterial&&(e+="specular-glossiness:"),r&&(e+="vertex-tangents:"),i&&(e+="vertex-colors:"),s&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=n.clone(),i&&(t.vertexColors=!0),s&&(t.flatShading=!0),r&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(n))),n=t}n.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&t.setAttribute("uv2",t.attributes.uv),e.material=n}getMaterialType(){return pc}loadMaterial(t){const n=this;var e=this.json;const r=this.extensions,i=e.materials[t];let s;const a={};e=i.extensions||{};const o=[];if(e[ku.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const c=r[ku.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];s=c.getMaterialType(),o.push(c.extendParams(a,i,n))}else if(e[ku.KHR_MATERIALS_UNLIT]){const u=r[ku.KHR_MATERIALS_UNLIT];s=u.getMaterialType(),o.push(u.extendParams(a,i,n))}else{var l=i.pbrMetallicRoughness||{};a.color=new pr(1,1,1),a.opacity=1,Array.isArray(l.baseColorFactor)&&(e=l.baseColorFactor,a.color.fromArray(e),a.opacity=e[3]),void 0!==l.baseColorTexture&&o.push(n.assignTexture(a,"map",l.baseColorTexture)),a.metalness=void 0!==l.metallicFactor?l.metallicFactor:1,a.roughness=void 0!==l.roughnessFactor?l.roughnessFactor:1,void 0!==l.metallicRoughnessTexture&&(o.push(n.assignTexture(a,"metalnessMap",l.metallicRoughnessTexture)),o.push(n.assignTexture(a,"roughnessMap",l.metallicRoughnessTexture))),s=this._invokeOne(function(e){return e.getMaterialType&&e.getMaterialType(t)}),o.push(Promise.all(this._invokeAll(function(e){return e.extendMaterialParams&&e.extendMaterialParams(t,a)})))}!0===i.doubleSided&&(a.side=Re);l=i.alphaMode||hh.OPAQUE;return l===hh.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.format=Ce,a.transparent=!1,l===hh.MASK&&(a.alphaTest=void 0!==i.alphaCutoff?i.alphaCutoff:.5)),void 0!==i.normalTexture&&s!==fr&&(o.push(n.assignTexture(a,"normalMap",i.normalTexture)),a.normalScale=new Nt(1,-1),void 0!==i.normalTexture.scale&&a.normalScale.set(i.normalTexture.scale,-i.normalTexture.scale)),void 0!==i.occlusionTexture&&s!==fr&&(o.push(n.assignTexture(a,"aoMap",i.occlusionTexture)),void 0!==i.occlusionTexture.strength&&(a.aoMapIntensity=i.occlusionTexture.strength)),void 0!==i.emissiveFactor&&s!==fr&&(a.emissive=(new pr).fromArray(i.emissiveFactor)),void 0!==i.emissiveTexture&&s!==fr&&o.push(n.assignTexture(a,"emissiveMap",i.emissiveTexture)),Promise.all(o).then(function(){let e;return e=s===Zu?r[ku.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(a):new s(a),i.name&&(e.name=i.name),e.map&&(e.map.encoding=3001),e.emissiveMap&&(e.emissiveMap.encoding=3001),fh(e,i),n.associations.set(e,{type:"materials",index:t}),i.extensions&&ph(r,e,i),e})}createUniqueName(e){var t=Su.sanitizeNodeName(e||"");let n=t;for(let e=1;this.nodeNamesUsed[n];++e)n=t+"_"+e;return this.nodeNamesUsed[n]=!0,n}loadGeometries(n){const r=this,i=this.extensions,s=this.primitiveCache;const a=[];for(let e=0,t=n.length;e<t;e++){var o=n[e],l=function(e){var t=e.extensions&&e.extensions[ku.KHR_DRACO_MESH_COMPRESSION];let n;return n=t?"draco:"+t.bufferView+":"+t.indices+":"+mh(t.attributes):e.indices+":"+mh(e.attributes)+":"+e.mode,n}(o),c=s[l];if(c)a.push(c.promise);else{let e;e=o.extensions&&o.extensions[ku.KHR_DRACO_MESH_COMPRESSION]?function(t){return i[ku.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(t,r).then(function(e){return yh(e,t,r)})}(o):yh(new Ar,o,r),s[l]={primitive:o,promise:e},a.push(e)}}return Promise.all(a)}loadMesh(c){const u=this;var e=this.json;const h=this.extensions,d=e.meshes[c],p=d.primitives,n=[];for(let e=0,t=p.length;e<t;e++){var r=void 0===p[e].material?(void 0===(r=this.cache).DefaultMaterial&&(r.DefaultMaterial=new pc({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Ae})),r.DefaultMaterial):this.getDependency("material",p[e].material);n.push(r)}return n.push(u.loadGeometries(p)),Promise.all(n).then(function(e){var n=e.slice(0,e.length-1),r=e[e.length-1];const i=[];for(let t=0,e=r.length;t<e;t++){var s=r[t],a=p[t];let e;var o=n[t];if(a.mode===rh.TRIANGLES||a.mode===rh.TRIANGLE_STRIP||a.mode===rh.TRIANGLE_FAN||void 0===a.mode)e=new(!0===d.isSkinnedMesh?So:Xr)(s,o),!0!==e.isSkinnedMesh||e.geometry.attributes.skinWeight.normalized||e.normalizeSkinWeights(),a.mode===rh.TRIANGLE_STRIP?e.geometry=xh(e.geometry,1):a.mode===rh.TRIANGLE_FAN&&(e.geometry=xh(e.geometry,2));else if(a.mode===rh.LINES)e=new jo(s,o);else if(a.mode===rh.LINE_STRIP)e=new Bo(s,o);else if(a.mode===rh.LINE_LOOP)e=new qo(s,o);else{if(a.mode!==rh.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+a.mode);e=new $o(s,o)}0<Object.keys(e.geometry.morphAttributes).length&&function(n,r){if(n.updateMorphTargets(),void 0!==r.weights)for(let e=0,t=r.weights.length;e<t;e++)n.morphTargetInfluences[e]=r.weights[e];if(r.extras&&Array.isArray(r.extras.targetNames)){var i=r.extras.targetNames;if(n.morphTargetInfluences.length===i.length){n.morphTargetDictionary={};for(let e=0,t=i.length;e<t;e++)n.morphTargetDictionary[i[e]]=e}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}(e,d),e.name=u.createUniqueName(d.name||"mesh_"+c),fh(e,d),a.extensions&&ph(h,e,a),u.assignFinalMaterial(e),i.push(e)}if(1===i.length)return i[0];const l=new Wa;for(let e=0,t=i.length;e<t;e++)l.add(i[e]);return l})}loadCamera(e){let t;var n=this.json.cameras[e],e=n[n.type];if(e)return"perspective"===n.type?t=new ti(Dt.radToDeg(e.yfov),e.aspectRatio||1,e.znear||1,e.zfar||2e6):"orthographic"===n.type&&(t=new Si(-e.xmag,e.xmag,e.ymag,-e.ymag,e.znear,e.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),fh(t,n),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){e=this.json.skins[e];const t={joints:e.joints};return void 0===e.inverseBindMatrices?Promise.resolve(t):this.getDependency("accessor",e.inverseBindMatrices).then(function(e){return t.inverseBindMatrices=e,t})}loadAnimation(t){const x=this.json.animations[t],n=[],r=[],i=[],s=[],a=[];for(let e=0,t=x.channels.length;e<t;e++){var o=x.channels[e],l=x.samplers[o.sampler],c=o.target,u=void 0!==c.node?c.node:c.id,h=void 0!==x.parameters?x.parameters[l.input]:l.input,o=void 0!==x.parameters?x.parameters[l.output]:l.output;n.push(this.getDependency("node",u)),r.push(this.getDependency("accessor",h)),i.push(this.getDependency("accessor",o)),s.push(l),a.push(c)}return Promise.all([Promise.all(n),Promise.all(r),Promise.all(i),Promise.all(s),Promise.all(a)]).then(function(e){var n=e[0],r=e[1],i=e[2],s=e[3],a=e[4];const o=[];for(let e=0,t=n.length;e<t;e++){const m=n[e];var l=r[e],c=i[e],u=s[e],h=a[e];if(void 0!==m){m.updateMatrix(),m.matrixAutoUpdate=!0;let n;switch(ch[h.path]){case ch.weights:n=Ac;break;case ch.rotation:n=Rc;break;case ch.position:case ch.scale:default:n=Nc}var d=m.name||m.uuid,p=void 0!==u.interpolation?uh[u.interpolation]:2301;const g=[];ch[h.path]===ch.weights?m.traverse(function(e){!0===e.isMesh&&e.morphTargetInfluences&&g.push(e.name||e.uuid)}):g.push(d);let r=c.array;if(c.normalized){var f=gh(r.constructor);const v=new Float32Array(r.length);for(let e=0,t=r.length;e<t;e++)v[e]=r[e]*f;r=v}for(let e=0,t=g.length;e<t;e++){const y=new n(g[e]+"."+ch[h.path],l.array,r,p);"CUBICSPLINE"===u.interpolation&&(y.createInterpolant=function(e){const t=this instanceof Rc?nh:eh;return new t(this.times,this.values,this.getValueSize()/3,e)},y.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),o.push(y)}}}e=x.name||"animation_"+t;return new Ic(e,void 0,o)})}createNodeMesh(e){var t=this.json;const n=this,r=t.nodes[e];return void 0===r.mesh?null:n.getDependency("mesh",r.mesh).then(function(e){const t=n._getNodeRef(n.meshCache,r.mesh,e);return void 0!==r.weights&&t.traverse(function(n){if(n.isMesh)for(let e=0,t=r.weights.length;e<t;e++)n.morphTargetInfluences[e]=r.weights[e]}),t})}loadNode(i){var e=this.json;const t=this.extensions,s=this,a=e.nodes[i],o=a.name?s.createUniqueName(a.name):"";return function(){const t=[];var e=s._invokeOne(function(e){return e.createNodeMesh&&e.createNodeMesh(i)});return e&&t.push(e),void 0!==a.camera&&t.push(s.getDependency("camera",a.camera).then(function(e){return s._getNodeRef(s.cameraCache,a.camera,e)})),s._invokeAll(function(e){return e.createNodeAttachment&&e.createNodeAttachment(i)}).forEach(function(e){t.push(e)}),Promise.all(t)}().then(function(n){let r;if(r=!0===a.isBone?new Eo:1<n.length?new Wa:1===n.length?n[0]:new Xn,r!==n[0])for(let e=0,t=n.length;e<t;e++)r.add(n[e]);if(a.name&&(r.userData.name=a.name,r.name=o),fh(r,a),a.extensions&&ph(t,r,a),void 0!==a.matrix){const e=new wn;e.fromArray(a.matrix),r.applyMatrix4(e)}else void 0!==a.translation&&r.position.fromArray(a.translation),void 0!==a.rotation&&r.quaternion.fromArray(a.rotation),void 0!==a.scale&&r.scale.fromArray(a.scale);return s.associations.set(r,{type:"nodes",index:i}),r})}loadScene(e){var n=this.json,t=this.extensions,e=this.json.scenes[e];const r=new Wa;e.name&&(r.name=this.createUniqueName(e.name)),fh(r,e),e.extensions&&ph(t,r,e);var i=e.nodes||[];const s=[];for(let e=0,t=i.length;e<t;e++)s.push(function a(e,t,o,l){const c=o.nodes[e];return l.getDependency("node",e).then(function(e){if(void 0===c.skin)return e;let o;return l.getDependency("skin",c.skin).then(function(e){o=e;const n=[];for(let e=0,t=o.joints.length;e<t;e++)n.push(l.getDependency("node",o.joints[e]));return Promise.all(n)}).then(function(a){return e.traverse(function(e){if(e.isMesh){const n=[],r=[];for(let e=0,t=a.length;e<t;e++){const i=a[e];if(i){n.push(i);const s=new wn;void 0!==o.inverseBindMatrices&&s.fromArray(o.inverseBindMatrices.array,16*e),r.push(s)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',o.joints[e])}e.bind(new Ao(n,r),e.matrixWorld)}}),e})}).then(function(n){t.add(n);const r=[];if(c.children){const i=c.children;for(let e=0,t=i.length;e<t;e++){const s=i[e];r.push(a(s,n,o,l))}}return Promise.all(r)})}(i[e],r,n,this));return Promise.all(s).then(function(){return r})}}function yh(n,e,r){var t,i=e.attributes;const s=[];for(const o in i){var a=lh[o]||o.toLowerCase();a in n.attributes||s.push(function(e,t){return r.getDependency("accessor",e).then(function(e){n.setAttribute(t,e)})}(i[o],a))}return void 0===e.indices||n.index||(t=r.getDependency("accessor",e.indices).then(function(e){n.setIndex(e)}),s.push(t)),fh(n,e),function(e,t,n){var r=t.attributes;const i=new Xt;if(void 0!==r.POSITION){var s=n.json.accessors[r.POSITION],a=s.min,r=s.max;if(void 0!==a&&void 0!==r){i.set(new Wt(a[0],a[1],a[2]),new Wt(r[0],r[1],r[2])),s.normalized&&(s=gh(ih[s.componentType]),i.min.multiplyScalar(s),i.max.multiplyScalar(s));var o=t.targets;if(void 0!==o){const d=new Wt,p=new Wt;for(let e=0,t=o.length;e<t;e++){var l,c,u=o[e];void 0!==u.POSITION&&(l=(c=n.json.accessors[u.POSITION]).min,u=c.max,void 0!==l&&void 0!==u?(p.setX(Math.max(Math.abs(l[0]),Math.abs(u[0]))),p.setY(Math.max(Math.abs(l[1]),Math.abs(u[1]))),p.setZ(Math.max(Math.abs(l[2]),Math.abs(u[2]))),c.normalized&&(c=gh(ih[c.componentType]),p.multiplyScalar(c)),d.max(p)):console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION."))}i.expandByVector(d)}e.boundingBox=i;const h=new pn;i.getCenter(h.center),h.radius=i.min.distanceTo(i.max)/2,e.boundingSphere=h}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}(n,e,r),Promise.all(s).then(function(){return void 0!==e.targets?function(n,r,i){let s=!1,a=!1;for(let e=0,t=r.length;e<t;e++){var o=r[e];if(void 0!==o.POSITION&&(s=!0),void 0!==o.NORMAL&&(a=!0),s&&a)break}if(!s&&!a)return Promise.resolve(n);const l=[],c=[];for(let e=0,t=r.length;e<t;e++){var u,h=r[e];s&&(u=void 0!==h.POSITION?i.getDependency("accessor",h.POSITION):n.attributes.position,l.push(u)),a&&(h=void 0!==h.NORMAL?i.getDependency("accessor",h.NORMAL):n.attributes.normal,c.push(h))}return Promise.all([Promise.all(l),Promise.all(c)]).then(function(e){var t=e[0],e=e[1];return s&&(n.morphAttributes.position=t),a&&(n.morphAttributes.normal=e),n.morphTargetsRelative=!0,n})}(n,e.targets,r):n})}function xh(e,t){let n=e.getIndex();if(null===n){const o=[];var r=e.getAttribute("position");if(void 0===r)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<r.count;e++)o.push(e);e.setIndex(o),n=e.getIndex()}var i=n.count-2;const s=[];if(2===t)for(let e=1;e<=i;e++)s.push(n.getX(0)),s.push(n.getX(e)),s.push(n.getX(e+1));else for(let e=0;e<i;e++)e%2==0?(s.push(n.getX(e)),s.push(n.getX(e+1)),s.push(n.getX(e+2))):(s.push(n.getX(e+2)),s.push(n.getX(e+1)),s.push(n.getX(e)));s.length/3!=i&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const a=e.clone();return a.setIndex(s),a}const bh=new WeakMap;class _h extends Uc{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,n,t,r){const i=new Fc(this.manager);i.setPath(this.path),i.setResponseType("arraybuffer"),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(e,e=>{var t={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(e,t).then(n).catch(r)},t,r)}decodeDracoFile(e,t,n,r){n={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:r||this.defaultAttributeTypes,useUniqueIDs:!!n};this.decodeGeometry(e,n).then(t)}decodeGeometry(n,r){for(const l in r.attributeTypes){var e=r.attributeTypes[l];void 0!==e.BYTES_PER_ELEMENT&&(r.attributeTypes[l]=e.name)}var t=JSON.stringify(r);if(bh.has(n)){var i=bh.get(n);if(i.key===t)return i.promise;if(0===n.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let s;const a=this.workerNextTaskID++;i=n.byteLength;const o=this._getWorker(a,i).then(e=>(s=e,new Promise((e,t)=>{s._callbacks[a]={resolve:e,reject:t},s.postMessage({type:"decode",id:a,taskConfig:r,buffer:n},[n])}))).then(e=>this._createGeometry(e.geometry));return o.catch(()=>!0).then(()=>{s&&a&&this._releaseTask(s,a)}),bh.set(n,{key:t,promise:o}),o}_createGeometry(t){const n=new Ar;t.index&&n.setIndex(new vr(t.index.array,1));for(let e=0;e<t.attributes.length;e++){var r=t.attributes[e],i=r.name,s=r.array,r=r.itemSize;n.setAttribute(i,new vr(s,r))}return n}_loadLibrary(n,e){const r=new Fc(this.manager);return r.setPath(this.decoderPath),r.setResponseType(e),r.setWithCredentials(this.withCredentials),new Promise((e,t)=>{r.load(n,e,void 0,t)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const r="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,e=[];return r?e.push(this._loadLibrary("draco_decoder.js","text")):(e.push(this._loadLibrary("draco_wasm_wrapper.js","text")),e.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(e).then(e=>{const t=e[0];r||(this.decoderConfig.wasmBinary=e[1]);const n=function(){let n,t;function l(n,r,e,i){var s=i.attributeIDs,a=i.attributeTypes;let o,t;var l=r.GetEncodedGeometryType(e);if(l===n.TRIANGULAR_MESH)o=new n.Mesh,t=r.DecodeBufferToMesh(e,o);else{if(l!==n.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");o=new n.PointCloud,t=r.DecodeBufferToPointCloud(e,o)}if(!t.ok()||0===o.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+t.error_msg());const c={index:null,attributes:[]};for(const h in s){var u=self[a[h]];let e,t;if(i.useUniqueIDs)t=s[h],e=r.GetAttributeByUniqueId(o,t);else{if(t=r.GetAttributeId(o,n[s[h]]),-1===t)continue;e=r.GetAttribute(o,t)}c.attributes.push(function(e,t,n,r,i,s){var a=s.num_components(),o=n.num_points(),l=o*a,c=l*i.BYTES_PER_ELEMENT,u=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32}}(e,i),o=e._malloc(c);t.GetAttributeDataArrayForAllPoints(n,s,u,c,o);l=new i(e.HEAPF32.buffer,o,l).slice();return e._free(o),{name:r,array:l,itemSize:a}}(n,r,o,h,u,e))}return l===n.TRIANGULAR_MESH&&(c.index=function(e,t,n){var r=n.num_faces(),i=3*r,s=4*i,r=e._malloc(s);t.GetTrianglesUInt32Array(n,s,r);i=new Uint32Array(e.HEAPF32.buffer,r,i).slice();return e._free(r),{array:i,itemSize:1}}(n,r,o)),n.destroy(o),c}onmessage=function(e){const s=e.data;switch(s.type){case"init":n=s.decoderConfig,t=new Promise(function(t){n.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(n)});break;case"decode":const a=s.buffer,o=s.taskConfig;t.then(e=>{const t=e.draco;e=new t.Decoder;const n=new t.DecoderBuffer;n.Init(new Int8Array(a),a.byteLength);try{const r=l(t,e,n,o),i=r.attributes.map(e=>e.array.buffer);r.index&&i.push(r.index.array.buffer),self.postMessage({type:"decode",id:s.id,geometry:r},i)}catch(e){console.error(e),self.postMessage({type:"error",id:s.id,error:e.message})}finally{t.destroy(n),t.destroy(e)}})}}}.toString();e=["/* draco decoder */",t,"","/* worker */",n.substring(n.indexOf("{")+1,n.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([e]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const n=new Worker(this.workerSourceURL);n._callbacks={},n._taskCosts={},n._taskLoad=0,n.postMessage({type:"init",decoderConfig:this.decoderConfig}),n.onmessage=function(e){var t=e.data;switch(t.type){case"decode":n._callbacks[t.id].resolve(t);break;case"error":n._callbacks[t.id].reject(t);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+t.type+'"')}},this.workerPool.push(n)}else this.workerPool.sort(function(e,t){return e._taskLoad>t._taskLoad?-1:1});const n=this.workerPool[this.workerPool.length-1];return n._taskCosts[e]=t,n._taskLoad+=t,n})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}var wh=Ch(466),Mh=Ch(498);const Sh=class extends class{constructor(e){this.options=e}debug(){}_onScroll(e){return this.onScroll(e)}_onResize(e){return this.onResize(e)}_onMouseMove(e){return this.onMouseMove(e)}_onUpdate(e){return this.onUpdate(e)}onScroll(e){}onResize(e){}onMouseMove(e){}onUpdate(e){}}{constructor(e){super(),this.options=e,this.config={envMapIntensity:4.6},this.createLights(),e=new Bc,this.environmentMap=e.load(["./scripts/tools/Scene/textures/environmentMaps/0/px.jpg","./scripts/tools/Scene/textures/environmentMaps/0/nx.jpg","./scripts/tools/Scene/textures/environmentMaps/0/py.jpg","./scripts/tools/Scene/textures/environmentMaps/0/ny.jpg","./scripts/tools/Scene/textures/environmentMaps/0/pz.jpg","./scripts/tools/Scene/textures/environmentMaps/0/nz.jpg"]),this.environmentMap.encoding=3001,this.options.scene.background=this.environmentMap,this.options.scene.environment=this.environmentMap,this.options.loaders.gltf.load("./scripts/tools/Scene/models/Burger/glTF/hamburger.glb",e=>{if(this.helmet=e.scene,this.helmet.scale.set(10,10,10),this.helmet.position.set(0,-4,0),this.helmet.rotation.y=.5*Math.PI,this.options.scene.add(this.helmet),this.updateAllMaterials(),this.options.debug)return this.debug()})}updateAllMaterials(){return this.options.scene.traverse(e=>{if(e instanceof Xr&&e.material instanceof pc)return e.material.envMapIntensity=this.config.envMapIntensity,e.material.needsUpdate=!0,e.castShadow=!0,e.receiveShadow=!0})}debug(){var e;return this.debugFolder=this.options.debug.addFolder({title:"Realistic Render",expanded:!0}),(e=this.debugFolder.addFolder({title:"Light",expanded:!1})).addInput(this.directionalLight,"intensity",{min:0,max:10,step:.001}),e.addInput(this.directionalLight.position,"x",{min:-5,max:5,step:.001}),e.addInput(this.directionalLight.position,"y",{min:-5,max:5,step:.001}),e.addInput(this.directionalLight.position,"z",{min:-5,max:5,step:.001}),(e=this.debugFolder.addFolder({title:"Helmet",expanded:!1})).addInput(this.helmet.rotation,"y",{min:-Math.PI,max:Math.PI,step:.001,label:"rotationY"}),e.addInput(this.config,"envMapIntensity",{min:0,max:20,step:.1}).on("change",e=>this.updateAllMaterials())}createLights(){return this.directionalLight=new ou(16777215,1),this.directionalLight.position.set(.25,3,-2.25),this.directionalLight.castShadow=!0,this.directionalLight.shadow.camera.far=15,this.directionalLight.shadow.mapSize.set(1024,1024),this.options.scene.add(this.directionalLight)}onUpdate(e){}},Eh=class{constructor(e){this.options=e,this.clock=new yu,this.scene=this.createScene(),this.camera=this.createCamera(),this.renderer=this.createRenderer(),this.debug=this.createDebug(),this.stats=this.createStats(),this.controls=this.createControls(),this.composer=this.createComposer(),this.loaders=this.createLoaders(),this.components=this.createComponents(),window.addEventListener("resize",e=>this.onResize(e)),window.addEventListener("mousemove",e=>this.onMouseMove(e)),this.onUpdate(),console.log(this)}createScene(){return new $a}createCamera(){var e=this.getViewport().aspectRatio,e=new ti(75,e,.1,100);return e.position.set(4,1,-4),e.lookAt(new Wt(0,0,0)),e}createRenderer(){var e=new Ka({antialias:!0,alpha:!0});return e.setSize(this.getViewport().width,this.getViewport().height),e.setPixelRatio=Math.min(window.devicePixelRatio,2),e.setClearColor("#000000"),e.shadowMap.enabled=!0,e.shadowMap.type=2,e.outputEncoding=3001,e.toneMapping=2,this.options.container.appendChild(e.domElement),e.domElement.style.position="fixed",e.domElement.style.top="0px",e.domElement.style.left="0px",e}createComponents(){var e={debug:this.debug,loaders:this.loaders,scene:this.scene,camera:this.camera,renderer:this.renderer};return{realisticRender:new Sh(e)}}createControls(){var e;return!!this.options.controls&&((e=new Du(this.camera,this.renderer.domElement)).noZoom=!1,e)}createDebug(){var e,t;return!!this.options.debug&&((t=new Mh.Pane({title:"CONTROLS",expanded:!0})).addSeparator(),(e=t.addFolder({title:"Camera",expanded:!1})).addInput(this.camera.position,"x",{min:-20,max:20,step:.01}),e.addInput(this.camera.position,"y",{min:-20,max:20,step:.01}),e.addInput(this.camera.position,"z",{min:-20,max:20,step:.01}),t)}createStats(){var e;return!!this.options.stats&&(e=new wh,this.options.container.appendChild(e.dom),e)}createComposer(){return!!this.options.composer&&composer}createLoaders(){var e,t={};return t.texture=new Gc,t.font=new vu,(new _h).setDecoderPath("./scripts/tools/Scene/draco/"),e=new Nu,t.gltf=e,t}getViewport(){var e=window.innerWidth,t=window.innerHeight;return{width:e,height:t,aspectRatio:e/t}}onScroll(e){var t,n,r=this.components,i=[];for(n in r)t=r[n],i.push(t._onScroll(e));return i}onResize(e){var t,n=this.components;for(t in n)n[t]._onResize(e);return this.camera.aspect=this.getViewport().aspectRatio,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.getViewport().width,this.getViewport().height)}onMouseMove(e){var t,n,r=this.components,i=[];for(n in r)t=r[n],i.push(t._onMouseMove(e));return i}onUpdate(){var e,t=this.clock.getElapsedTime(),n=this.components;for(e in n)n[e]._onUpdate(t);return this.controls&&this.controls.update(),this.stats&&this.stats.update(),this.composer?this.composer.render():this.renderer.render(this.scene,this.camera),requestAnimationFrame(()=>this.onUpdate())}};t()(function(){return new Eh({container:document.querySelector("body"),debug:!0,controls:!0,stats:!0,composer:!1})})})()})();