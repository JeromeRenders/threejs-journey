(()=>{var n={125:t=>{t.exports=function i(r,s,o){function a(n,t){if(!s[n]){if(!r[n]){if(0,l)return l(n,!0);throw new Error("Cannot find module '"+n+"'")}var e=s[n]={exports:{}};r[n][0].call(e.exports,function(t){var e=r[n][1][t];return a(e||t)},e,e.exports,i,r,s,o)}return s[n].exports}for(var l=void 0,t=0;t<o.length;t++)a(o[t]);return a}({1:[function(t,e,n){e.exports={name:"cannon",version:"0.6.2",description:"A lightweight 3D physics engine written in JavaScript.",homepage:"https://github.com/schteppe/cannon.js",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["cannon.js","cannon","physics","engine","3d"],main:"./build/cannon.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/cannon.js.git"},bugs:{url:"https://github.com/schteppe/cannon.js/issues"},licenses:[{type:"MIT"}],devDependencies:{jshint:"latest","uglify-js":"latest",nodeunit:"^0.9.0",grunt:"~0.4.0","grunt-contrib-jshint":"~0.1.1","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-concat":"~0.1.3","grunt-contrib-uglify":"^0.5.1","grunt-browserify":"^2.1.4","grunt-contrib-yuidoc":"^0.5.2",browserify:"*"},dependencies:{}}},{}],2:[function(t,e,n){e.exports={version:t("../package.json").version,AABB:t("./collision/AABB"),ArrayCollisionMatrix:t("./collision/ArrayCollisionMatrix"),Body:t("./objects/Body"),Box:t("./shapes/Box"),Broadphase:t("./collision/Broadphase"),Constraint:t("./constraints/Constraint"),ContactEquation:t("./equations/ContactEquation"),Narrowphase:t("./world/Narrowphase"),ConeTwistConstraint:t("./constraints/ConeTwistConstraint"),ContactMaterial:t("./material/ContactMaterial"),ConvexPolyhedron:t("./shapes/ConvexPolyhedron"),Cylinder:t("./shapes/Cylinder"),DistanceConstraint:t("./constraints/DistanceConstraint"),Equation:t("./equations/Equation"),EventTarget:t("./utils/EventTarget"),FrictionEquation:t("./equations/FrictionEquation"),GSSolver:t("./solver/GSSolver"),GridBroadphase:t("./collision/GridBroadphase"),Heightfield:t("./shapes/Heightfield"),HingeConstraint:t("./constraints/HingeConstraint"),LockConstraint:t("./constraints/LockConstraint"),Mat3:t("./math/Mat3"),Material:t("./material/Material"),NaiveBroadphase:t("./collision/NaiveBroadphase"),ObjectCollisionMatrix:t("./collision/ObjectCollisionMatrix"),Pool:t("./utils/Pool"),Particle:t("./shapes/Particle"),Plane:t("./shapes/Plane"),PointToPointConstraint:t("./constraints/PointToPointConstraint"),Quaternion:t("./math/Quaternion"),Ray:t("./collision/Ray"),RaycastVehicle:t("./objects/RaycastVehicle"),RaycastResult:t("./collision/RaycastResult"),RigidVehicle:t("./objects/RigidVehicle"),RotationalEquation:t("./equations/RotationalEquation"),RotationalMotorEquation:t("./equations/RotationalMotorEquation"),SAPBroadphase:t("./collision/SAPBroadphase"),SPHSystem:t("./objects/SPHSystem"),Shape:t("./shapes/Shape"),Solver:t("./solver/Solver"),Sphere:t("./shapes/Sphere"),SplitSolver:t("./solver/SplitSolver"),Spring:t("./objects/Spring"),Trimesh:t("./shapes/Trimesh"),Vec3:t("./math/Vec3"),Vec3Pool:t("./utils/Vec3Pool"),World:t("./world/World")}},{"../package.json":1,"./collision/AABB":3,"./collision/ArrayCollisionMatrix":4,"./collision/Broadphase":5,"./collision/GridBroadphase":6,"./collision/NaiveBroadphase":7,"./collision/ObjectCollisionMatrix":8,"./collision/Ray":9,"./collision/RaycastResult":10,"./collision/SAPBroadphase":11,"./constraints/ConeTwistConstraint":12,"./constraints/Constraint":13,"./constraints/DistanceConstraint":14,"./constraints/HingeConstraint":15,"./constraints/LockConstraint":16,"./constraints/PointToPointConstraint":17,"./equations/ContactEquation":19,"./equations/Equation":20,"./equations/FrictionEquation":21,"./equations/RotationalEquation":22,"./equations/RotationalMotorEquation":23,"./material/ContactMaterial":24,"./material/Material":25,"./math/Mat3":27,"./math/Quaternion":28,"./math/Vec3":30,"./objects/Body":31,"./objects/RaycastVehicle":32,"./objects/RigidVehicle":33,"./objects/SPHSystem":34,"./objects/Spring":35,"./shapes/Box":37,"./shapes/ConvexPolyhedron":38,"./shapes/Cylinder":39,"./shapes/Heightfield":40,"./shapes/Particle":41,"./shapes/Plane":42,"./shapes/Shape":43,"./shapes/Sphere":44,"./shapes/Trimesh":45,"./solver/GSSolver":46,"./solver/Solver":47,"./solver/SplitSolver":48,"./utils/EventTarget":49,"./utils/Pool":51,"./utils/Vec3Pool":54,"./world/Narrowphase":55,"./world/World":56}],3:[function(t,e,n){var i=t("../math/Vec3");t("../utils/Utils");function r(t){t=t||{},this.lowerBound=new i,t.lowerBound&&this.lowerBound.copy(t.lowerBound),this.upperBound=new i,t.upperBound&&this.upperBound.copy(t.upperBound)}e.exports=r;var h=new i;r.prototype.setFromPoints=function(t,e,n,i){var r=this.lowerBound,s=this.upperBound,o=n;r.copy(t[0]),o&&o.vmult(r,r),s.copy(r);for(var a=1;a<t.length;a++){var l=t[a];o&&(o.vmult(l,h),l=h),l.x>s.x&&(s.x=l.x),l.x<r.x&&(r.x=l.x),l.y>s.y&&(s.y=l.y),l.y<r.y&&(r.y=l.y),l.z>s.z&&(s.z=l.z),l.z<r.z&&(r.z=l.z)}return e&&(e.vadd(r,r),e.vadd(s,s)),i&&(r.x-=i,r.y-=i,r.z-=i,s.x+=i,s.y+=i,s.z+=i),this},r.prototype.copy=function(t){return this.lowerBound.copy(t.lowerBound),this.upperBound.copy(t.upperBound),this},r.prototype.clone=function(){return(new r).copy(this)},r.prototype.extend=function(t){var e=t.lowerBound.x;this.lowerBound.x>e&&(this.lowerBound.x=e);var n=t.upperBound.x;this.upperBound.x<n&&(this.upperBound.x=n);e=t.lowerBound.y;this.lowerBound.y>e&&(this.lowerBound.y=e);n=t.upperBound.y;this.upperBound.y<n&&(this.upperBound.y=n);e=t.lowerBound.z;this.lowerBound.z>e&&(this.lowerBound.z=e);n=t.upperBound.z;this.upperBound.z<n&&(this.upperBound.z=n)},r.prototype.overlaps=function(t){var e=this.lowerBound,n=this.upperBound,i=t.lowerBound,t=t.upperBound;return(i.x<=n.x&&n.x<=t.x||e.x<=t.x&&t.x<=n.x)&&(i.y<=n.y&&n.y<=t.y||e.y<=t.y&&t.y<=n.y)&&(i.z<=n.z&&n.z<=t.z||e.z<=t.z&&t.z<=n.z)},r.prototype.contains=function(t){var e=this.lowerBound,n=this.upperBound,i=t.lowerBound,t=t.upperBound;return e.x<=i.x&&n.x>=t.x&&e.y<=i.y&&n.y>=t.y&&e.z<=i.z&&n.z>=t.z},r.prototype.getCorners=function(t,e,n,i,r,s,o,a){var l=this.lowerBound,h=this.upperBound;t.copy(l),e.set(h.x,l.y,l.z),n.set(h.x,h.y,l.z),i.set(l.x,h.y,h.z),r.set(h.x,l.y,l.z),s.set(l.x,h.y,l.z),o.set(l.x,l.y,h.z),a.copy(h)};var s=[new i,new i,new i,new i,new i,new i,new i,new i];r.prototype.toLocalFrame=function(t,e){var n=s;this.getCorners(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7]);for(var i=0;8!==i;i++){var r=n[i];t.pointToLocal(r,r)}return e.setFromPoints(n)},r.prototype.toWorldFrame=function(t,e){var n=s;this.getCorners(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7]);for(var i=0;8!==i;i++){var r=n[i];t.pointToWorld(r,r)}return e.setFromPoints(n)}},{"../math/Vec3":30,"../utils/Utils":53}],4:[function(t,e,n){function i(){this.matrix=[]}(e.exports=i).prototype.get=function(t,e){var n;return(t=t.index)<(e=e.index)&&(n=e,e=t,t=n),this.matrix[(t*(t+1)>>1)+e-1]},i.prototype.set=function(t,e,n){var i;(t=t.index)<(e=e.index)&&(i=e,e=t,t=i),this.matrix[(t*(t+1)>>1)+e-1]=n?1:0},i.prototype.reset=function(){for(var t=0,e=this.matrix.length;t!==e;t++)this.matrix[t]=0},i.prototype.setNumObjects=function(t){this.matrix.length=t*(t-1)>>1}},{}],5:[function(t,e,n){var i=t("../objects/Body"),r=t("../math/Vec3"),s=t("../math/Quaternion");t("../shapes/Shape"),t("../shapes/Plane");function o(){this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}(e.exports=o).prototype.collisionPairs=function(t,e,n){throw new Error("collisionPairs not implemented for this BroadPhase class!")};var a=i.STATIC|i.KINEMATIC;o.prototype.needBroadphaseCollision=function(t,e){return 0!=(t.collisionFilterGroup&e.collisionFilterMask)&&0!=(e.collisionFilterGroup&t.collisionFilterMask)&&(0==(t.type&a)&&t.sleepState!==i.SLEEPING||0==(e.type&a)&&e.sleepState!==i.SLEEPING)},o.prototype.intersectionTest=function(t,e,n,i){this.useBoundingBoxes?this.doBoundingBoxBroadphase(t,e,n,i):this.doBoundingSphereBroadphase(t,e,n,i)};var l=new r;new r,new s,new r;o.prototype.doBoundingSphereBroadphase=function(t,e,n,i){var r=l;e.position.vsub(t.position,r);var s=Math.pow(t.boundingRadius+e.boundingRadius,2);r.norm2()<s&&(n.push(t),i.push(e))},o.prototype.doBoundingBoxBroadphase=function(t,e,n,i){t.aabbNeedsUpdate&&t.computeAABB(),e.aabbNeedsUpdate&&e.computeAABB(),t.aabb.overlaps(e.aabb)&&(n.push(t),i.push(e))};var u={keys:[]},d=[],p=[];o.prototype.makePairsUnique=function(t,e){for(var n=u,i=d,r=p,s=t.length,o=0;o!==s;o++)i[o]=t[o],r[o]=e[o];t.length=0;for(o=e.length=0;o!==s;o++){var a=i[o].id,l=r[o].id;n[h=a<l?a+","+l:l+","+a]=o,n.keys.push(h)}for(o=0;o!==n.keys.length;o++){var h=n.keys.pop(),c=n[h];t.push(i[c]),e.push(r[c]),delete n[h]}},o.prototype.setWorld=function(t){};var h=new r;o.boundingSphereCheck=function(t,e){var n=h;return t.position.vsub(e.position,n),Math.pow(t.shape.boundingSphereRadius+e.shape.boundingSphereRadius,2)>n.norm2()},o.prototype.aabbQuery=function(t,e,n){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Plane":42,"../shapes/Shape":43}],6:[function(t,e,n){e.exports=i;var a=t("./Broadphase"),l=t("../math/Vec3"),$=t("../shapes/Shape");function i(t,e,n,i,r){a.apply(this),this.nx=n||10,this.ny=i||10,this.nz=r||10,this.aabbMin=t||new l(100,100,100),this.aabbMax=e||new l(-100,-100,-100);var s=this.nx*this.ny*this.nz;if(s<=0)throw"GridBroadphase: Each dimension's n must be >0";this.bins=[],this.binLengths=[],this.bins.length=s,this.binLengths.length=s;for(var o=0;o<s;o++)this.bins[o]=[],this.binLengths[o]=0}(i.prototype=new a).constructor=i;var tt=new l;new l;i.prototype.collisionPairs=function(t,e,n){for(var i=t.numObjects(),r=t.bodies,s=this.aabbMax,o=this.aabbMin,v=this.nx,g=this.ny,y=this.nz,x=g*y,_=y,b=1,a=s.x,l=s.y,t=s.z,w=o.x,M=o.y,S=o.z,E=v/(a-w),T=g/(l-M),A=y/(t-S),h=(a-w)/v,c=(l-M)/g,u=(t-S)/y,d=.5*Math.sqrt(h*h+c*c+u*u),t=$.types,p=t.SPHERE,m=t.PLANE,C=(t.BOX,t.COMPOUND,t.CONVEXPOLYHEDRON,this.bins),P=this.binLengths,f=this.bins.length,L=0;L!==f;L++)P[L]=0;var R=Math.ceil;Math.min,Math.max;function I(t,e,n,i,r,s,o){var t=(t-w)*E|0,a=(e-M)*T|0,l=(n-S)*A|0,h=R((i-w)*E),c=R((r-M)*T),u=R((s-S)*A);t<0?t=0:v<=t&&(t=v-1),a<0?a=0:g<=a&&(a=g-1),l<0?l=0:y<=l&&(l=y-1),h<0?h=0:v<=h&&(h=v-1),c<0?c=0:g<=c&&(c=g-1),u<0?u=0:y<=u&&(u=y-1),a*=_,l*=b,h*=x,c*=_,u*=b;for(var d=t*=x;d<=h;d+=x)for(var p=a;p<=c;p+=_)for(var m=l;m<=u;m+=b){var f=d+p+m;C[f][P[f]++]=o}}for(L=0;L!==i;L++){var z=(J=r[L]).shape;switch(z.type){case p:var N=J.position.x,B=J.position.y,D=J.position.z,F=z.radius;I(N-F,B-F,D-F,N+F,B+F,D+F,J);break;case m:z.worldNormalNeedsUpdate&&z.computeWorldNormal(J.quaternion);var k=z.worldNormal,F=w+.5*h-J.position.x,O=M+.5*c-J.position.y,V=S+.5*u-J.position.z,U=tt;U.set(F,O,V);for(var H=0,W=0;H!==v;H++,W+=x,U.y=O,U.x+=h)for(var G=0,j=0;G!==g;G++,j+=_,U.z=V,U.y+=c)for(var q,X=0,Y=0;X!==y;X++,Y+=b,U.z+=u)U.dot(k)<d&&(C[q=W+j+Y][P[q]++]=J);break;default:J.aabbNeedsUpdate&&J.computeAABB(),I(J.aabb.lowerBound.x,J.aabb.lowerBound.y,J.aabb.lowerBound.z,J.aabb.upperBound.x,J.aabb.upperBound.y,J.aabb.upperBound.z,J)}}for(L=0;L!==f;L++){var Z=P[L];if(1<Z)for(var K=C[L],H=0;H!==Z;H++)for(var J=K[H],G=0;G!==H;G++){var Q=K[G];this.needBroadphaseCollision(J,Q)&&this.intersectionTest(J,Q,e,n)}}this.makePairsUnique(e,n)}},{"../math/Vec3":30,"../shapes/Shape":43,"./Broadphase":5}],7:[function(t,e,n){e.exports=r;var i=t("./Broadphase"),t=t("./AABB");function r(){i.apply(this)}((r.prototype=new i).constructor=r).prototype.collisionPairs=function(t,e,n){for(var i,r,s,o=t.bodies,a=o.length,l=0;l!==a;l++)for(i=0;i!==l;i++)r=o[l],s=o[i],this.needBroadphaseCollision(r,s)&&this.intersectionTest(r,s,e,n)};new t;r.prototype.aabbQuery=function(t,e,n){n=n||[];for(var i=0;i<t.bodies.length;i++){var r=t.bodies[i];r.aabbNeedsUpdate&&r.computeAABB(),r.aabb.overlaps(e)&&n.push(r)}return n}},{"./AABB":3,"./Broadphase":5}],8:[function(t,e,n){function i(){this.matrix={}}(e.exports=i).prototype.get=function(t,e){var n;return(t=t.id)<(e=e.id)&&(n=e,e=t,t=n),t+"-"+e in this.matrix},i.prototype.set=function(t,e,n){var i;(t=t.id)<(e=e.id)&&(i=e,e=t,t=i),n?this.matrix[t+"-"+e]=!0:delete this.matrix[t+"-"+e]},i.prototype.reset=function(){this.matrix={}},i.prototype.setNumObjects=function(t){}},{}],9:[function(t,e,n){e.exports=m;var p=t("../math/Vec3"),i=t("../math/Quaternion"),w=t("../math/Transform"),r=(t("../shapes/ConvexPolyhedron"),t("../shapes/Box"),t("../collision/RaycastResult")),e=t("../shapes/Shape"),t=t("../collision/AABB");function m(t,e){this.from=t?t.clone():new p,this.to=e?e.clone():new p,this._direction=new p,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=m.ANY,this.result=new r,this.hasHit=!1,this.callback=function(t){}}(m.prototype.constructor=m).CLOSEST=1,m.ANY=2,m.ALL=4;var s=new t,o=[];m.prototype.intersectWorld=function(t,e){return this.mode=e.mode||m.ANY,this.result=e.result||new r,this.skipBackfaces=!!e.skipBackfaces,this.collisionFilterMask=void 0!==e.collisionFilterMask?e.collisionFilterMask:-1,this.collisionFilterGroup=void 0!==e.collisionFilterGroup?e.collisionFilterGroup:-1,e.from&&this.from.copy(e.from),e.to&&this.to.copy(e.to),this.callback=e.callback||function(){},this.hasHit=!1,this.result.reset(),this._updateDirection(),this.getAABB(s),o.length=0,t.broadphase.aabbQuery(t,s,o),this.intersectBodies(o),this.hasHit};var a=new p,l=new p;function S(t,e,n,i){i.vsub(e,u),n.vsub(e,a),t.vsub(e,l);var r,s=u.dot(u),o=u.dot(a),i=u.dot(l),n=a.dot(a),t=a.dot(l);return 0<=(e=n*i-o*t)&&0<=(r=s*t-o*i)&&e+r<s*n-o*o}m.pointInTriangle=S;var h=new p,c=new i;m.prototype.intersectBody=function(t,e){e&&(this.result=e,this._updateDirection());var n=this.checkCollisionResponse;if((!n||t.collisionResponse)&&0!=(this.collisionFilterGroup&t.collisionFilterMask)&&0!=(t.collisionFilterGroup&this.collisionFilterMask))for(var i=h,r=c,s=0,o=t.shapes.length;s<o;s++){var a=t.shapes[s];if((!n||a.collisionResponse)&&(t.quaternion.mult(t.shapeOrientations[s],r),t.quaternion.vmult(t.shapeOffsets[s],i),i.vadd(t.position,i),this.intersectShape(a,r,i,t),this.result._shouldStop))break}},m.prototype.intersectBodies=function(t,e){e&&(this.result=e,this._updateDirection());for(var n=0,i=t.length;!this.result._shouldStop&&n<i;n++)this.intersectBody(t[n])},m.prototype._updateDirection=function(){this.to.vsub(this.from,this._direction),this._direction.normalize()},m.prototype.intersectShape=function(t,e,n,i){var r;(function(t,e,n){n.vsub(t,u);var i=u.dot(e);return e.mult(i,g),g.vadd(t,g),n.distanceTo(g)})(this.from,this._direction,n)>t.boundingSphereRadius||(r=this[t.type])&&r.call(this,t,e,n,i)};new p,new p;var E=new p,T=new p,A=new p,C=new p;new p,new r;m.prototype[e.types.BOX]=m.prototype.intersectBox=function(t,e,n,i){return this.intersectConvex(t.convexPolyhedronRepresentation,e,n,i)},m.prototype[e.types.PLANE]=m.prototype.intersectPlane=function(t,e,n,i){var r=this.from,s=this.to,o=this._direction,a=new p(0,0,1);e.vmult(a,a);var l=new p;r.vsub(n,l);var h=l.dot(a);s.vsub(n,l),0<h*l.dot(a)||r.distanceTo(s)<h||(e=a.dot(o),Math.abs(e)<this.precision||(l=new p,s=new p,h=new p,r.vsub(n,l),e=-a.dot(l)/e,o.scale(e,s),r.vadd(s,h),this.reportIntersection(a,h,t,i,-1)))},m.prototype.getAABB=function(t){var e=this.to,n=this.from;t.lowerBound.x=Math.min(e.x,n.x),t.lowerBound.y=Math.min(e.y,n.y),t.lowerBound.z=Math.min(e.z,n.z),t.upperBound.x=Math.max(e.x,n.x),t.upperBound.y=Math.max(e.y,n.y),t.upperBound.z=Math.max(e.z,n.z)};var f={faceList:[0]};m.prototype.intersectHeightfield=function(t,e,n,i){t.data,t.elementSize;var r=new p,s=new m(this.from,this.to);w.pointToLocalFrame(n,e,s.from,s.from),w.pointToLocalFrame(n,e,s.to,s.to);var o=[],a=null,l=null,h=null,c=null;if(t.getIndexOfPosition(s.from.x,s.from.y,o,!1)&&(h=a=o[0],c=l=o[1]),t.getIndexOfPosition(s.to.x,s.to.y,o,!1)&&((null===a||o[0]<a)&&(a=o[0]),(null===h||h<o[0])&&(h=o[0]),(null===l||o[1]<l)&&(l=o[1]),(null===c||c<o[1])&&(c=o[1])),null!==a){o=[];t.getRectMinMax(a,l,h,c,o);for(var u=a;u<=h;u++)for(var d=l;d<=c;d++){if(this.result._shouldStop)return;if(t.getConvexTrianglePillar(u,d,!1),w.pointToWorldFrame(n,e,t.pillarOffset,r),this.intersectConvex(t.pillarConvex,e,r,i,f),this.result._shouldStop)return;t.getConvexTrianglePillar(u,d,!0),w.pointToWorldFrame(n,e,t.pillarOffset,r),this.intersectConvex(t.pillarConvex,e,r,i,f)}}},m.prototype[e.types.HEIGHTFIELD]=m.prototype.intersectHeightfield;var d=new p,v=new p;m.prototype[e.types.SPHERE]=m.prototype.intersectSphere=function(t,e,n,i){var r=this.from,s=this.to,o=t.radius,a=Math.pow(s.x-r.x,2)+Math.pow(s.y-r.y,2)+Math.pow(s.z-r.z,2),l=2*((s.x-r.x)*(r.x-n.x)+(s.y-r.y)*(r.y-n.y)+(s.z-r.z)*(r.z-n.z)),h=Math.pow(r.x-n.x,2)+Math.pow(r.y-n.y,2)+Math.pow(r.z-n.z,2)-Math.pow(o,2),c=Math.pow(l,2)-4*a*h,u=d,o=v;c<0||(0==c?(r.lerp(s,c,u),u.vsub(n,o),o.normalize(),this.reportIntersection(o,u,t,i,-1)):(h=(-l-Math.sqrt(c))/(2*a),a=(-l+Math.sqrt(c))/(2*a),0<=h&&h<=1&&(r.lerp(s,h,u),u.vsub(n,o),o.normalize(),this.reportIntersection(o,u,t,i,-1)),this.result._shouldStop||0<=a&&a<=1&&(r.lerp(s,a,u),u.vsub(n,o),o.normalize(),this.reportIntersection(o,u,t,i,-1))))};var P=new p,L=(new p,new p,new p);m.prototype.intersectConvex=function(t,e,n,i,r){for(var s=P,o=L,a=r&&r.faceList||null,l=t.faces,h=t.vertices,c=t.faceNormals,u=this._direction,d=this.from,r=this.to,p=d.distanceTo(r),m=(a||l).length,f=this.result,v=0;!f._shouldStop&&v<m;v++){var g=a?a[v]:v,y=l[g],x=c[g],_=e,b=n;o.copy(h[y[0]]),_.vmult(o,o),o.vadd(b,o),o.vsub(d,o),_.vmult(x,s);x=u.dot(s);if(!(Math.abs(x)<this.precision)){x=s.dot(o)/x;if(!(x<0)){u.mult(x,E),E.vadd(d,E),T.copy(h[y[0]]),_.vmult(T,T),b.vadd(T,T);for(var w=1;!f._shouldStop&&w<y.length-1;w++){A.copy(h[y[w]]),C.copy(h[y[w+1]]),_.vmult(A,A),_.vmult(C,C),b.vadd(A,A),b.vadd(C,C);var M=E.distanceTo(d);!S(E,T,A,C)&&!S(E,A,T,C)||p<M||this.reportIntersection(s,E,t,i,g)}}}}},m.prototype[e.types.CONVEXPOLYHEDRON]=m.prototype.intersectConvex;var M=new p,R=new p,I=new p,z=new p,N=new p,B=new p,D=(new t,[]),F=new w;m.prototype.intersectTrimesh=function(t,e,n,i,r){var s=M,o=D,a=F,l=L,h=R,c=I,u=z,d=B,p=N,m=(r&&r.faceList,t.indices),f=(t.vertices,t.faceNormals,this.from),v=this.to,r=this._direction;a.position.copy(n),a.quaternion.copy(e),w.vectorToLocalFrame(n,e,r,h),w.pointToLocalFrame(n,e,f,c),w.pointToLocalFrame(n,e,v,u);var g=c.distanceSquared(u);t.tree.rayQuery(this,a,o);for(var y=0,x=o.length;!this.result._shouldStop&&y!==x;y++){var _=o[y];t.getNormal(_,s),t.getVertex(m[3*_],T),T.vsub(c,l);var b=h.dot(s),b=s.dot(l)/b;b<0||(h.scale(b,E),E.vadd(c,E),t.getVertex(m[3*_+1],A),t.getVertex(m[3*_+2],C),b=E.distanceSquared(c),!S(E,A,T,C)&&!S(E,T,A,C)||g<b||(w.vectorToWorldFrame(e,s,p),w.pointToWorldFrame(n,e,E,d),this.reportIntersection(p,d,t,i,_)))}o.length=0},m.prototype[e.types.TRIMESH]=m.prototype.intersectTrimesh,m.prototype.reportIntersection=function(t,e,n,i,r){var s=this.from,o=this.to,a=s.distanceTo(e),l=this.result;if(!(this.skipBackfaces&&0<t.dot(this._direction)))switch(l.hitFaceIndex=void 0!==r?r:-1,this.mode){case m.ALL:this.hasHit=!0,l.set(s,o,t,e,n,i,a),l.hasHit=!0,this.callback(l);break;case m.CLOSEST:(a<l.distance||!l.hasHit)&&(this.hasHit=!0,l.hasHit=!0,l.set(s,o,t,e,n,i,a));break;case m.ANY:this.hasHit=!0,l.hasHit=!0,l.set(s,o,t,e,n,i,a),l._shouldStop=!0}};var u=new p,g=new p},{"../collision/AABB":3,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/Box":37,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43}],10:[function(t,e,n){var i=t("../math/Vec3");function r(){this.rayFromWorld=new i,this.rayToWorld=new i,this.hitNormalWorld=new i,this.hitPointWorld=new i,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1}(e.exports=r).prototype.reset=function(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1},r.prototype.abort=function(){this._shouldStop=!0},r.prototype.set=function(t,e,n,i,r,s,o){this.rayFromWorld.copy(t),this.rayToWorld.copy(e),this.hitNormalWorld.copy(n),this.hitPointWorld.copy(i),this.shape=r,this.body=s,this.distance=o}},{"../math/Vec3":30}],11:[function(t,e,n){t("../shapes/Shape");var i=t("../collision/Broadphase");function c(t){i.apply(this),this.axisList=[],this.world=null,this.axisIndex=0;var e=this.axisList;this._addBodyHandler=function(t){e.push(t.body)},this._removeBodyHandler=function(t){t=e.indexOf(t.body);-1!==t&&e.splice(t,1)},t&&this.setWorld(t)}((e.exports=c).prototype=new i).setWorld=function(t){for(var e=this.axisList.length=0;e<t.bodies.length;e++)this.axisList.push(t.bodies[e]);t.removeEventListener("addBody",this._addBodyHandler),t.removeEventListener("removeBody",this._removeBodyHandler),t.addEventListener("addBody",this._addBodyHandler),t.addEventListener("removeBody",this._removeBodyHandler),this.world=t,this.dirty=!0},c.insertionSortX=function(t){for(var e=1,n=t.length;e<n;e++){for(var i=t[e],r=e-1;0<=r&&!(t[r].aabb.lowerBound.x<=i.aabb.lowerBound.x);r--)t[r+1]=t[r];t[r+1]=i}return t},c.insertionSortY=function(t){for(var e=1,n=t.length;e<n;e++){for(var i=t[e],r=e-1;0<=r&&!(t[r].aabb.lowerBound.y<=i.aabb.lowerBound.y);r--)t[r+1]=t[r];t[r+1]=i}return t},c.insertionSortZ=function(t){for(var e=1,n=t.length;e<n;e++){for(var i=t[e],r=e-1;0<=r&&!(t[r].aabb.lowerBound.z<=i.aabb.lowerBound.z);r--)t[r+1]=t[r];t[r+1]=i}return t},c.prototype.collisionPairs=function(t,e,n){var i,r=this.axisList,s=r.length,o=this.axisIndex;for(this.dirty&&(this.sortList(),this.dirty=!1),i=0;i!==s;i++)for(var a=r[i],l=i+1;l<s;l++){var h=r[l];if(this.needBroadphaseCollision(a,h)){if(!c.checkBounds(a,h,o))break;this.intersectionTest(a,h,e,n)}}},c.prototype.sortList=function(){for(var t=this.axisList,e=this.axisIndex,n=t.length,i=0;i!==n;i++){var r=t[i];r.aabbNeedsUpdate&&r.computeAABB()}0===e?c.insertionSortX(t):1===e?c.insertionSortY(t):2===e&&c.insertionSortZ(t)},c.checkBounds=function(t,e,n){var i,r;0===n?(i=t.position.x,r=e.position.x):1===n?(i=t.position.y,r=e.position.y):2===n&&(i=t.position.z,r=e.position.z);t=t.boundingRadius,e=e.boundingRadius;return r-e<i+t},c.prototype.autoDetectAxis=function(){for(var t=0,e=0,n=0,i=0,r=0,s=0,o=this.axisList,a=o.length,l=1/a,h=0;h!==a;h++){var c=o[h],u=c.position.x;t+=u,e+=u*u;u=c.position.y;n+=u,i+=u*u;c=c.position.z;r+=c,s+=c*c}var d=e-t*t*l,p=i-n*n*l,l=s-r*r*l;this.axisIndex=p<d?l<d?0:2:l<p?1:2},c.prototype.aabbQuery=function(t,e,n){n=n||[],this.dirty&&(this.sortList(),this.dirty=!1);for(var i=this.axisIndex,i=2===i?"z":1===i?"y":"x",r=this.axisList,s=(e.lowerBound[i],e.upperBound[i],0);s<r.length;s++){var o=r[s];o.aabbNeedsUpdate&&o.computeAABB(),o.aabb.overlaps(e)&&n.push(o)}return n}},{"../collision/Broadphase":5,"../shapes/Shape":43}],12:[function(t,e,n){e.exports=i;t("./Constraint");var o=t("./PointToPointConstraint"),a=t("../equations/ConeEquation"),l=t("../equations/RotationalEquation"),h=(t("../equations/ContactEquation"),t("../math/Vec3"));function i(t,e,n){var i=void 0!==(n=n||{}).maxForce?n.maxForce:1e6,r=n.pivotA?n.pivotA.clone():new h,s=n.pivotB?n.pivotB.clone():new h;this.axisA=n.axisA?n.axisA.clone():new h,this.axisB=n.axisB?n.axisB.clone():new h,o.call(this,t,r,e,s,i),this.collideConnected=!!n.collideConnected,this.angle=void 0!==n.angle?n.angle:0;s=this.coneEquation=new a(t,e,n),e=this.twistEquation=new l(t,e,n);this.twistAngle=void 0!==n.twistAngle?n.twistAngle:0,s.maxForce=0,s.minForce=-i,e.maxForce=0,e.minForce=-i,this.equations.push(s,e)}i.prototype=new o,i.constructor=i;new h,new h;i.prototype.update=function(){var t=this.bodyA,e=this.bodyB,n=this.coneEquation,i=this.twistEquation;o.prototype.update.call(this),t.vectorToWorldFrame(this.axisA,n.axisA),e.vectorToWorldFrame(this.axisB,n.axisB),this.axisA.tangents(i.axisA,i.axisA),t.vectorToWorldFrame(i.axisA,i.axisA),this.axisB.tangents(i.axisB,i.axisB),e.vectorToWorldFrame(i.axisB,i.axisB),n.angle=this.angle,i.maxAngle=this.twistAngle}},{"../equations/ConeEquation":18,"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],13:[function(t,e,n){e.exports=r;var i=t("../utils/Utils");function r(t,e,n){n=i.defaults(n,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=t,this.bodyB=e,this.id=r.idCounter++,this.collideConnected=n.collideConnected,n.wakeUpBodies&&(t&&t.wakeUp(),e&&e.wakeUp())}r.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")},r.prototype.enable=function(){for(var t=this.equations,e=0;e<t.length;e++)t[e].enabled=!0},r.prototype.disable=function(){for(var t=this.equations,e=0;e<t.length;e++)t[e].enabled=!1},r.idCounter=0},{"../utils/Utils":53}],14:[function(t,e,n){e.exports=i;var r=t("./Constraint"),s=t("../equations/ContactEquation");function i(t,e,n,i){r.call(this,t,e),void 0===n&&(n=t.position.distanceTo(e.position)),void 0===i&&(i=1e6),this.distance=n;e=this.distanceEquation=new s(t,e);this.equations.push(e),e.minForce=-i,e.maxForce=i}(i.prototype=new r).update=function(){var t=this.bodyA,e=this.bodyB,n=this.distanceEquation,i=.5*this.distance,r=n.ni;e.position.vsub(t.position,r),r.normalize(),r.mult(i,n.ri),r.mult(-i,n.rj)}},{"../equations/ContactEquation":19,"./Constraint":13}],15:[function(t,e,n){e.exports=i;t("./Constraint");var h=t("./PointToPointConstraint"),o=t("../equations/RotationalEquation"),a=t("../equations/RotationalMotorEquation"),l=(t("../equations/ContactEquation"),t("../math/Vec3"));function i(t,e,n){var i=void 0!==(n=n||{}).maxForce?n.maxForce:1e6,r=n.pivotA?n.pivotA.clone():new l,s=n.pivotB?n.pivotB.clone():new l;h.call(this,t,r,e,s,i),(this.axisA=n.axisA?n.axisA.clone():new l(1,0,0)).normalize(),(this.axisB=n.axisB?n.axisB.clone():new l(1,0,0)).normalize();s=this.rotationalEquation1=new o(t,e,n),n=this.rotationalEquation2=new o(t,e,n),i=this.motorEquation=new a(t,e,i);i.enabled=!1,this.equations.push(s,n,i)}i.prototype=new h,(i.constructor=i).prototype.enableMotor=function(){this.motorEquation.enabled=!0},i.prototype.disableMotor=function(){this.motorEquation.enabled=!1},i.prototype.setMotorSpeed=function(t){this.motorEquation.targetVelocity=t},i.prototype.setMotorMaxForce=function(t){this.motorEquation.maxForce=t,this.motorEquation.minForce=-t};var c=new l,u=new l;i.prototype.update=function(){var t=this.bodyA,e=this.bodyB,n=this.motorEquation,i=this.rotationalEquation1,r=this.rotationalEquation2,s=c,o=u,a=this.axisA,l=this.axisB;h.prototype.update.call(this),t.quaternion.vmult(a,s),e.quaternion.vmult(l,o),s.tangents(i.axisA,r.axisA),i.axisB.copy(o),r.axisB.copy(o),this.motorEquation.enabled&&(t.quaternion.vmult(this.axisA,n.axisA),e.quaternion.vmult(this.axisB,n.axisB))}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],16:[function(t,e,n){e.exports=i;t("./Constraint");var a=t("./PointToPointConstraint"),l=t("../equations/RotationalEquation"),h=(t("../equations/RotationalMotorEquation"),t("../equations/ContactEquation"),t("../math/Vec3"));function i(t,e,n){var i=void 0!==(n=n||{}).maxForce?n.maxForce:1e6,r=new h,s=new h,o=new h;t.position.vadd(e.position,o),o.scale(.5,o),e.pointToLocalFrame(o,s),t.pointToLocalFrame(o,r),a.call(this,t,r,e,s,i);s=this.rotationalEquation1=new l(t,e,n),i=this.rotationalEquation2=new l(t,e,n),n=this.rotationalEquation3=new l(t,e,n);this.equations.push(s,i,n)}i.prototype=new a,i.constructor=i;new h,new h;i.prototype.update=function(){var t=this.bodyA,e=this.bodyB,n=(this.motorEquation,this.rotationalEquation1),i=this.rotationalEquation2,r=this.rotationalEquation3;a.prototype.update.call(this),t.vectorToWorldFrame(h.UNIT_X,n.axisA),e.vectorToWorldFrame(h.UNIT_Y,n.axisB),t.vectorToWorldFrame(h.UNIT_Y,i.axisA),e.vectorToWorldFrame(h.UNIT_Z,i.axisB),t.vectorToWorldFrame(h.UNIT_Z,r.axisA),e.vectorToWorldFrame(h.UNIT_X,r.axisB)}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],17:[function(t,e,n){e.exports=i;var s=t("./Constraint"),o=t("../equations/ContactEquation"),a=t("../math/Vec3");function i(t,e,n,i,r){s.call(this,t,n),r=void 0!==r?r:1e6,this.pivotA=e?e.clone():new a,this.pivotB=i?i.clone():new a;e=this.equationX=new o(t,n),i=this.equationY=new o(t,n),n=this.equationZ=new o(t,n);this.equations.push(e,i,n),e.minForce=i.minForce=n.minForce=-r,e.maxForce=i.maxForce=n.maxForce=r,e.ni.set(1,0,0),i.ni.set(0,1,0),n.ni.set(0,0,1)}(i.prototype=new s).update=function(){var t=this.bodyA,e=this.bodyB,n=this.equationX,i=this.equationY,r=this.equationZ;t.quaternion.vmult(this.pivotA,n.ri),e.quaternion.vmult(this.pivotB,n.rj),i.ri.copy(n.ri),i.rj.copy(n.rj),r.ri.copy(n.ri),r.rj.copy(n.rj)}},{"../equations/ContactEquation":19,"../math/Vec3":30,"./Constraint":13}],18:[function(t,e,n){e.exports=i;var r=t("../math/Vec3"),s=(t("../math/Mat3"),t("./Equation"));function i(t,e,n){var i=void 0!==(n=n||{}).maxForce?n.maxForce:1e6;s.call(this,t,e,-i,i),this.axisA=n.axisA?n.axisA.clone():new r(1,0,0),this.axisB=n.axisB?n.axisB.clone():new r(0,1,0),this.angle=void 0!==n.angle?n.angle:0}(i.prototype=new s).constructor=i;var h=new r,c=new r;i.prototype.computeB=function(t){var e=this.a,n=this.b,i=this.axisA,r=this.axisB,s=h,o=c,a=this.jacobianElementA,l=this.jacobianElementB;return i.cross(r,s),r.cross(i,o),a.rotational.copy(o),l.rotational.copy(s),-(Math.cos(this.angle)-i.dot(r))*e-this.computeGW()*n-t*this.computeGiMf()}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],19:[function(t,e,n){e.exports=s;var i=t("./Equation"),r=t("../math/Vec3");t("../math/Mat3");function s(t,e,n){i.call(this,t,e,0,n=void 0!==n?n:1e6),this.restitution=0,this.ri=new r,this.rj=new r,this.ni=new r}(s.prototype=new i).constructor=s;var g=new r,y=new r,x=new r;s.prototype.computeB=function(t){var e=this.a,n=this.b,i=this.bi,r=this.bj,s=this.ri,o=this.rj,a=g,l=y,h=i.velocity,c=i.angularVelocity,u=(i.force,i.torque,r.velocity),d=r.angularVelocity,p=(r.force,r.torque,x),m=this.jacobianElementA,f=this.jacobianElementB,v=this.ni;s.cross(v,a),o.cross(v,l),v.negate(m.spatial),a.negate(m.rotational),f.spatial.copy(v),f.rotational.copy(l),p.copy(r.position),p.vadd(o,p),p.vsub(i.position,p),p.vsub(s,p);s=v.dot(p),p=this.restitution+1;return-s*e-(p*u.dot(v)-p*h.dot(v)+d.dot(l)-c.dot(a))*n-t*this.computeGiMf()};var o=new r,a=new r,l=new r,h=new r,c=new r;s.prototype.getImpactVelocityAlongNormal=function(){var t=o,e=a,n=l,i=h,r=c;return this.bi.position.vadd(this.ri,n),this.bj.position.vadd(this.rj,i),this.bi.getVelocityAtWorldPoint(n,t),this.bj.getVelocityAtWorldPoint(i,e),t.vsub(e,r),this.ni.dot(r)}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],20:[function(t,e,n){e.exports=s;var r=t("../math/JacobianElement"),t=t("../math/Vec3");function s(t,e,n,i){this.id=s.id++,this.minForce=void 0===n?-1e6:n,this.maxForce=void 0===i?1e6:i,this.bi=t,this.bj=e,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new r,this.jacobianElementB=new r,this.enabled=!0,this.setSpookParams(1e7,4,1/60)}(s.prototype.constructor=s).id=0,s.prototype.setSpookParams=function(t,e,n){this.a=4/(n*(1+4*e)),this.b=4*e/(1+4*e),this.eps=4/(n*n*t*(1+4*e))},s.prototype.computeB=function(t,e,n){var i=this.computeGW();return-this.computeGq()*t-i*e-this.computeGiMf()*n},s.prototype.computeGq=function(){var t=this.jacobianElementA,e=this.jacobianElementB,n=this.bi,i=this.bj,n=n.position,i=i.position;return t.spatial.dot(n)+e.spatial.dot(i)};var o=new t;s.prototype.computeGW=function(){var t=this.jacobianElementA,e=this.jacobianElementB,n=this.bi,i=this.bj,r=n.velocity,s=i.velocity,n=n.angularVelocity||o,i=i.angularVelocity||o;return t.multiplyVectors(r,n)+e.multiplyVectors(s,i)},s.prototype.computeGWlambda=function(){var t=this.jacobianElementA,e=this.jacobianElementB,n=this.bi,i=this.bj,r=n.vlambda,s=i.vlambda,n=n.wlambda||o,i=i.wlambda||o;return t.multiplyVectors(r,n)+e.multiplyVectors(s,i)};var c=new t,u=new t,d=new t,p=new t;s.prototype.computeGiMf=function(){var t=this.jacobianElementA,e=this.jacobianElementB,n=this.bi,i=this.bj,r=n.force,s=n.torque,o=i.force,a=i.torque,l=n.invMassSolve,h=i.invMassSolve;return n.invInertiaWorldSolve?n.invInertiaWorldSolve.vmult(s,d):d.set(0,0,0),i.invInertiaWorldSolve?i.invInertiaWorldSolve.vmult(a,p):p.set(0,0,0),r.mult(l,c),o.mult(h,u),t.multiplyVectors(c,d)+e.multiplyVectors(u,p)};var a=new t;s.prototype.computeGiMGt=function(){var t=this.jacobianElementA,e=this.jacobianElementB,n=this.bi,i=this.bj,r=n.invMassSolve,s=i.invMassSolve,n=n.invInertiaWorldSolve,i=i.invInertiaWorldSolve,s=r+s;return n&&(n.vmult(t.rotational,a),s+=a.dot(t.rotational)),i&&(i.vmult(e.rotational,a),s+=a.dot(e.rotational)),s};var l=new t;new t,new t,new t,new t,new t;s.prototype.addToWlambda=function(t){var e=this.jacobianElementA,n=this.jacobianElementB,i=this.bi,r=this.bj,s=l;e.spatial.mult(i.invMassSolve*t,s),i.vlambda.vadd(s,i.vlambda),n.spatial.mult(r.invMassSolve*t,s),r.vlambda.vadd(s,r.vlambda),i.invInertiaWorldSolve&&(i.invInertiaWorldSolve.vmult(e.rotational,s),s.mult(t,s),i.wlambda.vadd(s,i.wlambda)),r.invInertiaWorldSolve&&(r.invInertiaWorldSolve.vmult(n.rotational,s),s.mult(t,s),r.wlambda.vadd(s,r.wlambda))},s.prototype.computeC=function(){return this.computeGiMGt()+this.eps}},{"../math/JacobianElement":26,"../math/Vec3":30}],21:[function(t,e,n){e.exports=s;var i=t("./Equation"),r=t("../math/Vec3");t("../math/Mat3");function s(t,e,n){i.call(this,t,e,-n,n),this.ri=new r,this.rj=new r,this.t=new r}(s.prototype=new i).constructor=s;var a=new r,l=new r;s.prototype.computeB=function(t){this.a;var e=this.b,n=(this.bi,this.bj,this.ri),i=this.rj,r=a,s=l,o=this.t;n.cross(o,r),i.cross(o,s);n=this.jacobianElementA,i=this.jacobianElementB;return o.negate(n.spatial),r.negate(n.rotational),i.spatial.copy(o),i.rotational.copy(s),-this.computeGW()*e-t*this.computeGiMf()}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],22:[function(t,e,n){e.exports=i;var r=t("../math/Vec3"),s=(t("../math/Mat3"),t("./Equation"));function i(t,e,n){var i=void 0!==(n=n||{}).maxForce?n.maxForce:1e6;s.call(this,t,e,-i,i),this.axisA=n.axisA?n.axisA.clone():new r(1,0,0),this.axisB=n.axisB?n.axisB.clone():new r(0,1,0),this.maxAngle=Math.PI/2}(i.prototype=new s).constructor=i;var h=new r,c=new r;i.prototype.computeB=function(t){var e=this.a,n=this.b,i=this.axisA,r=this.axisB,s=h,o=c,a=this.jacobianElementA,l=this.jacobianElementB;return i.cross(r,s),r.cross(i,o),a.rotational.copy(o),l.rotational.copy(s),-(Math.cos(this.maxAngle)-i.dot(r))*e-this.computeGW()*n-t*this.computeGiMf()}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],23:[function(t,e,n){e.exports=s;var i=t("../math/Vec3"),r=(t("../math/Mat3"),t("./Equation"));function s(t,e,n){r.call(this,t,e,-(n=void 0!==n?n:1e6),n),this.axisA=new i,this.axisB=new i,this.targetVelocity=0}((s.prototype=new r).constructor=s).prototype.computeB=function(t){this.a;var e=this.b,n=(this.bi,this.bj,this.axisA),i=this.axisB,r=this.jacobianElementA,s=this.jacobianElementB;return r.rotational.copy(n),i.negate(s.rotational),-(this.computeGW()-this.targetVelocity)*e-t*this.computeGiMf()}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],24:[function(t,e,n){var i=t("../utils/Utils");function r(t,e,n){n=i.defaults(n,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=r.idCounter++,this.materials=[t,e],this.friction=n.friction,this.restitution=n.restitution,this.contactEquationStiffness=n.contactEquationStiffness,this.contactEquationRelaxation=n.contactEquationRelaxation,this.frictionEquationStiffness=n.frictionEquationStiffness,this.frictionEquationRelaxation=n.frictionEquationRelaxation}(e.exports=r).idCounter=0},{"../utils/Utils":53}],25:[function(t,e,n){function i(t){var e="";"string"==typeof(t=t||{})?(e=t,t={}):"object"==typeof t&&(e=""),this.name=e,this.id=i.idCounter++,this.friction=void 0!==t.friction?t.friction:-1,this.restitution=void 0!==t.restitution?t.restitution:-1}(e.exports=i).idCounter=0},{}],26:[function(t,e,n){e.exports=r;var i=t("./Vec3");function r(){this.spatial=new i,this.rotational=new i}r.prototype.multiplyElement=function(t){return t.spatial.dot(this.spatial)+t.rotational.dot(this.rotational)},r.prototype.multiplyVectors=function(t,e){return t.dot(this.spatial)+e.dot(this.rotational)}},{"./Vec3":30}],27:[function(t,e,n){e.exports=h;var c=t("./Vec3");function h(t){this.elements=t||[0,0,0,0,0,0,0,0,0]}h.prototype.identity=function(){var t=this.elements;t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1},h.prototype.setZero=function(){var t=this.elements;t[0]=0,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t[8]=0},h.prototype.setTrace=function(t){var e=this.elements;e[0]=t.x,e[4]=t.y,e[8]=t.z},h.prototype.getTrace=function(t){var t=t||new c,e=this.elements;t.x=e[0],t.y=e[4],t.z=e[8]},h.prototype.vmult=function(t,e){e=e||new c;var n=this.elements,i=t.x,r=t.y,t=t.z;return e.x=n[0]*i+n[1]*r+n[2]*t,e.y=n[3]*i+n[4]*r+n[5]*t,e.z=n[6]*i+n[7]*r+n[8]*t,e},h.prototype.smult=function(t){for(var e=0;e<this.elements.length;e++)this.elements[e]*=t},h.prototype.mmult=function(t,e){for(var n=e||new h,i=0;i<3;i++)for(var r=0;r<3;r++){for(var s=0,o=0;o<3;o++)s+=t.elements[i+3*o]*this.elements[o+3*r];n.elements[i+3*r]=s}return n},h.prototype.scale=function(t,e){e=e||new h;for(var n=this.elements,i=e.elements,r=0;3!==r;r++)i[3*r+0]=t.x*n[3*r+0],i[3*r+1]=t.y*n[3*r+1],i[3*r+2]=t.z*n[3*r+2];return e},h.prototype.solve=function(t,e){e=e||new c;for(var n,i=[],r=0;r<12;r++)i.push(0);for(r=0;r<3;r++)for(n=0;n<3;n++)i[r+4*n]=this.elements[r+3*n];i[3]=t.x,i[7]=t.y,i[11]=t.z;var s,o=3,a=o;do{if(0===i[(r=a-o)+4*r])for(n=r+1;n<a;n++)if(0!==i[r+4*n]){for(h=4;i[(s=4-h)+4*r]+=i[s+4*n],--h;);break}if(0!==i[r+4*r])for(n=r+1;n<a;n++)for(var l=i[r+4*n]/i[r+4*r],h=4;i[(s=4-h)+4*n]=s<=r?0:i[s+4*n]-i[s+4*r]*l,--h;);}while(--o);if(e.z=i[11]/i[10],e.y=(i[7]-i[6]*e.z)/i[5],e.x=(i[3]-i[2]*e.z-i[1]*e.y)/i[0],isNaN(e.x)||isNaN(e.y)||isNaN(e.z)||e.x===1/0||e.y===1/0||e.z===1/0)throw"Could not solve equation! Got x=["+e.toString()+"], b=["+t.toString()+"], A=["+this.toString()+"]";return e},h.prototype.e=function(t,e,n){if(void 0===n)return this.elements[e+3*t];this.elements[e+3*t]=n},h.prototype.copy=function(t){for(var e=0;e<t.elements.length;e++)this.elements[e]=t.elements[e];return this},h.prototype.toString=function(){for(var t="",e=0;e<9;e++)t+=this.elements[e]+",";return t},h.prototype.reverse=function(t){t=t||new h;for(var e,n=[],i=0;i<18;i++)n.push(0);for(i=0;i<3;i++)for(e=0;e<3;e++)n[i+6*e]=this.elements[i+3*e];n[3]=1,n[9]=0,n[15]=0,n[4]=0,n[10]=1,n[16]=0,n[5]=0,n[11]=0,n[17]=1;var r,s=3,o=s;do{if(0===n[(i=o-s)+6*i])for(e=i+1;e<o;e++)if(0!==n[i+6*e]){for(l=6;n[(r=6-l)+6*i]+=n[r+6*e],--l;);break}if(0!==n[i+6*i])for(e=i+1;e<o;e++)for(var a=n[i+6*e]/n[i+6*i],l=6;n[(r=6-l)+6*e]=r<=i?0:n[r+6*e]-n[r+6*i]*a,--l;);}while(--s);i=2;do{e=i-1;do{a=n[i+6*e]/n[i+6*i];for(l=6;n[(r=6-l)+6*e]=n[r+6*e]-n[r+6*i]*a,--l;);}while(e--)}while(--i);i=2;do{a=1/n[i+6*i];for(l=6;n[(r=6-l)+6*i]=n[r+6*i]*a,--l;);}while(i--);i=2;do{e=2;do{if(r=n[3+e+6*i],isNaN(r)||r===1/0)throw"Could not reverse! A=["+this.toString()+"]"}while(t.e(i,e,r),e--)}while(i--);return t},h.prototype.setRotationFromQuaternion=function(t){var e=t.x,n=t.y,i=t.z,r=t.w,s=e+e,o=n+n,a=i+i,l=e*s,h=e*o,t=e*a,e=n*o,n=n*a,i=i*a,s=r*s,o=r*o,r=r*a,a=this.elements;return a[0]=1-(e+i),a[1]=h-r,a[2]=t+o,a[3]=h+r,a[4]=1-(l+i),a[5]=n-s,a[6]=t-o,a[7]=n+s,a[8]=1-(l+e),this},h.prototype.transpose=function(t){for(var e=(t=t||new h).elements,n=this.elements,i=0;3!==i;i++)for(var r=0;3!==r;r++)e[3*i+r]=n[3*r+i];return t}},{"./Vec3":30}],28:[function(t,e,n){e.exports=o;var u=t("./Vec3");function o(t,e,n,i){this.x=void 0!==t?t:0,this.y=void 0!==e?e:0,this.z=void 0!==n?n:0,this.w=void 0!==i?i:1}o.prototype.set=function(t,e,n,i){this.x=t,this.y=e,this.z=n,this.w=i},o.prototype.toString=function(){return this.x+","+this.y+","+this.z+","+this.w},o.prototype.toArray=function(){return[this.x,this.y,this.z,this.w]},o.prototype.setFromAxisAngle=function(t,e){var n=Math.sin(.5*e);this.x=t.x*n,this.y=t.y*n,this.z=t.z*n,this.w=Math.cos(.5*e)},o.prototype.toAxisAngle=function(t){t=t||new u,this.normalize();var e=2*Math.acos(this.w),n=Math.sqrt(1-this.w*this.w);return n<.001?(t.x=this.x,t.y=this.y,t.z=this.z):(t.x=this.x/n,t.y=this.y/n,t.z=this.z/n),[t,e]};var i=new u,r=new u;o.prototype.setFromVectors=function(t,e){var n;t.isAntiparallelTo(e)?(t.tangents(n=i,r),this.setFromAxisAngle(n,Math.PI)):(n=t.cross(e),this.x=n.x,this.y=n.y,this.z=n.z,this.w=Math.sqrt(Math.pow(t.norm(),2)*Math.pow(e.norm(),2))+t.dot(e),this.normalize())};var a=new u,l=new u,h=new u;o.prototype.mult=function(t,e){e=e||new o;var n=this.w,i=a,r=l,s=h;return i.set(this.x,this.y,this.z),r.set(t.x,t.y,t.z),e.w=n*t.w-i.dot(r),i.cross(r,s),e.x=n*r.x+t.w*i.x+s.x,e.y=n*r.y+t.w*i.y+s.y,e.z=n*r.z+t.w*i.z+s.z,e},o.prototype.inverse=function(t){var e=this.x,n=this.y,i=this.z,r=this.w;t=t||new o,this.conjugate(t);r=1/(e*e+n*n+i*i+r*r);return t.x*=r,t.y*=r,t.z*=r,t.w*=r,t},o.prototype.conjugate=function(t){return(t=t||new o).x=-this.x,t.y=-this.y,t.z=-this.z,t.w=this.w,t},o.prototype.normalize=function(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);0===t?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=t=1/t,this.y*=t,this.z*=t,this.w*=t)},o.prototype.normalizeFast=function(){var t=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;0==t?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=t,this.y*=t,this.z*=t,this.w*=t)},o.prototype.vmult=function(t,e){e=e||new u;var n=t.x,i=t.y,r=t.z,s=this.x,o=this.y,a=this.z,l=this.w,h=l*n+o*r-a*i,c=l*i+a*n-s*r,t=l*r+s*i-o*n,r=-s*n-o*i-a*r;return e.x=h*l+r*-s+c*-a-t*-o,e.y=c*l+r*-o+t*-s-h*-a,e.z=t*l+r*-a+h*-o-c*-s,e},o.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},o.prototype.toEuler=function(t,e){e=e||"YZX";var n=this.x,i=this.y,r=this.z,s=this.w;if("YZX"!==e)throw new Error("Euler order "+e+" not supported yet.");var o,a,l,h,c=n*i+r*s;.499<c&&(a=2*Math.atan2(n,s),l=Math.PI/2,h=0),c<-.499&&(a=-2*Math.atan2(n,s),l=-Math.PI/2,h=0),isNaN(a)&&(o=n*n,e=r*r,a=Math.atan2(2*i*s-2*n*r,1-2*(i*i)-2*e),l=Math.asin(2*c),h=Math.atan2(2*n*s-2*i*r,1-2*o-2*e)),t.y=a,t.z=l,t.x=h},o.prototype.setFromEuler=function(t,e,n,i){i=i||"XYZ";var r=Math.cos(t/2),s=Math.cos(e/2),o=Math.cos(n/2),t=Math.sin(t/2),e=Math.sin(e/2),n=Math.sin(n/2);return"XYZ"===i?(this.x=t*s*o+r*e*n,this.y=r*e*o-t*s*n,this.z=r*s*n+t*e*o,this.w=r*s*o-t*e*n):"YXZ"===i?(this.x=t*s*o+r*e*n,this.y=r*e*o-t*s*n,this.z=r*s*n-t*e*o,this.w=r*s*o+t*e*n):"ZXY"===i?(this.x=t*s*o-r*e*n,this.y=r*e*o+t*s*n,this.z=r*s*n+t*e*o,this.w=r*s*o-t*e*n):"ZYX"===i?(this.x=t*s*o-r*e*n,this.y=r*e*o+t*s*n,this.z=r*s*n-t*e*o,this.w=r*s*o+t*e*n):"YZX"===i?(this.x=t*s*o+r*e*n,this.y=r*e*o+t*s*n,this.z=r*s*n-t*e*o,this.w=r*s*o-t*e*n):"XZY"===i&&(this.x=t*s*o-r*e*n,this.y=r*e*o-t*s*n,this.z=r*s*n+t*e*o,this.w=r*s*o+t*e*n),this},o.prototype.clone=function(){return new o(this.x,this.y,this.z,this.w)}},{"./Vec3":30}],29:[function(t,e,n){var r=t("./Vec3"),i=t("./Quaternion");function s(t){t=t||{},this.position=new r,t.position&&this.position.copy(t.position),this.quaternion=new i,t.quaternion&&this.quaternion.copy(t.quaternion)}e.exports=s;var o=new i;s.pointToLocalFrame=function(t,e,n,i){i=i||new r;return n.vsub(t,i),e.conjugate(o),o.vmult(i,i),i},s.prototype.pointToLocal=function(t,e){return s.pointToLocalFrame(this.position,this.quaternion,t,e)},s.pointToWorldFrame=function(t,e,n,i){i=i||new r;return e.vmult(n,i),i.vadd(t,i),i},s.prototype.pointToWorld=function(t,e){return s.pointToWorldFrame(this.position,this.quaternion,t,e)},s.prototype.vectorToWorldFrame=function(t,e){e=e||new r;return this.quaternion.vmult(t,e),e},s.vectorToWorldFrame=function(t,e,n){return t.vmult(e,n),n},s.vectorToLocalFrame=function(t,e,n,i){i=i||new r;return e.w*=-1,e.vmult(n,i),e.w*=-1,i}},{"./Quaternion":28,"./Vec3":30}],30:[function(t,e,n){e.exports=a;var i=t("./Mat3");function a(t,e,n){this.x=t||0,this.y=e||0,this.z=n||0}a.ZERO=new a(0,0,0),a.UNIT_X=new a(1,0,0),a.UNIT_Y=new a(0,1,0),a.UNIT_Z=new a(0,0,1),a.prototype.cross=function(t,e){var n=t.x,i=t.y,r=t.z,s=this.x,o=this.y,t=this.z;return(e=e||new a).x=o*r-t*i,e.y=t*n-s*r,e.z=s*i-o*n,e},a.prototype.set=function(t,e,n){return this.x=t,this.y=e,this.z=n,this},a.prototype.setZero=function(){this.x=this.y=this.z=0},a.prototype.vadd=function(t,e){if(!e)return new a(this.x+t.x,this.y+t.y,this.z+t.z);e.x=t.x+this.x,e.y=t.y+this.y,e.z=t.z+this.z},a.prototype.vsub=function(t,e){if(!e)return new a(this.x-t.x,this.y-t.y,this.z-t.z);e.x=this.x-t.x,e.y=this.y-t.y,e.z=this.z-t.z},a.prototype.crossmat=function(){return new i([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])},a.prototype.normalize=function(){var t=this.x,e=this.y,n=this.z,e=Math.sqrt(t*t+e*e+n*n);return 0<e?(this.x*=n=1/e,this.y*=n,this.z*=n):(this.x=0,this.y=0,this.z=0),e},a.prototype.unit=function(t){t=t||new a;var e=this.x,n=this.y,i=this.z,r=Math.sqrt(e*e+n*n+i*i);return 0<r?(t.x=e*(r=1/r),t.y=n*r,t.z=i*r):(t.x=1,t.y=0,t.z=0),t},a.prototype.length=a.prototype.norm=function(){var t=this.x,e=this.y,n=this.z;return Math.sqrt(t*t+e*e+n*n)},a.prototype.lengthSquared=a.prototype.norm2=function(){return this.dot(this)},a.prototype.distanceTo=function(t){var e=this.x,n=this.y,i=this.z,r=t.x,s=t.y,t=t.z;return Math.sqrt((r-e)*(r-e)+(s-n)*(s-n)+(t-i)*(t-i))},a.prototype.distanceSquared=function(t){var e=this.x,n=this.y,i=this.z,r=t.x,s=t.y,t=t.z;return(r-e)*(r-e)+(s-n)*(s-n)+(t-i)*(t-i)},a.prototype.scale=a.prototype.mult=function(t,e){e=e||new a;var n=this.x,i=this.y,r=this.z;return e.x=t*n,e.y=t*i,e.z=t*r,e},a.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},a.prototype.isZero=function(){return 0===this.x&&0===this.y&&0===this.z},a.prototype.negate=function(t){return(t=t||new a).x=-this.x,t.y=-this.y,t.z=-this.z,t};var r=new a,s=new a;a.prototype.tangents=function(t,e){var n,i=this.norm();0<i?((n=r).set(this.x*(i=1/i),this.y*i,this.z*i),i=s,Math.abs(n.x)<.9?i.set(1,0,0):i.set(0,1,0),n.cross(i,t),n.cross(t,e)):(t.set(1,0,0),e.set(0,1,0))},a.prototype.toString=function(){return this.x+","+this.y+","+this.z},a.prototype.toArray=function(){return[this.x,this.y,this.z]},a.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},a.prototype.lerp=function(t,e,n){var i=this.x,r=this.y,s=this.z;n.x=i+(t.x-i)*e,n.y=r+(t.y-r)*e,n.z=s+(t.z-s)*e},a.prototype.almostEquals=function(t,e){return void 0===e&&(e=1e-6),!(Math.abs(this.x-t.x)>e||Math.abs(this.y-t.y)>e||Math.abs(this.z-t.z)>e)},a.prototype.almostZero=function(t){return void 0===t&&(t=1e-6),!(Math.abs(this.x)>t||Math.abs(this.y)>t||Math.abs(this.z)>t)};var o=new a;a.prototype.isAntiparallelTo=function(t,e){return this.negate(o),o.almostEquals(t,e)},a.prototype.clone=function(){return new a(this.x,this.y,this.z)}},{"./Mat3":27}],31:[function(t,e,n){e.exports=h;var i=t("../utils/EventTarget"),s=(t("../shapes/Shape"),t("../math/Vec3")),r=t("../math/Mat3"),o=t("../math/Quaternion"),a=(t("../material/Material"),t("../collision/AABB")),l=t("../shapes/Box");function h(t){t=t||{},i.apply(this),this.id=h.idCounter++,this.world=null,this.preStep=null,this.postStep=null,this.vlambda=new s,this.collisionFilterGroup="number"==typeof t.collisionFilterGroup?t.collisionFilterGroup:1,this.collisionFilterMask="number"==typeof t.collisionFilterMask?t.collisionFilterMask:1,this.collisionResponse=!0,this.position=new s,t.position&&this.position.copy(t.position),this.previousPosition=new s,this.initPosition=new s,this.velocity=new s,t.velocity&&this.velocity.copy(t.velocity),this.initVelocity=new s,this.force=new s;var e="number"==typeof t.mass?t.mass:0;this.mass=e,this.invMass=0<e?1/e:0,this.material=t.material||null,this.linearDamping="number"==typeof t.linearDamping?t.linearDamping:.01,this.type=e<=0?h.STATIC:h.DYNAMIC,typeof t.type==typeof h.STATIC&&(this.type=t.type),this.allowSleep=void 0===t.allowSleep||t.allowSleep,this.sleepState=0,this.sleepSpeedLimit=void 0!==t.sleepSpeedLimit?t.sleepSpeedLimit:.1,this.sleepTimeLimit=void 0!==t.sleepTimeLimit?t.sleepTimeLimit:1,this.timeLastSleepy=0,this._wakeUpAfterNarrowphase=!1,this.torque=new s,this.quaternion=new o,t.quaternion&&this.quaternion.copy(t.quaternion),this.initQuaternion=new o,this.angularVelocity=new s,t.angularVelocity&&this.angularVelocity.copy(t.angularVelocity),this.initAngularVelocity=new s,this.interpolatedPosition=new s,this.interpolatedQuaternion=new o,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new s,this.invInertia=new s,this.invInertiaWorld=new r,this.invMassSolve=0,this.invInertiaSolve=new s,this.invInertiaWorldSolve=new r,this.fixedRotation=void 0!==t.fixedRotation&&t.fixedRotation,this.angularDamping=void 0!==t.angularDamping?t.angularDamping:.01,this.aabb=new a,this.aabbNeedsUpdate=!0,this.wlambda=new s,t.shape&&this.addShape(t.shape),this.updateMassProperties()}((h.prototype=new i).constructor=h).DYNAMIC=1,h.STATIC=2,h.KINEMATIC=4,h.AWAKE=0,h.SLEEPY=1,h.SLEEPING=2,h.idCounter=0,h.prototype.wakeUp=function(){var t=this.sleepState;this.sleepState=0,t===h.SLEEPING&&this.dispatchEvent({type:"wakeup"})},h.prototype.sleep=function(){this.sleepState=h.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0)},h.sleepyEvent={type:"sleepy"},h.sleepEvent={type:"sleep"},h.prototype.sleepTick=function(t){var e,n,i;this.allowSleep&&(e=this.sleepState,n=this.velocity.norm2()+this.angularVelocity.norm2(),i=Math.pow(this.sleepSpeedLimit,2),e===h.AWAKE&&n<i?(this.sleepState=h.SLEEPY,this.timeLastSleepy=t,this.dispatchEvent(h.sleepyEvent)):e===h.SLEEPY&&i<n?this.wakeUp():e===h.SLEEPY&&t-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(h.sleepEvent)))},h.prototype.updateSolveMassProperties=function(){this.sleepState===h.SLEEPING||this.type===h.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))},h.prototype.pointToLocalFrame=function(t,e){e=e||new s;return t.vsub(this.position,e),this.quaternion.conjugate().vmult(e,e),e},h.prototype.vectorToLocalFrame=function(t,e){e=e||new s;return this.quaternion.conjugate().vmult(t,e),e},h.prototype.pointToWorldFrame=function(t,e){e=e||new s;return this.quaternion.vmult(t,e),e.vadd(this.position,e),e},h.prototype.vectorToWorldFrame=function(t,e){e=e||new s;return this.quaternion.vmult(t,e),e};var u=new s,d=new o;h.prototype.addShape=function(t,e,n){var i=new s,r=new o;return e&&i.copy(e),n&&r.copy(n),this.shapes.push(t),this.shapeOffsets.push(i),this.shapeOrientations.push(r),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,this},h.prototype.updateBoundingRadius=function(){for(var t=this.shapes,e=this.shapeOffsets,n=t.length,i=0,r=0;r!==n;r++){var s=t[r];s.updateBoundingSphereRadius();var o=e[r].norm(),s=s.boundingSphereRadius;i<o+s&&(i=o+s)}this.boundingRadius=i};var p=new a;h.prototype.computeAABB=function(){for(var t=this.shapes,e=this.shapeOffsets,n=this.shapeOrientations,i=t.length,r=u,s=d,o=this.quaternion,a=this.aabb,l=p,h=0;h!==i;h++){var c=t[h];n[h].mult(o,s),s.vmult(e[h],r),r.vadd(this.position,r),c.calculateWorldAABB(r,s,l.lowerBound,l.upperBound),0===h?a.copy(l):a.extend(l)}this.aabbNeedsUpdate=!1};var c=new r,m=new r;new r;h.prototype.updateInertiaWorld=function(t){var e,n=this.invInertia;n.x===n.y&&n.y===n.z&&!t||(e=m,(t=c).setRotationFromQuaternion(this.quaternion),t.transpose(e),t.scale(n,t),t.mmult(e,this.invInertiaWorld))};var f=new s,v=new s;h.prototype.applyForce=function(t,e){this.type===h.DYNAMIC&&(e.vsub(this.position,e=f),e.cross(t,e=v),this.force.vadd(t,this.force),this.torque.vadd(e,this.torque))};var g=new s,y=new s;h.prototype.applyLocalForce=function(t,e){var n;this.type===h.DYNAMIC&&(n=y,this.vectorToWorldFrame(t,t=g),this.pointToWorldFrame(e,n),this.applyForce(t,n))};var x=new s,_=new s,b=new s;h.prototype.applyImpulse=function(t,e){var n;this.type===h.DYNAMIC&&(e.vsub(this.position,n=x),(e=_).copy(t),e.mult(this.invMass,e),this.velocity.vadd(e,this.velocity),n.cross(t,t=b),this.invInertiaWorld.vmult(t,t),this.angularVelocity.vadd(t,this.angularVelocity))};var w=new s,M=new s;h.prototype.applyLocalImpulse=function(t,e){var n;this.type===h.DYNAMIC&&(n=M,this.vectorToWorldFrame(t,t=w),this.pointToWorldFrame(e,n),this.applyImpulse(t,n))};var S=new s;h.prototype.updateMassProperties=function(){var t=S;this.invMass=0<this.mass?1/this.mass:0;var e=this.inertia,n=this.fixedRotation;this.computeAABB(),t.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),l.calculateInertia(t,this.mass,e),this.invInertia.set(0<e.x&&!n?1/e.x:0,0<e.y&&!n?1/e.y:0,0<e.z&&!n?1/e.z:0),this.updateInertiaWorld(!0)},h.prototype.getVelocityAtWorldPoint=function(t,e){var n=new s;return t.vsub(this.position,n),this.angularVelocity.cross(n,e),this.velocity.vadd(e,e),e}},{"../collision/AABB":3,"../material/Material":25,"../math/Mat3":27,"../math/Quaternion":28,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Shape":43,"../utils/EventTarget":49}],32:[function(t,e,n){t("./Body");var _=t("../math/Vec3"),s=t("../math/Quaternion"),i=(t("../collision/RaycastResult"),t("../collision/Ray")),r=t("../objects/WheelInfo");function o(t){this.chassisBody=t.chassisBody,this.wheelInfos=[],this.sliding=!1,this.world=null,this.indexRightAxis=void 0!==t.indexRightAxis?t.indexRightAxis:1,this.indexForwardAxis=void 0!==t.indexForwardAxis?t.indexForwardAxis:0,this.indexUpAxis=void 0!==t.indexUpAxis?t.indexUpAxis:2}e.exports=o;new _,new _,new _;var a=new _,l=new _,h=new _;new i;o.prototype.addWheel=function(t){var e=new r(t=t||{}),t=this.wheelInfos.length;return this.wheelInfos.push(e),t},o.prototype.setSteeringValue=function(t,e){this.wheelInfos[e].steering=t};new _;o.prototype.applyEngineForce=function(t,e){this.wheelInfos[e].engineForce=t},o.prototype.setBrake=function(t,e){this.wheelInfos[e].brake=t},o.prototype.addToWorld=function(t){this.constraints;t.add(this.chassisBody);var e=this;this.preStepCallback=function(){e.updateVehicle(t.dt)},t.addEventListener("preStep",this.preStepCallback),this.world=t},o.prototype.getVehicleAxisWorld=function(t,e){e.set(0===t?1:0,1===t?1:0,2===t?1:0),this.chassisBody.vectorToWorldFrame(e,e)},o.prototype.updateVehicle=function(t){for(var e=this.wheelInfos,n=e.length,i=this.chassisBody,r=0;r<n;r++)this.updateWheelTransform(r);this.currentVehicleSpeedKmHour=3.6*i.velocity.norm();var s=new _;this.getVehicleAxisWorld(this.indexForwardAxis,s),s.dot(i.velocity)<0&&(this.currentVehicleSpeedKmHour*=-1);for(r=0;r<n;r++)this.castRay(e[r]);this.updateSuspension(t);for(var o=new _,a=new _,r=0;r<n;r++){var l=(d=e[r]).suspensionForce;l>d.maxSuspensionForce&&(l=d.maxSuspensionForce),d.raycastResult.hitNormalWorld.scale(l*t,o),d.raycastResult.hitPointWorld.vsub(i.position,a),i.applyImpulse(o,d.raycastResult.hitPointWorld)}this.updateFriction(t);var h=new _,c=new _,u=new _;for(r=0;r<n;r++){var d=e[r];i.getVelocityAtWorldPoint(d.chassisConnectionPointWorld,u);var p,m=1;1===this.indexUpAxis&&(m=-1),d.isInContact&&(this.getVehicleAxisWorld(this.indexForwardAxis,c),p=c.dot(d.raycastResult.hitNormalWorld),d.raycastResult.hitNormalWorld.scale(p,h),c.vsub(h,c),p=c.dot(u),d.deltaRotation=m*p*t/d.radius),!d.sliding&&d.isInContact||0===d.engineForce||!d.useCustomSlidingRotationalSpeed||(d.deltaRotation=(0<d.engineForce?1:-1)*d.customSlidingRotationalSpeed*t),Math.abs(d.brake)>Math.abs(d.engineForce)&&(d.deltaRotation=0),d.rotation+=d.deltaRotation,d.deltaRotation*=.99}},o.prototype.updateSuspension=function(t){for(var e=this.chassisBody.mass,n=this.wheelInfos,i=n.length,r=0;r<i;r++){var s,o,a=n[r];a.isInContact?(s=a.suspensionRestLength,o=a.suspensionLength,s=a.suspensionStiffness*(s-o)*a.clippedInvContactDotSuspension,s-=((o=a.suspensionRelativeVelocity)<0?a.dampingCompression:a.dampingRelaxation)*o,a.suspensionForce=s*e,a.suspensionForce<0&&(a.suspensionForce=0)):a.suspensionForce=0}},o.prototype.removeFromWorld=function(t){this.constraints;t.remove(this.chassisBody),t.removeEventListener("preStep",this.preStepCallback),this.world=null};var c=new _,u=new _;o.prototype.castRay=function(t){var e=c,n=u;this.updateWheelTransformWorld(t);var i=this.chassisBody,r=-1,s=t.suspensionRestLength+t.radius;t.directionWorld.scale(s,e);var o=t.chassisConnectionPointWorld;o.vadd(e,n);s=t.raycastResult;s.reset();e=i.collisionResponse;i.collisionResponse=!1,this.world.rayTest(o,n,s),i.collisionResponse=e;e=s.body;return t.raycastResult.groundObject=0,e?(r=s.distance,t.raycastResult.hitNormalWorld=s.hitNormalWorld,t.isInContact=!0,e=s.distance,t.suspensionLength=e-t.radius,s=t.suspensionRestLength-t.maxSuspensionTravel,e=t.suspensionRestLength+t.maxSuspensionTravel,t.suspensionLength<s&&(t.suspensionLength=s),t.suspensionLength>e&&(t.suspensionLength=e,t.raycastResult.reset()),s=t.raycastResult.hitNormalWorld.dot(t.directionWorld),e=new _,i.getVelocityAtWorldPoint(t.raycastResult.hitPointWorld,e),e=t.raycastResult.hitNormalWorld.dot(e),-.1<=s?(t.suspensionRelativeVelocity=0,t.clippedInvContactDotSuspension=10):(t.suspensionRelativeVelocity=e*(s=-1/s),t.clippedInvContactDotSuspension=s)):(t.suspensionLength=t.suspensionRestLength+0*t.maxSuspensionTravel,t.suspensionRelativeVelocity=0,t.directionWorld.scale(-1,t.raycastResult.hitNormalWorld),t.clippedInvContactDotSuspension=1),r},o.prototype.updateWheelTransformWorld=function(t){t.isInContact=!1;var e=this.chassisBody;e.pointToWorldFrame(t.chassisConnectionPointLocal,t.chassisConnectionPointWorld),e.vectorToWorldFrame(t.directionLocal,t.directionWorld),e.vectorToWorldFrame(t.axleLocal,t.axleWorld)},o.prototype.updateWheelTransform=function(t){var e=a,n=l,i=h,r=this.wheelInfos[t];this.updateWheelTransformWorld(r),r.directionLocal.scale(-1,e),n.copy(r.axleLocal),e.cross(n,i),i.normalize(),n.normalize();t=r.steering,i=new s;i.setFromAxisAngle(e,t);t=new s;t.setFromAxisAngle(n,r.rotation);n=r.worldTransform.quaternion;this.chassisBody.quaternion.mult(i,n),n.mult(t,n),n.normalize();n=r.worldTransform.position;n.copy(r.directionWorld),n.scale(r.suspensionLength,n),n.vadd(r.chassisConnectionPointWorld,n)};var b=[new _(1,0,0),new _(0,1,0),new _(0,0,1)];o.prototype.getWheelTransformWorld=function(t){return this.wheelInfos[t].worldTransform};var w=new _,M=[],S=[];o.prototype.updateFriction=function(t){for(var e=w,n=this.wheelInfos,i=n.length,r=this.chassisBody,s=S,o=M,a=0;a<i;a++)(m=(y=n[a]).raycastResult.body)&&0,y.sideImpulse=0,y.forwardImpulse=0,s[a]||(s[a]=new _),o[a]||(o[a]=new _);for(var l,h,c,a=0;a<i;a++)(m=(y=n[a]).raycastResult.body)&&(l=o[a],this.getWheelTransformWorld(a).vectorToWorldFrame(b[this.indexRightAxis],l),h=y.raycastResult.hitNormalWorld,c=l.dot(h),h.scale(c,e),l.vsub(e,l),l.normalize(),h.cross(l,s[a]),s[a].normalize(),y.sideImpulse=function(t,e,n,i,r){if(1.1<r.norm2())return 0;var s=P,o=L,a=R;t.getVelocityAtWorldPoint(e,s),n.getVelocityAtWorldPoint(i,o),s.vsub(o,a);a=r.dot(a),n=1/(t.invMass+n.invMass);return-.2*a*n}(r,y.raycastResult.hitPointWorld,m,y.raycastResult.hitPointWorld,l),y.sideImpulse*=1);this.sliding=!1;for(a=0;a<i;a++){var u,d,p,m=(y=n[a]).raycastResult.body,f=0;y.slipInfo=1,m&&(d=y.brake||0,f=function(t,e,n,i,r){var s=0,o=n,a=E,l=T,h=A;t.getVelocityAtWorldPoint(o,a),e.getVelocityAtWorldPoint(o,l),a.vsub(l,h);h=i.dot(h),t=C(t,n,i),i=C(e,n,i);r<(s=1/(t+i)*-h)&&(s=r);s<-r&&(s=-r);return s}(r,m,y.raycastResult.hitPointWorld,s[a],d),p=d/(f+=y.engineForce*t),y.slipInfo*=p),y.forwardImpulse=0,y.skidInfo=1,m&&(y.skidInfo=1,d=(u=y.suspensionForce*t*y.frictionSlip)*u,y.forwardImpulse=f,f=(f=.5*y.forwardImpulse)*f+(f=+y.sideImpulse)*f,y.sliding=!1,d<f&&(this.sliding=!0,y.sliding=!0,p=u/Math.sqrt(f),y.skidInfo*=p))}if(this.sliding)for(a=0;a<i;a++)0!==(y=n[a]).sideImpulse&&y.skidInfo<1&&(y.forwardImpulse*=y.skidInfo,y.sideImpulse*=y.skidInfo);for(a=0;a<i;a++){var v,g,y=n[a],x=new _;x.copy(y.raycastResult.hitPointWorld),0!==y.forwardImpulse&&(g=new _,s[a].scale(y.forwardImpulse,g),r.applyImpulse(g,x)),0!==y.sideImpulse&&(m=y.raycastResult.body,(v=new _).copy(y.raycastResult.hitPointWorld),g=new _,o[a].scale(y.sideImpulse,g),r.pointToLocalFrame(x,x),x["xyz"[this.indexUpAxis]]*=y.rollInfluence,r.pointToWorldFrame(x,x),r.applyImpulse(g,x),g.scale(-1,g),m.applyImpulse(g,v))}};var E=new _,T=new _,A=new _;var d=new _,p=new _,m=new _,f=new _;function C(t,e,n){var i=d,r=p,s=m,o=f;return e.vsub(t.position,i),i.cross(n,r),t.invInertiaWorld.vmult(r,o),o.cross(i,s),t.invMass+n.dot(s)}var P=new _,L=new _,R=new _},{"../collision/Ray":9,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Vec3":30,"../objects/WheelInfo":36,"./Body":31}],33:[function(t,e,n){var r=t("./Body"),s=t("../shapes/Sphere"),i=t("../shapes/Box"),o=t("../math/Vec3"),a=t("../constraints/HingeConstraint");function l(t){this.wheelBodies=[],this.coordinateSystem=void 0===t.coordinateSystem?new o(1,2,3):t.coordinateSystem.clone(),this.chassisBody=t.chassisBody,this.chassisBody||(t=new i(new o(5,2,.5)),this.chassisBody=new r(1,t)),this.constraints=[],this.wheelAxes=[],this.wheelForces=[]}(e.exports=l).prototype.addWheel=function(t){var e=(e=(t=t||{}).body)||new r(1,new s(1.2));this.wheelBodies.push(e),this.wheelForces.push(0);new o;var n=void 0!==t.position?t.position.clone():new o,i=new o;this.chassisBody.pointToWorldFrame(n,i),e.position.set(i.x,i.y,i.z);t=void 0!==t.axis?t.axis.clone():new o(0,1,0);this.wheelAxes.push(t);t=new a(this.chassisBody,e,{pivotA:n,axisA:t,pivotB:o.ZERO,axisB:t,collideConnected:!1});return this.constraints.push(t),this.wheelBodies.length-1},l.prototype.setSteeringValue=function(t,e){var n=this.wheelAxes[e],i=Math.cos(t),r=Math.sin(t),t=n.x,n=n.y;this.constraints[e].axisA.set(i*t-r*n,r*t+i*n,0)},l.prototype.setMotorSpeed=function(t,e){e=this.constraints[e];e.enableMotor(),e.motorTargetVelocity=t},l.prototype.disableMotor=function(t){this.constraints[t].disableMotor()};var h=new o;l.prototype.setWheelForce=function(t,e){this.wheelForces[e]=t},l.prototype.applyWheelForce=function(t,e){var n=this.wheelAxes[e],i=this.wheelBodies[e],e=i.torque;n.scale(t,h),i.vectorToWorldFrame(h,h),e.vadd(h,e)},l.prototype.addToWorld=function(t){for(var e=this.constraints,n=this.wheelBodies.concat([this.chassisBody]),i=0;i<n.length;i++)t.add(n[i]);for(i=0;i<e.length;i++)t.addConstraint(e[i]);t.addEventListener("preStep",this._update.bind(this))},l.prototype._update=function(){for(var t=this.wheelForces,e=0;e<t.length;e++)this.applyWheelForce(t[e],e)},l.prototype.removeFromWorld=function(t){for(var e=this.constraints,n=this.wheelBodies.concat([this.chassisBody]),i=0;i<n.length;i++)t.remove(n[i]);for(i=0;i<e.length;i++)t.removeConstraint(e[i])};var c=new o;l.prototype.getWheelSpeed=function(t){var e=this.wheelAxes[t],t=this.wheelBodies[t].angularVelocity;return this.chassisBody.vectorToWorldFrame(e,c),t.dot(c)}},{"../constraints/HingeConstraint":15,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Sphere":44,"./Body":31}],34:[function(t,e,n){e.exports=i;t("../shapes/Shape");e=t("../math/Vec3"),t("../math/Quaternion"),t("../shapes/Particle"),t("../objects/Body"),t("../material/Material");function i(){this.particles=[],this.density=1,this.smoothingRadius=1,this.speedOfSound=1,this.viscosity=.01,this.eps=1e-6,this.pressures=[],this.densities=[],this.neighbors=[]}i.prototype.add=function(t){this.particles.push(t),this.neighbors.length<this.particles.length&&this.neighbors.push([])},i.prototype.remove=function(t){t=this.particles.indexOf(t);-1!==t&&(this.particles.splice(t,1),this.neighbors.length>this.particles.length&&this.neighbors.pop())};var l=new e;i.prototype.getNeighbors=function(t,e){for(var n=this.particles.length,i=t.id,r=this.smoothingRadius*this.smoothingRadius,s=l,o=0;o!==n;o++){var a=this.particles[o];a.position.vsub(t.position,s),i!==a.id&&s.norm2()<r&&e.push(a)}};var _=new e,b=new e,w=new e,M=new e,S=new e,E=new e;i.prototype.update=function(){for(var t=this.particles.length,e=_,n=this.speedOfSound,i=this.eps,r=0;r!==t;r++){var s=this.particles[r];(v=this.neighbors[r]).length=0,this.getNeighbors(s,v),v.push(this.particles[r]);for(var o=v.length,a=0,l=0;l!==o;l++){s.position.vsub(v[l].position,e);var h=e.norm(),h=this.w(h);a+=v[l].mass*h}this.densities[r]=a,this.pressures[r]=n*n*(this.densities[r]-this.density)}for(var c=b,u=w,d=M,p=S,m=E,r=0;r!==t;r++){var f=this.particles[r];c.set(0,0,0),u.set(0,0,0);for(var v,o=(v=this.neighbors[r]).length,l=0;l!==o;l++){var g=v[l];f.position.vsub(g.position,p);var y=p.norm(),x=-g.mass*(this.pressures[r]/(this.densities[r]*this.densities[r]+i)+this.pressures[l]/(this.densities[l]*this.densities[l]+i));this.gradw(p,d),d.mult(x,d),c.vadd(d,c),g.velocity.vsub(f.velocity,m),m.mult(1/(1e-4+this.densities[r]*this.densities[l])*this.viscosity*g.mass,m),y=this.nablaw(y),m.mult(y,m),u.vadd(m,u)}u.mult(f.mass,u),c.mult(f.mass,c),f.force.vadd(u,f.force),f.force.vadd(c,f.force)}},i.prototype.w=function(t){var e=this.smoothingRadius;return 315/(64*Math.PI*Math.pow(e,9))*Math.pow(e*e-t*t,3)},i.prototype.gradw=function(t,e){var n=t.norm(),i=this.smoothingRadius;t.mult(945/(32*Math.PI*Math.pow(i,9))*Math.pow(i*i-n*n,2),e)},i.prototype.nablaw=function(t){var e=this.smoothingRadius;return 945/(32*Math.PI*Math.pow(e,9))*(e*e-t*t)*(7*t*t-3*e*e)}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Particle":41,"../shapes/Shape":43}],35:[function(t,e,n){var i=t("../math/Vec3");function r(t,e,n){this.restLength="number"==typeof(n=n||{}).restLength?n.restLength:1,this.stiffness=n.stiffness||100,this.damping=n.damping||1,this.bodyA=t,this.bodyB=e,this.localAnchorA=new i,this.localAnchorB=new i,n.localAnchorA&&this.localAnchorA.copy(n.localAnchorA),n.localAnchorB&&this.localAnchorB.copy(n.localAnchorB),n.worldAnchorA&&this.setWorldAnchorA(n.worldAnchorA),n.worldAnchorB&&this.setWorldAnchorB(n.worldAnchorB)}(e.exports=r).prototype.setWorldAnchorA=function(t){this.bodyA.pointToLocalFrame(t,this.localAnchorA)},r.prototype.setWorldAnchorB=function(t){this.bodyB.pointToLocalFrame(t,this.localAnchorB)},r.prototype.getWorldAnchorA=function(t){this.bodyA.pointToWorldFrame(this.localAnchorA,t)},r.prototype.getWorldAnchorB=function(t){this.bodyB.pointToWorldFrame(this.localAnchorB,t)};var v=new i,g=new i,y=new i,x=new i,_=new i,b=new i,w=new i,M=new i,S=new i,E=new i,T=new i;r.prototype.applyForce=function(){var t=this.stiffness,e=this.damping,n=this.restLength,i=this.bodyA,r=this.bodyB,s=v,o=g,a=y,l=x,h=T,c=_,u=b,d=w,p=M,m=S,f=E;this.getWorldAnchorA(c),this.getWorldAnchorB(u),c.vsub(i.position,d),u.vsub(r.position,p),u.vsub(c,s);c=s.norm();o.copy(s),o.normalize(),r.velocity.vsub(i.velocity,a),r.angularVelocity.cross(p,h),a.vadd(h,a),i.angularVelocity.cross(d,h),a.vsub(h,a),o.mult(-t*(c-n)-e*a.dot(o),l),i.force.vsub(l,i.force),r.force.vadd(l,r.force),d.cross(l,m),p.cross(l,f),i.torque.vsub(m,i.torque),r.torque.vadd(f,r.torque)}},{"../math/Vec3":30}],36:[function(t,e,n){var i=t("../math/Vec3"),r=t("../math/Transform"),s=t("../collision/RaycastResult"),o=t("../utils/Utils");function a(t){t=o.defaults(t,{chassisConnectionPointLocal:new i,chassisConnectionPointWorld:new i,directionLocal:new i,directionWorld:new i,axleLocal:new i,axleWorld:new i,suspensionRestLength:1,suspensionMaxLength:2,radius:1,suspensionStiffness:100,dampingCompression:10,dampingRelaxation:10,frictionSlip:1e4,steering:0,rotation:0,deltaRotation:0,rollInfluence:.01,maxSuspensionForce:Number.MAX_VALUE,isFrontWheel:!0,clippedInvContactDotSuspension:1,suspensionRelativeVelocity:0,suspensionForce:0,skidInfo:0,suspensionLength:0,maxSuspensionTravel:1,useCustomSlidingRotationalSpeed:!1,customSlidingRotationalSpeed:-.1}),this.maxSuspensionTravel=t.maxSuspensionTravel,this.customSlidingRotationalSpeed=t.customSlidingRotationalSpeed,this.useCustomSlidingRotationalSpeed=t.useCustomSlidingRotationalSpeed,this.sliding=!1,this.chassisConnectionPointLocal=t.chassisConnectionPointLocal.clone(),this.chassisConnectionPointWorld=t.chassisConnectionPointWorld.clone(),this.directionLocal=t.directionLocal.clone(),this.directionWorld=t.directionWorld.clone(),this.axleLocal=t.axleLocal.clone(),this.axleWorld=t.axleWorld.clone(),this.suspensionRestLength=t.suspensionRestLength,this.suspensionMaxLength=t.suspensionMaxLength,this.radius=t.radius,this.suspensionStiffness=t.suspensionStiffness,this.dampingCompression=t.dampingCompression,this.dampingRelaxation=t.dampingRelaxation,this.frictionSlip=t.frictionSlip,this.steering=0,this.rotation=0,this.deltaRotation=0,this.rollInfluence=t.rollInfluence,this.maxSuspensionForce=t.maxSuspensionForce,this.engineForce=0,this.brake=0,this.isFrontWheel=t.isFrontWheel,this.clippedInvContactDotSuspension=1,this.suspensionRelativeVelocity=0,this.suspensionForce=0,this.skidInfo=0,this.suspensionLength=0,this.sideImpulse=0,this.forwardImpulse=0,this.raycastResult=new s,this.worldTransform=new r,this.isInContact=!1}e.exports=a;new i;var l=new i,h=new i;a.prototype.updateWheel=function(t){var e,n=this.raycastResult;this.isInContact?(e=n.hitNormalWorld.dot(n.directionWorld),n.hitPointWorld.vsub(t.position,l),t.getVelocityAtWorldPoint(l,h),t=n.hitNormalWorld.dot(h),-.1<=e?(this.suspensionRelativeVelocity=0,this.clippedInvContactDotSuspension=10):(this.suspensionRelativeVelocity=t*(e=-1/e),this.clippedInvContactDotSuspension=e)):(n.suspensionLength=this.suspensionRestLength,this.suspensionRelativeVelocity=0,n.directionWorld.scale(-1,n.hitNormalWorld),this.clippedInvContactDotSuspension=1)}},{"../collision/RaycastResult":10,"../math/Transform":29,"../math/Vec3":30,"../utils/Utils":53}],37:[function(t,e,n){e.exports=o;var i=t("./Shape"),r=t("../math/Vec3"),s=t("./ConvexPolyhedron");function o(t){i.call(this),this.type=i.types.BOX,this.halfExtents=t,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}((o.prototype=new i).constructor=o).prototype.updateConvexPolyhedronRepresentation=function(){var t=this.halfExtents.x,e=this.halfExtents.y,n=this.halfExtents.z,i=r,n=[new i(-t,-e,-n),new i(t,-e,-n),new i(t,e,-n),new i(-t,e,-n),new i(-t,-e,n),new i(t,-e,n),new i(t,e,n),new i(-t,e,n)],n=(new i(0,0,1),new i(0,1,0),new i(1,0,0),new s(n,[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]]));(this.convexPolyhedronRepresentation=n).material=this.material},o.prototype.calculateLocalInertia=function(t,e){return e=e||new r,o.calculateInertia(this.halfExtents,t,e),e},o.calculateInertia=function(t,e,n){n.x=1/12*e*(2*t.y*2*t.y+2*t.z*2*t.z),n.y=1/12*e*(2*t.x*2*t.x+2*t.z*2*t.z),n.z=1/12*e*(2*t.y*2*t.y+2*t.x*2*t.x)},o.prototype.getSideNormals=function(t,e){var n=t,t=this.halfExtents;if(n[0].set(t.x,0,0),n[1].set(0,t.y,0),n[2].set(0,0,t.z),n[3].set(-t.x,0,0),n[4].set(0,-t.y,0),n[5].set(0,0,-t.z),void 0!==e)for(var i=0;i!==n.length;i++)e.vmult(n[i],n[i]);return n},o.prototype.volume=function(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z},o.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.halfExtents.norm()};var a=new r;new r;o.prototype.forEachWorldCorner=function(t,e,n){for(var i=this.halfExtents,r=[[i.x,i.y,i.z],[-i.x,i.y,i.z],[-i.x,-i.y,i.z],[-i.x,-i.y,-i.z],[i.x,-i.y,-i.z],[i.x,i.y,-i.z],[-i.x,i.y,-i.z],[i.x,-i.y,i.z]],s=0;s<r.length;s++)a.set(r[s][0],r[s][1],r[s][2]),e.vmult(a,a),t.vadd(a,a),n(a.x,a.y,a.z)};var c=[new r,new r,new r,new r,new r,new r,new r,new r];o.prototype.calculateWorldAABB=function(t,e,n,i){var r=this.halfExtents;c[0].set(r.x,r.y,r.z),c[1].set(-r.x,r.y,r.z),c[2].set(-r.x,-r.y,r.z),c[3].set(-r.x,-r.y,-r.z),c[4].set(r.x,-r.y,-r.z),c[5].set(r.x,r.y,-r.z),c[6].set(-r.x,r.y,-r.z),c[7].set(r.x,-r.y,r.z);var s=c[0];e.vmult(s,s),t.vadd(s,s),i.copy(s),n.copy(s);for(var o=1;o<8;o++){s=c[o];e.vmult(s,s),t.vadd(s,s);var a=s.x,l=s.y,h=s.z;a>i.x&&(i.x=a),l>i.y&&(i.y=l),h>i.z&&(i.z=h),a<n.x&&(n.x=a),l<n.y&&(n.y=l),h<n.z&&(n.z=h)}}},{"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],38:[function(t,e,n){e.exports=o;var i=t("./Shape"),_=t("../math/Vec3"),p=(t("../math/Quaternion"),t("../math/Transform"));function o(t,e,n){i.call(this),this.type=i.types.CONVEXPOLYHEDRON,this.vertices=t||[],this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.faces=e||[],this.faceNormals=[],this.computeNormals(),this.worldFaceNormalsNeedsUpdate=!0,this.worldFaceNormals=[],this.uniqueEdges=[],this.uniqueAxes=n?n.slice():null,this.computeEdges(),this.updateBoundingSphereRadius()}(o.prototype=new i).constructor=o;var c=new _;o.prototype.computeEdges=function(){var t=this.faces,e=this.vertices,n=(e.length,this.uniqueEdges);n.length=0;for(var i=c,r=0;r!==t.length;r++)for(var s=t[r],o=s.length,a=0;a!==o;a++){e[s[a]].vsub(e[s[(a+1)%o]],i),i.normalize();for(var l=!1,h=0;h!==n.length;h++)if(n[h].almostEquals(i)||n[h].almostEquals(i)){l=!0;break}l||n.push(i.clone())}},o.prototype.computeNormals=function(){this.faceNormals.length=this.faces.length;for(var t=0;t<this.faces.length;t++){for(var e=0;e<this.faces[t].length;e++)if(!this.vertices[this.faces[t][e]])throw new Error("Vertex "+this.faces[t][e]+" not found!");var n=this.faceNormals[t]||new _;this.getFaceNormal(t,n),n.negate(n),this.faceNormals[t]=n;var i=this.vertices[this.faces[t][0]];if(n.dot(i)<0){console.error(".faceNormals["+t+"] = Vec3("+n.toString()+") looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule.");for(e=0;e<this.faces[t].length;e++)console.warn(".vertices["+this.faces[t][e]+"] = Vec3("+this.vertices[this.faces[t][e]].toString()+")")}}};var r=new _,s=new _;o.computeNormal=function(t,e,n,i){e.vsub(t,s),n.vsub(e,r),r.cross(s,i),i.isZero()||i.normalize()},o.prototype.getFaceNormal=function(t,e){var n=this.faces[t],i=this.vertices[n[0]],t=this.vertices[n[1]],n=this.vertices[n[2]];return o.computeNormal(i,t,n,e)};var b=new _;o.prototype.clipAgainstHull=function(t,e,n,i,r,s,o,a,l){for(var h=b,c=-1,u=-Number.MAX_VALUE,d=0;d<n.faces.length;d++){h.copy(n.faceNormals[d]),r.vmult(h,h);var p=h.dot(s);u<p&&(u=p,c=d)}for(var m=[],f=n.faces[c],v=f.length,g=0;g<v;g++){var y=n.vertices[f[g]],x=new _;x.copy(y),r.vmult(x,x),i.vadd(x,x),m.push(x)}0<=c&&this.clipFaceAgainstHull(s,t,e,m,o,a,l)};var S=new _,E=new _,T=new _,A=new _,C=new _,P=new _;o.prototype.findSeparatingAxis=function(t,e,n,i,r,s,o,a){var l=S,h=E,c=T,u=A,d=C,p=P,m=Number.MAX_VALUE,f=this;if(f.uniqueAxes)for(g=0;g!==f.uniqueAxes.length;g++){if(n.vmult(f.uniqueAxes[g],l),!1===(_=f.testSepAxis(l,t,e,n,i,r)))return!1;_<m&&(m=_,s.copy(l))}else for(var v=(o||f.faces).length,g=0;g<v;g++){var y=o?o[g]:g;if(l.copy(f.faceNormals[y]),n.vmult(l,l),!1===(_=f.testSepAxis(l,t,e,n,i,r)))return!1;_<m&&(m=_,s.copy(l))}if(t.uniqueAxes)for(g=0;g!==t.uniqueAxes.length;g++){if(r.vmult(t.uniqueAxes[g],h),!1===(_=f.testSepAxis(h,t,e,n,i,r)))return!1;_<m&&(m=_,s.copy(h))}else for(var x=(a||t.faces).length,g=0;g<x;g++){var _,y=a?a[g]:g;if(h.copy(t.faceNormals[y]),r.vmult(h,h),!1===(_=f.testSepAxis(h,t,e,n,i,r)))return!1;_<m&&(m=_,s.copy(h))}for(var b=0;b!==f.uniqueEdges.length;b++){n.vmult(f.uniqueEdges[b],u);for(var w=0;w!==t.uniqueEdges.length;w++)if(r.vmult(t.uniqueEdges[w],d),u.cross(d,p),!p.almostZero()){p.normalize();var M=f.testSepAxis(p,t,e,n,i,r);if(!1===M)return!1;M<m&&(m=M,s.copy(p))}}return i.vsub(e,c),0<c.dot(s)&&s.negate(s),!0};var a=[],l=[];o.prototype.testSepAxis=function(t,e,n,i,r,s){o.project(this,t,n,i,a),o.project(e,t,r,s,l);e=a[0],t=a[1],r=l[0],s=l[1];if(e<s||r<t)return!1;s=e-s,t=r-t;return s<t?s:t};var h=new _,u=new _;o.prototype.calculateLocalInertia=function(t,e){this.computeLocalAABB(h,u);var n=u.x-h.x,i=u.y-h.y,r=u.z-h.z;e.x=1/12*t*(2*i*2*i+2*r*2*r),e.y=1/12*t*(2*n*2*n+2*r*2*r),e.z=1/12*t*(2*i*2*i+2*n*2*n)},o.prototype.getPlaneConstantOfFace=function(t){var e=this.faces[t],t=this.faceNormals[t],e=this.vertices[e[0]];return-t.dot(e)};var z=new _,N=new _,B=new _,D=new _,F=new _,k=new _,O=new _,V=new _;o.prototype.clipFaceAgainstHull=function(t,e,n,i,r,s,o){for(var a=z,l=N,h=B,c=D,u=F,d=k,p=O,m=V,f=this,v=i,g=[],y=-1,x=Number.MAX_VALUE,_=0;_<f.faces.length;_++){a.copy(f.faceNormals[_]),n.vmult(a,a);var b=a.dot(t);b<x&&(x=b,y=_)}if(!(y<0)){var w=f.faces[y];w.connectedFaces=[];for(var M=0;M<f.faces.length;M++)for(var S=0;S<f.faces[M].length;S++)-1!==w.indexOf(f.faces[M][S])&&M!==y&&-1===w.connectedFaces.indexOf(M)&&w.connectedFaces.push(M);v.length;for(var E=w.length,T=0;T<E;T++){var A=f.vertices[w[T]],C=f.vertices[w[(T+1)%E]];A.vsub(C,l),h.copy(l),n.vmult(h,h),e.vadd(h,h),c.copy(this.faceNormals[y]),n.vmult(c,c),e.vadd(c,c),h.cross(c,u),u.negate(u),d.copy(A),n.vmult(d,d),e.vadd(d,d);d.dot(u);A=w.connectedFaces[T];p.copy(this.faceNormals[A]);var P=this.getPlaneConstantOfFace(A);m.copy(p),n.vmult(m,m);var L=P-m.dot(e);for(this.clipFaceAgainstPlane(v,g,m,L);v.length;)v.shift();for(;g.length;)v.push(g.shift())}p.copy(this.faceNormals[y]);P=this.getPlaneConstantOfFace(y);m.copy(p),n.vmult(m,m);for(L=P-m.dot(e),M=0;M<v.length;M++){var R,I=m.dot(v[M])+L;I<=r&&(console.log("clamped: depth="+I+" to minDist="+r+""),I=r),I<=s&&(R=v[M],I<=0&&o.push({point:R,normal:m,depth:I}))}}},o.prototype.clipFaceAgainstPlane=function(t,e,n,i){var r=t.length;if(r<2)return e;for(var s=t[t.length-1],o=(t[0],n.dot(s)+i),a=0;a<r;a++){var l,h=t[a],c=n.dot(h)+i;o<0?(c<0?(l=new _).copy(h):(l=new _,s.lerp(h,o/(o-c),l)),e.push(l)):c<0&&(l=new _,s.lerp(h,o/(o-c),l),e.push(l),e.push(h)),s=h,o=c}return e},o.prototype.computeWorldVertices=function(t,e){for(var n=this.vertices.length;this.worldVertices.length<n;)this.worldVertices.push(new _);for(var i=this.vertices,r=this.worldVertices,s=0;s!==n;s++)e.vmult(i[s],r[s]),t.vadd(r[s],r[s]);this.worldVerticesNeedsUpdate=!1};new _;o.prototype.computeLocalAABB=function(t,e){var n=this.vertices.length,i=this.vertices;t.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),e.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var r=0;r<n;r++){var s=i[r];s.x<t.x?t.x=s.x:s.x>e.x&&(e.x=s.x),s.y<t.y?t.y=s.y:s.y>e.y&&(e.y=s.y),s.z<t.z?t.z=s.z:s.z>e.z&&(e.z=s.z)}},o.prototype.computeWorldFaceNormals=function(t){for(var e=this.faceNormals.length;this.worldFaceNormals.length<e;)this.worldFaceNormals.push(new _);for(var n=this.faceNormals,i=this.worldFaceNormals,r=0;r!==e;r++)t.vmult(n[r],i[r]);this.worldFaceNormalsNeedsUpdate=!1},o.prototype.updateBoundingSphereRadius=function(){for(var t=0,e=this.vertices,n=0,i=e.length;n!==i;n++){var r=e[n].norm2();t<r&&(t=r)}this.boundingSphereRadius=Math.sqrt(t)};var m=new _;o.prototype.calculateWorldAABB=function(t,e,n,i){for(var r,s,o,a,l,h,c=this.vertices.length,u=this.vertices,d=0;d<c;d++)m.copy(u[d]),e.vmult(m,m),t.vadd(m,m),m.x<r||void 0===r?r=m.x:(m.x>a||void 0===a)&&(a=m.x),m.y<s||void 0===s?s=m.y:(m.y>l||void 0===l)&&(l=m.y),m.z<o||void 0===o?o=m.z:(m.z>h||void 0===h)&&(h=m.z);n.set(r,s,o),i.set(a,l,h)},o.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},o.prototype.getAveragePointLocal=function(t){t=t||new _;for(var e=this.vertices.length,n=this.vertices,i=0;i<e;i++)t.vadd(n[i],t);return t.mult(1/e,t),t},o.prototype.transformAllPoints=function(t,e){var n=this.vertices.length,i=this.vertices;if(e){for(var r=0;r<n;r++){var s=i[r];e.vmult(s,s)}for(r=0;r<this.faceNormals.length;r++){s=this.faceNormals[r];e.vmult(s,s)}}if(t)for(r=0;r<n;r++)(s=i[r]).vadd(t,s)};var d=new _,f=new _,v=new _;o.prototype.pointIsInside=function(t){var e=this.vertices.length,n=this.vertices,i=this.faces,r=this.faceNormals,s=this.faces.length,o=d;this.getAveragePointLocal(o);for(var a=0;a<s;a++){this.faces[a].length;var e=r[a],l=n[i[a][0]],h=f;t.vsub(l,h);var c=e.dot(h),h=v;o.vsub(l,h);h=e.dot(h);if(c<0&&0<h||0<c&&h<0)return!1}return-1};new _;var g=new _,y=new _;o.project=function(t,e,n,i,r){var s=t.vertices.length,o=g,a=0,l=0,h=y,c=t.vertices;h.setZero(),p.vectorToLocalFrame(n,i,e,o),p.pointToLocalFrame(n,i,h,h);h=h.dot(o);l=a=c[0].dot(o);for(var u=1;u<s;u++){var d=c[u].dot(o);a<d&&(a=d),d<l&&(l=d)}(a-=h)<(l-=h)&&(h=l,l=a,a=h),r[0]=a,r[1]=l}},{"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"./Shape":43}],39:[function(t,e,n){e.exports=i;var v=t("./Shape"),g=t("../math/Vec3"),y=(t("../math/Quaternion"),t("./ConvexPolyhedron"));function i(t,e,n,i){var r=i,s=[],o=[],a=[],l=[],h=[],c=Math.cos,u=Math.sin;s.push(new g(e*c(0),e*u(0),.5*-n)),l.push(0),s.push(new g(t*c(0),t*u(0),.5*n)),h.push(1);for(var d=0;d<r;d++){var p=2*Math.PI/r*(d+1),m=2*Math.PI/r*(d+.5);d<r-1?(s.push(new g(e*c(p),e*u(p),.5*-n)),l.push(2*d+2),s.push(new g(t*c(p),t*u(p),.5*n)),h.push(2*d+3),a.push([2*d+2,2*d+3,2*d+1,2*d])):a.push([0,1,2*d+1,2*d]),(r%2==1||d<r/2)&&o.push(new g(c(m),u(m),0))}a.push(h),o.push(new g(0,0,1));for(var f=[],d=0;d<l.length;d++)f.push(l[l.length-d-1]);a.push(f),this.type=v.types.CONVEXPOLYHEDRON,y.call(this,s,a,o)}i.prototype=new y},{"../math/Quaternion":28,"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],40:[function(t,e,n){var i=t("./Shape"),u=t("./ConvexPolyhedron"),d=t("../math/Vec3"),r=t("../utils/Utils");function s(t,e){e=r.defaults(e,{maxValue:null,minValue:null,elementSize:1}),this.data=t,this.maxValue=e.maxValue,this.minValue=e.minValue,this.elementSize=e.elementSize,null===e.minValue&&this.updateMinValue(),null===e.maxValue&&this.updateMaxValue(),this.cacheEnabled=!0,i.call(this),this.pillarConvex=new u,this.pillarOffset=new d,this.type=i.types.HEIGHTFIELD,this.updateBoundingSphereRadius(),this._cachedPillars={}}((e.exports=s).prototype=new i).update=function(){this._cachedPillars={}},s.prototype.updateMinValue=function(){for(var t=this.data,e=t[0][0],n=0;n!==t.length;n++)for(var i=0;i!==t[n].length;i++){var r=t[n][i];r<e&&(e=r)}this.minValue=e},s.prototype.updateMaxValue=function(){for(var t=this.data,e=t[0][0],n=0;n!==t.length;n++)for(var i=0;i!==t[n].length;i++){var r=t[n][i];e<r&&(e=r)}this.maxValue=e},s.prototype.setHeightValueAtIndex=function(t,e,n){this.data[t][e]=n,this.clearCachedConvexTrianglePillar(t,e,!1),0<t&&(this.clearCachedConvexTrianglePillar(t-1,e,!0),this.clearCachedConvexTrianglePillar(t-1,e,!1)),0<e&&(this.clearCachedConvexTrianglePillar(t,e-1,!0),this.clearCachedConvexTrianglePillar(t,e-1,!1)),0<e&&0<t&&this.clearCachedConvexTrianglePillar(t-1,e-1,!0)},s.prototype.getRectMinMax=function(t,e,n,i,r){r=r||[];for(var s=this.data,o=this.minValue,a=t;a<=n;a++)for(var l=e;l<=i;l++){var h=s[a][l];o<h&&(o=h)}r[0]=this.minValue,r[1]=o},s.prototype.getIndexOfPosition=function(t,e,n,i){var r=this.elementSize,s=this.data,t=Math.floor(t/r),r=Math.floor(e/r);return n[0]=t,n[1]=r,i&&((t=t<0?0:t)>=s.length-1&&(t=s.length-1),(r=r<0?0:r)>=s[0].length-1&&(r=s[0].length-1)),!(t<0||r<0||t>=s.length-1||r>=s[0].length-1)},s.prototype.getHeightAt=function(t,e,n){var i=[];this.getIndexOfPosition(t,e,i,n);n=[];return this.getRectMinMax(i[0],i[1]+1,i[0],i[1]+1,n),(n[0]+n[1])/2},s.prototype.getCacheConvexTrianglePillarKey=function(t,e,n){return t+"_"+e+"_"+(n?1:0)},s.prototype.getCachedConvexTrianglePillar=function(t,e,n){return this._cachedPillars[this.getCacheConvexTrianglePillarKey(t,e,n)]},s.prototype.setCachedConvexTrianglePillar=function(t,e,n,i,r){this._cachedPillars[this.getCacheConvexTrianglePillarKey(t,e,n)]={convex:i,offset:r}},s.prototype.clearCachedConvexTrianglePillar=function(t,e,n){delete this._cachedPillars[this.getCacheConvexTrianglePillarKey(t,e,n)]},s.prototype.getConvexTrianglePillar=function(t,e,n){var i=this.pillarConvex,r=this.pillarOffset;if(this.cacheEnabled){if(s=this.getCachedConvexTrianglePillar(t,e,n))return this.pillarConvex=s.convex,void(this.pillarOffset=s.offset);i=new u,r=new d,this.pillarConvex=i,this.pillarOffset=r}var s=this.data,o=this.elementSize,a=i.faces;i.vertices.length=6;for(var l=0;l<6;l++)i.vertices[l]||(i.vertices[l]=new d);a.length=5;for(l=0;l<5;l++)a[l]||(a[l]=[]);var h=i.vertices,c=(Math.min(s[t][e],s[t+1][e],s[t][e+1],s[t+1][e+1])-this.minValue)/2+this.minValue;n?(r.set((t+.75)*o,(e+.75)*o,c),h[0].set(.25*o,.25*o,s[t+1][e+1]-c),h[1].set(-.75*o,.25*o,s[t][e+1]-c),h[2].set(.25*o,-.75*o,s[t+1][e]-c),h[3].set(.25*o,.25*o,-c-1),h[4].set(-.75*o,.25*o,-c-1),h[5].set(.25*o,-.75*o,-c-1),a[0][0]=0,a[0][1]=1,a[0][2]=2,a[1][0]=5,a[1][1]=4,a[1][2]=3,a[2][0]=2,a[2][1]=5,a[2][2]=3,a[2][3]=0,a[3][0]=3,a[3][1]=4,a[3][2]=1,a[3][3]=0,a[4][0]=1,a[4][1]=4,a[4][2]=5,a[4][3]=2):(r.set((t+.25)*o,(e+.25)*o,c),h[0].set(-.25*o,-.25*o,s[t][e]-c),h[1].set(.75*o,-.25*o,s[t+1][e]-c),h[2].set(-.25*o,.75*o,s[t][e+1]-c),h[3].set(-.25*o,-.25*o,-c-1),h[4].set(.75*o,-.25*o,-c-1),h[5].set(-.25*o,.75*o,-c-1),a[0][0]=0,a[0][1]=1,a[0][2]=2,a[1][0]=5,a[1][1]=4,a[1][2]=3,a[2][0]=0,a[2][1]=2,a[2][2]=5,a[2][3]=3,a[3][0]=1,a[3][1]=0,a[3][2]=3,a[3][3]=4,a[4][0]=4,a[4][1]=5,a[4][2]=2,a[4][3]=1),i.computeNormals(),i.computeEdges(),i.updateBoundingSphereRadius(),this.setCachedConvexTrianglePillar(t,e,n,i,r)},s.prototype.calculateLocalInertia=function(t,e){return(e=e||new d).set(0,0,0),e},s.prototype.volume=function(){return Number.MAX_VALUE},s.prototype.calculateWorldAABB=function(t,e,n,i){n.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),i.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},s.prototype.updateBoundingSphereRadius=function(){var t=this.data,e=this.elementSize;this.boundingSphereRadius=new d(t.length*e,t[0].length*e,Math.max(Math.abs(this.maxValue),Math.abs(this.minValue))).norm()}},{"../math/Vec3":30,"../utils/Utils":53,"./ConvexPolyhedron":38,"./Shape":43}],41:[function(t,e,n){e.exports=s;var i=t("./Shape"),r=t("../math/Vec3");function s(){i.call(this),this.type=i.types.PARTICLE}((s.prototype=new i).constructor=s).prototype.calculateLocalInertia=function(t,e){return(e=e||new r).set(0,0,0),e},s.prototype.volume=function(){return 0},s.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=0},s.prototype.calculateWorldAABB=function(t,e,n,i){n.copy(t),i.copy(t)}},{"../math/Vec3":30,"./Shape":43}],42:[function(t,e,n){e.exports=s;var i=t("./Shape"),r=t("../math/Vec3");function s(){i.call(this),this.type=i.types.PLANE,this.worldNormal=new r,this.worldNormalNeedsUpdate=!0,this.boundingSphereRadius=Number.MAX_VALUE}((s.prototype=new i).constructor=s).prototype.computeWorldNormal=function(t){var e=this.worldNormal;e.set(0,0,1),t.vmult(e,e),this.worldNormalNeedsUpdate=!1},s.prototype.calculateLocalInertia=function(t,e){return e=e||new r},s.prototype.volume=function(){return Number.MAX_VALUE};var o=new r;s.prototype.calculateWorldAABB=function(t,e,n,i){o.set(0,0,1),e.vmult(o,o);e=Number.MAX_VALUE;n.set(-e,-e,-e),i.set(e,e,e),1===o.x&&(i.x=t.x),1===o.y&&(i.y=t.y),1===o.z&&(i.z=t.z),-1===o.x&&(n.x=t.x),-1===o.y&&(n.y=t.y),-1===o.z&&(n.z=t.z)},s.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=Number.MAX_VALUE}},{"../math/Vec3":30,"./Shape":43}],43:[function(t,e,n){e.exports=i;var i=t("./Shape");t("../math/Vec3"),t("../math/Quaternion"),t("../material/Material");function i(){this.id=i.idCounter++,this.type=0,this.boundingSphereRadius=0,this.collisionResponse=!0,this.material=null}(i.prototype.constructor=i).prototype.updateBoundingSphereRadius=function(){throw"computeBoundingSphereRadius() not implemented for shape type "+this.type},i.prototype.volume=function(){throw"volume() not implemented for shape type "+this.type},i.prototype.calculateLocalInertia=function(t,e){throw"calculateLocalInertia() not implemented for shape type "+this.type},i.idCounter=0,i.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"./Shape":43}],44:[function(t,e,n){e.exports=s;var i=t("./Shape"),r=t("../math/Vec3");function s(t){if(i.call(this),this.radius=void 0!==t?Number(t):1,this.type=i.types.SPHERE,this.radius<0)throw new Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}((s.prototype=new i).constructor=s).prototype.calculateLocalInertia=function(t,e){e=e||new r;t=2*t*this.radius*this.radius/5;return e.x=t,e.y=t,e.z=t,e},s.prototype.volume=function(){return 4*Math.PI*this.radius/3},s.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.radius},s.prototype.calculateWorldAABB=function(t,e,n,i){for(var r=this.radius,s=["x","y","z"],o=0;o<s.length;o++){var a=s[o];n[a]=t[a]-r,i[a]=t[a]+r}}},{"../math/Vec3":30,"./Shape":43}],45:[function(t,e,n){e.exports=f;var i=t("./Shape"),h=t("../math/Vec3"),r=(t("../math/Quaternion"),t("../math/Transform")),c=t("../collision/AABB"),s=t("../utils/Octree");function f(t,e){i.call(this),this.type=i.types.TRIMESH,this.vertices=new Float32Array(t),this.indices=new Int16Array(e),this.normals=new Float32Array(e.length),this.aabb=new c,this.edges=null,this.scale=new h(1,1,1),this.tree=new s,this.updateEdges(),this.updateNormals(),this.updateAABB(),this.updateBoundingSphereRadius(),this.updateTree()}(f.prototype=new i).constructor=f;var a=new h;f.prototype.updateTree=function(){var t=this.tree;t.reset(),t.aabb.copy(this.aabb);var e=this.scale;t.aabb.lowerBound.x*=1/e.x,t.aabb.lowerBound.y*=1/e.y,t.aabb.lowerBound.z*=1/e.z,t.aabb.upperBound.x*=1/e.x,t.aabb.upperBound.y*=1/e.y,t.aabb.upperBound.z*=1/e.z;for(var n=new c,i=new h,r=new h,s=new h,o=[i,r,s],a=0;a<this.indices.length/3;a++){var l=3*a;this._getUnscaledVertex(this.indices[l],i),this._getUnscaledVertex(this.indices[1+l],r),this._getUnscaledVertex(this.indices[2+l],s),n.setFromPoints(o),t.insert(n,a)}t.removeEmptyNodes()};var o=new c;f.prototype.getTrianglesInAABB=function(t,e){o.copy(t);var n=this.scale,i=n.x,r=n.y,s=n.z,t=o.lowerBound,n=o.upperBound;return t.x/=i,t.y/=r,t.z/=s,n.x/=i,n.y/=r,n.z/=s,this.tree.aabbQuery(o,e)},f.prototype.setScale=function(t){var e=this.scale.x===this.scale.y===this.scale.z,n=t.x===t.y===t.z;e&&n||this.updateNormals(),this.scale.copy(t),this.updateAABB(),this.updateBoundingSphereRadius()},f.prototype.updateNormals=function(){for(var t=a,e=this.normals,n=0;n<this.indices.length/3;n++){var i=3*n,r=this.indices[i],s=this.indices[1+i],o=this.indices[2+i];this.getVertex(r,m),this.getVertex(s,v),this.getVertex(o,g),f.computeNormal(v,m,g,t),e[i]=t.x,e[1+i]=t.y,e[2+i]=t.z}},f.prototype.updateEdges=function(){function t(t,e){n[r<s?r+"_"+s:s+"_"+r]=!0}for(var n={},e=0;e<this.indices.length/3;e++){var i=3*e,r=this.indices[i],s=this.indices[1+i];this.indices[2+i];t(),t(),t()}var o=Object.keys(n);this.edges=new Int16Array(2*o.length);for(e=0;e<o.length;e++){var a=o[e].split("_");this.edges[2*e]=parseInt(a[0],10),this.edges[2*e+1]=parseInt(a[1],10)}},f.prototype.getEdgeVertex=function(t,e,n){e=this.edges[2*t+(e?1:0)];this.getVertex(e,n)};var l=new h,u=new h;f.prototype.getEdgeVector=function(t,e){var n=l,i=u;this.getEdgeVertex(t,0,n),this.getEdgeVertex(t,1,i),i.vsub(n,e)};var d=new h,p=new h;f.computeNormal=function(t,e,n,i){e.vsub(t,p),n.vsub(e,d),d.cross(p,i),i.isZero()||i.normalize()};var m=new h,v=new h,g=new h;f.prototype.getVertex=function(t,e){var n=this.scale;return this._getUnscaledVertex(t,e),e.x*=n.x,e.y*=n.y,e.z*=n.z,e},f.prototype._getUnscaledVertex=function(t,e){var n=3*t,t=this.vertices;return e.set(t[n],t[1+n],t[2+n])},f.prototype.getWorldVertex=function(t,e,n,i){return this.getVertex(t,i),r.pointToWorldFrame(e,n,i,i),i},f.prototype.getTriangleVertices=function(t,e,n,i){t*=3;this.getVertex(this.indices[t],e),this.getVertex(this.indices[1+t],n),this.getVertex(this.indices[2+t],i)},f.prototype.getNormal=function(t,e){t*=3;return e.set(this.normals[t],this.normals[1+t],this.normals[2+t])};var y=new c;f.prototype.calculateLocalInertia=function(t,e){this.computeLocalAABB(y);var n=y.upperBound.x-y.lowerBound.x,i=y.upperBound.y-y.lowerBound.y,r=y.upperBound.z-y.lowerBound.z;return e.set(1/12*t*(2*i*2*i+2*r*2*r),1/12*t*(2*n*2*n+2*r*2*r),1/12*t*(2*i*2*i+2*n*2*n))};var x=new h;f.prototype.computeLocalAABB=function(t){var e=t.lowerBound,n=t.upperBound,i=this.vertices.length,r=(this.vertices,x);this.getVertex(0,r),e.copy(r),n.copy(r);for(var s=0;s!==i;s++)this.getVertex(s,r),r.x<e.x?e.x=r.x:r.x>n.x&&(n.x=r.x),r.y<e.y?e.y=r.y:r.y>n.y&&(n.y=r.y),r.z<e.z?e.z=r.z:r.z>n.z&&(n.z=r.z)},f.prototype.updateAABB=function(){this.computeLocalAABB(this.aabb)},f.prototype.updateBoundingSphereRadius=function(){for(var t=0,e=this.vertices,n=new h,i=0,r=e.length/3;i!==r;i++){this.getVertex(i,n);var s=n.norm2();t<s&&(t=s)}this.boundingSphereRadius=Math.sqrt(t)};new h;var _=new r,b=new c;f.prototype.calculateWorldAABB=function(t,e,n,i){var r=_,s=b;r.position=t,r.quaternion=e,this.aabb.toWorldFrame(r,s),n.copy(s.lowerBound),i.copy(s.upperBound)},f.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},f.createTorus=function(t,e,n,i,r){t=t||1,e=e||.5,n=n||8,i=i||6,r=r||2*Math.PI;for(var s=[],o=[],a=0;a<=n;a++)for(var l=0;l<=i;l++){var h=l/i*r,c=a/n*Math.PI*2,u=(t+e*Math.cos(c))*Math.cos(h),h=(t+e*Math.cos(c))*Math.sin(h),c=e*Math.sin(c);s.push(u,h,c)}for(a=1;a<=n;a++)for(l=1;l<=i;l++){var d=(i+1)*(a-1)+l-1,p=(i+1)*(a-1)+l,m=(i+1)*a+l;o.push((i+1)*a+l-1,d,m),o.push(d,p,m)}return new f(s,o)}},{"../collision/AABB":3,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../utils/Octree":50,"./Shape":43}],46:[function(t,e,n){e.exports=r;t("../math/Vec3"),t("../math/Quaternion");var i=t("./Solver");function r(){i.call(this),this.iterations=10,this.tolerance=1e-7}r.prototype=new i;var E=[],T=[],A=[];r.prototype.solve=function(t,e){var n=0,i=this.iterations,r=this.tolerance*this.tolerance,s=this.equations,o=s.length,a=e.bodies,l=a.length,h=t;if(0!==o)for(var c=0;c!==l;c++)a[c].updateSolveMassProperties();var u=T,d=A,p=E;u.length=o,d.length=o,p.length=o;for(c=0;c!==o;c++){var m=s[c];p[c]=0,d[c]=m.computeB(h),u[c]=1/m.computeC()}if(0!==o){for(c=0;c!==l;c++){var f=(w=a[c]).vlambda,v=w.wlambda;f.set(0,0,0),v&&v.set(0,0,0)}for(n=0;n!==i;n++){for(var g=0,y=0;y!==o;y++){var x,m=s[y],_=d[y],b=u[y];(x=p[y])+(_=b*(_-m.computeGWlambda()-m.eps*x))<m.minForce?_=m.minForce-x:x+_>m.maxForce&&(_=m.maxForce-x),p[y]+=_,g+=0<_?_:-_,m.addToWlambda(_)}if(g*g<r)break}for(c=0;c!==l;c++){var w,M=(w=a[c]).velocity,S=w.angularVelocity;M.vadd(w.vlambda,M),S&&S.vadd(w.wlambda,S)}}return n}},{"../math/Quaternion":28,"../math/Vec3":30,"./Solver":47}],47:[function(t,e,n){function i(){this.equations=[]}(e.exports=i).prototype.solve=function(t,e){return 0},i.prototype.addEquation=function(t){t.enabled&&this.equations.push(t)},i.prototype.removeEquation=function(t){var e=this.equations,t=e.indexOf(t);-1!==t&&e.splice(t,1)},i.prototype.removeAllEquations=function(){this.equations.length=0}},{}],48:[function(t,e,n){e.exports=r;t("../math/Vec3"),t("../math/Quaternion");var i=t("./Solver"),t=t("../objects/Body");function r(t){for(i.call(this),this.iterations=10,this.tolerance=1e-7,this.subsolver=t,this.nodes=[],this.nodePool=[];this.nodePool.length<128;)this.nodePool.push(this.createNode())}r.prototype=new i;var _=[],b=[],w={bodies:[]},s=t.STATIC;function M(t){for(var e=t.length,n=0;n!==e;n++){var i=t[n];if(!(i.visited||i.body.type&s))return i}return!1}var S=[];function E(t,e,n){e.push(t.body);for(var i=t.eqs.length,r=0;r!==i;r++){var s=t.eqs[r];-1===n.indexOf(s)&&n.push(s)}}function T(t,e){return e.id-t.id}r.prototype.createNode=function(){return{body:null,children:[],eqs:[],visited:!1}},r.prototype.solve=function(t,e){for(var n=_,i=this.nodePool,r=e.bodies,s=this.equations,o=s.length,a=r.length,l=this.subsolver;i.length<a;)i.push(this.createNode());n.length=a;for(var h=0;h<a;h++)n[h]=i[h];for(h=0;h!==a;h++){var c=n[h];c.body=r[h],c.children.length=0,c.eqs.length=0,c.visited=!1}for(var u=0;u!==o;u++){var d=s[u],h=r.indexOf(d.bi),p=r.indexOf(d.bj),m=n[h],p=n[p];m.children.push(p),m.eqs.push(d),p.children.push(m),p.eqs.push(d)}var f,v=0,g=b;l.tolerance=this.tolerance,l.iterations=this.iterations;for(var y=w;f=M(n);){g.length=0,y.bodies.length=0,function(t,e,n,i){for(S.push(t),t.visited=!0,e(t,n,i);S.length;)for(var r,s=S.pop();r=M(s.children);)r.visited=!0,e(r,n,i),S.push(r)}(f,E,y.bodies,g);for(var x=g.length,g=g.sort(T),h=0;h!==x;h++)l.addEquation(g[h]);l.solve(t,y);l.removeAllEquations(),v++}return v}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"./Solver":47}],49:[function(t,e,n){function i(){}(e.exports=i).prototype={constructor:i,addEventListener:function(t,e){void 0===this._listeners&&(this._listeners={});var n=this._listeners;return void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e),this},hasEventListener:function(t,e){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[t]&&-1!==n[t].indexOf(e)},removeEventListener:function(t,e){if(void 0===this._listeners)return this;var n=this._listeners;if(void 0===n[t])return this;e=n[t].indexOf(e);return-1!==e&&n[t].splice(e,1),this},dispatchEvent:function(t){if(void 0===this._listeners)return this;var e=this._listeners[t.type];if(void 0!==e){t.target=this;for(var n=0,i=e.length;n<i;n++)e[n].call(this,t)}return this}}},{}],50:[function(t,e,n){var a=t("../collision/AABB"),l=t("../math/Vec3");function h(t){this.root=(t=t||{}).root||null,this.aabb=t.aabb?t.aabb.clone():new a,this.data=[],this.children=[]}function i(t,e){(e=e||{}).root=null,e.aabb=t,h.call(this,e),this.maxDepth=void 0!==e.maxDepth?e.maxDepth:8}(e.exports=i).prototype=new h,h.prototype.reset=function(t,e){this.children.length=this.data.length=0},h.prototype.insert=function(t,e,n){var i=this.data;if(n=n||0,!this.aabb.contains(t))return!1;var r=this.children;if(n<(this.maxDepth||this.root.maxDepth)){var s=!1;r.length||(this.subdivide(),s=!0);for(var o=0;8!==o;o++)if(r[o].insert(t,e,n+1))return!0;s&&(r.length=0)}return i.push(e),!0};var c=new l;h.prototype.subdivide=function(){var t=this.aabb,e=t.lowerBound,t=t.upperBound,n=this.children;n.push(new h({aabb:new a({lowerBound:new l(0,0,0)})}),new h({aabb:new a({lowerBound:new l(1,0,0)})}),new h({aabb:new a({lowerBound:new l(1,1,0)})}),new h({aabb:new a({lowerBound:new l(1,1,1)})}),new h({aabb:new a({lowerBound:new l(0,1,1)})}),new h({aabb:new a({lowerBound:new l(0,0,1)})}),new h({aabb:new a({lowerBound:new l(1,0,1)})}),new h({aabb:new a({lowerBound:new l(0,1,0)})})),t.vsub(e,c),c.scale(.5,c);for(var i=this.root||this,r=0;8!==r;r++){var s=n[r];s.root=i;var o=s.aabb.lowerBound;o.x*=c.x,o.y*=c.y,o.z*=c.z,o.vadd(e,o),o.vadd(c,s.aabb.upperBound)}},h.prototype.aabbQuery=function(t,e){this.data,this.children;for(var n=[this];n.length;){var i=n.pop();i.aabb.overlaps(t)&&Array.prototype.push.apply(e,i.data),Array.prototype.push.apply(n,i.children)}return e};var r=new a;h.prototype.rayQuery=function(t,e,n){return t.getAABB(r),r.toLocalFrame(e,r),this.aabbQuery(r,n),n},h.prototype.removeEmptyNodes=function(){for(var t=[this];t.length;){for(var e=t.pop(),n=e.children.length-1;0<=n;n--)e.children[n].data.length||e.children.splice(n,1);Array.prototype.push.apply(t,e.children)}}},{"../collision/AABB":3,"../math/Vec3":30}],51:[function(t,e,n){function i(){this.objects=[],this.type=Object}(e.exports=i).prototype.release=function(){for(var t=arguments.length,e=0;e!==t;e++)this.objects.push(arguments[e])},i.prototype.get=function(){return 0===this.objects.length?this.constructObject():this.objects.pop()},i.prototype.constructObject=function(){throw new Error("constructObject() not implemented in this Pool subclass yet!")}},{}],52:[function(t,e,n){function i(){this.data={keys:[]}}(e.exports=i).prototype.get=function(t,e){var n;return e<t&&(n=e,e=t,t=n),this.data[t+"-"+e]},i.prototype.set=function(t,e,n){e<t&&(i=e,e=t,t=i);var i=t+"-"+e;this.get(t,e)||this.data.keys.push(i),this.data[i]=n},i.prototype.reset=function(){for(var t=this.data,e=t.keys;0<e.length;)delete t[e.pop()]}},{}],53:[function(t,e,n){function i(){}(e.exports=i).defaults=function(t,e){for(var n in t=t||{},e)n in t||(t[n]=e[n]);return t}},{}],54:[function(t,e,n){e.exports=s;var i=t("../math/Vec3"),r=t("./Pool");function s(){r.call(this),this.type=i}(s.prototype=new r).constructObject=function(){return new i}},{"../math/Vec3":30,"./Pool":51}],55:[function(t,e,n){e.exports=o;var i=t("../collision/AABB"),r=t("../shapes/Shape"),I=t("../collision/Ray"),m=t("../math/Vec3"),z=t("../math/Transform"),e=(t("../shapes/ConvexPolyhedron"),t("../math/Quaternion")),s=(t("../solver/Solver"),t("../utils/Vec3Pool")),l=t("../equations/ContactEquation"),c=t("../equations/FrictionEquation");function o(t){this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new s,this.world=t,this.currentContactMaterial=null,this.enableFrictionReduction=!1}o.prototype.createContactEquation=function(t,e,n,i,r,s){var o;this.contactPointPool.length?((o=this.contactPointPool.pop()).bi=t,o.bj=e):o=new l(t,e),o.enabled=t.collisionResponse&&e.collisionResponse&&n.collisionResponse&&i.collisionResponse;var a=this.currentContactMaterial;o.restitution=a.restitution,o.setSpookParams(a.contactEquationStiffness,a.contactEquationRelaxation,this.world.dt);t=n.material||t.material,e=i.material||e.material;return t&&e&&0<=t.restitution&&0<=e.restitution&&(o.restitution=t.restitution*e.restitution),o.si=r||n,o.sj=s||i,o},o.prototype.createFrictionEquationsFromContact=function(t,e){var n=t.bi,i=t.bj,r=t.si,s=t.sj,o=this.world,a=this.currentContactMaterial,l=a.friction,h=r.material||n.material,r=s.material||i.material;if(0<(l=h&&r&&0<=h.friction&&0<=r.friction?h.friction*r.friction:l)){s=l*o.gravity.length(),h=n.invMass+i.invMass;0<h&&(h=1/h);r=this.frictionEquationPool,l=r.length?r.pop():new c(n,i,s*h),r=r.length?r.pop():new c(n,i,s*h);return l.bi=r.bi=n,l.bj=r.bj=i,l.minForce=r.minForce=-s*h,l.maxForce=r.maxForce=s*h,l.ri.copy(t.ri),l.rj.copy(t.rj),r.ri.copy(t.ri),r.rj.copy(t.rj),t.ni.tangents(l.t,r.t),l.setSpookParams(a.frictionEquationStiffness,a.frictionEquationRelaxation,o.dt),r.setSpookParams(a.frictionEquationStiffness,a.frictionEquationRelaxation,o.dt),l.enabled=r.enabled=t.enabled,e.push(l,r),!0}return!1};var a=new m,h=new m,u=new m;o.prototype.createFrictionFromAverage=function(t){var e=this.result[this.result.length-1];if(this.createFrictionEquationsFromContact(e,this.frictionResult)&&1!==t){var n=this.frictionResult[this.frictionResult.length-2],i=this.frictionResult[this.frictionResult.length-1];a.setZero(),h.setZero(),u.setZero();for(var r=e.bi,s=(e.bj,0);s!==t;s++)(e=this.result[this.result.length-1-s]).bodyA!==r?(a.vadd(e.ni,a),h.vadd(e.ri,h),u.vadd(e.rj,u)):(a.vsub(e.ni,a),h.vadd(e.rj,h),u.vadd(e.ri,u));var o=1/t;h.scale(o,n.ri),u.scale(o,n.rj),i.ri.copy(n.ri),i.rj.copy(n.rj),a.normalize(),a.tangents(n.t,i.t)}};var b=new m,w=new m,M=new e,S=new e;o.prototype.getContacts=function(t,e,n,i,r,s,o){this.contactPointPool=r,this.frictionEquationPool=o,this.result=i,this.frictionResult=s;for(var a=M,l=S,h=b,c=w,u=0,d=t.length;u!==d;u++){var p=t[u],m=e[u],f=null;p.material&&m.material&&(f=n.getContactMaterial(p.material,m.material)||null);for(var v=0;v<p.shapes.length;v++){p.quaternion.mult(p.shapeOrientations[v],a),p.quaternion.vmult(p.shapeOffsets[v],h),h.vadd(p.position,h);for(var g=p.shapes[v],y=0;y<m.shapes.length;y++){m.quaternion.mult(m.shapeOrientations[y],l),m.quaternion.vmult(m.shapeOffsets[y],c),c.vadd(m.position,c);var x,_=m.shapes[y];h.distanceTo(c)>g.boundingSphereRadius+_.boundingSphereRadius||(x=null,g.material&&_.material&&(x=n.getContactMaterial(g.material,_.material)||null),this.currentContactMaterial=x||f||n.defaultContactMaterial,(x=this[g.type|_.type])&&(g.type<_.type?x.call(this,g,_,h,c,a,l,p,m,g,_):x.call(this,_,g,c,h,l,a,m,p,g,_)))}}}};o.prototype[r.types.BOX|r.types.BOX]=o.prototype.boxBox=function(t,e,n,i,r,s,o,a){t.convexPolyhedronRepresentation.material=t.material,e.convexPolyhedronRepresentation.material=e.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexConvex(t.convexPolyhedronRepresentation,e.convexPolyhedronRepresentation,n,i,r,s,o,a,t,e)},o.prototype[r.types.BOX|r.types.CONVEXPOLYHEDRON]=o.prototype.boxConvex=function(t,e,n,i,r,s,o,a){t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexConvex(t.convexPolyhedronRepresentation,e,n,i,r,s,o,a,t,e)},o.prototype[r.types.BOX|r.types.PARTICLE]=o.prototype.boxParticle=function(t,e,n,i,r,s,o,a){t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexParticle(t.convexPolyhedronRepresentation,e,n,i,r,s,o,a,t,e)},o.prototype[r.types.SPHERE]=o.prototype.sphereSphere=function(t,e,n,i,r,s,o,a){var l=this.createContactEquation(o,a,t,e);i.vsub(n,l.ni),l.ni.normalize(),l.ri.copy(l.ni),l.rj.copy(l.ni),l.ri.mult(t.radius,l.ri),l.rj.mult(-e.radius,l.rj),l.ri.vadd(n,l.ri),l.ri.vsub(o.position,l.ri),l.rj.vadd(i,l.rj),l.rj.vsub(a.position,l.rj),this.result.push(l),this.createFrictionEquationsFromContact(l,this.frictionResult)};var f=new m,v=new m,g=new m;o.prototype[r.types.PLANE|r.types.TRIMESH]=o.prototype.planeTrimesh=function(t,e,n,i,r,s,o,a){var l=new m,h=f;h.set(0,0,1),r.vmult(h,h);for(var c=0;c<e.vertices.length/3;c++){e.getVertex(c,l);var u=new m;u.copy(l),z.pointToWorldFrame(i,s,u,l);var d,p=v;l.vsub(n,p),h.dot(p)<=0&&((d=this.createContactEquation(o,a,t,e)).ni.copy(h),u=g,h.scale(p.dot(h),u),l.vsub(u,u),d.ri.copy(u),d.ri.vsub(o.position,d.ri),d.rj.copy(l),d.rj.vsub(a.position,d.rj),this.result.push(d),this.createFrictionEquationsFromContact(d,this.frictionResult))}};var N=new m,B=new m,D=(new m,new m),F=new m,k=new m,O=new m,V=new m,U=new m,H=new m,W=new m,G=new m,j=new m,q=new m,X=new i,Y=[];o.prototype[r.types.SPHERE|r.types.TRIMESH]=o.prototype.sphereTrimesh=function(t,e,n,i,r,s,o,a){var l=k,h=O,c=V,u=U,d=H,p=W,m=X,f=F,v=B,g=Y;z.pointToLocalFrame(i,s,n,d);var y=t.radius;m.lowerBound.set(d.x-y,d.y-y,d.z-y),m.upperBound.set(d.x+y,d.y+y,d.z+y),e.getTrianglesInAABB(m,g);for(var x=D,_=t.radius*t.radius,b=0;b<g.length;b++)for(var w=0;w<3;w++)e.getVertex(e.indices[3*g[b]+w],x),x.vsub(d,v),v.norm2()<=_&&(f.copy(x),z.pointToWorldFrame(i,s,f,x),x.vsub(n,v),(L=this.createContactEquation(o,a,t,e)).ni.copy(v),L.ni.normalize(),L.ri.copy(L.ni),L.ri.scale(t.radius,L.ri),L.ri.vadd(n,L.ri),L.ri.vsub(o.position,L.ri),L.rj.copy(x),L.rj.vsub(a.position,L.rj),this.result.push(L),this.createFrictionEquationsFromContact(L,this.frictionResult));for(b=0;b<g.length;b++)for(w=0;w<3;w++){e.getVertex(e.indices[3*g[b]+w],l),e.getVertex(e.indices[3*g[b]+(w+1)%3],h),h.vsub(l,c),d.vsub(h,p);var M,S=p.dot(c);d.vsub(l,p),0<(M=p.dot(c))&&S<0&&(d.vsub(l,p),u.copy(c),u.normalize(),M=p.dot(u),u.scale(M,p),p.vadd(l,p),(R=p.distanceTo(d))<t.radius&&(L=this.createContactEquation(o,a,t,e),p.vsub(d,L.ni),L.ni.normalize(),L.ni.scale(t.radius,L.ri),z.pointToWorldFrame(i,s,p,p),p.vsub(a.position,L.rj),z.vectorToWorldFrame(s,L.ni,L.ni),z.vectorToWorldFrame(s,L.ri,L.ri),this.result.push(L),this.createFrictionEquationsFromContact(L,this.frictionResult)))}for(var E=G,T=j,A=q,C=N,b=0,P=g.length;b!==P;b++){e.getTriangleVertices(g[b],E,T,A),e.getNormal(g[b],C),d.vsub(E,p);var L,R=p.dot(C);C.scale(R,p),d.vsub(p,p),R=p.distanceTo(d),I.pointInTriangle(p,E,T,A)&&R<t.radius&&(L=this.createContactEquation(o,a,t,e),p.vsub(d,L.ni),L.ni.normalize(),L.ni.scale(t.radius,L.ri),z.pointToWorldFrame(i,s,p,p),p.vsub(a.position,L.rj),z.vectorToWorldFrame(s,L.ni,L.ni),z.vectorToWorldFrame(s,L.ri,L.ri),this.result.push(L),this.createFrictionEquationsFromContact(L,this.frictionResult))}g.length=0};var d=new m,p=new m;o.prototype[r.types.SPHERE|r.types.PLANE]=o.prototype.spherePlane=function(t,e,n,i,r,s,o,a){e=this.createContactEquation(o,a,t,e);e.ni.set(0,0,1),s.vmult(e.ni,e.ni),e.ni.negate(e.ni),e.ni.normalize(),e.ni.mult(t.radius,e.ri),n.vsub(i,d),e.ni.mult(e.ni.dot(d),p),d.vsub(p,e.rj),-d.dot(e.ni)<=t.radius&&(s=e.ri,t=e.rj,s.vadd(n,s),s.vsub(o.position,s),t.vadd(i,t),t.vsub(a.position,t),this.result.push(e),this.createFrictionEquationsFromContact(e,this.frictionResult))};var Z=new m,K=new m,J=new m;var Q=new m,$=new m,tt=new m,et=new m,nt=[new m,new m,new m,new m,new m,new m],it=new m,rt=new m,st=new m,ot=new m;o.prototype[r.types.SPHERE|r.types.BOX]=o.prototype.sphereBox=function(t,e,n,i,r,s,o,a){var l=this.v3pool,h=nt;n.vsub(i,Q),e.getSideNormals(h,s);for(var c=t.radius,u=!1,d=rt,p=st,m=ot,f=null,v=0,g=0,y=0,x=null,_=0,b=h.length;_!==b&&!1===u;_++){var w=$;w.copy(h[_]);var M=w.norm();w.normalize();var S,E,T,A,C,P,L=Q.dot(w);L<M+c&&0<L&&(E=et,(S=tt).copy(h[(_+1)%3]),E.copy(h[(_+2)%3]),T=S.norm(),A=E.norm(),S.normalize(),E.normalize(),C=Q.dot(S),P=Q.dot(E),C<T&&-T<C&&P<A&&-A<P&&(V=Math.abs(L-M-c),(null===x||V<x)&&(x=V,g=C,y=P,f=M,d.copy(w),p.copy(S),m.copy(E),v++)))}v&&(u=!0,k=this.createContactEquation(o,a,t,e),d.mult(-c,k.ri),k.ni.copy(d),k.ni.negate(k.ni),d.mult(f,d),p.mult(g,p),d.vadd(p,d),m.mult(y,m),d.vadd(m,k.rj),k.ri.vadd(n,k.ri),k.ri.vsub(o.position,k.ri),k.rj.vadd(i,k.rj),k.rj.vsub(a.position,k.rj),this.result.push(k),this.createFrictionEquationsFromContact(k,this.frictionResult));for(var R=l.get(),I=it,z=0;2!==z&&!u;z++)for(var N=0;2!==N&&!u;N++)for(var B=0;2!==B&&!u;B++)R.set(0,0,0),z?R.vadd(h[0],R):R.vsub(h[0],R),N?R.vadd(h[1],R):R.vsub(h[1],R),B?R.vadd(h[2],R):R.vsub(h[2],R),i.vadd(R,I),I.vsub(n,I),I.norm2()<c*c&&(u=!0,(k=this.createContactEquation(o,a,t,e)).ri.copy(I),k.ri.normalize(),k.ni.copy(k.ri),k.ri.mult(c,k.ri),k.rj.copy(R),k.ri.vadd(n,k.ri),k.ri.vsub(o.position,k.ri),k.rj.vadd(i,k.rj),k.rj.vsub(a.position,k.rj),this.result.push(k),this.createFrictionEquationsFromContact(k,this.frictionResult));l.release(R);for(var R=null,D=l.get(),F=l.get(),k=l.get(),O=l.get(),V=l.get(),U=h.length,z=0;z!==U&&!u;z++)for(N=0;N!==U&&!u;N++)if(z%3!=N%3){h[N].cross(h[z],D),D.normalize(),h[z].vadd(h[N],F),k.copy(n),k.vsub(F,k),k.vsub(i,k);var H=k.dot(D);D.mult(H,O);for(B=0;B===z%3||B===N%3;)B++;V.copy(n),V.vsub(O,V),V.vsub(F,V),V.vsub(i,V);var W=Math.abs(H),H=V.norm();W<h[B].norm()&&H<c&&(u=!0,H=this.createContactEquation(o,a,t,e),F.vadd(O,H.rj),H.rj.copy(H.rj),V.negate(H.ni),H.ni.normalize(),H.ri.copy(H.rj),H.ri.vadd(i,H.ri),H.ri.vsub(n,H.ri),H.ri.normalize(),H.ri.mult(c,H.ri),H.ri.vadd(n,H.ri),H.ri.vsub(o.position,H.ri),H.rj.vadd(i,H.rj),H.rj.vsub(a.position,H.rj),this.result.push(H),this.createFrictionEquationsFromContact(H,this.frictionResult))}l.release(D,F,k,O,V)};var at=new m,lt=new m,ht=new m,ct=new m,ut=new m,dt=new m,pt=new m,mt=new m,ft=new m,vt=new m;o.prototype[r.types.SPHERE|r.types.CONVEXPOLYHEDRON]=o.prototype.sphereConvex=function(t,e,n,i,r,s,o,a){var l=this.v3pool;n.vsub(i,at);for(var h=e.faceNormals,c=e.faces,u=e.vertices,d=t.radius,p=0;p!==u.length;p++){var m=u[p],f=ut;s.vmult(m,f),i.vadd(f,f);m=ct;if(f.vsub(n,m),m.norm2()<d*d){v=!0;return(A=this.createContactEquation(o,a,t,e)).ri.copy(m),A.ri.normalize(),A.ni.copy(A.ri),A.ri.mult(d,A.ri),f.vsub(i,A.rj),A.ri.vadd(n,A.ri),A.ri.vsub(o.position,A.ri),A.rj.vadd(i,A.rj),A.rj.vsub(a.position,A.rj),this.result.push(A),void this.createFrictionEquationsFromContact(A,this.frictionResult)}}for(var v=!1,p=0,g=c.length;p!==g&&!1===v;p++){var y=h[p],x=c[p],_=dt;s.vmult(y,_);var b=pt;s.vmult(u[x[0]],b),b.vadd(i,b);var w=mt;_.mult(-d,w),n.vadd(w,w);y=ft;w.vsub(b,y);w=y.dot(_),y=vt;if(n.vsub(b,y),w<0&&0<y.dot(_)){for(var M=[],S=0,E=x.length;S!==E;S++){var T=l.get();s.vmult(u[x[S]],T),i.vadd(T,T),M.push(T)}if(function(t,e,n){for(var i=null,r=t.length,s=0;s!==r;s++){var o=t[s],a=Z;t[(s+1)%r].vsub(o,a);var l=K;a.cross(e,l);a=J;n.vsub(o,a);a=l.dot(a);if(!(null===i||0<a&&!0===i||a<=0&&!1===i))return;null===i&&(i=0<a)}return 1}(M,_,n)){v=!0;var A=this.createContactEquation(o,a,t,e);_.mult(-d,A.ri),_.negate(A.ni);y=l.get();_.mult(-w,y);w=l.get();_.mult(-d,w),n.vsub(i,A.rj),A.rj.vadd(w,A.rj),A.rj.vadd(y,A.rj),A.rj.vadd(i,A.rj),A.rj.vsub(a.position,A.rj),A.ri.vadd(n,A.ri),A.ri.vsub(o.position,A.ri),l.release(y),l.release(w),this.result.push(A),this.createFrictionEquationsFromContact(A,this.frictionResult);for(var S=0,C=M.length;S!==C;S++)l.release(M[S]);return}for(S=0;S!==x.length;S++){var P=l.get(),L=l.get();s.vmult(u[x[(S+1)%x.length]],P),s.vmult(u[x[(S+2)%x.length]],L),i.vadd(P,P),i.vadd(L,L);var R=lt;L.vsub(P,R);var I=ht;R.unit(I);var z=l.get(),N=l.get();n.vsub(P,N);var B=N.dot(I);I.mult(B,z),z.vadd(P,z);I=l.get();if(z.vsub(n,I),0<B&&B*B<R.norm2()&&I.norm2()<d*d){A=this.createContactEquation(o,a,t,e);z.vsub(i,A.rj),z.vsub(n,A.ni),A.ni.normalize(),A.ni.mult(d,A.ri),A.rj.vadd(i,A.rj),A.rj.vsub(a.position,A.rj),A.ri.vadd(n,A.ri),A.ri.vsub(o.position,A.ri),this.result.push(A),this.createFrictionEquationsFromContact(A,this.frictionResult);for(S=0,C=M.length;S!==C;S++)l.release(M[S]);return l.release(P),l.release(L),l.release(z),l.release(I),void l.release(N)}l.release(P),l.release(L),l.release(z),l.release(I),l.release(N)}for(S=0,C=M.length;S!==C;S++)l.release(M[S])}}};new m,new m;o.prototype[r.types.PLANE|r.types.BOX]=o.prototype.planeBox=function(t,e,n,i,r,s,o,a){e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.planeConvex(t,e.convexPolyhedronRepresentation,n,i,r,s,o,a)};var y=new m,x=new m,_=new m,E=new m;o.prototype[r.types.PLANE|r.types.CONVEXPOLYHEDRON]=o.prototype.planeConvex=function(t,e,n,i,r,s,o,a){var l=y,h=x;h.set(0,0,1),r.vmult(h,h);for(var c,u,d=0,p=_,m=0;m!==e.vertices.length;m++)l.copy(e.vertices[m]),s.vmult(l,l),i.vadd(l,l),l.vsub(n,p),h.dot(p)<=0&&(c=this.createContactEquation(o,a,t,e),u=E,h.mult(h.dot(p),u),l.vsub(u,u),u.vsub(n,c.ri),c.ni.copy(h),l.vsub(i,c.rj),c.ri.vadd(n,c.ri),c.ri.vsub(o.position,c.ri),c.rj.vadd(i,c.rj),c.rj.vsub(a.position,c.rj),this.result.push(c),d++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(c,this.frictionResult));this.enableFrictionReduction&&d&&this.createFrictionFromAverage(d)};var T=new m,A=new m;o.prototype[r.types.CONVEXPOLYHEDRON]=o.prototype.convexConvex=function(t,e,n,i,r,s,o,a,l,h,c,u){var d=T;if(!(n.distanceTo(i)>t.boundingSphereRadius+e.boundingSphereRadius)&&t.findSeparatingAxis(e,n,r,i,s,d,c,u)){var p=[],m=A;t.clipAgainstHull(n,r,e,i,s,d,-100,100,p);for(var f=0,v=0;v!==p.length;v++){var g=this.createContactEquation(o,a,t,e,l,h),y=g.ri,x=g.rj;d.negate(g.ni),p[v].normal.negate(m),m.mult(p[v].depth,m),p[v].point.vadd(m,y),x.copy(p[v].point),y.vsub(n,y),x.vsub(i,x),y.vadd(n,y),y.vsub(o.position,y),x.vadd(i,x),x.vsub(a.position,x),this.result.push(g),f++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(g,this.frictionResult)}this.enableFrictionReduction&&f&&this.createFrictionFromAverage(f)}};var C=new m,P=new m,L=new m;o.prototype[r.types.PLANE|r.types.PARTICLE]=o.prototype.planeParticle=function(t,e,n,i,r,s,o,a){var l=C;l.set(0,0,1),o.quaternion.vmult(l,l);var h=P;i.vsub(o.position,h),l.dot(h)<=0&&((e=this.createContactEquation(a,o,e,t)).ni.copy(l),e.ni.negate(e.ni),e.ri.set(0,0,0),t=L,l.mult(l.dot(i),t),i.vsub(t,t),e.rj.copy(t),this.result.push(e),this.createFrictionEquationsFromContact(e,this.frictionResult))};var R=new m;o.prototype[r.types.PARTICLE|r.types.SPHERE]=o.prototype.sphereParticle=function(t,e,n,i,r,s,o,a){var l=R;l.set(0,0,1),i.vsub(n,l),l.norm2()<=t.radius*t.radius&&(e=this.createContactEquation(a,o,e,t),l.normalize(),e.rj.copy(l),e.rj.mult(t.radius,e.rj),e.ni.copy(l),e.ni.negate(e.ni),e.ri.set(0,0,0),this.result.push(e),this.createFrictionEquationsFromContact(e,this.frictionResult))};var gt=new e,yt=new m,xt=(new m,new m),_t=new m,bt=new m;o.prototype[r.types.PARTICLE|r.types.CONVEXPOLYHEDRON]=o.prototype.convexParticle=function(t,e,n,i,r,s,o,a){var l=-1,h=xt,c=bt,u=null,d=yt;if(d.copy(i),d.vsub(n,d),r.conjugate(gt),gt.vmult(d,d),t.pointIsInside(d)){t.worldVerticesNeedsUpdate&&t.computeWorldVertices(n,r),t.worldFaceNormalsNeedsUpdate&&t.computeWorldFaceNormals(r);for(var p=0,m=t.faces.length;p!==m;p++){var f=[t.worldVertices[t.faces[p][0]]],v=t.worldFaceNormals[p];i.vsub(f[0],_t);f=-v.dot(_t);(null===u||Math.abs(f)<Math.abs(u))&&(u=f,l=p,h.copy(v),0)}-1!==l?(r=this.createContactEquation(a,o,e,t),h.mult(u,c),c.vadd(i,c),c.vsub(n,c),r.rj.copy(c),h.negate(r.ni),r.ri.set(0,0,0),e=r.ri,c=r.rj,e.vadd(i,e),e.vsub(a.position,e),c.vadd(n,c),c.vsub(o.position,c),this.result.push(r),this.createFrictionEquationsFromContact(r,this.frictionResult)):console.warn("Point found inside convex, but did not find penetrating face!")}},o.prototype[r.types.BOX|r.types.HEIGHTFIELD]=o.prototype.boxHeightfield=function(t,e,n,i,r,s,o,a){t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexHeightfield(t.convexPolyhedronRepresentation,e,n,i,r,s,o,a)};var wt=new m,Mt=new m,St=[0];o.prototype[r.types.CONVEXPOLYHEDRON|r.types.HEIGHTFIELD]=o.prototype.convexHeightfield=function(t,e,n,i,r,s,o,a){var l=e.data,h=e.elementSize,c=t.boundingSphereRadius,u=Mt,d=St,p=wt;z.pointToLocalFrame(i,s,n,p);var m=Math.floor((p.x-c)/h)-1,f=Math.ceil((p.x+c)/h)+1,v=Math.floor((p.y-c)/h)-1,g=Math.ceil((p.y+c)/h)+1;if(!(f<0||g<0||m>l.length||v>l[0].length)){(m=m<0?0:m)>=l.length&&(m=l.length-1),(f=f<0?0:f)>=l.length&&(f=l.length-1),(g=g<0?0:g)>=l[0].length&&(g=l[0].length-1),(v=v<0?0:v)>=l[0].length&&(v=l[0].length-1);l=[];if(e.getRectMinMax(m,v,f,g,l),!(p.z-c>l[1]||p.z+c<l[0]))for(var y=m;y<f;y++)for(var x=v;x<g;x++)e.getConvexTrianglePillar(y,x,!1),z.pointToWorldFrame(i,s,e.pillarOffset,u),n.distanceTo(u)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&this.convexConvex(t,e.pillarConvex,n,u,r,s,o,a,null,null,d,null),e.getConvexTrianglePillar(y,x,!0),z.pointToWorldFrame(i,s,e.pillarOffset,u),n.distanceTo(u)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&this.convexConvex(t,e.pillarConvex,n,u,r,s,o,a,null,null,d,null)}};var Et=new m,Tt=new m;o.prototype[r.types.SPHERE|r.types.HEIGHTFIELD]=o.prototype.sphereHeightfield=function(t,e,n,i,r,s,o,a){var l=e.data,h=t.radius,c=e.elementSize,u=Tt,d=Et;z.pointToLocalFrame(i,s,n,d);var p=Math.floor((d.x-h)/c)-1,m=Math.ceil((d.x+h)/c)+1,f=Math.floor((d.y-h)/c)-1,v=Math.ceil((d.y+h)/c)+1;if(!(m<0||v<0||p>l.length||v>l[0].length)){(p=p<0?0:p)>=l.length&&(p=l.length-1),(m=m<0?0:m)>=l.length&&(m=l.length-1),(v=v<0?0:v)>=l[0].length&&(v=l[0].length-1),(f=f<0?0:f)>=l[0].length&&(f=l[0].length-1);l=[];if(e.getRectMinMax(p,f,m,v,l),!(d.z-h>l[1]||d.z+h<l[0]))for(var g=this.result,y=p;y<m;y++)for(var x=f;x<v;x++){var _=g.length;if(e.getConvexTrianglePillar(y,x,!1),z.pointToWorldFrame(i,s,e.pillarOffset,u),n.distanceTo(u)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&this.sphereConvex(t,e.pillarConvex,n,u,r,s,o,a),e.getConvexTrianglePillar(y,x,!0),z.pointToWorldFrame(i,s,e.pillarOffset,u),n.distanceTo(u)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&this.sphereConvex(t,e.pillarConvex,n,u,r,s,o,a),2<g.length-_)return}}}},{"../collision/AABB":3,"../collision/Ray":9,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43,"../solver/Solver":47,"../utils/Vec3Pool":54}],56:[function(t,e,n){e.exports=f;var tt=t("../shapes/Shape"),i=t("../math/Vec3"),r=t("../math/Quaternion"),s=t("../solver/GSSolver"),o=(t("../utils/Vec3Pool"),t("../equations/ContactEquation"),t("../equations/FrictionEquation"),t("./Narrowphase")),a=t("../utils/EventTarget"),l=t("../collision/ArrayCollisionMatrix"),h=t("../material/Material"),c=t("../material/ContactMaterial"),et=t("../objects/Body"),u=t("../utils/TupleDictionary"),d=t("../collision/RaycastResult"),e=t("../collision/AABB"),p=t("../collision/Ray"),m=t("../collision/NaiveBroadphase");function f(){a.apply(this),this.dt=-1,this.allowSleep=!1,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=0,this.quatNormalizeFast=!1,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new i,this.broadphase=new m,this.bodies=[],this.solver=new s,this.constraints=[],this.narrowphase=new o(this),this.collisionMatrix=new l,this.collisionMatrixPrevious=new l,this.materials=[],this.contactmaterials=[],this.contactMaterialTable=new u,this.defaultMaterial=new h("default"),this.defaultContactMaterial=new c(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.subsystems=[],this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null}}f.prototype=new a;new e;var v,g=new p;f.prototype.getContactMaterial=function(t,e){return this.contactMaterialTable.get(t.id,e.id)},f.prototype.numObjects=function(){return this.bodies.length},f.prototype.collisionMatrixTick=function(){var t=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=t,this.collisionMatrix.reset()},f.prototype.add=f.prototype.addBody=function(t){-1===this.bodies.indexOf(t)&&(t.index=this.bodies.length,this.bodies.push(t),t.world=this,t.initPosition.copy(t.position),t.initVelocity.copy(t.velocity),t.timeLastSleepy=this.time,t instanceof et&&(t.initAngularVelocity.copy(t.angularVelocity),t.initQuaternion.copy(t.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=t,this.dispatchEvent(this.addBodyEvent))},f.prototype.addConstraint=function(t){this.constraints.push(t)},f.prototype.removeConstraint=function(t){t=this.constraints.indexOf(t);-1!==t&&this.constraints.splice(t,1)},f.prototype.rayTest=function(t,e,n){n instanceof d?this.raycastClosest(t,e,{skipBackfaces:!0},n):this.raycastAll(t,e,{skipBackfaces:!0},n)},f.prototype.raycastAll=function(t,e,n,i){return n.mode=p.ALL,n.from=t,n.to=e,n.callback=i,g.intersectWorld(this,n)},f.prototype.raycastAny=function(t,e,n,i){return n.mode=p.ANY,n.from=t,n.to=e,n.result=i,g.intersectWorld(this,n)},f.prototype.raycastClosest=function(t,e,n,i){return n.mode=p.CLOSEST,n.from=t,n.to=e,n.result=i,g.intersectWorld(this,n)},f.prototype.remove=function(t){t.world=null;var e=this.bodies.length-1,n=this.bodies,i=n.indexOf(t);if(-1!==i){n.splice(i,1);for(var r=0;r!==n.length;r++)n[r].index=r;this.collisionMatrix.setNumObjects(e),this.removeBodyEvent.body=t,this.dispatchEvent(this.removeBodyEvent)}},f.prototype.removeBody=f.prototype.remove,f.prototype.addMaterial=function(t){this.materials.push(t)},f.prototype.addContactMaterial=function(t){this.contactmaterials.push(t),this.contactMaterialTable.set(t.materials[0].id,t.materials[1].id,t)},"undefined"==typeof performance&&(performance={}),performance.now||(v=Date.now(),performance.timing&&performance.timing.navigationStart&&(v=performance.timing.navigationStart),performance.now=function(){return Date.now()-v});var y=new i;f.prototype.step=function(t,e,n){if(n=n||10,0===(e=e||0))this.internalStep(t),this.time+=t;else{for(var i=Math.floor((this.time+e)/t)-Math.floor(this.time/t),i=Math.min(i,n),r=performance.now(),s=0;s!==i&&(this.internalStep(t),!(performance.now()-r>1e3*t));s++);this.time+=e;for(var o=this.time%t/t,a=y,l=this.bodies,h=0;h!==l.length;h++){var c=l[h];c.type!==et.STATIC&&c.sleepState!==et.SLEEPING?(c.position.vsub(c.previousPosition,a),a.scale(o,a),c.position.vadd(a,c.interpolatedPosition)):(c.interpolatedPosition.copy(c.position),c.interpolatedQuaternion.copy(c.quaternion))}}};var nt={type:"postStep"},it={type:"preStep"},rt={type:"collide",body:null,contact:null},st=[],ot=[],at=[],lt=[],ht=(new i,new i,new i,new i,new i,new i,new i,new i,new i,new r,new r),ct=new r,ut=new i;f.prototype.internalStep=function(t){this.dt=t;var e,n,i,r=this.contacts,s=at,o=lt,a=this.numObjects(),l=this.bodies,h=this.solver,c=this.gravity,u=this.doProfiling,d=this.profile,p=et.DYNAMIC,m=this.constraints,f=ot,v=(c.norm(),c.x),g=c.y,y=c.z,x=0;for(u&&(e=performance.now()),x=0;x!==a;x++)(P=l[x]).type&p&&(n=P.force,i=P.mass,n.x+=i*v,n.y+=i*g,n.z+=i*y);for(var x=0,_=this.subsystems.length;x!==_;x++)this.subsystems[x].update();u&&(e=performance.now()),s.length=0,o.length=0,this.broadphase.collisionPairs(this,s,o),u&&(d.broadphase=performance.now()-e);var b=m.length;for(x=0;x!==b;x++)if(!(I=m[x]).collideConnected)for(var w=s.length-1;0<=w;--w)(I.bodyA===s[w]&&I.bodyB===o[w]||I.bodyB===s[w]&&I.bodyA===o[w])&&(s.splice(w,1),o.splice(w,1));this.collisionMatrixTick(),u&&(e=performance.now());var M=st,S=r.length;for(x=0;x!==S;x++)M.push(r[x]);r.length=0;var E=this.frictionEquations.length;for(x=0;x!==E;x++)f.push(this.frictionEquations[x]);this.frictionEquations.length=0,this.narrowphase.getContacts(s,o,this,r,M,this.frictionEquations,f),u&&(d.narrowphase=performance.now()-e),u&&(e=performance.now());for(x=0;x<this.frictionEquations.length;x++)h.addEquation(this.frictionEquations[x]);for(var T=r.length,A=0;A!==T;A++){var C,P=(I=r[A]).bi,L=I.bj,R=(I.si,I.sj,P.material&&L.material&&this.getContactMaterial(P.material,L.material)||this.defaultContactMaterial);R.friction;P.material&&L.material&&(0<=P.material.friction&&0<=L.material.friction&&(P.material.friction,L.material.friction),0<=P.material.restitution&&0<=L.material.restitution&&(I.restitution=P.material.restitution*L.material.restitution)),h.addEquation(I),P.allowSleep&&P.type===et.DYNAMIC&&P.sleepState===et.SLEEPING&&L.sleepState===et.AWAKE&&L.type!==et.STATIC&&(C=L.velocity.norm2()+L.angularVelocity.norm2(),2*Math.pow(L.sleepSpeedLimit,2)<=C&&(P._wakeUpAfterNarrowphase=!0)),L.allowSleep&&L.type===et.DYNAMIC&&L.sleepState===et.SLEEPING&&P.sleepState===et.AWAKE&&P.type!==et.STATIC&&(C=P.velocity.norm2()+P.angularVelocity.norm2(),2*Math.pow(P.sleepSpeedLimit,2)<=C&&(L._wakeUpAfterNarrowphase=!0)),this.collisionMatrix.set(P,L,!0),this.collisionMatrixPrevious.get(P,L)||(rt.body=L,rt.contact=I,P.dispatchEvent(rt),rt.body=P,L.dispatchEvent(rt))}for(u&&(d.makeContactConstraints=performance.now()-e,e=performance.now()),x=0;x!==a;x++)(P=l[x])._wakeUpAfterNarrowphase&&(P.wakeUp(),P._wakeUpAfterNarrowphase=!1);var I,b=m.length;for(x=0;x!==b;x++){(I=m[x]).update();for(var w=0,z=I.equations.length;w!==z;w++){var N=I.equations[w];h.addEquation(N)}}h.solve(t,this),u&&(d.solve=performance.now()-e),h.removeAllEquations();var B,D,F=Math.pow;for(x=0;x!==a;x++)(P=l[x]).type&p&&(B=F(1-P.linearDamping,t),(D=P.velocity).mult(B,D),(B=P.angularVelocity)&&(D=F(1-P.angularDamping,t),B.mult(D,B)));for(this.dispatchEvent(it),x=0;x!==a;x++)(P=l[x]).preStep&&P.preStep.call(P);u&&(e=performance.now());var k=ht,O=ct,c=this.stepnumber,V=et.DYNAMIC|et.KINEMATIC,U=c%(this.quatNormalizeSkip+1)==0,H=this.quatNormalizeFast,W=.5*t;tt.types.PLANE,tt.types.CONVEXPOLYHEDRON;for(x=0;x!==a;x++){var G,j,q,X,Y,Z,K=l[x],J=K.force,Q=K.torque;K.type&V&&K.sleepState!==et.SLEEPING&&(G=K.velocity,j=K.angularVelocity,q=K.position,X=K.quaternion,Y=K.invMass,Z=K.invInertiaWorld,G.x+=J.x*Y*t,G.y+=J.y*Y*t,G.z+=J.z*Y*t,K.angularVelocity&&(Z.vmult(Q,ut),ut.mult(t,ut),ut.vadd(j,j)),q.x+=G.x*t,q.y+=G.y*t,q.z+=G.z*t,K.angularVelocity&&(k.set(j.x,j.y,j.z,0),k.mult(X,O),X.x+=W*O.x,X.y+=W*O.y,X.z+=W*O.z,X.w+=W*O.w,U&&(H?X.normalizeFast():X.normalize())),K.aabb&&(K.aabbNeedsUpdate=!0),K.updateInertiaWorld&&K.updateInertiaWorld())}for(this.clearForces(),this.broadphase.dirty=!0,u&&(d.integrate=performance.now()-e),this.time+=t,this.stepnumber+=1,this.dispatchEvent(nt),x=0;x!==a;x++){var $=(P=l[x]).postStep;$&&$.call(P)}if(this.allowSleep)for(x=0;x!==a;x++)l[x].sleepTick(this.time)},f.prototype.clearForces=function(){for(var t=this.bodies,e=t.length,n=0;n!==e;n++){var i=t[n];i.force,i.torque;i.force.set(0,0,0),i.torque.set(0,0,0)}}},{"../collision/AABB":3,"../collision/ArrayCollisionMatrix":4,"../collision/NaiveBroadphase":7,"../collision/Ray":9,"../collision/RaycastResult":10,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,"../material/ContactMaterial":24,"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Shape":43,"../solver/GSSolver":46,"../utils/EventTarget":49,"../utils/TupleDictionary":52,"../utils/Vec3Pool":54,"./Narrowphase":55}]},{},[2])(2)},466:function(t){var c;t.exports=((c=function(){function t(t){return i.appendChild(t.dom),t}function e(t){for(var e=0;e<i.children.length;e++)i.children[e].style.display=e===t?"block":"none";n=t}var n=0,i=document.createElement("div");i.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",i.addEventListener("click",function(t){t.preventDefault(),e(++n%i.children.length)},!1);var r,s=(performance||Date).now(),o=s,a=0,l=t(new c.Panel("FPS","#0ff","#002")),h=t(new c.Panel("MS","#0f0","#020"));return self.performance&&self.performance.memory&&(r=t(new c.Panel("MB","#f08","#201"))),e(0),{REVISION:16,dom:i,addPanel:t,showPanel:e,begin:function(){s=(performance||Date).now()},end:function(){a++;var t,e=(performance||Date).now();return h.update(e-s,200),o+1e3<e&&(l.update(1e3*a/(e-o),100),o=e,a=0,r)&&(t=performance.memory,r.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)),e},update:function(){s=this.end()},domElement:i,setMode:e}}).Panel=function(n,i,r){var s=1/0,o=0,a=Math.round,l=a(window.devicePixelRatio||1),h=80*l,t=48*l,c=3*l,u=2*l,d=3*l,p=15*l,m=74*l,f=30*l,v=document.createElement("canvas");v.width=h,v.height=t,v.style.cssText="width:80px;height:48px";var g=v.getContext("2d");return g.font="bold "+9*l+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=r,g.fillRect(0,0,h,t),g.fillStyle=i,g.fillText(n,c,u),g.fillRect(d,p,m,f),g.fillStyle=r,g.globalAlpha=.9,g.fillRect(d,p,m,f),{dom:v,update:function(t,e){s=Math.min(s,t),o=Math.max(o,t),g.fillStyle=r,g.globalAlpha=1,g.fillRect(0,0,h,p),g.fillStyle=i,g.fillText(a(t)+" "+n+" ("+a(s)+"-"+a(o)+")",c,u),g.drawImage(v,d+l,p,m-l,f,d,p,m-l,f),g.fillRect(d+m-l,p,l,f),g.fillStyle=r,g.globalAlpha=.9,g.fillRect(d+m-l,p,l,a((1-t/e)*f))}}},c)},498:function(t,e){
/*! Tweakpane 3.0.5 (c) 2016 cocopon, licensed under the MIT license. */
!function(t){"use strict";class e{constructor(t){const[e,n]=t.split("-");const i=e.split(".");this.major=parseInt(i[0],10);this.minor=parseInt(i[1],10);this.patch=parseInt(i[2],10);this.prerelease=n!==null&&n!==void 0?n:null}toString(){const t=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[t,this.prerelease].join("-"):t}}class n{constructor(t){this.controller_=t}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(t){this.controller_.viewProps.set("disabled",t)}get hidden(){return this.controller_.viewProps.get("hidden")}set hidden(t){this.controller_.viewProps.set("hidden",t)}dispose(){this.controller_.viewProps.set("disposed",true)}}class r{constructor(t){this.target=t}}class s extends r{constructor(t,e,n,i){super(t);this.value=e;this.presetKey=n;this.last=i!==null&&i!==void 0?i:true}}class i extends r{constructor(t,e,n){super(t);this.value=e;this.presetKey=n}}class o extends r{constructor(t,e){super(t);this.expanded=e}}function a(t){return t}function v(t){return t===null||t===undefined}function l(e,n){if(e.length!==n.length)return false;for(let t=0;t<e.length;t++)if(e[t]!==n[t])return false;return true}const h={alreadydisposed:()=>"View has been already disposed",invalidparams:t=>`Invalid parameters for '${t.name}'`,nomatchingcontroller:t=>`No matching controller for '${t.key}'`,nomatchingview:t=>`No matching view for '${JSON.stringify(t.params)}'`,notbindable:()=>`Value is not bindable`,propertynotfound:t=>`Property '${t.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class c{constructor(t){var e;this.message=(e=h[t.type](a(t.context)))!==null&&e!==void 0?e:"Unexpected error";this.name=this.constructor.name;this.stack=new Error(this.message).stack;this.type=t.type}static alreadyDisposed(){return new c({type:"alreadydisposed"})}static notBindable(){return new c({type:"notbindable"})}static propertyNotFound(t){return new c({type:"propertynotfound",context:{name:t}})}static shouldNeverHappen(){return new c({type:"shouldneverhappen"})}}class u{constructor(t,e,n){this.obj_=t;this.key_=e;this.presetKey_=n!==null&&n!==void 0?n:e}static isBindable(t){if(t===null)return false;if(typeof t!=="object")return false;return true}get key(){return this.key_}get presetKey(){return this.presetKey_}read(){return this.obj_[this.key_]}write(t){this.obj_[this.key_]=t}writeProperty(t,e){const n=this.read();if(!u.isBindable(n))throw c.notBindable();if(!(t in n))throw c.propertyNotFound(t);n[t]=e}}class d extends n{get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}get title(){var t;return(t=this.controller_.valueController.props.get("title"))!==null&&t!==void 0?t:""}set title(t){this.controller_.valueController.props.set("title",t)}on(t,e){const n=e.bind(this);const i=this.controller_.valueController.emitter;i.on(t,()=>{n(new r(this))});return this}}class p{constructor(){this.observers_={}}on(t,e){let n=this.observers_[t];if(!n)n=this.observers_[t]=[];n.push({handler:e});return this}off(t,e){const n=this.observers_[t];if(n)this.observers_[t]=n.filter(t=>{return t.handler!==e});return this}emit(t,e){const n=this.observers_[t];if(!n)return;n.forEach(t=>{t.handler(e)})}}const m="tp";function f(n){const t=(t,e)=>{return[m,"-",n,"v",t?`_${t}`:"",e?`-${e}`:""].join("")};return t}function g(e,n){return t=>n(e(t))}function y(t){return t.rawValue}function x(t,e){t.emitter.on("change",g(y,e));e(t.rawValue)}function _(t,e,n){x(t.value(e),n)}function b(t,e,n){if(n)t.classList.add(e);else t.classList.remove(e)}function w(e,n){return t=>{b(e,n,t)}}function M(t,e){x(t,t=>{e.textContent=t!==null&&t!==void 0?t:""})}const S=f("btn");class E{constructor(t,e){this.element=t.createElement("div");this.element.classList.add(S());e.viewProps.bindClassModifiers(this.element);const n=t.createElement("button");n.classList.add(S("b"));e.viewProps.bindDisabled(n);this.element.appendChild(n);this.buttonElement=n;const i=t.createElement("div");i.classList.add(S("t"));M(e.props.value("title"),i);this.buttonElement.appendChild(i)}}class T{constructor(t,e){this.emitter=new p;this.onClick_=this.onClick_.bind(this);this.props=e.props;this.viewProps=e.viewProps;this.view=new E(t,{props:this.props,viewProps:this.viewProps});this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class A{constructor(t,e){var n;this.constraint_=e===null||e===void 0?void 0:e.constraint;this.equals_=(n=e===null||e===void 0?void 0:e.equals)!==null&&n!==void 0?n:(t,e)=>t===e;this.emitter=new p;this.rawValue_=t}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(t){this.setRawValue(t,{forceEmit:false,last:true})}setRawValue(t,e){const n=e!==null&&e!==void 0?e:{forceEmit:false,last:true};const i=this.constraint_?this.constraint_.constrain(t):t;const r=!this.equals_(this.rawValue_,i);if(!r&&!n.forceEmit)return;this.emitter.emit("beforechange",{sender:this});this.rawValue_=i;this.emitter.emit("change",{options:n,rawValue:i,sender:this})}}class C{constructor(t){this.emitter=new p;this.value_=t}get rawValue(){return this.value_}set rawValue(t){this.setRawValue(t,{forceEmit:false,last:true})}setRawValue(t,e){const n=e!==null&&e!==void 0?e:{forceEmit:false,last:true};if(this.value_===t&&!n.forceEmit)return;this.emitter.emit("beforechange",{sender:this});this.value_=t;this.emitter.emit("change",{options:n,rawValue:this.value_,sender:this})}}function P(t,e){const n=e===null||e===void 0?void 0:e.constraint;const i=e===null||e===void 0?void 0:e.equals;if(!n&&!i)return new C(t);return new A(t,e)}class L{constructor(t){this.emitter=new p;this.valMap_=t;for(const e in this.valMap_){const n=this.valMap_[e];n.emitter.on("change",()=>{this.emitter.emit("change",{key:e,sender:this})})}}static createCore(n){const t=Object.keys(n);return t.reduce((t,e)=>{return Object.assign(t,{[e]:P(n[e])})},{})}static fromObject(t){const e=this.createCore(t);return new L(e)}get(t){return this.valMap_[t].rawValue}set(t,e){this.valMap_[t].rawValue=e}value(t){return this.valMap_[t]}}function R(r,s){const t=Object.keys(s);const e=t.reduce((t,e)=>{if(t===undefined)return undefined;const n=s[e];const i=n(r[e]);return i.succeeded?Object.assign(Object.assign({},t),{[e]:i.value}):undefined},{});return a(e)}function I(t,i){return t.reduce((t,e)=>{if(t===undefined)return undefined;const n=i(e);if(!n.succeeded||n.value===undefined)return undefined;return[...t,n.value]},[])}function z(t){if(t===null)return false;return typeof t==="object"}function N(i){return n=>t=>{if(!n&&t===undefined)return{succeeded:false,value:undefined};if(n&&t===undefined)return{succeeded:true,value:undefined};const e=i(t);return e!==undefined?{succeeded:true,value:e}:{succeeded:false,value:undefined}}}function B(n){return{custom:t=>N(t)(n),boolean:N(t=>typeof t==="boolean"?t:undefined)(n),number:N(t=>typeof t==="number"?t:undefined)(n),string:N(t=>typeof t==="string"?t:undefined)(n),function:N(t=>typeof t==="function"?t:undefined)(n),constant:e=>N(t=>t===e?e:undefined)(n),raw:N(t=>t)(n),object:e=>N(t=>{if(!z(t))return undefined;return R(t,e)})(n),array:e=>N(t=>{if(!Array.isArray(t))return undefined;return I(t,e)})(n)}}const D={optional:B(true),required:B(false)};function F(t,e){const n=D.required.object(e)(t);return n.succeeded?n.value:undefined}function k(t){if(t&&t.parentElement)t.parentElement.removeChild(t);return null}function O(){return["veryfirst","first","last","verylast"]}const V=f(""),U={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class H{constructor(t){this.parent_=null;this.blade=t.blade;this.view=t.view;this.viewProps=t.viewProps;const e=this.view.element;this.blade.value("positions").emitter.on("change",()=>{O().forEach(t=>{e.classList.remove(V(undefined,U[t]))});this.blade.get("positions").forEach(t=>{e.classList.add(V(undefined,U[t]))})});this.viewProps.handleDispose(()=>{k(e)})}get parent(){return this.parent_}}const W="http://www.w3.org/2000/svg";function G(t){t.offsetHeight}function j(t,e){const n=t.style.transition;t.style.transition="none";e();t.style.transition=n}function q(t){return t.ontouchstart!==undefined}function X(){return new Function("return this")()}function Y(){const t=a(X());return t.document}function Z(){return"document"in X()}function K(t){return Z()?t.getContext("2d"):null}const J={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function Q(t,e){const n=t.createElementNS(W,"svg");n.innerHTML=J[e];return n}function $(t,e,n){t.insertBefore(e,t.children[n])}function tt(t){if(t.parentElement)t.parentElement.removeChild(t)}function et(t){while(t.children.length>0)t.removeChild(t.children[0])}function nt(t){while(t.childNodes.length>0)t.removeChild(t.childNodes[0])}function it(t){if(t.relatedTarget)return a(t.relatedTarget);if("explicitOriginalTarget"in t)return t.explicitOriginalTarget;return null}const rt=f("lbl");function st(n,t){const i=n.createDocumentFragment();const e=t.split("\n").map(t=>{return n.createTextNode(t)});e.forEach((t,e)=>{if(e>0)i.appendChild(n.createElement("br"));i.appendChild(t)});return i}class ot{constructor(e,t){this.element=e.createElement("div");this.element.classList.add(rt());t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(rt("l"));_(t.props,"label",t=>{if(v(t))this.element.classList.add(rt(undefined,"nol"));else{this.element.classList.remove(rt(undefined,"nol"));nt(n);n.appendChild(st(e,t))}});this.element.appendChild(n);this.labelElement=n;const i=e.createElement("div");i.classList.add(rt("v"));this.element.appendChild(i);this.valueElement=i}}class at extends H{constructor(t,e){const n=e.valueController.viewProps;super(Object.assign(Object.assign({},e),{view:new ot(t,{props:e.props,viewProps:n}),viewProps:n}));this.props=e.props;this.valueController=e.valueController;this.view.valueElement.appendChild(this.valueController.view.element)}}const lt={id:"button",type:"blade",accept(t){const e=D;const n=F(t,{title:e.required.string,view:e.required.constant("button"),label:e.optional.string});return n?{params:n}:null},controller(t){return new at(t.document,{blade:t.blade,props:L.fromObject({label:t.params.label}),valueController:new T(t.document,{props:L.fromObject({title:t.params.title}),viewProps:t.viewProps})})},api(t){if(!(t.controller instanceof at))return null;if(!(t.controller.valueController instanceof T))return null;return new d(t.controller)}};class ht extends H{constructor(t){super(t);this.value=t.value}}function ct(){return new L({positions:P([],{equals:l})})}class ut extends L{constructor(t){super(t)}static create(t){const e={completed:true,expanded:t,expandedHeight:null,shouldFixHeight:false,temporaryExpanded:null};const n=L.createCore(e);return new ut(n)}get styleExpanded(){var t;return(t=this.get("temporaryExpanded"))!==null&&t!==void 0?t:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const t=this.get("expandedHeight");if(this.get("shouldFixHeight")&&!v(t))return`${t}px`;return"auto"}bindExpandedClass(e,n){_(this,"expanded",()=>{const t=this.styleExpanded;if(t)e.classList.add(n);else e.classList.remove(n)})}}function dt(t,e){let n=0;j(e,()=>{t.set("expandedHeight",null);t.set("temporaryExpanded",true);G(e);n=e.clientHeight;t.set("temporaryExpanded",null);G(e)});return n}function pt(t,e){e.style.height=t.styleHeight}function mt(e,t){e.value("expanded").emitter.on("beforechange",()=>{e.set("completed",false);if(v(e.get("expandedHeight")))e.set("expandedHeight",dt(e,t));e.set("shouldFixHeight",true);G(t)});e.emitter.on("change",()=>{pt(e,t)});pt(e,t);t.addEventListener("transitionend",t=>{if(t.propertyName!=="height")return;e.set("shouldFixHeight",false);e.set("expandedHeight",null);e.set("completed",true)})}class ft extends n{constructor(t,e){super(t);this.rackApi_=e}}function vt(t,e){return t.addBlade(Object.assign(Object.assign({},e),{view:"button"}))}function gt(t,e){return t.addBlade(Object.assign(Object.assign({},e),{view:"folder"}))}function yt(t,e){const n=e||{};return t.addBlade(Object.assign(Object.assign({},n),{view:"separator"}))}function xt(t,e){return t.addBlade(Object.assign(Object.assign({},e),{view:"tab"}))}class _t{constructor(t){this.emitter=new p;this.items_=[];this.cache_=new Set;this.onSubListAdd_=this.onSubListAdd_.bind(this);this.onSubListRemove_=this.onSubListRemove_.bind(this);this.extract_=t}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(t){for(const e of this.allItems())if(t(e))return e;return null}includes(t){return this.cache_.has(t)}add(t,e){if(this.includes(t))throw c.shouldNeverHappen();const n=e!==undefined?e:this.items_.length;this.items_.splice(n,0,t);this.cache_.add(t);const i=this.extract_(t);if(i){i.emitter.on("add",this.onSubListAdd_);i.emitter.on("remove",this.onSubListRemove_);i.allItems().forEach(t=>{this.cache_.add(t)})}this.emitter.emit("add",{index:n,item:t,root:this,target:this})}remove(t){const e=this.items_.indexOf(t);if(e<0)return;this.items_.splice(e,1);this.cache_.delete(t);const n=this.extract_(t);if(n){n.emitter.off("add",this.onSubListAdd_);n.emitter.off("remove",this.onSubListRemove_)}this.emitter.emit("remove",{index:e,item:t,root:this,target:this})}onSubListAdd_(t){this.cache_.add(t.item);this.emitter.emit("add",{index:t.index,item:t.item,root:this,target:t.target})}onSubListRemove_(t){this.cache_.delete(t.item);this.emitter.emit("remove",{index:t.index,item:t.item,root:this,target:t.target})}}class bt extends n{constructor(t){super(t);this.onBindingChange_=this.onBindingChange_.bind(this);this.emitter_=new p;this.controller_.binding.emitter.on("change",this.onBindingChange_)}get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}on(t,e){const n=e.bind(this);this.emitter_.on(t,t=>{n(t.event)});return this}refresh(){this.controller_.binding.read()}onBindingChange_(t){const e=t.sender.target.read();this.emitter_.emit("change",{event:new s(this,a(e),this.controller_.binding.target.presetKey,t.options.last)})}}class wt extends at{constructor(t,e){super(t,e);this.binding=e.binding}}class Mt extends n{constructor(t){super(t);this.onBindingUpdate_=this.onBindingUpdate_.bind(this);this.emitter_=new p;this.controller_.binding.emitter.on("update",this.onBindingUpdate_)}get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}on(t,e){const n=e.bind(this);this.emitter_.on(t,t=>{n(t.event)});return this}refresh(){this.controller_.binding.read()}onBindingUpdate_(t){const e=t.sender.target.read();this.emitter_.emit("update",{event:new i(this,a(e),this.controller_.binding.target.presetKey)})}}class St extends at{constructor(t,e){super(t,e);this.binding=e.binding;this.viewProps.bindDisabled(this.binding.ticker);this.viewProps.handleDispose(()=>{this.binding.dispose()})}}function Et(t){if(t instanceof Ct)return t["apiSet_"];if(t instanceof ft)return t["rackApi_"]["apiSet_"];return null}function Tt(t,e){const n=t.find(t=>t.controller_===e);if(!n)throw c.shouldNeverHappen();return n}function At(t,e,n){if(!u.isBindable(t))throw c.notBindable();return new u(t,e,n)}class Ct extends n{constructor(t,e){super(t);this.onRackAdd_=this.onRackAdd_.bind(this);this.onRackRemove_=this.onRackRemove_.bind(this);this.onRackInputChange_=this.onRackInputChange_.bind(this);this.onRackMonitorUpdate_=this.onRackMonitorUpdate_.bind(this);this.emitter_=new p;this.apiSet_=new _t(Et);this.pool_=e;const n=this.controller_.rack;n.emitter.on("add",this.onRackAdd_);n.emitter.on("remove",this.onRackRemove_);n.emitter.on("inputchange",this.onRackInputChange_);n.emitter.on("monitorupdate",this.onRackMonitorUpdate_);n.children.forEach(t=>{this.setUpApi_(t)})}get children(){return this.controller_.rack.children.map(t=>Tt(this.apiSet_,t))}addInput(t,e,n){const i=n||{};const r=this.controller_.view.element.ownerDocument;const s=this.pool_.createInput(r,At(t,e,i.presetKey),i);const o=new bt(s);return this.add(o,i.index)}addMonitor(t,e,n){const i=n||{};const r=this.controller_.view.element.ownerDocument;const s=this.pool_.createMonitor(r,At(t,e),i);const o=new Mt(s);return a(this.add(o,i.index))}addFolder(t){return gt(this,t)}addButton(t){return vt(this,t)}addSeparator(t){return yt(this,t)}addTab(t){return xt(this,t)}add(e,t){this.controller_.rack.add(e.controller_,t);const n=this.apiSet_.find(t=>t.controller_===e.controller_);if(n)this.apiSet_.remove(n);this.apiSet_.add(e);return e}remove(t){this.controller_.rack.remove(t.controller_)}addBlade(t){const e=this.controller_.view.element.ownerDocument;const n=this.pool_.createBlade(e,t);const i=this.pool_.createBladeApi(n);return this.add(i,t.index)}on(t,e){const n=e.bind(this);this.emitter_.on(t,t=>{n(t.event)});return this}setUpApi_(e){const t=this.apiSet_.find(t=>t.controller_===e);if(!t)this.apiSet_.add(this.pool_.createBladeApi(e))}onRackAdd_(t){this.setUpApi_(t.bladeController)}onRackRemove_(t){if(t.isRoot){const e=Tt(this.apiSet_,t.bladeController);this.apiSet_.remove(e)}}onRackInputChange_(t){const e=t.bladeController;if(e instanceof wt){const n=Tt(this.apiSet_,e);const i=e.binding;this.emitter_.emit("change",{event:new s(n,a(i.target.read()),i.target.presetKey,t.options.last)})}else if(e instanceof ht){const r=Tt(this.apiSet_,e);this.emitter_.emit("change",{event:new s(r,e.value.rawValue,undefined,t.options.last)})}}onRackMonitorUpdate_(t){if(!(t.bladeController instanceof St))throw c.shouldNeverHappen();const e=Tt(this.apiSet_,t.bladeController);const n=t.bladeController.binding;this.emitter_.emit("update",{event:new i(e,a(n.target.read()),n.target.presetKey)})}}class Pt extends ft{constructor(t,e){super(t,new Ct(t.rackController,e));this.emitter_=new p;this.controller_.foldable.value("expanded").emitter.on("change",t=>{this.emitter_.emit("fold",{event:new o(this,t.sender.rawValue)})});this.rackApi_.on("change",t=>{this.emitter_.emit("change",{event:t})});this.rackApi_.on("update",t=>{this.emitter_.emit("update",{event:t})})}get expanded(){return this.controller_.foldable.get("expanded")}set expanded(t){this.controller_.foldable.set("expanded",t)}get title(){return this.controller_.props.get("title")}set title(t){this.controller_.props.set("title",t)}get children(){return this.rackApi_.children}addInput(t,e,n){return this.rackApi_.addInput(t,e,n)}addMonitor(t,e,n){return this.rackApi_.addMonitor(t,e,n)}addFolder(t){return this.rackApi_.addFolder(t)}addButton(t){return this.rackApi_.addButton(t)}addSeparator(t){return this.rackApi_.addSeparator(t)}addTab(t){return this.rackApi_.addTab(t)}add(t,e){return this.rackApi_.add(t,e)}remove(t){this.rackApi_.remove(t)}addBlade(t){return this.rackApi_.addBlade(t)}on(t,e){const n=e.bind(this);this.emitter_.on(t,t=>{n(t.event)});return this}}class Lt extends H{constructor(t){super({blade:t.blade,view:t.view,viewProps:t.rackController.viewProps});this.rackController=t.rackController}}class Rt{constructor(t,e){const n=f(e.viewName);this.element=t.createElement("div");this.element.classList.add(n());e.viewProps.bindClassModifiers(this.element)}}function It(e,n){for(let t=0;t<e.length;t++){const i=e[t];if(i instanceof wt&&i.binding===n)return i}return null}function zt(e,n){for(let t=0;t<e.length;t++){const i=e[t];if(i instanceof St&&i.binding===n)return i}return null}function Nt(e,n){for(let t=0;t<e.length;t++){const i=e[t];if(i instanceof ht&&i.value===n)return i}return null}function Bt(t){if(t instanceof kt)return t.rack;if(t instanceof Lt)return t.rackController.rack;return null}function Dt(t){const e=Bt(t);return e?e["bcSet_"]:null}class Ft{constructor(t){var e;this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this);this.onSetAdd_=this.onSetAdd_.bind(this);this.onSetRemove_=this.onSetRemove_.bind(this);this.onChildDispose_=this.onChildDispose_.bind(this);this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this);this.onChildInputChange_=this.onChildInputChange_.bind(this);this.onChildMonitorUpdate_=this.onChildMonitorUpdate_.bind(this);this.onChildValueChange_=this.onChildValueChange_.bind(this);this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this);this.onDescendantLayout_=this.onDescendantLayout_.bind(this);this.onDescendantInputChange_=this.onDescendantInputChange_.bind(this);this.onDescendantMonitorUpdate_=this.onDescendantMonitorUpdate_.bind(this);this.emitter=new p;this.blade_=t!==null&&t!==void 0?t:null;(e=this.blade_)===null||e===void 0?void 0:e.value("positions").emitter.on("change",this.onBladePositionsChange_);this.bcSet_=new _t(Dt);this.bcSet_.emitter.on("add",this.onSetAdd_);this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(t,e){if(t.parent)t.parent.remove(t);t["parent_"]=this;this.bcSet_.add(t,e)}remove(t){t["parent_"]=null;this.bcSet_.remove(t)}find(e){return a(this.bcSet_.allItems().filter(t=>{return t instanceof e}))}onSetAdd_(t){this.updatePositions_();const e=t.target===t.root;this.emitter.emit("add",{bladeController:t.item,index:t.index,isRoot:e,sender:this});if(!e)return;const n=t.item;n.viewProps.emitter.on("change",this.onChildViewPropsChange_);n.blade.value("positions").emitter.on("change",this.onChildPositionsChange_);n.viewProps.handleDispose(this.onChildDispose_);if(n instanceof wt)n.binding.emitter.on("change",this.onChildInputChange_);else if(n instanceof St)n.binding.emitter.on("update",this.onChildMonitorUpdate_);else if(n instanceof ht)n.value.emitter.on("change",this.onChildValueChange_);else{const i=Bt(n);if(i){const r=i.emitter;r.on("layout",this.onDescendantLayout_);r.on("inputchange",this.onDescendantInputChange_);r.on("monitorupdate",this.onDescendantMonitorUpdate_)}}}onSetRemove_(t){this.updatePositions_();const e=t.target===t.root;this.emitter.emit("remove",{bladeController:t.item,isRoot:e,sender:this});if(!e)return;const n=t.item;if(n instanceof wt)n.binding.emitter.off("change",this.onChildInputChange_);else if(n instanceof St)n.binding.emitter.off("update",this.onChildMonitorUpdate_);else if(n instanceof ht)n.value.emitter.off("change",this.onChildValueChange_);else{const i=Bt(n);if(i){const r=i.emitter;r.off("layout",this.onDescendantLayout_);r.off("inputchange",this.onDescendantInputChange_);r.off("monitorupdate",this.onDescendantMonitorUpdate_)}}}updatePositions_(){const t=this.bcSet_.items.filter(t=>!t.viewProps.get("hidden"));const n=t[0];const i=t[t.length-1];this.bcSet_.items.forEach(t=>{const e=[];if(t===n){e.push("first");if(!this.blade_||this.blade_.get("positions").includes("veryfirst"))e.push("veryfirst")}if(t===i){e.push("last");if(!this.blade_||this.blade_.get("positions").includes("verylast"))e.push("verylast")}t.blade.set("positions",e)})}onChildPositionsChange_(){this.updatePositions_();this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(t){this.updatePositions_();this.emitter.emit("layout",{sender:this})}onChildDispose_(){const t=this.bcSet_.items.filter(t=>{return t.viewProps.get("disposed")});t.forEach(t=>{this.bcSet_.remove(t)})}onChildInputChange_(t){const e=It(this.find(wt),t.sender);if(!e)throw c.shouldNeverHappen();this.emitter.emit("inputchange",{bladeController:e,options:t.options,sender:this})}onChildMonitorUpdate_(t){const e=zt(this.find(St),t.sender);if(!e)throw c.shouldNeverHappen();this.emitter.emit("monitorupdate",{bladeController:e,sender:this})}onChildValueChange_(t){const e=Nt(this.find(ht),t.sender);if(!e)throw c.shouldNeverHappen();this.emitter.emit("inputchange",{bladeController:e,options:t.options,sender:this})}onDescendantLayout_(t){this.updatePositions_();this.emitter.emit("layout",{sender:this})}onDescendantInputChange_(t){this.emitter.emit("inputchange",{bladeController:t.bladeController,options:t.options,sender:this})}onDescendantMonitorUpdate_(t){this.emitter.emit("monitorupdate",{bladeController:t.bladeController,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class kt extends H{constructor(t,e){super(Object.assign(Object.assign({},e),{view:new Rt(t,{viewName:"brk",viewProps:e.viewProps})}));this.onRackAdd_=this.onRackAdd_.bind(this);this.onRackRemove_=this.onRackRemove_.bind(this);const n=new Ft(e.root?undefined:e.blade);n.emitter.on("add",this.onRackAdd_);n.emitter.on("remove",this.onRackRemove_);this.rack=n;this.viewProps.handleDispose(()=>{for(let t=this.rack.children.length-1;t>=0;t--){const e=this.rack.children[t];e.viewProps.set("disposed",true)}})}onRackAdd_(t){if(!t.isRoot)return;$(this.view.element,t.bladeController.view.element,t.index)}onRackRemove_(t){if(!t.isRoot)return;tt(t.bladeController.view.element)}}const Ot=f("cnt");class Vt{constructor(t,e){this.className_=f(e.viewName||"fld");this.element=t.createElement("div");this.element.classList.add(this.className_(),Ot());e.viewProps.bindClassModifiers(this.element);this.foldable_=e.foldable;this.foldable_.bindExpandedClass(this.element,this.className_(undefined,"expanded"));_(this.foldable_,"completed",w(this.element,this.className_(undefined,"cpl")));const n=t.createElement("button");n.classList.add(this.className_("b"));_(e.props,"title",t=>{if(v(t))this.element.classList.add(this.className_(undefined,"not"));else this.element.classList.remove(this.className_(undefined,"not"))});e.viewProps.bindDisabled(n);this.element.appendChild(n);this.buttonElement=n;const i=t.createElement("div");i.classList.add(this.className_("t"));M(e.props.value("title"),i);this.buttonElement.appendChild(i);this.titleElement=i;const r=t.createElement("div");r.classList.add(this.className_("m"));this.buttonElement.appendChild(r);const s=e.containerElement;s.classList.add(this.className_("c"));this.element.appendChild(s);this.containerElement=s}}class Ut extends Lt{constructor(t,e){var n;const i=ut.create((n=e.expanded)!==null&&n!==void 0?n:true);const r=new kt(t,{blade:e.blade,root:e.root,viewProps:e.viewProps});super(Object.assign(Object.assign({},e),{rackController:r,view:new Vt(t,{containerElement:r.view.element,foldable:i,props:e.props,viewName:e.root?"rot":undefined,viewProps:e.viewProps})}));this.onTitleClick_=this.onTitleClick_.bind(this);this.props=e.props;this.foldable=i;mt(this.foldable,this.view.containerElement);this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}const Ht={id:"folder",type:"blade",accept(t){const e=D;const n=F(t,{title:e.required.string,view:e.required.constant("folder"),expanded:e.optional.boolean});return n?{params:n}:null},controller(t){return new Ut(t.document,{blade:t.blade,expanded:t.params.expanded,props:L.fromObject({title:t.params.title}),viewProps:t.viewProps})},api(t){if(!(t.controller instanceof Ut))return null;return new Pt(t.controller,t.pool)}};class Wt extends ht{constructor(t,e){const n=e.valueController.viewProps;super(Object.assign(Object.assign({},e),{value:e.valueController.value,view:new ot(t,{props:e.props,viewProps:n}),viewProps:n}));this.props=e.props;this.valueController=e.valueController;this.view.valueElement.appendChild(this.valueController.view.element)}}class Gt extends n{}const jt=f("spr");class qt{constructor(t,e){this.element=t.createElement("div");this.element.classList.add(jt());e.viewProps.bindClassModifiers(this.element);const n=t.createElement("hr");n.classList.add(jt("r"));this.element.appendChild(n)}}class Xt extends H{constructor(t,e){super(Object.assign(Object.assign({},e),{view:new qt(t,{viewProps:e.viewProps})}))}}const Yt={id:"separator",type:"blade",accept(t){const e=D;const n=F(t,{view:e.required.constant("separator")});return n?{params:n}:null},controller(t){return new Xt(t.document,{blade:t.blade,viewProps:t.viewProps})},api(t){if(!(t.controller instanceof Xt))return null;return new Gt(t.controller)}},Zt=f("");function Kt(t,e){return w(t,Zt(undefined,e))}class Jt extends L{constructor(t){super(t)}static create(t){var e,n;const i=t!==null&&t!==void 0?t:{};const r={disabled:(e=i.disabled)!==null&&e!==void 0?e:false,disposed:false,hidden:(n=i.hidden)!==null&&n!==void 0?n:false};const s=L.createCore(r);return new Jt(s)}bindClassModifiers(t){_(this,"disabled",Kt(t,"disabled"));_(this,"hidden",Kt(t,"hidden"))}bindDisabled(e){_(this,"disabled",t=>{e.disabled=t})}bindTabIndex(e){_(this,"disabled",t=>{e.tabIndex=t?-1:0})}handleDispose(e){this.value("disposed").emitter.on("change",t=>{if(t)e()})}}const Qt=f("tbi");class $t{constructor(t,e){this.element=t.createElement("div");this.element.classList.add(Qt());e.viewProps.bindClassModifiers(this.element);_(e.props,"selected",t=>{if(t)this.element.classList.add(Qt(undefined,"sel"));else this.element.classList.remove(Qt(undefined,"sel"))});const n=t.createElement("button");n.classList.add(Qt("b"));e.viewProps.bindDisabled(n);this.element.appendChild(n);this.buttonElement=n;const i=t.createElement("div");i.classList.add(Qt("t"));M(e.props.value("title"),i);this.buttonElement.appendChild(i);this.titleElement=i}}class te{constructor(t,e){this.emitter=new p;this.onClick_=this.onClick_.bind(this);this.props=e.props;this.viewProps=e.viewProps;this.view=new $t(t,{props:e.props,viewProps:e.viewProps});this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class ee{constructor(t,e){this.onItemClick_=this.onItemClick_.bind(this);this.ic_=new te(t,{props:e.itemProps,viewProps:Jt.create()});this.ic_.emitter.on("click",this.onItemClick_);this.cc_=new kt(t,{blade:ct(),viewProps:Jt.create()});this.props=e.props;_(this.props,"selected",t=>{this.itemController.props.set("selected",t);this.contentController.viewProps.set("hidden",!t)})}get itemController(){return this.ic_}get contentController(){return this.cc_}onItemClick_(){this.props.set("selected",true)}}class ne{constructor(t,e){this.controller_=t;this.rackApi_=e}get title(){var t;return(t=this.controller_.itemController.props.get("title"))!==null&&t!==void 0?t:""}set title(t){this.controller_.itemController.props.set("title",t)}get selected(){return this.controller_.props.get("selected")}set selected(t){this.controller_.props.set("selected",t)}get children(){return this.rackApi_.children}addButton(t){return this.rackApi_.addButton(t)}addFolder(t){return this.rackApi_.addFolder(t)}addSeparator(t){return this.rackApi_.addSeparator(t)}addTab(t){return this.rackApi_.addTab(t)}add(t,e){this.rackApi_.add(t,e)}remove(t){this.rackApi_.remove(t)}addInput(t,e,n){return this.rackApi_.addInput(t,e,n)}addMonitor(t,e,n){return this.rackApi_.addMonitor(t,e,n)}addBlade(t){return this.rackApi_.addBlade(t)}}class ie extends ft{constructor(t,e){super(t,new Ct(t.rackController,e));this.onPageAdd_=this.onPageAdd_.bind(this);this.onPageRemove_=this.onPageRemove_.bind(this);this.emitter_=new p;this.pageApiMap_=new Map;this.rackApi_.on("change",t=>{this.emitter_.emit("change",{event:t})});this.rackApi_.on("update",t=>{this.emitter_.emit("update",{event:t})});this.controller_.pageSet.emitter.on("add",this.onPageAdd_);this.controller_.pageSet.emitter.on("remove",this.onPageRemove_);this.controller_.pageSet.items.forEach(t=>{this.setUpPageApi_(t)})}get pages(){return this.controller_.pageSet.items.map(t=>{const e=this.pageApiMap_.get(t);if(!e)throw c.shouldNeverHappen();return e})}addPage(t){const e=this.controller_.view.element.ownerDocument;const n=new ee(e,{itemProps:L.fromObject({selected:false,title:t.title}),props:L.fromObject({selected:false})});this.controller_.add(n,t.index);const i=this.pageApiMap_.get(n);if(!i)throw c.shouldNeverHappen();return i}removePage(t){this.controller_.remove(t)}on(t,e){const n=e.bind(this);this.emitter_.on(t,t=>{n(t.event)});return this}setUpPageApi_(e){const t=this.rackApi_["apiSet_"].find(t=>t.controller_===e.contentController);if(!t)throw c.shouldNeverHappen();const n=new ne(e,t);this.pageApiMap_.set(e,n)}onPageAdd_(t){this.setUpPageApi_(t.item)}onPageRemove_(t){const e=this.pageApiMap_.get(t.item);if(!e)throw c.shouldNeverHappen();this.pageApiMap_.delete(t.item)}}const re=f("tab");class se{constructor(t,e){this.element=t.createElement("div");this.element.classList.add(re(),Ot());e.viewProps.bindClassModifiers(this.element);x(e.empty,w(this.element,re(undefined,"nop")));const n=t.createElement("div");n.classList.add(re("i"));this.element.appendChild(n);this.itemsElement=n;const i=e.contentsElement;i.classList.add(re("c"));this.element.appendChild(i);this.contentsElement=i}}class oe extends Lt{constructor(t,e){const n=new kt(t,{blade:e.blade,viewProps:e.viewProps});const i=P(true);super({blade:e.blade,rackController:n,view:new se(t,{contentsElement:n.view.element,empty:i,viewProps:e.viewProps})});this.onPageAdd_=this.onPageAdd_.bind(this);this.onPageRemove_=this.onPageRemove_.bind(this);this.onPageSelectedChange_=this.onPageSelectedChange_.bind(this);this.pageSet_=new _t(()=>null);this.pageSet_.emitter.on("add",this.onPageAdd_);this.pageSet_.emitter.on("remove",this.onPageRemove_);this.empty_=i;this.applyPages_()}get pageSet(){return this.pageSet_}add(t,e){this.pageSet_.add(t,e!==null&&e!==void 0?e:this.pageSet_.items.length)}remove(t){this.pageSet_.remove(this.pageSet_.items[t])}applyPages_(){this.keepSelection_();this.empty_.rawValue=this.pageSet_.items.length===0}onPageAdd_(t){const e=t.item;$(this.view.itemsElement,e.itemController.view.element,t.index);this.rackController.rack.add(e.contentController,t.index);e.props.value("selected").emitter.on("change",this.onPageSelectedChange_);this.applyPages_()}onPageRemove_(t){const e=t.item;tt(e.itemController.view.element);this.rackController.rack.remove(e.contentController);e.props.value("selected").emitter.off("change",this.onPageSelectedChange_);this.applyPages_()}keepSelection_(){if(this.pageSet_.items.length===0)return;const n=this.pageSet_.items.findIndex(t=>t.props.get("selected"));if(n<0)this.pageSet_.items.forEach((t,e)=>{t.props.set("selected",e===0)});else this.pageSet_.items.forEach((t,e)=>{t.props.set("selected",e===n)})}onPageSelectedChange_(e){if(e.rawValue){const n=this.pageSet_.items.findIndex(t=>t.props.value("selected")===e.sender);this.pageSet_.items.forEach((t,e)=>{t.props.set("selected",e===n)})}else this.keepSelection_()}}const ae={id:"tab",type:"blade",accept(t){const e=D;const n=F(t,{pages:e.required.array(e.required.object({title:e.required.string})),view:e.required.constant("tab")});if(!n||n.pages.length===0)return null;return{params:n}},controller(n){const i=new oe(n.document,{blade:n.blade,viewProps:n.viewProps});n.params.pages.forEach(t=>{const e=new ee(n.document,{itemProps:L.fromObject({selected:false,title:t.title}),props:L.fromObject({selected:false})});i.add(e)});return i},api(t){if(!(t.controller instanceof oe))return null;return new ie(t.controller,t.pool)}};function le(t,e){const n=t.accept(e.params);if(!n)return null;const i=D.optional.boolean(e.params["disabled"]).value;const r=D.optional.boolean(e.params["hidden"]).value;return t.controller({blade:ct(),document:e.document,params:a(Object.assign(Object.assign({},n.params),{disabled:i,hidden:r})),viewProps:Jt.create({disabled:i,hidden:r})})}class he{constructor(){this.disabled=false;this.emitter=new p}dispose(){}tick(){if(this.disabled)return;this.emitter.emit("tick",{sender:this})}}class ce{constructor(t,e){this.disabled_=false;this.timerId_=null;this.onTick_=this.onTick_.bind(this);this.doc_=t;this.emitter=new p;this.interval_=e;this.setTimer_()}get disabled(){return this.disabled_}set disabled(t){this.disabled_=t;if(this.disabled_)this.clearTimer_();else this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;const t=this.doc_.defaultView;if(t)t.clearInterval(this.timerId_);this.timerId_=null}setTimer_(){this.clearTimer_();if(this.interval_<=0)return;const t=this.doc_.defaultView;if(t)this.timerId_=t.setInterval(this.onTick_,this.interval_)}onTick_(){if(this.disabled_)return;this.emitter.emit("tick",{sender:this})}}class ue{constructor(t){this.constraints=t}constrain(t){return this.constraints.reduce((t,e)=>{return e.constrain(t)},t)}}function de(t,n){if(t instanceof n)return t;if(t instanceof ue){const e=t.constraints.reduce((t,e)=>{if(t)return t;return e instanceof n?e:null},null);if(e)return e}return null}class pe{constructor(t){this.options=t}constrain(e){const t=this.options;if(t.length===0)return e;const n=t.filter(t=>{return t.value===e}).length>0;return n?e:t[0].value}}class me{constructor(t){this.maxValue=t.max;this.minValue=t.min}constrain(t){let e=t;if(!v(this.minValue))e=Math.max(e,this.minValue);if(!v(this.maxValue))e=Math.min(e,this.maxValue);return e}}class fe{constructor(t){this.step=t}constrain(t){const e=t<0?-Math.round(-t/this.step):Math.round(t/this.step);return e*this.step}}const ve=f("lst");class ge{constructor(i,t){this.onValueChange_=this.onValueChange_.bind(this);this.props_=t.props;this.element=i.createElement("div");this.element.classList.add(ve());t.viewProps.bindClassModifiers(this.element);const r=i.createElement("select");r.classList.add(ve("s"));_(this.props_,"options",t=>{et(r);t.forEach((t,e)=>{const n=i.createElement("option");n.dataset.index=String(e);n.textContent=t.text;n.value=String(t.value);r.appendChild(n)})});t.viewProps.bindDisabled(r);this.element.appendChild(r);this.selectElement=r;const e=i.createElement("div");e.classList.add(ve("m"));e.appendChild(Q(i,"dropdown"));this.element.appendChild(e);t.value.emitter.on("change",this.onValueChange_);this.value_=t.value;this.update_()}update_(){this.selectElement.value=String(this.value_.rawValue)}onValueChange_(){this.update_()}}class ye{constructor(t,e){this.onSelectChange_=this.onSelectChange_.bind(this);this.props=e.props;this.value=e.value;this.viewProps=e.viewProps;this.view=new ge(t,{props:this.props,value:this.value,viewProps:this.viewProps});this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(t){const e=a(t.currentTarget);const n=e.selectedOptions.item(0);if(!n)return;const i=Number(n.dataset.index);this.value.rawValue=this.props.get("options")[i].value}}const xe=f("pop");class _e{constructor(t,e){this.element=t.createElement("div");this.element.classList.add(xe());e.viewProps.bindClassModifiers(this.element);x(e.shows,w(this.element,xe(undefined,"v")))}}class be{constructor(t,e){this.shows=P(false);this.viewProps=e.viewProps;this.view=new _e(t,{shows:this.shows,viewProps:this.viewProps})}}const we=f("txt");class Me{constructor(t,e){this.onChange_=this.onChange_.bind(this);this.element=t.createElement("div");this.element.classList.add(we());e.viewProps.bindClassModifiers(this.element);this.props_=e.props;this.props_.emitter.on("change",this.onChange_);const n=t.createElement("input");n.classList.add(we("i"));n.type="text";e.viewProps.bindDisabled(n);this.element.appendChild(n);this.inputElement=n;e.value.emitter.on("change",this.onChange_);this.value_=e.value;this.refresh()}refresh(){const t=this.props_.get("formatter");this.inputElement.value=t(this.value_.rawValue)}onChange_(){this.refresh()}}class Se{constructor(t,e){this.onInputChange_=this.onInputChange_.bind(this);this.parser_=e.parser;this.props=e.props;this.value=e.value;this.viewProps=e.viewProps;this.view=new Me(t,{props:e.props,value:this.value,viewProps:this.viewProps});this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(t){const e=a(t.currentTarget);const n=e.value;const i=this.parser_(n);if(!v(i))this.value.rawValue=i;this.view.refresh()}}function Ee(t){return String(t)}function Te(t){if(t==="false")return false;return!!t}function Ae(t){return Ee(t)}class Ce{constructor(t){this.text=t}evaluate(){return Number(this.text)}toString(){return this.text}}const Pe={"**":(t,e)=>Math.pow(t,e),"*":(t,e)=>t*e,"/":(t,e)=>t/e,"%":(t,e)=>t%e,"+":(t,e)=>t+e,"-":(t,e)=>t-e,"<<":(t,e)=>t<<e,">>":(t,e)=>t>>e,">>>":(t,e)=>t>>>e,"&":(t,e)=>t&e,"^":(t,e)=>t^e,"|":(t,e)=>t|e};class Le{constructor(t,e,n){this.left=e;this.operator=t;this.right=n}evaluate(){const t=Pe[this.operator];if(!t)throw new Error(`unexpected binary operator: '${this.operator}`);return t(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const Re={"+":t=>t,"-":t=>-t,"~":t=>~t};class Ie{constructor(t,e){this.operator=t;this.expression=e}evaluate(){const t=Re[this.operator];if(!t)throw new Error(`unexpected unary operator: '${this.operator}`);return t(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function ze(r){return(e,n)=>{for(let t=0;t<r.length;t++){const i=r[t](e,n);if(i!=="")return i}return""}}function Ne(t,e){var n;const i=t.substr(e).match(/^\s+/);return(n=i&&i[0])!==null&&n!==void 0?n:""}function Be(t,e){const n=t.substr(e,1);return n.match(/^[1-9]$/)?n:""}function De(t,e){var n;const i=t.substr(e).match(/^[0-9]+/);return(n=i&&i[0])!==null&&n!==void 0?n:""}function Fe(t,e){const n=De(t,e);if(n!=="")return n;const i=t.substr(e,1);e+=1;if(i!=="-"&&i!=="+")return"";const r=De(t,e);if(r==="")return"";return i+r}function ke(t,e){const n=t.substr(e,1);e+=1;if(n.toLowerCase()!=="e")return"";const i=Fe(t,e);if(i==="")return"";return n+i}function Oe(t,e){const n=t.substr(e,1);if(n==="0")return n;const i=Be(t,e);e+=i.length;if(i==="")return"";return i+De(t,e)}function Ve(t,e){const n=Oe(t,e);e+=n.length;if(n==="")return"";const i=t.substr(e,1);e+=i.length;if(i!==".")return"";const r=De(t,e);e+=r.length;return n+i+r+ke(t,e)}function Ue(t,e){const n=t.substr(e,1);e+=n.length;if(n!==".")return"";const i=De(t,e);e+=i.length;if(i==="")return"";return n+i+ke(t,e)}function He(t,e){const n=Oe(t,e);e+=n.length;if(n==="")return"";return n+ke(t,e)}const We=ze([Ve,Ue,He]);function Ge(t,e){var n;const i=t.substr(e).match(/^[01]+/);return(n=i&&i[0])!==null&&n!==void 0?n:""}function je(t,e){const n=t.substr(e,2);e+=n.length;if(n.toLowerCase()!=="0b")return"";const i=Ge(t,e);if(i==="")return"";return n+i}function qe(t,e){var n;const i=t.substr(e).match(/^[0-7]+/);return(n=i&&i[0])!==null&&n!==void 0?n:""}function Xe(t,e){const n=t.substr(e,2);e+=n.length;if(n.toLowerCase()!=="0o")return"";const i=qe(t,e);if(i==="")return"";return n+i}function Ye(t,e){var n;const i=t.substr(e).match(/^[0-9a-f]+/i);return(n=i&&i[0])!==null&&n!==void 0?n:""}function Ze(t,e){const n=t.substr(e,2);e+=n.length;if(n.toLowerCase()!=="0x")return"";const i=Ye(t,e);if(i==="")return"";return n+i}const Ke=ze([je,Xe,Ze]),Je=ze([Ke,We]);function Qe(t,e){const n=Je(t,e);e+=n.length;if(n==="")return null;return{evaluable:new Ce(n),cursor:e}}function $e(t,e){const n=t.substr(e,1);e+=n.length;if(n!=="(")return null;const i=on(t,e);if(!i)return null;e=i.cursor;e+=Ne(t,e).length;const r=t.substr(e,1);e+=r.length;if(r!==")")return null;return{evaluable:i.evaluable,cursor:e}}function tn(t,e){return Qe(t,e)||$e(t,e)}function en(t,e){const n=tn(t,e);if(n)return n;const i=t.substr(e,1);e+=i.length;if(i!=="+"&&i!=="-"&&i!=="~")return null;const r=en(t,e);if(!r)return null;e=r.cursor;return{cursor:e,evaluable:new Ie(i,r.evaluable)}}function nn(t,e,n){n+=Ne(e,n).length;const i=t.filter(t=>e.startsWith(t,n))[0];if(!i)return null;n+=i.length;n+=Ne(e,n).length;return{cursor:n,operator:i}}function rn(o,a){return(t,e)=>{const n=o(t,e);if(!n)return null;e=n.cursor;let i=n.evaluable;for(;;){const r=nn(a,t,e);if(!r)break;e=r.cursor;const s=o(t,e);if(!s)return null;e=s.cursor;i=new Le(r.operator,i,s.evaluable)}return i?{cursor:e,evaluable:i}:null}}const sn=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((t,e)=>{return rn(t,e)},en);function on(t,e){e+=Ne(t,e).length;return sn(t,e)}function an(t){const e=on(t,0);if(!e)return null;const n=e.cursor+Ne(t,e.cursor).length;if(n!==t.length)return null;return e.evaluable}function ln(t){var e;const n=an(t);return(e=n===null||n===void 0?void 0:n.evaluate())!==null&&e!==void 0?e:null}function hn(t){if(typeof t==="number")return t;if(typeof t==="string"){const e=ln(t);if(!v(e))return e}return 0}function cn(t){return String(t)}function un(e){return t=>{return t.toFixed(Math.max(Math.min(e,20),0))}}const dn=un(0);function pn(t){return dn(t)+"%"}function mn(t){return String(t)}function fn(t){return t}function vn(t,e){while(t.length<e)t.push(undefined)}function gn(t){const e=[];vn(e,t);return P(e)}function yn(t){const e=t.indexOf(undefined);return a(e<0?t:t.slice(0,e))}function xn(t,e){const n=[...yn(t),e];if(n.length>t.length)n.splice(0,n.length-t.length);else vn(n,t.length);return n}function _n({primary:e,secondary:n,forward:i,backward:r}){let s=false;function o(t){if(s)return;s=true;t();s=false}e.emitter.on("change",t=>{o(()=>{n.setRawValue(i(e,n),t.options)})});n.emitter.on("change",t=>{o(()=>{e.setRawValue(r(e,n),t.options)});o(()=>{n.setRawValue(i(e,n),t.options)})});o(()=>{n.setRawValue(i(e,n),{forceEmit:false,last:true})})}function bn(t,e){const n=t*(e.altKey?.1:1)*(e.shiftKey?10:1);if(e.upKey)return+n;else if(e.downKey)return-n;return 0}function wn(t){return{altKey:t.altKey,downKey:t.key==="ArrowDown",shiftKey:t.shiftKey,upKey:t.key==="ArrowUp"}}function Mn(t){return{altKey:t.altKey,downKey:t.key==="ArrowLeft",shiftKey:t.shiftKey,upKey:t.key==="ArrowRight"}}function Sn(t){return t==="ArrowUp"||t==="ArrowDown"}function En(t){return Sn(t)||t==="ArrowLeft"||t==="ArrowRight"}function Tn(t,e){const n=e.ownerDocument.defaultView;const i=e.getBoundingClientRect();return{x:t.pageX-((n&&n.scrollX||0)+i.left),y:t.pageY-((n&&n.scrollY||0)+i.top)}}class An{constructor(t){this.lastTouch_=null;this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this);this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this);this.onMouseDown_=this.onMouseDown_.bind(this);this.onTouchEnd_=this.onTouchEnd_.bind(this);this.onTouchMove_=this.onTouchMove_.bind(this);this.onTouchStart_=this.onTouchStart_.bind(this);this.elem_=t;this.emitter=new p;t.addEventListener("touchstart",this.onTouchStart_);t.addEventListener("touchmove",this.onTouchMove_);t.addEventListener("touchend",this.onTouchEnd_);t.addEventListener("mousedown",this.onMouseDown_)}computePosition_(t){const e=this.elem_.getBoundingClientRect();return{bounds:{width:e.width,height:e.height},point:t?{x:t.x,y:t.y}:null}}onMouseDown_(t){var e;t.preventDefault();(e=t.currentTarget)===null||e===void 0?void 0:e.focus();const n=this.elem_.ownerDocument;n.addEventListener("mousemove",this.onDocumentMouseMove_);n.addEventListener("mouseup",this.onDocumentMouseUp_);this.emitter.emit("down",{altKey:t.altKey,data:this.computePosition_(Tn(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onDocumentMouseMove_(t){this.emitter.emit("move",{altKey:t.altKey,data:this.computePosition_(Tn(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onDocumentMouseUp_(t){const e=this.elem_.ownerDocument;e.removeEventListener("mousemove",this.onDocumentMouseMove_);e.removeEventListener("mouseup",this.onDocumentMouseUp_);this.emitter.emit("up",{altKey:t.altKey,data:this.computePosition_(Tn(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onTouchStart_(t){t.preventDefault();const e=t.targetTouches.item(0);const n=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:t.altKey,data:this.computePosition_(e?{x:e.clientX-n.left,y:e.clientY-n.top}:undefined),sender:this,shiftKey:t.shiftKey});this.lastTouch_=e}onTouchMove_(t){const e=t.targetTouches.item(0);const n=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:t.altKey,data:this.computePosition_(e?{x:e.clientX-n.left,y:e.clientY-n.top}:undefined),sender:this,shiftKey:t.shiftKey});this.lastTouch_=e}onTouchEnd_(t){var e;const n=(e=t.targetTouches.item(0))!==null&&e!==void 0?e:this.lastTouch_;const i=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:t.altKey,data:this.computePosition_(n?{x:n.clientX-i.left,y:n.clientY-i.top}:undefined),sender:this,shiftKey:t.shiftKey})}}function Cn(t,e,n,i,r){const s=(t-e)/(n-e);return i+s*(r-i)}function Pn(t){const e=String(t.toFixed(10));const n=e.split(".")[1];return n.replace(/0+$/,"").length}function Ln(t,e,n){return Math.min(Math.max(t,e),n)}function Rn(t,e){return(t%e+e)%e}const In=f("txt");class zn{constructor(t,e){this.onChange_=this.onChange_.bind(this);this.props_=e.props;this.props_.emitter.on("change",this.onChange_);this.element=t.createElement("div");this.element.classList.add(In(),In(undefined,"num"));if(e.arrayPosition)this.element.classList.add(In(undefined,e.arrayPosition));e.viewProps.bindClassModifiers(this.element);const n=t.createElement("input");n.classList.add(In("i"));n.type="text";e.viewProps.bindDisabled(n);this.element.appendChild(n);this.inputElement=n;this.onDraggingChange_=this.onDraggingChange_.bind(this);this.dragging_=e.dragging;this.dragging_.emitter.on("change",this.onDraggingChange_);this.element.classList.add(In());this.inputElement.classList.add(In("i"));const i=t.createElement("div");i.classList.add(In("k"));this.element.appendChild(i);this.knobElement=i;const r=t.createElementNS(W,"svg");r.classList.add(In("g"));this.knobElement.appendChild(r);const s=t.createElementNS(W,"path");s.classList.add(In("gb"));r.appendChild(s);this.guideBodyElem_=s;const o=t.createElementNS(W,"path");o.classList.add(In("gh"));r.appendChild(o);this.guideHeadElem_=o;const a=t.createElement("div");a.classList.add(f("tt")());this.knobElement.appendChild(a);this.tooltipElem_=a;e.value.emitter.on("change",this.onChange_);this.value=e.value;this.refresh()}onDraggingChange_(t){if(t.rawValue===null){this.element.classList.remove(In(undefined,"drg"));return}this.element.classList.add(In(undefined,"drg"));const e=t.rawValue/this.props_.get("draggingScale");const n=e+(e>0?-1:e<0?+1:0);const i=Ln(-n,-4,+4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${n+i},0 L${n},4 L${n+i},8`,`M ${e},-1 L${e},9`].join(" "));this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${e},4`);const r=this.props_.get("formatter");this.tooltipElem_.textContent=r(this.value.rawValue);this.tooltipElem_.style.left=`${e}px`}refresh(){const t=this.props_.get("formatter");this.inputElement.value=t(this.value.rawValue)}onChange_(){this.refresh()}}class Nn{constructor(t,e){this.originRawValue_=0;this.onInputChange_=this.onInputChange_.bind(this);this.onInputKeyDown_=this.onInputKeyDown_.bind(this);this.onInputKeyUp_=this.onInputKeyUp_.bind(this);this.onPointerDown_=this.onPointerDown_.bind(this);this.onPointerMove_=this.onPointerMove_.bind(this);this.onPointerUp_=this.onPointerUp_.bind(this);this.baseStep_=e.baseStep;this.parser_=e.parser;this.props=e.props;this.value=e.value;this.viewProps=e.viewProps;this.dragging_=P(null);this.view=new zn(t,{arrayPosition:e.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps});this.view.inputElement.addEventListener("change",this.onInputChange_);this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_);this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const n=new An(this.view.knobElement);n.emitter.on("down",this.onPointerDown_);n.emitter.on("move",this.onPointerMove_);n.emitter.on("up",this.onPointerUp_)}onInputChange_(t){const e=a(t.currentTarget);const n=e.value;const i=this.parser_(n);if(!v(i))this.value.rawValue=i;this.view.refresh()}onInputKeyDown_(t){const e=bn(this.baseStep_,wn(t));if(e===0)return;this.value.setRawValue(this.value.rawValue+e,{forceEmit:false,last:false})}onInputKeyUp_(t){const e=bn(this.baseStep_,wn(t));if(e===0)return;this.value.setRawValue(this.value.rawValue,{forceEmit:true,last:true})}onPointerDown_(){this.originRawValue_=this.value.rawValue;this.dragging_.rawValue=0}computeDraggingValue_(t){if(!t.point)return null;const e=t.point.x-t.bounds.width/2;return this.originRawValue_+e*this.props.get("draggingScale")}onPointerMove_(t){const e=this.computeDraggingValue_(t.data);if(e===null)return;this.value.setRawValue(e,{forceEmit:false,last:false});this.dragging_.rawValue=this.value.rawValue-this.originRawValue_}onPointerUp_(t){const e=this.computeDraggingValue_(t.data);if(e===null)return;this.value.setRawValue(e,{forceEmit:true,last:true});this.dragging_.rawValue=null}}const Bn=f("sld");class Dn{constructor(t,e){this.onChange_=this.onChange_.bind(this);this.props_=e.props;this.props_.emitter.on("change",this.onChange_);this.element=t.createElement("div");this.element.classList.add(Bn());e.viewProps.bindClassModifiers(this.element);const n=t.createElement("div");n.classList.add(Bn("t"));e.viewProps.bindTabIndex(n);this.element.appendChild(n);this.trackElement=n;const i=t.createElement("div");i.classList.add(Bn("k"));this.trackElement.appendChild(i);this.knobElement=i;e.value.emitter.on("change",this.onChange_);this.value=e.value;this.update_()}update_(){const t=Ln(Cn(this.value.rawValue,this.props_.get("minValue"),this.props_.get("maxValue"),0,100),0,100);this.knobElement.style.width=`${t}%`}onChange_(){this.update_()}}class Fn{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this);this.onKeyUp_=this.onKeyUp_.bind(this);this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this);this.onPointerUp_=this.onPointerUp_.bind(this);this.baseStep_=e.baseStep;this.value=e.value;this.viewProps=e.viewProps;this.props=e.props;this.view=new Dn(t,{props:this.props,value:this.value,viewProps:this.viewProps});this.ptHandler_=new An(this.view.trackElement);this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_);this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_);this.ptHandler_.emitter.on("up",this.onPointerUp_);this.view.trackElement.addEventListener("keydown",this.onKeyDown_);this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;this.value.setRawValue(Cn(Ln(t.point.x,0,t.bounds.width),0,t.bounds.width,this.props.get("minValue"),this.props.get("maxValue")),e)}onPointerDownOrMove_(t){this.handlePointerEvent_(t.data,{forceEmit:false,last:false})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:true,last:true})}onKeyDown_(t){const e=bn(this.baseStep_,Mn(t));if(e===0)return;this.value.setRawValue(this.value.rawValue+e,{forceEmit:false,last:false})}onKeyUp_(t){const e=bn(this.baseStep_,Mn(t));if(e===0)return;this.value.setRawValue(this.value.rawValue,{forceEmit:true,last:true})}}const kn=f("sldtxt");class On{constructor(t,e){this.element=t.createElement("div");this.element.classList.add(kn());const n=t.createElement("div");n.classList.add(kn("s"));this.sliderView_=e.sliderView;n.appendChild(this.sliderView_.element);this.element.appendChild(n);const i=t.createElement("div");i.classList.add(kn("t"));this.textView_=e.textView;i.appendChild(this.textView_.element);this.element.appendChild(i)}}class Vn{constructor(t,e){this.value=e.value;this.viewProps=e.viewProps;this.sliderC_=new Fn(t,{baseStep:e.baseStep,props:e.sliderProps,value:e.value,viewProps:this.viewProps});this.textC_=new Nn(t,{baseStep:e.baseStep,parser:e.parser,props:e.textProps,value:e.value,viewProps:e.viewProps});this.view=new On(t,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}}function Un(t,e){t.write(e)}function Hn(t){const e=D;if(Array.isArray(t))return e.required.array(e.required.object({text:e.required.string,value:e.required.raw}))(t).value;if(typeof t==="object")return e.required.raw(t).value;return undefined}function Wn(t){if(t==="inline"||t==="popup")return t;return undefined}function Gn(t){const e=D;return e.required.object({max:e.optional.number,min:e.optional.number,step:e.optional.number})(t).value}function jn(e){if(Array.isArray(e))return e;const n=[];Object.keys(e).forEach(t=>{n.push({text:t,value:e[t]})});return n}function qn(t){return!v(t)?new pe(jn(a(t))):null}function Xn(t){const e=t?de(t,pe):null;if(!e)return null;return e.options}function Yn(t){const e=t?de(t,fe):null;if(!e)return null;return e.step}function Zn(t,e){const n=t&&de(t,fe);if(n)return Pn(n.step);return Math.max(Pn(e),2)}function Kn(t){const e=Yn(t);return e!==null&&e!==void 0?e:1}function Jn(t,e){var n;const i=t&&de(t,fe);const r=Math.abs((n=i===null||i===void 0?void 0:i.step)!==null&&n!==void 0?n:e);return r===0?.1:Math.pow(10,Math.floor(Math.log10(r))-1)}const Qn=f("ckb");class $n{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this);this.element=t.createElement("div");this.element.classList.add(Qn());e.viewProps.bindClassModifiers(this.element);const n=t.createElement("label");n.classList.add(Qn("l"));this.element.appendChild(n);const i=t.createElement("input");i.classList.add(Qn("i"));i.type="checkbox";n.appendChild(i);this.inputElement=i;e.viewProps.bindDisabled(this.inputElement);const r=t.createElement("div");r.classList.add(Qn("w"));n.appendChild(r);const s=Q(t,"check");r.appendChild(s);e.value.emitter.on("change",this.onValueChange_);this.value=e.value;this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class ti{constructor(t,e){this.onInputChange_=this.onInputChange_.bind(this);this.value=e.value;this.viewProps=e.viewProps;this.view=new $n(t,{value:this.value,viewProps:this.viewProps});this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(t){const e=a(t.currentTarget);this.value.rawValue=e.checked}}function ei(t){const e=[];const n=qn(t.options);if(n)e.push(n);return new ue(e)}const ni={id:"input-bool",type:"input",accept:(t,e)=>{if(typeof t!=="boolean")return null;const n=D;const i=F(e,{options:n.optional.custom(Hn)});return i?{initialValue:t,params:i}:null},binding:{reader:t=>Te,constraint:t=>ei(t.params),writer:t=>Un},controller:t=>{var e;const n=t.document;const i=t.value;const r=t.constraint;if(r&&de(r,pe))return new ye(n,{props:L.fromObject({options:(e=Xn(r))!==null&&e!==void 0?e:[]}),value:i,viewProps:t.viewProps});return new ti(n,{value:i,viewProps:t.viewProps})}},ii=f("col");class ri{constructor(t,e){this.element=t.createElement("div");this.element.classList.add(ii());e.foldable.bindExpandedClass(this.element,ii(undefined,"expanded"));_(e.foldable,"completed",w(this.element,ii(undefined,"cpl")));const n=t.createElement("div");n.classList.add(ii("h"));this.element.appendChild(n);const i=t.createElement("div");i.classList.add(ii("s"));n.appendChild(i);this.swatchElement=i;const r=t.createElement("div");r.classList.add(ii("t"));n.appendChild(r);this.textElement=r;if(e.pickerLayout==="inline"){const s=t.createElement("div");s.classList.add(ii("p"));this.element.appendChild(s);this.pickerElement=s}else this.pickerElement=null}}function si(t,e,n){const i=Ln(t/255,0,1);const r=Ln(e/255,0,1);const s=Ln(n/255,0,1);const o=Math.max(i,r,s);const a=Math.min(i,r,s);const l=o-a;let h=0;let c=0;const u=(a+o)/2;if(l!==0){c=l/(1-Math.abs(o+a-1));if(i===o)h=(r-s)/l;else if(r===o)h=2+(s-i)/l;else h=4+(i-r)/l;h=h/6+(h<0?1:0)}return[h*360,c*100,u*100]}function oi(t,e,n){const i=(t%360+360)%360;const r=Ln(e/100,0,1);const s=Ln(n/100,0,1);const o=(1-Math.abs(2*s-1))*r;const a=o*(1-Math.abs(i/60%2-1));const l=s-o/2;let h,c,u;if(i>=0&&i<60)[h,c,u]=[o,a,0];else if(i>=60&&i<120)[h,c,u]=[a,o,0];else if(i>=120&&i<180)[h,c,u]=[0,o,a];else if(i>=180&&i<240)[h,c,u]=[0,a,o];else if(i>=240&&i<300)[h,c,u]=[a,0,o];else[h,c,u]=[o,0,a];return[(h+l)*255,(c+l)*255,(u+l)*255]}function ai(t,e,n){const i=Ln(t/255,0,1);const r=Ln(e/255,0,1);const s=Ln(n/255,0,1);const o=Math.max(i,r,s);const a=Math.min(i,r,s);const l=o-a;let h;if(l===0)h=0;else if(o===i)h=60*(((r-s)/l%6+6)%6);else if(o===r)h=60*((s-i)/l+2);else h=60*((i-r)/l+4);const c=o===0?0:l/o;const u=o;return[h,c*100,u*100]}function li(t,e,n){const i=Rn(t,360);const r=Ln(e/100,0,1);const s=Ln(n/100,0,1);const o=s*r;const a=o*(1-Math.abs(i/60%2-1));const l=s-o;let h,c,u;if(i>=0&&i<60)[h,c,u]=[o,a,0];else if(i>=60&&i<120)[h,c,u]=[a,o,0];else if(i>=120&&i<180)[h,c,u]=[0,o,a];else if(i>=180&&i<240)[h,c,u]=[0,a,o];else if(i>=240&&i<300)[h,c,u]=[a,0,o];else[h,c,u]=[o,0,a];return[(h+l)*255,(c+l)*255,(u+l)*255]}function hi(t,e,n){const i=n+e*(100-Math.abs(2*n-100))/(2*100);return[t,i!==0?e*(100-Math.abs(2*n-100))/i:0,n+e*(100-Math.abs(2*n-100))/(2*100)]}function ci(t,e,n){const i=100-Math.abs(n*(200-e)/100-100);return[t,i!==0?e*n/i:0,n*(200-e)/(2*100)]}function ui(t){return[t[0],t[1],t[2]]}function di(t,e){return[t[0],t[1],t[2],e]}const pi={hsl:{hsl:(t,e,n)=>[t,e,n],hsv:hi,rgb:oi},hsv:{hsl:ci,hsv:(t,e,n)=>[t,e,n],rgb:li},rgb:{hsl:si,hsv:ai,rgb:(t,e,n)=>[t,e,n]}};function mi(t,e,n){return pi[e][n](...t)}const fi={hsl:t=>{var e;return[Rn(t[0],360),Ln(t[1],0,100),Ln(t[2],0,100),Ln((e=t[3])!==null&&e!==void 0?e:1,0,1)]},hsv:t=>{var e;return[Rn(t[0],360),Ln(t[1],0,100),Ln(t[2],0,100),Ln((e=t[3])!==null&&e!==void 0?e:1,0,1)]},rgb:t=>{var e;return[Ln(t[0],0,255),Ln(t[1],0,255),Ln(t[2],0,255),Ln((e=t[3])!==null&&e!==void 0?e:1,0,1)]}};function vi(t,e){if(typeof t!=="object"||v(t))return false;return e in t&&typeof t[e]==="number"}class gi{constructor(t,e){this.mode_=e;this.comps_=fi[e](t)}static black(){return new gi([0,0,0],"rgb")}static fromObject(t){const e="a"in t?[t.r,t.g,t.b,t.a]:[t.r,t.g,t.b];return new gi(e,"rgb")}static toRgbaObject(t){return t.toRgbaObject()}static isRgbColorObject(t){return vi(t,"r")&&vi(t,"g")&&vi(t,"b")}static isRgbaColorObject(t){return this.isRgbColorObject(t)&&vi(t,"a")}static isColorObject(t){return this.isRgbColorObject(t)}static equals(t,e){if(t.mode_!==e.mode_)return false;const n=t.comps_;const i=e.comps_;for(let t=0;t<n.length;t++)if(n[t]!==i[t])return false;return true}get mode(){return this.mode_}getComponents(t){return di(mi(ui(this.comps_),this.mode_,t||this.mode_),this.comps_[3])}toRgbaObject(){const t=this.getComponents("rgb");return{r:t[0],g:t[1],b:t[2],a:t[3]}}}const yi=f("colp");class xi{constructor(t,e){this.alphaViews_=null;this.element=t.createElement("div");this.element.classList.add(yi());const n=t.createElement("div");n.classList.add(yi("hsv"));const i=t.createElement("div");i.classList.add(yi("sv"));this.svPaletteView_=e.svPaletteView;i.appendChild(this.svPaletteView_.element);n.appendChild(i);const r=t.createElement("div");r.classList.add(yi("h"));this.hPaletteView_=e.hPaletteView;r.appendChild(this.hPaletteView_.element);n.appendChild(r);this.element.appendChild(n);const s=t.createElement("div");s.classList.add(yi("rgb"));this.textView_=e.textView;s.appendChild(this.textView_.element);this.element.appendChild(s);if(e.alphaViews){this.alphaViews_={palette:e.alphaViews.palette,text:e.alphaViews.text};const o=t.createElement("div");o.classList.add(yi("a"));const a=t.createElement("div");a.classList.add(yi("ap"));a.appendChild(this.alphaViews_.palette.element);o.appendChild(a);const l=t.createElement("div");l.classList.add(yi("at"));l.appendChild(this.alphaViews_.text.element);o.appendChild(l);this.element.appendChild(o)}}get allFocusableElements(){const t=[this.svPaletteView_.element,this.hPaletteView_.element,this.textView_.modeSelectElement,...this.textView_.textViews.map(t=>t.inputElement)];if(this.alphaViews_)t.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement);return t}}function _i(t){const e=D;return F(t,{alpha:e.optional.boolean,expanded:e.optional.boolean,picker:e.optional.custom(Wn)})}function bi(t){return t?.1:1}function wi(t,e){const n=t.match(/^(.+)%$/);if(!n)return Math.min(parseFloat(t),e);return Math.min(parseFloat(n[1])*.01*e,e)}const Mi={deg:t=>t,grad:t=>t*360/400,rad:t=>t*360/(2*Math.PI),turn:t=>t*360};function Si(t){const e=t.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!e)return parseFloat(t);const n=parseFloat(e[1]);const i=e[2];return Mi[i](n)}const Ei={"func.rgb":t=>{const e=t.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const n=[wi(e[1],255),wi(e[2],255),wi(e[3],255)];if(isNaN(n[0])||isNaN(n[1])||isNaN(n[2]))return null;return new gi(n,"rgb")},"func.rgba":t=>{const e=t.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const n=[wi(e[1],255),wi(e[2],255),wi(e[3],255),wi(e[4],1)];if(isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(n[3]))return null;return new gi(n,"rgb")},"func.hsl":t=>{const e=t.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const n=[Si(e[1]),wi(e[2],100),wi(e[3],100)];if(isNaN(n[0])||isNaN(n[1])||isNaN(n[2]))return null;return new gi(n,"hsl")},"func.hsla":t=>{const e=t.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const n=[Si(e[1]),wi(e[2],100),wi(e[3],100),wi(e[4],1)];if(isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(n[3]))return null;return new gi(n,"hsl")},"hex.rgb":t=>{const e=t.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return new gi([parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)],"rgb");const n=t.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);if(n)return new gi([parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16)],"rgb");return null},"hex.rgba":t=>{const e=t.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return new gi([parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),Cn(parseInt(e[4]+e[4],16),0,255,0,1)],"rgb");const n=t.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);if(n)return new gi([parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16),Cn(parseInt(n[4],16),0,255,0,1)],"rgb");return null}};function Ti(i){const t=Object.keys(Ei);return t.reduce((t,e)=>{if(t)return t;const n=Ei[e];return n(i)?e:null},null)}const Ai=t=>{const e=Ti(t);return e?Ei[e](t):null};function Ci(t){return t==="func.hsla"||t==="func.rgba"||t==="hex.rgba"}function Pi(t){if(typeof t==="string"){const e=Ai(t);if(e)return e}return gi.black()}function Li(t){const e=Ln(Math.floor(t),0,255).toString(16);return e.length===1?`0${e}`:e}function Ri(t,e="#"){const n=ui(t.getComponents("rgb")).map(Li).join("");return`${e}${n}`}function Ii(t,e="#"){const n=t.getComponents("rgb");const i=[n[0],n[1],n[2],n[3]*255].map(Li).join("");return`${e}${i}`}function zi(t){const e=un(0);const n=ui(t.getComponents("rgb")).map(t=>e(t));return`rgb(${n.join(", ")})`}function Ni(t){const i=un(2);const r=un(0);const e=t.getComponents("rgb").map((t,e)=>{const n=e===3?i:r;return n(t)});return`rgba(${e.join(", ")})`}function Bi(t){const n=[un(0),pn,pn];const e=ui(t.getComponents("hsl")).map((t,e)=>n[e](t));return`hsl(${e.join(", ")})`}function Di(t){const n=[un(0),pn,pn,un(2)];const e=t.getComponents("hsl").map((t,e)=>n[e](t));return`hsla(${e.join(", ")})`}const Fi={"func.hsl":Bi,"func.hsla":Di,"func.rgb":zi,"func.rgba":Ni,"hex.rgb":Ri,"hex.rgba":Ii};function ki(t){return Fi[t]}const Oi=f("apl");class Vi{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this);this.value=e.value;this.value.emitter.on("change",this.onValueChange_);this.element=t.createElement("div");this.element.classList.add(Oi());e.viewProps.bindTabIndex(this.element);const n=t.createElement("div");n.classList.add(Oi("b"));this.element.appendChild(n);const i=t.createElement("div");i.classList.add(Oi("c"));n.appendChild(i);this.colorElem_=i;const r=t.createElement("div");r.classList.add(Oi("m"));this.element.appendChild(r);this.markerElem_=r;const s=t.createElement("div");s.classList.add(Oi("p"));this.markerElem_.appendChild(s);this.previewElem_=s;this.update_()}update_(){const t=this.value.rawValue;const e=t.getComponents("rgb");const n=new gi([e[0],e[1],e[2],0],"rgb");const i=new gi([e[0],e[1],e[2],255],"rgb");const r=["to right",Ni(n),Ni(i)];this.colorElem_.style.background=`linear-gradient(${r.join(",")})`;this.previewElem_.style.backgroundColor=Ni(t);const s=Cn(e[3],0,1,0,100);this.markerElem_.style.left=`${s}%`}onValueChange_(){this.update_()}}class Ui{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this);this.onKeyUp_=this.onKeyUp_.bind(this);this.onPointerDown_=this.onPointerDown_.bind(this);this.onPointerMove_=this.onPointerMove_.bind(this);this.onPointerUp_=this.onPointerUp_.bind(this);this.value=e.value;this.viewProps=e.viewProps;this.view=new Vi(t,{value:this.value,viewProps:this.viewProps});this.ptHandler_=new An(this.view.element);this.ptHandler_.emitter.on("down",this.onPointerDown_);this.ptHandler_.emitter.on("move",this.onPointerMove_);this.ptHandler_.emitter.on("up",this.onPointerUp_);this.view.element.addEventListener("keydown",this.onKeyDown_);this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;const n=t.point.x/t.bounds.width;const i=this.value.rawValue;const[r,s,o]=i.getComponents("hsv");this.value.setRawValue(new gi([r,s,o,n],"hsv"),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:false,last:false})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:false,last:false})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:true,last:true})}onKeyDown_(t){const e=bn(bi(true),Mn(t));if(e===0)return;const n=this.value.rawValue;const[i,r,s,o]=n.getComponents("hsv");this.value.setRawValue(new gi([i,r,s,o+e],"hsv"),{forceEmit:false,last:false})}onKeyUp_(t){const e=bn(bi(true),Mn(t));if(e===0)return;this.value.setRawValue(this.value.rawValue,{forceEmit:true,last:true})}}const Hi=f("coltxt");function Wi(i){const t=i.createElement("select");const e=[{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"}];t.appendChild(e.reduce((t,e)=>{const n=i.createElement("option");n.textContent=e.text;n.value=e.value;t.appendChild(n);return t},i.createDocumentFragment()));return t}class Gi{constructor(t,e){this.element=t.createElement("div");this.element.classList.add(Hi());const n=t.createElement("div");n.classList.add(Hi("m"));this.modeElem_=Wi(t);this.modeElem_.classList.add(Hi("ms"));n.appendChild(this.modeSelectElement);const i=t.createElement("div");i.classList.add(Hi("mm"));i.appendChild(Q(t,"dropdown"));n.appendChild(i);this.element.appendChild(n);const r=t.createElement("div");r.classList.add(Hi("w"));this.element.appendChild(r);this.textsElem_=r;this.textViews_=e.textViews;this.applyTextViews_();x(e.colorMode,t=>{this.modeElem_.value=t})}get modeSelectElement(){return this.modeElem_}get textViews(){return this.textViews_}set textViews(t){this.textViews_=t;this.applyTextViews_()}applyTextViews_(){et(this.textsElem_);const n=this.element.ownerDocument;this.textViews_.forEach(t=>{const e=n.createElement("div");e.classList.add(Hi("c"));e.appendChild(t.element);this.textsElem_.appendChild(e)})}}const ji=un(0),qi={rgb:()=>{return new me({min:0,max:255})},hsl:t=>{return t===0?new me({min:0,max:360}):new me({min:0,max:100})},hsv:t=>{return t===0?new me({min:0,max:360}):new me({min:0,max:100})}};function Xi(t,e,n){return new Nn(t,{arrayPosition:n===0?"fst":n===3-1?"lst":"mid",baseStep:bi(false),parser:e.parser,props:L.fromObject({draggingScale:1,formatter:ji}),value:P(0,{constraint:qi[e.colorMode](n)}),viewProps:e.viewProps})}class Yi{constructor(t,e){this.onModeSelectChange_=this.onModeSelectChange_.bind(this);this.parser_=e.parser;this.value=e.value;this.viewProps=e.viewProps;this.colorMode=P(this.value.rawValue.mode);this.ccs_=this.createComponentControllers_(t);this.view=new Gi(t,{colorMode:this.colorMode,textViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]});this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(t){const e={colorMode:this.colorMode.rawValue,parser:this.parser_,viewProps:this.viewProps};const n=[Xi(t,e,0),Xi(t,e,1),Xi(t,e,2)];n.forEach((t,r)=>{_n({primary:this.value,secondary:t.value,forward:t=>{return t.rawValue.getComponents(this.colorMode.rawValue)[r]},backward:(t,e)=>{const n=this.colorMode.rawValue;const i=t.rawValue.getComponents(n);i[r]=e.rawValue;return new gi(di(ui(i),i[3]),n)}})});return n}onModeSelectChange_(t){const e=t.currentTarget;this.colorMode.rawValue=e.value;this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument);this.view.textViews=[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}}const Zi=f("hpl");class Ki{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this);this.value=e.value;this.value.emitter.on("change",this.onValueChange_);this.element=t.createElement("div");this.element.classList.add(Zi());e.viewProps.bindTabIndex(this.element);const n=t.createElement("div");n.classList.add(Zi("c"));this.element.appendChild(n);const i=t.createElement("div");i.classList.add(Zi("m"));this.element.appendChild(i);this.markerElem_=i;this.update_()}update_(){const t=this.value.rawValue;const[e]=t.getComponents("hsv");this.markerElem_.style.backgroundColor=zi(new gi([e,100,100],"hsv"));const n=Cn(e,0,360,0,100);this.markerElem_.style.left=`${n}%`}onValueChange_(){this.update_()}}class Ji{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this);this.onKeyUp_=this.onKeyUp_.bind(this);this.onPointerDown_=this.onPointerDown_.bind(this);this.onPointerMove_=this.onPointerMove_.bind(this);this.onPointerUp_=this.onPointerUp_.bind(this);this.value=e.value;this.viewProps=e.viewProps;this.view=new Ki(t,{value:this.value,viewProps:this.viewProps});this.ptHandler_=new An(this.view.element);this.ptHandler_.emitter.on("down",this.onPointerDown_);this.ptHandler_.emitter.on("move",this.onPointerMove_);this.ptHandler_.emitter.on("up",this.onPointerUp_);this.view.element.addEventListener("keydown",this.onKeyDown_);this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;const n=Cn(t.point.x,0,t.bounds.width,0,360);const i=this.value.rawValue;const[,r,s,o]=i.getComponents("hsv");this.value.setRawValue(new gi([n,r,s,o],"hsv"),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:false,last:false})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:false,last:false})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:true,last:true})}onKeyDown_(t){const e=bn(bi(false),Mn(t));if(e===0)return;const n=this.value.rawValue;const[i,r,s,o]=n.getComponents("hsv");this.value.setRawValue(new gi([i+e,r,s,o],"hsv"),{forceEmit:false,last:false})}onKeyUp_(t){const e=bn(bi(false),Mn(t));if(e===0)return;this.value.setRawValue(this.value.rawValue,{forceEmit:true,last:true})}}const Qi=f("svp"),$i=64;class tr{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this);this.value=e.value;this.value.emitter.on("change",this.onValueChange_);this.element=t.createElement("div");this.element.classList.add(Qi());e.viewProps.bindTabIndex(this.element);const n=t.createElement("canvas");n.height=$i;n.width=$i;n.classList.add(Qi("c"));this.element.appendChild(n);this.canvasElement=n;const i=t.createElement("div");i.classList.add(Qi("m"));this.element.appendChild(i);this.markerElem_=i;this.update_()}update_(){const t=K(this.canvasElement);if(!t)return;const e=this.value.rawValue;const n=e.getComponents("hsv");const i=this.canvasElement.width;const r=this.canvasElement.height;const s=t.getImageData(0,0,i,r);const o=s.data;for(let e=0;e<r;e++)for(let t=0;t<i;t++){const h=Cn(t,0,i,0,100);const c=Cn(e,0,r,100,0);const u=li(n[0],h,c);const d=(e*i+t)*4;o[d]=u[0];o[d+1]=u[1];o[d+2]=u[2];o[d+3]=255}t.putImageData(s,0,0);const a=Cn(n[1],0,100,0,100);this.markerElem_.style.left=`${a}%`;const l=Cn(n[2],0,100,100,0);this.markerElem_.style.top=`${l}%`}onValueChange_(){this.update_()}}class er{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this);this.onKeyUp_=this.onKeyUp_.bind(this);this.onPointerDown_=this.onPointerDown_.bind(this);this.onPointerMove_=this.onPointerMove_.bind(this);this.onPointerUp_=this.onPointerUp_.bind(this);this.value=e.value;this.viewProps=e.viewProps;this.view=new tr(t,{value:this.value,viewProps:this.viewProps});this.ptHandler_=new An(this.view.element);this.ptHandler_.emitter.on("down",this.onPointerDown_);this.ptHandler_.emitter.on("move",this.onPointerMove_);this.ptHandler_.emitter.on("up",this.onPointerUp_);this.view.element.addEventListener("keydown",this.onKeyDown_);this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;const n=Cn(t.point.x,0,t.bounds.width,0,100);const i=Cn(t.point.y,0,t.bounds.height,100,0);const[r,,,s]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new gi([r,n,i,s],"hsv"),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:false,last:false})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:false,last:false})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:true,last:true})}onKeyDown_(t){if(En(t.key))t.preventDefault();const[e,n,i,r]=this.value.rawValue.getComponents("hsv");const s=bi(false);const o=bn(s,Mn(t));const a=bn(s,wn(t));if(o===0&&a===0)return;this.value.setRawValue(new gi([e,n+o,i+a,r],"hsv"),{forceEmit:false,last:false})}onKeyUp_(t){const e=bi(false);const n=bn(e,Mn(t));const i=bn(e,wn(t));if(n===0&&i===0)return;this.value.setRawValue(this.value.rawValue,{forceEmit:true,last:true})}}class nr{constructor(t,e){this.value=e.value;this.viewProps=e.viewProps;this.hPaletteC_=new Ji(t,{value:this.value,viewProps:this.viewProps});this.svPaletteC_=new er(t,{value:this.value,viewProps:this.viewProps});this.alphaIcs_=e.supportsAlpha?{palette:new Ui(t,{value:this.value,viewProps:this.viewProps}),text:new Nn(t,{parser:ln,baseStep:.1,props:L.fromObject({draggingScale:.01,formatter:un(2)}),value:P(0,{constraint:new me({min:0,max:1})}),viewProps:this.viewProps})}:null;if(this.alphaIcs_)_n({primary:this.value,secondary:this.alphaIcs_.text.value,forward:t=>{return t.rawValue.getComponents()[3]},backward:(t,e)=>{const n=t.rawValue.getComponents();n[3]=e.rawValue;return new gi(n,t.rawValue.mode)}});this.textC_=new Yi(t,{parser:ln,value:this.value,viewProps:this.viewProps});this.view=new xi(t,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:e.supportsAlpha,svPaletteView:this.svPaletteC_.view,textView:this.textC_.view})}get textController(){return this.textC_}}const ir=f("colsw");class rr{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this);e.value.emitter.on("change",this.onValueChange_);this.value=e.value;this.element=t.createElement("div");this.element.classList.add(ir());e.viewProps.bindClassModifiers(this.element);const n=t.createElement("div");n.classList.add(ir("sw"));this.element.appendChild(n);this.swatchElem_=n;const i=t.createElement("button");i.classList.add(ir("b"));e.viewProps.bindDisabled(i);this.element.appendChild(i);this.buttonElement=i;this.update_()}update_(){const t=this.value.rawValue;this.swatchElem_.style.backgroundColor=Ii(t)}onValueChange_(){this.update_()}}class sr{constructor(t,e){this.value=e.value;this.viewProps=e.viewProps;this.view=new rr(t,{value:this.value,viewProps:this.viewProps})}}class or{constructor(t,e){this.onButtonBlur_=this.onButtonBlur_.bind(this);this.onButtonClick_=this.onButtonClick_.bind(this);this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this);this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this);this.value=e.value;this.viewProps=e.viewProps;this.foldable_=ut.create(e.expanded);this.swatchC_=new sr(t,{value:this.value,viewProps:this.viewProps});const n=this.swatchC_.view.buttonElement;n.addEventListener("blur",this.onButtonBlur_);n.addEventListener("click",this.onButtonClick_);this.textC_=new Se(t,{parser:e.parser,props:L.fromObject({formatter:e.formatter}),value:this.value,viewProps:this.viewProps});this.view=new ri(t,{foldable:this.foldable_,pickerLayout:e.pickerLayout});this.view.swatchElement.appendChild(this.swatchC_.view.element);this.view.textElement.appendChild(this.textC_.view.element);this.popC_=e.pickerLayout==="popup"?new be(t,{viewProps:this.viewProps}):null;const i=new nr(t,{supportsAlpha:e.supportsAlpha,value:this.value,viewProps:this.viewProps});i.view.allFocusableElements.forEach(t=>{t.addEventListener("blur",this.onPopupChildBlur_);t.addEventListener("keydown",this.onPopupChildKeydown_)});this.pickerC_=i;if(this.popC_){this.view.element.appendChild(this.popC_.view.element);this.popC_.view.element.appendChild(i.view.element);_n({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:t=>t.rawValue,backward:(t,e)=>e.rawValue})}else if(this.view.pickerElement){this.view.pickerElement.appendChild(this.pickerC_.view.element);mt(this.foldable_,this.view.pickerElement)}}get textController(){return this.textC_}onButtonBlur_(t){if(!this.popC_)return;const e=this.view.element;const n=a(t.relatedTarget);if(!n||!e.contains(n))this.popC_.shows.rawValue=false}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded"));if(this.foldable_.get("expanded"))this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(t){if(!this.popC_)return;const e=this.popC_.view.element;const n=it(t);if(n&&e.contains(n))return;if(n&&n===this.swatchC_.view.buttonElement&&!q(e.ownerDocument))return;this.popC_.shows.rawValue=false}onPopupChildKeydown_(t){if(this.popC_){if(t.key==="Escape")this.popC_.shows.rawValue=false}else if(this.view.pickerElement)if(t.key==="Escape")this.swatchC_.view.buttonElement.focus()}}function ar(t){if(gi.isColorObject(t))return gi.fromObject(t);return gi.black()}function lr(t){return ui(t.getComponents("rgb")).reduce((t,e)=>{return t<<8|Math.floor(e)&255},0)}function hr(t){return t.getComponents("rgb").reduce((t,e,n)=>{const i=Math.floor(n===3?e*255:e)&255;return t<<8|i},0)>>>0}function cr(t){return new gi([t>>16&255,t>>8&255,t&255],"rgb")}function ur(t){return new gi([t>>24&255,t>>16&255,t>>8&255,Cn(t&255,0,255,0,1)],"rgb")}function dr(t){if(typeof t!=="number")return gi.black();return cr(t)}function pr(t){if(typeof t!=="number")return gi.black();return ur(t)}function mr(t){const n=ki(t);return(t,e)=>{Un(t,n(e))}}function fr(t){const n=t?hr:lr;return(t,e)=>{Un(t,n(e))}}function vr(t,e){const n=e.toRgbaObject();t.writeProperty("r",n.r);t.writeProperty("g",n.g);t.writeProperty("b",n.b);t.writeProperty("a",n.a)}function gr(t,e){const n=e.toRgbaObject();t.writeProperty("r",n.r);t.writeProperty("g",n.g);t.writeProperty("b",n.b)}function yr(t){return t?vr:gr}function xr(t){return"alpha"in t&&t.alpha===true}function _r(t){return t?t=>Ii(t,"0x"):t=>Ri(t,"0x")}const br={id:"input-color-number",type:"input",accept:(t,e)=>{if(typeof t!=="number")return null;if(!("view"in e))return null;if(e.view!=="color")return null;const n=_i(e);return n?{initialValue:t,params:n}:null},binding:{reader:t=>{return xr(t.params)?pr:dr},equals:gi.equals,writer:t=>{return fr(xr(t.params))}},controller:t=>{const e=xr(t.params);const n="expanded"in t.params?t.params.expanded:undefined;const i="picker"in t.params?t.params.picker:undefined;return new or(t.document,{expanded:n!==null&&n!==void 0?n:false,formatter:_r(e),parser:Ai,pickerLayout:i!==null&&i!==void 0?i:"popup",supportsAlpha:e,value:t.value,viewProps:t.viewProps})}};function wr(t){return gi.isRgbaColorObject(t)}const Mr={id:"input-color-object",type:"input",accept:(t,e)=>{if(!gi.isColorObject(t))return null;const n=_i(e);return n?{initialValue:t,params:n}:null},binding:{reader:t=>ar,equals:gi.equals,writer:t=>yr(wr(t.initialValue))},controller:t=>{const e=gi.isRgbaColorObject(t.initialValue);const n="expanded"in t.params?t.params.expanded:undefined;const i="picker"in t.params?t.params.picker:undefined;const r=e?Ii:Ri;return new or(t.document,{expanded:n!==null&&n!==void 0?n:false,formatter:r,parser:Ai,pickerLayout:i!==null&&i!==void 0?i:"popup",supportsAlpha:e,value:t.value,viewProps:t.viewProps})}},Sr={id:"input-color-string",type:"input",accept:(t,e)=>{if(typeof t!=="string")return null;if("view"in e&&e.view==="text")return null;const n=Ti(t);if(!n)return null;const i=_i(e);return i?{initialValue:t,params:i}:null},binding:{reader:t=>Pi,equals:gi.equals,writer:t=>{const e=Ti(t.initialValue);if(!e)throw c.shouldNeverHappen();return mr(e)}},controller:t=>{const e=Ti(t.initialValue);if(!e)throw c.shouldNeverHappen();const n=ki(e);const i="expanded"in t.params?t.params.expanded:undefined;const r="picker"in t.params?t.params.picker:undefined;return new or(t.document,{expanded:i!==null&&i!==void 0?i:false,formatter:n,parser:Ai,pickerLayout:r!==null&&r!==void 0?r:"popup",supportsAlpha:Ci(e),value:t.value,viewProps:t.viewProps})}};class Er{constructor(t){this.components=t.components;this.asm_=t.assembly}constrain(t){const e=this.asm_.toComponents(t).map((t,e)=>{var n,i;return(i=(n=this.components[e])===null||n===void 0?void 0:n.constrain(t))!==null&&i!==void 0?i:t});return this.asm_.fromComponents(e)}}const Tr=f("pndtxt");class Ar{constructor(n,t){this.textViews=t.textViews;this.element=n.createElement("div");this.element.classList.add(Tr());this.textViews.forEach(t=>{const e=n.createElement("div");e.classList.add(Tr("a"));e.appendChild(t.element);this.element.appendChild(e)})}}function Cr(t,e,n){return new Nn(t,{arrayPosition:n===0?"fst":n===e.axes.length-1?"lst":"mid",baseStep:e.axes[n].baseStep,parser:e.parser,props:e.axes[n].textProps,value:P(0,{constraint:e.axes[n].constraint}),viewProps:e.viewProps})}class Pr{constructor(n,r){this.value=r.value;this.viewProps=r.viewProps;this.acs_=r.axes.map((t,e)=>Cr(n,r,e));this.acs_.forEach((t,i)=>{_n({primary:this.value,secondary:t.value,forward:t=>{return r.assembly.toComponents(t.rawValue)[i]},backward:(t,e)=>{const n=r.assembly.toComponents(t.rawValue);n[i]=e.rawValue;return r.assembly.fromComponents(n)}})});this.view=new Ar(n,{textViews:this.acs_.map(t=>t.view)})}}function Lr(t){if("step"in t&&!v(t.step))return new fe(t.step);return null}function Rr(t){if("max"in t&&!v(t.max)||"min"in t&&!v(t.min))return new me({max:t.max,min:t.min});return null}function Ir(t){const e=[];const n=Lr(t);if(n)e.push(n);const i=Rr(t);if(i)e.push(i);const r=qn(t.options);if(r)e.push(r);return new ue(e)}function zr(t){const e=t?de(t,me):null;if(!e)return[undefined,undefined];return[e.minValue,e.maxValue]}function Nr(t){const[e,n]=zr(t);return[e!==null&&e!==void 0?e:0,n!==null&&n!==void 0?n:100]}const Br={id:"input-number",type:"input",accept:(t,e)=>{if(typeof t!=="number")return null;const n=D;const i=F(e,{format:n.optional.function,max:n.optional.number,min:n.optional.number,options:n.optional.custom(Hn),step:n.optional.number});return i?{initialValue:t,params:i}:null},binding:{reader:t=>hn,constraint:t=>Ir(t.params),writer:t=>Un},controller:t=>{var e,n;const i=t.value;const r=t.constraint;if(r&&de(r,pe))return new ye(t.document,{props:L.fromObject({options:(e=Xn(r))!==null&&e!==void 0?e:[]}),value:i,viewProps:t.viewProps});const s=(n="format"in t.params?t.params.format:undefined)!==null&&n!==void 0?n:un(Zn(r,i.rawValue));if(r&&de(r,me)){const[o,a]=Nr(r);return new Vn(t.document,{baseStep:Kn(r),parser:ln,sliderProps:L.fromObject({maxValue:a,minValue:o}),textProps:L.fromObject({draggingScale:Jn(r,i.rawValue),formatter:s}),value:i,viewProps:t.viewProps})}return new Nn(t.document,{baseStep:Kn(r),parser:ln,props:L.fromObject({draggingScale:Jn(r,i.rawValue),formatter:s}),value:i,viewProps:t.viewProps})}};class Dr{constructor(t=0,e=0){this.x=t;this.y=e}getComponents(){return[this.x,this.y]}static isObject(t){if(v(t))return false;const e=t.x;const n=t.y;if(typeof e!=="number"||typeof n!=="number")return false;return true}static equals(t,e){return t.x===e.x&&t.y===e.y}toObject(){return{x:this.x,y:this.y}}}const Fr={toComponents:t=>t.getComponents(),fromComponents:t=>new Dr(...t)},kr=f("p2d");class Or{constructor(t,e){this.element=t.createElement("div");this.element.classList.add(kr());e.viewProps.bindClassModifiers(this.element);x(e.expanded,w(this.element,kr(undefined,"expanded")));const n=t.createElement("div");n.classList.add(kr("h"));this.element.appendChild(n);const i=t.createElement("button");i.classList.add(kr("b"));i.appendChild(Q(t,"p2dpad"));e.viewProps.bindDisabled(i);n.appendChild(i);this.buttonElement=i;const r=t.createElement("div");r.classList.add(kr("t"));n.appendChild(r);this.textElement=r;if(e.pickerLayout==="inline"){const s=t.createElement("div");s.classList.add(kr("p"));this.element.appendChild(s);this.pickerElement=s}else this.pickerElement=null}}const Vr=f("p2dp");class Ur{constructor(t,e){this.onFoldableChange_=this.onFoldableChange_.bind(this);this.onValueChange_=this.onValueChange_.bind(this);this.invertsY_=e.invertsY;this.maxValue_=e.maxValue;this.element=t.createElement("div");this.element.classList.add(Vr());if(e.layout==="popup")this.element.classList.add(Vr(undefined,"p"));const n=t.createElement("div");n.classList.add(Vr("p"));e.viewProps.bindTabIndex(n);this.element.appendChild(n);this.padElement=n;const i=t.createElementNS(W,"svg");i.classList.add(Vr("g"));this.padElement.appendChild(i);this.svgElem_=i;const r=t.createElementNS(W,"line");r.classList.add(Vr("ax"));r.setAttributeNS(null,"x1","0");r.setAttributeNS(null,"y1","50%");r.setAttributeNS(null,"x2","100%");r.setAttributeNS(null,"y2","50%");this.svgElem_.appendChild(r);const s=t.createElementNS(W,"line");s.classList.add(Vr("ax"));s.setAttributeNS(null,"x1","50%");s.setAttributeNS(null,"y1","0");s.setAttributeNS(null,"x2","50%");s.setAttributeNS(null,"y2","100%");this.svgElem_.appendChild(s);const o=t.createElementNS(W,"line");o.classList.add(Vr("l"));o.setAttributeNS(null,"x1","50%");o.setAttributeNS(null,"y1","50%");this.svgElem_.appendChild(o);this.lineElem_=o;const a=t.createElement("div");a.classList.add(Vr("m"));this.padElement.appendChild(a);this.markerElem_=a;e.value.emitter.on("change",this.onValueChange_);this.value=e.value;this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[t,e]=this.value.rawValue.getComponents();const n=this.maxValue_;const i=Cn(t,-n,+n,0,100);const r=Cn(e,-n,+n,0,100);const s=this.invertsY_?100-r:r;this.lineElem_.setAttributeNS(null,"x2",`${i}%`);this.lineElem_.setAttributeNS(null,"y2",`${s}%`);this.markerElem_.style.left=`${i}%`;this.markerElem_.style.top=`${s}%`}onValueChange_(){this.update_()}onFoldableChange_(){this.update_()}}function Hr(t,e,n){return[bn(e[0],Mn(t)),bn(e[1],wn(t))*(n?1:-1)]}class Wr{constructor(t,e){this.onPadKeyDown_=this.onPadKeyDown_.bind(this);this.onPadKeyUp_=this.onPadKeyUp_.bind(this);this.onPointerDown_=this.onPointerDown_.bind(this);this.onPointerMove_=this.onPointerMove_.bind(this);this.onPointerUp_=this.onPointerUp_.bind(this);this.value=e.value;this.viewProps=e.viewProps;this.baseSteps_=e.baseSteps;this.maxValue_=e.maxValue;this.invertsY_=e.invertsY;this.view=new Ur(t,{invertsY:this.invertsY_,layout:e.layout,maxValue:this.maxValue_,value:this.value,viewProps:this.viewProps});this.ptHandler_=new An(this.view.padElement);this.ptHandler_.emitter.on("down",this.onPointerDown_);this.ptHandler_.emitter.on("move",this.onPointerMove_);this.ptHandler_.emitter.on("up",this.onPointerUp_);this.view.padElement.addEventListener("keydown",this.onPadKeyDown_);this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;const n=this.maxValue_;const i=Cn(t.point.x,0,t.bounds.width,-n,+n);const r=Cn(this.invertsY_?t.bounds.height-t.point.y:t.point.y,0,t.bounds.height,-n,+n);this.value.setRawValue(new Dr(i,r),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:false,last:false})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:false,last:false})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:true,last:true})}onPadKeyDown_(t){if(En(t.key))t.preventDefault();const[e,n]=Hr(t,this.baseSteps_,this.invertsY_);if(e===0&&n===0)return;this.value.setRawValue(new Dr(this.value.rawValue.x+e,this.value.rawValue.y+n),{forceEmit:false,last:false})}onPadKeyUp_(t){const[e,n]=Hr(t,this.baseSteps_,this.invertsY_);if(e===0&&n===0)return;this.value.setRawValue(this.value.rawValue,{forceEmit:true,last:true})}}class Gr{constructor(t,e){var n,i;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this);this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this);this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this);this.onPadButtonClick_=this.onPadButtonClick_.bind(this);this.value=e.value;this.viewProps=e.viewProps;this.foldable_=ut.create(e.expanded);this.popC_=e.pickerLayout==="popup"?new be(t,{viewProps:this.viewProps}):null;const r=new Wr(t,{baseSteps:[e.axes[0].baseStep,e.axes[1].baseStep],invertsY:e.invertsY,layout:e.pickerLayout,maxValue:e.maxValue,value:this.value,viewProps:this.viewProps});r.view.allFocusableElements.forEach(t=>{t.addEventListener("blur",this.onPopupChildBlur_);t.addEventListener("keydown",this.onPopupChildKeydown_)});this.pickerC_=r;this.textC_=new Pr(t,{assembly:Fr,axes:e.axes,parser:e.parser,value:this.value,viewProps:this.viewProps});this.view=new Or(t,{expanded:this.foldable_.value("expanded"),pickerLayout:e.pickerLayout,viewProps:this.viewProps});this.view.textElement.appendChild(this.textC_.view.element);(n=this.view.buttonElement)===null||n===void 0?void 0:n.addEventListener("blur",this.onPadButtonBlur_);(i=this.view.buttonElement)===null||i===void 0?void 0:i.addEventListener("click",this.onPadButtonClick_);if(this.popC_){this.view.element.appendChild(this.popC_.view.element);this.popC_.view.element.appendChild(this.pickerC_.view.element);_n({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:t=>t.rawValue,backward:(t,e)=>e.rawValue})}else if(this.view.pickerElement){this.view.pickerElement.appendChild(this.pickerC_.view.element);mt(this.foldable_,this.view.pickerElement)}}onPadButtonBlur_(t){if(!this.popC_)return;const e=this.view.element;const n=a(t.relatedTarget);if(!n||!e.contains(n))this.popC_.shows.rawValue=false}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded"));if(this.foldable_.get("expanded"))this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(t){if(!this.popC_)return;const e=this.popC_.view.element;const n=it(t);if(n&&e.contains(n))return;if(n&&n===this.view.buttonElement&&!q(e.ownerDocument))return;this.popC_.shows.rawValue=false}onPopupChildKeydown_(t){if(this.popC_){if(t.key==="Escape")this.popC_.shows.rawValue=false}else if(this.view.pickerElement)if(t.key==="Escape")this.view.buttonElement.focus()}}function jr(t){return Dr.isObject(t)?new Dr(t.x,t.y):new Dr}function qr(t,e){t.writeProperty("x",e.x);t.writeProperty("y",e.y)}function Xr(t){if(!t)return undefined;const e=[];if(!v(t.step))e.push(new fe(t.step));if(!v(t.max)||!v(t.min))e.push(new me({max:t.max,min:t.min}));return new ue(e)}function Yr(t){return new Er({assembly:Fr,components:[Xr("x"in t?t.x:undefined),Xr("y"in t?t.y:undefined)]})}function Zr(t,e){const n=t&&de(t,me);if(n)return Math.max(Math.abs(n.minValue||0),Math.abs(n.maxValue||0));const i=Kn(t);return Math.max(Math.abs(i)*10,Math.abs(e)*10)}function Kr(t,e){const n=e instanceof Er?e.components[0]:undefined;const i=e instanceof Er?e.components[1]:undefined;const r=Zr(n,t.x);const s=Zr(i,t.y);return Math.max(r,s)}function Jr(t,e){return{baseStep:Kn(e),constraint:e,textProps:L.fromObject({draggingScale:Jn(e,t),formatter:un(Zn(e,t))})}}function Qr(t){if(!("y"in t))return false;const e=t.y;if(!e)return false;return"inverted"in e?!!e.inverted:false}const $r={id:"input-point2d",type:"input",accept:(t,e)=>{if(!Dr.isObject(t))return null;const n=D;const i=F(e,{expanded:n.optional.boolean,picker:n.optional.custom(Wn),x:n.optional.custom(Gn),y:n.optional.object({inverted:n.optional.boolean,max:n.optional.number,min:n.optional.number,step:n.optional.number})});return i?{initialValue:t,params:i}:null},binding:{reader:t=>jr,constraint:t=>Yr(t.params),equals:Dr.equals,writer:t=>qr},controller:t=>{const e=t.document;const n=t.value;const i=t.constraint;if(!(i instanceof Er))throw c.shouldNeverHappen();const r="expanded"in t.params?t.params.expanded:undefined;const s="picker"in t.params?t.params.picker:undefined;return new Gr(e,{axes:[Jr(n.rawValue.x,i.components[0]),Jr(n.rawValue.y,i.components[1])],expanded:r!==null&&r!==void 0?r:false,invertsY:Qr(t.params),maxValue:Kr(n.rawValue,i),parser:ln,pickerLayout:s!==null&&s!==void 0?s:"popup",value:n,viewProps:t.viewProps})}};class ts{constructor(t=0,e=0,n=0){this.x=t;this.y=e;this.z=n}getComponents(){return[this.x,this.y,this.z]}static isObject(t){if(v(t))return false;const e=t.x;const n=t.y;const i=t.z;if(typeof e!=="number"||typeof n!=="number"||typeof i!=="number")return false;return true}static equals(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const es={toComponents:t=>t.getComponents(),fromComponents:t=>new ts(...t)};function ns(t){return ts.isObject(t)?new ts(t.x,t.y,t.z):new ts}function is(t,e){t.writeProperty("x",e.x);t.writeProperty("y",e.y);t.writeProperty("z",e.z)}function rs(t){if(!t)return undefined;const e=[];if(!v(t.step))e.push(new fe(t.step));if(!v(t.max)||!v(t.min))e.push(new me({max:t.max,min:t.min}));return new ue(e)}function ss(t){return new Er({assembly:es,components:[rs("x"in t?t.x:undefined),rs("y"in t?t.y:undefined),rs("z"in t?t.z:undefined)]})}function os(t,e){return{baseStep:Kn(e),constraint:e,textProps:L.fromObject({draggingScale:Jn(e,t),formatter:un(Zn(e,t))})}}const as={id:"input-point3d",type:"input",accept:(t,e)=>{if(!ts.isObject(t))return null;const n=D;const i=F(e,{x:n.optional.custom(Gn),y:n.optional.custom(Gn),z:n.optional.custom(Gn)});return i?{initialValue:t,params:i}:null},binding:{reader:t=>ns,constraint:t=>ss(t.params),equals:ts.equals,writer:t=>is},controller:t=>{const e=t.value;const n=t.constraint;if(!(n instanceof Er))throw c.shouldNeverHappen();return new Pr(t.document,{assembly:es,axes:[os(e.rawValue.x,n.components[0]),os(e.rawValue.y,n.components[1]),os(e.rawValue.z,n.components[2])],parser:ln,value:e,viewProps:t.viewProps})}};class ls{constructor(t=0,e=0,n=0,i=0){this.x=t;this.y=e;this.z=n;this.w=i}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(t){if(v(t))return false;const e=t.x;const n=t.y;const i=t.z;const r=t.w;if(typeof e!=="number"||typeof n!=="number"||typeof i!=="number"||typeof r!=="number")return false;return true}static equals(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z&&t.w===e.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const hs={toComponents:t=>t.getComponents(),fromComponents:t=>new ls(...t)};function cs(t){return ls.isObject(t)?new ls(t.x,t.y,t.z,t.w):new ls}function us(t,e){t.writeProperty("x",e.x);t.writeProperty("y",e.y);t.writeProperty("z",e.z);t.writeProperty("w",e.w)}function ds(t){if(!t)return undefined;const e=[];if(!v(t.step))e.push(new fe(t.step));if(!v(t.max)||!v(t.min))e.push(new me({max:t.max,min:t.min}));return new ue(e)}function ps(t){return new Er({assembly:hs,components:[ds("x"in t?t.x:undefined),ds("y"in t?t.y:undefined),ds("z"in t?t.z:undefined),ds("w"in t?t.w:undefined)]})}function ms(t,e){return{baseStep:Kn(e),constraint:e,textProps:L.fromObject({draggingScale:Jn(e,t),formatter:un(Zn(e,t))})}}const fs={id:"input-point4d",type:"input",accept:(t,e)=>{if(!ls.isObject(t))return null;const n=D;const i=F(e,{x:n.optional.custom(Gn),y:n.optional.custom(Gn),z:n.optional.custom(Gn),w:n.optional.custom(Gn)});return i?{initialValue:t,params:i}:null},binding:{reader:t=>cs,constraint:t=>ps(t.params),equals:ls.equals,writer:t=>us},controller:t=>{const e=t.value;const n=t.constraint;if(!(n instanceof Er))throw c.shouldNeverHappen();return new Pr(t.document,{assembly:hs,axes:e.rawValue.getComponents().map((t,e)=>ms(t,n.components[e])),parser:ln,value:e,viewProps:t.viewProps})}};function vs(t){const e=[];const n=qn(t.options);if(n)e.push(n);return new ue(e)}const gs={id:"input-string",type:"input",accept:(t,e)=>{if(typeof t!=="string")return null;const n=D;const i=F(e,{options:n.optional.custom(Hn)});return i?{initialValue:t,params:i}:null},binding:{reader:t=>mn,constraint:t=>vs(t.params),writer:t=>Un},controller:t=>{var e;const n=t.document;const i=t.value;const r=t.constraint;if(r&&de(r,pe))return new ye(n,{props:L.fromObject({options:(e=Xn(r))!==null&&e!==void 0?e:[]}),value:i,viewProps:t.viewProps});return new Se(n,{parser:t=>t,props:L.fromObject({formatter:fn}),value:i,viewProps:t.viewProps})}},ys={monitor:{defaultInterval:200,defaultLineCount:3}},xs=f("mll");class _s{constructor(t,e){this.onValueUpdate_=this.onValueUpdate_.bind(this);this.formatter_=e.formatter;this.element=t.createElement("div");this.element.classList.add(xs());e.viewProps.bindClassModifiers(this.element);const n=t.createElement("textarea");n.classList.add(xs("i"));n.style.height=`calc(var(--bld-us) * ${e.lineCount})`;n.readOnly=true;e.viewProps.bindDisabled(n);this.element.appendChild(n);this.textareaElem_=n;e.value.emitter.on("change",this.onValueUpdate_);this.value=e.value;this.update_()}update_(){const t=this.textareaElem_;const e=t.scrollTop===t.scrollHeight-t.clientHeight;const n=[];this.value.rawValue.forEach(t=>{if(t!==undefined)n.push(this.formatter_(t))});t.textContent=n.join("\n");if(e)t.scrollTop=t.scrollHeight}onValueUpdate_(){this.update_()}}class bs{constructor(t,e){this.value=e.value;this.viewProps=e.viewProps;this.view=new _s(t,{formatter:e.formatter,lineCount:e.lineCount,value:this.value,viewProps:this.viewProps})}}const ws=f("sgl");class Ms{constructor(t,e){this.onValueUpdate_=this.onValueUpdate_.bind(this);this.formatter_=e.formatter;this.element=t.createElement("div");this.element.classList.add(ws());e.viewProps.bindClassModifiers(this.element);const n=t.createElement("input");n.classList.add(ws("i"));n.readOnly=true;n.type="text";e.viewProps.bindDisabled(n);this.element.appendChild(n);this.inputElement=n;e.value.emitter.on("change",this.onValueUpdate_);this.value=e.value;this.update_()}update_(){const t=this.value.rawValue;const e=t[t.length-1];this.inputElement.value=e!==undefined?this.formatter_(e):""}onValueUpdate_(){this.update_()}}class Ss{constructor(t,e){this.value=e.value;this.viewProps=e.viewProps;this.view=new Ms(t,{formatter:e.formatter,value:this.value,viewProps:this.viewProps})}}const Es={id:"monitor-bool",type:"monitor",accept:(t,e)=>{if(typeof t!=="boolean")return null;const n=D;const i=F(e,{lineCount:n.optional.number});return i?{initialValue:t,params:i}:null},binding:{reader:t=>Te},controller:t=>{var e;if(t.value.rawValue.length===1)return new Ss(t.document,{formatter:Ae,value:t.value,viewProps:t.viewProps});return new bs(t.document,{formatter:Ae,lineCount:(e=t.params.lineCount)!==null&&e!==void 0?e:ys.monitor.defaultLineCount,value:t.value,viewProps:t.viewProps})}};class Ts{constructor(){this.emitter=new p;this.index_=-1}get index(){return this.index_}set index(t){const e=this.index_!==t;if(e){this.index_=t;this.emitter.emit("change",{index:t,sender:this})}}}const As=f("grl");class Cs{constructor(t,e){this.onCursorChange_=this.onCursorChange_.bind(this);this.onValueUpdate_=this.onValueUpdate_.bind(this);this.element=t.createElement("div");this.element.classList.add(As());e.viewProps.bindClassModifiers(this.element);this.formatter_=e.formatter;this.minValue_=e.minValue;this.maxValue_=e.maxValue;this.cursor_=e.cursor;this.cursor_.emitter.on("change",this.onCursorChange_);const n=t.createElementNS(W,"svg");n.classList.add(As("g"));n.style.height=`calc(var(--bld-us) * ${e.lineCount})`;this.element.appendChild(n);this.svgElem_=n;const i=t.createElementNS(W,"polyline");this.svgElem_.appendChild(i);this.lineElem_=i;const r=t.createElement("div");r.classList.add(As("t"),f("tt")());this.element.appendChild(r);this.tooltipElem_=r;e.value.emitter.on("change",this.onValueUpdate_);this.value=e.value;this.update_()}get graphElement(){return this.svgElem_}update_(){const r=this.svgElem_.getBoundingClientRect();const s=this.value.rawValue.length-1;const o=this.minValue_;const a=this.maxValue_;const l=[];this.value.rawValue.forEach((t,e)=>{if(t===undefined)return;const n=Cn(e,0,s,0,r.width);const i=Cn(t,o,a,r.height,0);l.push([n,i].join(","))});this.lineElem_.setAttributeNS(null,"points",l.join(" "));const t=this.tooltipElem_;const e=this.value.rawValue[this.cursor_.index];if(e===undefined){t.classList.remove(As("t","a"));return}const n=Cn(this.cursor_.index,0,s,0,r.width);const i=Cn(e,o,a,r.height,0);t.style.left=`${n}px`;t.style.top=`${i}px`;t.textContent=`${this.formatter_(e)}`;if(!t.classList.contains(As("t","a"))){t.classList.add(As("t","a"),As("t","in"));G(t);t.classList.remove(As("t","in"))}}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class Ps{constructor(t,e){this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this);this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this);this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this);this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this);this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this);this.value=e.value;this.viewProps=e.viewProps;this.cursor_=new Ts;this.view=new Cs(t,{cursor:this.cursor_,formatter:e.formatter,lineCount:e.lineCount,maxValue:e.maxValue,minValue:e.minValue,value:this.value,viewProps:this.viewProps});if(!q(t)){this.view.element.addEventListener("mousemove",this.onGraphMouseMove_);this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_)}else{const n=new An(this.view.element);n.emitter.on("down",this.onGraphPointerDown_);n.emitter.on("move",this.onGraphPointerMove_);n.emitter.on("up",this.onGraphPointerUp_)}}onGraphMouseLeave_(){this.cursor_.index=-1}onGraphMouseMove_(t){const e=this.view.element.getBoundingClientRect();this.cursor_.index=Math.floor(Cn(t.offsetX,0,e.width,0,this.value.rawValue.length))}onGraphPointerDown_(t){this.onGraphPointerMove_(t)}onGraphPointerMove_(t){if(!t.data.point){this.cursor_.index=-1;return}this.cursor_.index=Math.floor(Cn(t.data.point.x,0,t.data.bounds.width,0,this.value.rawValue.length))}onGraphPointerUp_(){this.cursor_.index=-1}}function Ls(t){return"format"in t&&!v(t.format)?t.format:un(2)}function Rs(t){var e;if(t.value.rawValue.length===1)return new Ss(t.document,{formatter:Ls(t.params),value:t.value,viewProps:t.viewProps});return new bs(t.document,{formatter:Ls(t.params),lineCount:(e=t.params.lineCount)!==null&&e!==void 0?e:ys.monitor.defaultLineCount,value:t.value,viewProps:t.viewProps})}function Is(t){var e,n,i;return new Ps(t.document,{formatter:Ls(t.params),lineCount:(e=t.params.lineCount)!==null&&e!==void 0?e:ys.monitor.defaultLineCount,maxValue:(n="max"in t.params?t.params.max:null)!==null&&n!==void 0?n:100,minValue:(i="min"in t.params?t.params.min:null)!==null&&i!==void 0?i:0,value:t.value,viewProps:t.viewProps})}function zs(t){return"view"in t&&t.view==="graph"}const Ns={id:"monitor-number",type:"monitor",accept:(t,e)=>{if(typeof t!=="number")return null;const n=D;const i=F(e,{format:n.optional.function,lineCount:n.optional.number,max:n.optional.number,min:n.optional.number,view:n.optional.string});return i?{initialValue:t,params:i}:null},binding:{defaultBufferSize:t=>zs(t)?64:1,reader:t=>hn},controller:t=>{if(zs(t.params))return Is(t);return Rs(t)}},Bs={id:"monitor-string",type:"monitor",accept:(t,e)=>{if(typeof t!=="string")return null;const n=D;const i=F(e,{lineCount:n.optional.number,multiline:n.optional.boolean});return i?{initialValue:t,params:i}:null},binding:{reader:t=>mn},controller:t=>{var e;const n=t.value;const i=n.rawValue.length>1||"multiline"in t.params&&t.params.multiline;if(i)return new bs(t.document,{formatter:fn,lineCount:(e=t.params.lineCount)!==null&&e!==void 0?e:ys.monitor.defaultLineCount,value:n,viewProps:t.viewProps});return new Ss(t.document,{formatter:fn,value:n,viewProps:t.viewProps})}};class Ds{constructor(t){this.onValueChange_=this.onValueChange_.bind(this);this.reader=t.reader;this.writer=t.writer;this.emitter=new p;this.value=t.value;this.value.emitter.on("change",this.onValueChange_);this.target=t.target;this.read()}read(){const t=this.target.read();if(t!==undefined)this.value.rawValue=this.reader(t)}write_(t){this.writer(this.target,t)}onValueChange_(t){this.write_(t.rawValue);this.emitter.emit("change",{options:t.options,rawValue:t.rawValue,sender:this})}}function Fs(t,e){const n=t.accept(e.target.read(),e.params);if(v(n))return null;const i=D;const r={target:e.target,initialValue:n.initialValue,params:n.params};const s=t.binding.reader(r);const o=t.binding.constraint?t.binding.constraint(r):undefined;const a=P(s(n.initialValue),{constraint:o,equals:t.binding.equals});const l=new Ds({reader:s,target:e.target,value:a,writer:t.binding.writer(r)});const h=i.optional.boolean(e.params.disabled).value;const c=i.optional.boolean(e.params.hidden).value;const u=t.controller({constraint:o,document:e.document,initialValue:n.initialValue,params:n.params,value:l.value,viewProps:Jt.create({disabled:h,hidden:c})});const d=i.optional.string(e.params.label).value;return new wt(e.document,{binding:l,blade:ct(),props:L.fromObject({label:d||e.target.key}),valueController:u})}class ks{constructor(t){this.onTick_=this.onTick_.bind(this);this.reader_=t.reader;this.target=t.target;this.emitter=new p;this.value=t.value;this.ticker=t.ticker;this.ticker.emitter.on("tick",this.onTick_);this.read()}dispose(){this.ticker.dispose()}read(){const t=this.target.read();if(t===undefined)return;const e=this.value.rawValue;const n=this.reader_(t);this.value.rawValue=xn(e,n);this.emitter.emit("update",{rawValue:n,sender:this})}onTick_(t){this.read()}}function Os(t,e){return e===0?new he:new ce(t,e!==null&&e!==void 0?e:ys.monitor.defaultInterval)}function Vs(t,e){var n,i,r;const s=D;const o=t.accept(e.target.read(),e.params);if(v(o))return null;const a={target:e.target,initialValue:o.initialValue,params:o.params};const l=t.binding.reader(a);const h=(i=(n=s.optional.number(e.params.bufferSize).value)!==null&&n!==void 0?n:t.binding.defaultBufferSize&&t.binding.defaultBufferSize(o.params))!==null&&i!==void 0?i:1;const c=s.optional.number(e.params.interval).value;const u=new ks({reader:l,target:e.target,ticker:Os(e.document,c),value:gn(h)});const d=s.optional.boolean(e.params.disabled).value;const p=s.optional.boolean(e.params.hidden).value;const m=t.controller({document:e.document,params:o.params,value:u.value,viewProps:Jt.create({disabled:d,hidden:p})});const f=(r=s.optional.string(e.params.label).value)!==null&&r!==void 0?r:e.target.key;return new St(e.document,{binding:u,blade:ct(),props:L.fromObject({label:f}),valueController:m})}class Us{constructor(){this.pluginsMap_={blades:[],inputs:[],monitors:[]}}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(t){if(t.type==="blade")this.pluginsMap_.blades.unshift(t);else if(t.type==="input")this.pluginsMap_.inputs.unshift(t);else if(t.type==="monitor")this.pluginsMap_.monitors.unshift(t)}createInput(n,i,r){const t=i.read();if(v(t))throw new c({context:{key:i.key},type:"nomatchingcontroller"});const e=this.pluginsMap_.inputs.reduce((t,e)=>t||Fs(e,{document:n,target:i,params:r}),null);if(e)return e;throw new c({context:{key:i.key},type:"nomatchingcontroller"})}createMonitor(n,i,r){const t=this.pluginsMap_.monitors.reduce((t,e)=>t||Vs(e,{document:n,params:r,target:i}),null);if(t)return t;throw new c({context:{key:i.key},type:"nomatchingcontroller"})}createBlade(n,i){const t=this.pluginsMap_.blades.reduce((t,e)=>t||le(e,{document:n,params:i}),null);if(!t)throw new c({type:"nomatchingview",context:{params:i}});return t}createBladeApi(n){if(n instanceof wt)return new bt(n);if(n instanceof St)return new Mt(n);if(n instanceof kt)return new Ct(n,this);const t=this.pluginsMap_.blades.reduce((t,e)=>t||e.api({controller:n,pool:this}),null);if(!t)throw c.shouldNeverHappen();return t}}function Hs(){const e=new Us;[$r,as,fs,gs,Br,Sr,Mr,br,ni,Es,Bs,Ns,lt,Ht,Yt,ae].forEach(t=>{e.register(t)});return e}class Ws extends n{constructor(t){super(t);this.emitter_=new p;this.controller_.valueController.value.emitter.on("change",t=>{this.emitter_.emit("change",{event:new s(this,t.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}get options(){return this.controller_.valueController.props.get("options")}set options(t){this.controller_.valueController.props.set("options",t)}get value(){return this.controller_.valueController.value.rawValue}set value(t){this.controller_.valueController.value.rawValue=t}on(t,e){const n=e.bind(this);this.emitter_.on(t,t=>{n(t.event)});return this}}class Gs extends n{constructor(t){super(t);this.emitter_=new p;this.controller_.valueController.value.emitter.on("change",t=>{this.emitter_.emit("change",{event:new s(this,t.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}get maxValue(){return this.controller_.valueController.sliderController.props.get("maxValue")}set maxValue(t){this.controller_.valueController.sliderController.props.set("maxValue",t)}get minValue(){return this.controller_.valueController.sliderController.props.get("minValue")}set minValue(t){this.controller_.valueController.sliderController.props.set("minValue",t)}get value(){return this.controller_.valueController.value.rawValue}set value(t){this.controller_.valueController.value.rawValue=t}on(t,e){const n=e.bind(this);this.emitter_.on(t,t=>{n(t.event)});return this}}class js extends n{constructor(t){super(t);this.emitter_=new p;this.controller_.valueController.value.emitter.on("change",t=>{this.emitter_.emit("change",{event:new s(this,t.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}get formatter(){return this.controller_.valueController.props.get("formatter")}set formatter(t){this.controller_.valueController.props.set("formatter",t)}get value(){return this.controller_.valueController.value.rawValue}set value(t){this.controller_.valueController.value.rawValue=t}on(t,e){const n=e.bind(this);this.emitter_.on(t,t=>{n(t.event)});return this}}const qs=function(){return{id:"list",type:"blade",accept(t){const e=D;const n=F(t,{options:e.required.custom(Hn),value:e.required.raw,view:e.required.constant("list"),label:e.optional.string});return n?{params:n}:null},controller(t){const e=new ye(t.document,{props:L.fromObject({options:jn(t.params.options)}),value:P(t.params.value),viewProps:t.viewProps});return new Wt(t.document,{blade:t.blade,props:L.fromObject({label:t.params.label}),valueController:e})},api(t){if(!(t.controller instanceof Wt))return null;if(!(t.controller.valueController instanceof ye))return null;return new Ws(t.controller)}}}();function Xs(t){return t.reduce((t,e)=>{return Object.assign(t,{[e.presetKey]:e.read()})},{})}function Ys(t,n){t.forEach(t=>{const e=n[t.presetKey];if(e!==undefined)t.write(e)})}class Zs extends Pt{constructor(t,e){super(t,e)}get element(){return this.controller_.view.element}importPreset(t){const e=this.controller_.rackController.rack.find(wt).map(t=>{return t.binding.target});Ys(e,t);this.refresh()}exportPreset(){const t=this.controller_.rackController.rack.find(wt).map(t=>{return t.binding.target});return Xs(t)}refresh(){this.controller_.rackController.rack.find(wt).forEach(t=>{t.binding.read()});this.controller_.rackController.rack.find(St).forEach(t=>{t.binding.read()})}}class Ks extends Ut{constructor(t,e){super(t,{expanded:e.expanded,blade:e.blade,props:e.props,root:true,viewProps:e.viewProps})}}const Js={id:"slider",type:"blade",accept(t){const e=D;const n=F(t,{max:e.required.number,min:e.required.number,view:e.required.constant("slider"),format:e.optional.function,label:e.optional.string,value:e.optional.number});return n?{params:n}:null},controller(t){var e,n;const i=(e=t.params.value)!==null&&e!==void 0?e:0;const r=new Vn(t.document,{baseStep:1,parser:ln,sliderProps:L.fromObject({maxValue:t.params.max,minValue:t.params.min}),textProps:L.fromObject({draggingScale:Jn(undefined,i),formatter:(n=t.params.format)!==null&&n!==void 0?n:cn}),value:P(i),viewProps:t.viewProps});return new Wt(t.document,{blade:t.blade,props:L.fromObject({label:t.params.label}),valueController:r})},api(t){if(!(t.controller instanceof Wt))return null;if(!(t.controller.valueController instanceof Vn))return null;return new Gs(t.controller)}},Qs=function(){return{id:"text",type:"blade",accept(t){const e=D;const n=F(t,{parse:e.required.function,value:e.required.raw,view:e.required.constant("text"),format:e.optional.function,label:e.optional.string});return n?{params:n}:null},controller(t){var e;const n=new Se(t.document,{parser:t.params.parse,props:L.fromObject({formatter:(e=t.params.format)!==null&&e!==void 0?e:t=>String(t)}),value:P(t.params.value),viewProps:t.viewProps});return new Wt(t.document,{blade:t.blade,props:L.fromObject({label:t.params.label}),valueController:n})},api(t){if(!(t.controller instanceof Wt))return null;if(!(t.controller.valueController instanceof Se))return null;return new js(t.controller)}}}();function $s(t){const e=t.createElement("div");e.classList.add(f("dfw")());if(t.body)t.body.appendChild(e);return e}function to(t,e,n){if(t.querySelector(`style[data-tp-style=${e}]`))return;const i=t.createElement("style");i.dataset.tpStyle=e;i.textContent=n;t.head.appendChild(i)}class eo extends Zs{constructor(t){var e;const n=t||{};const i=(e=n.document)!==null&&e!==void 0?e:Y();const r=Hs();const s=new Ks(i,{expanded:n.expanded,blade:ct(),props:L.fromObject({title:n.title}),viewProps:Jt.create()});super(s,r);this.pool_=r;this.containerElem_=n.container||$s(i);this.containerElem_.appendChild(this.element);this.doc_=i;this.usesDefaultWrapper_=!n.container;this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw c.alreadyDisposed();return this.doc_}dispose(){const t=this.containerElem_;if(!t)throw c.alreadyDisposed();if(this.usesDefaultWrapper_){const e=t.parentElement;if(e)e.removeChild(t)}this.containerElem_=null;this.doc_=null;super.dispose()}registerPlugin(t){const e="plugin"in t?[t.plugin]:"plugins"in t?t.plugins:[];e.forEach(t=>{this.pool_.register(t);this.embedPluginStyle_(t)})}embedPluginStyle_(t){if(t.css)to(this.document,`plugin-${t.id}`,t.css)}setUpDefaultPlugins_(){to(this.document,"default",".tp-lstv_s,.tp-btnv_b,.tp-p2dv_b,.tp-colswv_sw,.tp-p2dpv_p,.tp-txtv_i,.tp-grlv_g,.tp-sglv_i,.tp-mllv_i,.tp-fldv_b,.tp-rotv_b,.tp-ckbv_i,.tp-coltxtv_ms,.tp-tbiv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-lstv_s,.tp-btnv_b,.tp-p2dv_b{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-lstv_s:hover,.tp-btnv_b:hover,.tp-p2dv_b:hover{background-color:var(--btn-bg-h)}.tp-lstv_s:focus,.tp-btnv_b:focus,.tp-p2dv_b:focus{background-color:var(--btn-bg-f)}.tp-lstv_s:active,.tp-btnv_b:active,.tp-p2dv_b:active{background-color:var(--btn-bg-a)}.tp-lstv_s:disabled,.tp-btnv_b:disabled,.tp-p2dv_b:disabled{opacity:0.5}.tp-colswv_sw,.tp-p2dpv_p,.tp-txtv_i{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-colswv_sw:hover,.tp-p2dpv_p:hover,.tp-txtv_i:hover{background-color:var(--in-bg-h)}.tp-colswv_sw:focus,.tp-p2dpv_p:focus,.tp-txtv_i:focus{background-color:var(--in-bg-f)}.tp-colswv_sw:active,.tp-p2dpv_p:active,.tp-txtv_i:active{background-color:var(--in-bg-a)}.tp-colswv_sw:disabled,.tp-p2dpv_p:disabled,.tp-txtv_i:disabled{opacity:0.5}.tp-grlv_g,.tp-sglv_i,.tp-mllv_i{background-color:var(--mo-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--mo-fg);height:var(--bld-us);width:100%}.tp-rotv{--font-family: var(--tp-font-family, Roboto Mono,Source Code Pro,Menlo,Courier,monospace);--bs-br: var(--tp-base-border-radius, 6px);--cnt-h-p: var(--tp-container-horizontal-padding, 4px);--cnt-v-p: var(--tp-container-vertical-padding, 4px);--elm-br: var(--tp-element-border-radius, 2px);--bld-s: var(--tp-blade-spacing, 4px);--bld-us: var(--tp-blade-unit-size, 20px);--bs-bg: var(--tp-base-background-color, #2f3137);--bs-sh: var(--tp-base-shadow-color, rgba(0,0,0,0.2));--btn-bg: var(--tp-button-background-color, #adafb8);--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, #2f3137);--cnt-bg: var(--tp-container-background-color, rgba(187,188,196,0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187,188,196,0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187,188,196,0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187,188,196,0.15));--cnt-fg: var(--tp-container-foreground-color, #bbbcc4);--in-bg: var(--tp-input-background-color, rgba(0,0,0,0.2));--in-bg-a: var(--tp-input-background-color-active, rgba(0,0,0,0.35));--in-bg-f: var(--tp-input-background-color-focus, rgba(0,0,0,0.3));--in-bg-h: var(--tp-input-background-color-hover, rgba(0,0,0,0.25));--in-fg: var(--tp-input-foreground-color, #bbbcc4);--lbl-fg: var(--tp-label-foreground-color, rgba(187,188,196,0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0,0,0,0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187,188,196,0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(0,0,0,0.2))}.tp-fldv_c>.tp-cntv.tp-v-lst,.tp-tabv_c .tp-brkv>.tp-cntv.tp-v-lst,.tp-rotv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1 * var(--cnt-v-p))}.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-fldv_c>*:not(.tp-v-fst),.tp-tabv_c .tp-brkv>*:not(.tp-v-fst),.tp-rotv_c>*:not(.tp-v-fst){margin-top:var(--bld-s)}.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-v-p)}.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-cntv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-v-p)}.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-fldv_c>.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv{margin-left:4px}.tp-fldv_c>.tp-fldv>.tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--elm-br);border-bottom-left-radius:var(--elm-br)}.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-fldv_c .tp-fldv>.tp-fldv_c,.tp-tabv_c .tp-brkv .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--elm-br)}.tp-fldv_c>.tp-tabv>.tp-tabv_i,.tp-tabv_c .tp-brkv>.tp-tabv>.tp-tabv_i{border-top-left-radius:var(--elm-br)}.tp-fldv_c .tp-tabv>.tp-tabv_c,.tp-tabv_c .tp-brkv .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--elm-br)}.tp-fldv_b,.tp-rotv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);overflow:hidden;padding-left:calc(var(--cnt-h-p) + 8px);padding-right:calc(2px * 2 + var(--bld-us) + var(--cnt-h-p));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-fldv_b:hover,.tp-rotv_b:hover{background-color:var(--cnt-bg-h)}.tp-fldv_b:focus,.tp-rotv_b:focus{background-color:var(--cnt-bg-f)}.tp-fldv_b:active,.tp-rotv_b:active{background-color:var(--cnt-bg-a)}.tp-fldv_b:disabled,.tp-rotv_b:disabled{opacity:0.5}.tp-fldv_m,.tp-rotv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:'';display:block;height:6px;right:calc(var(--cnt-h-p) + (var(--bld-us) + 4px - 6px) / 2 - 2px);margin:auto;opacity:0.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m,.tp-rotv.tp-rotv-expanded .tp-rotv_m{transform:none}.tp-fldv_c,.tp-rotv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c,.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c{display:none}.tp-fldv.tp-fldv-expanded>.tp-fldv_c,.tp-rotv.tp-rotv-expanded .tp-rotv_c{opacity:1;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-coltxtv_m,.tp-lstv{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-coltxtv_mm,.tp-lstv_m{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-coltxtv_mm svg,.tp-lstv_m svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-coltxtv_mm svg path,.tp-lstv_m svg path{fill:currentColor}.tp-coltxtv_w,.tp-pndtxtv{display:flex}.tp-coltxtv_c,.tp-pndtxtv_a{width:100%}.tp-coltxtv_c+.tp-coltxtv_c,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-pndtxtv_a{margin-left:2px}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--elm-br);cursor:pointer;display:block;height:var(--bld-us);position:relative;width:var(--bld-us)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:0.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--bld-s);opacity:1}.tp-colv .tp-popv{left:calc(-1 * var(--cnt-h-p));right:calc(-1 * var(--cnt-h-p));top:var(--bld-us)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--bld-s)}.tp-colpv_rgb{display:flex;margin-top:var(--bld-s);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-v-p);padding-top:calc(var(--cnt-v-p) + 2px);position:relative}.tp-colpv_a:before{background-color:var(--grv-fg);content:'';height:2px;left:calc(-1 * var(--cnt-h-p));position:absolute;right:calc(-1 * var(--cnt-h-p));top:0}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--elm-br);outline:none;overflow:hidden;position:relative}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--bld-us) * 4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,0.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0,0,0,0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--elm-br);border:rgba(255,255,255,0.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,0.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative;width:100%}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--elm-br);box-shadow:0 0 2px rgba(0,0,0,0.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--elm-br);border:rgba(255,255,255,0.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--elm-br)}.tp-colswv.tp-v-disabled{opacity:0.5}.tp-colswv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;cursor:pointer;display:block;height:var(--bld-us);left:0;margin:0;outline:none;padding:0;position:absolute;top:0;width:var(--bld-us)}.tp-colswv_b:focus::after{border:rgba(255,255,255,0.75) solid 2px;border-radius:var(--elm-br);bottom:0;content:'';display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--elm-br);color:var(--lbl-fg);cursor:pointer;height:var(--bld-us);line-height:var(--bld-us);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv.tp-fldv-not .tp-fldv_b{display:none}.tp-fldv_c{border-left:var(--cnt-bg) solid 4px}.tp-fldv_b:hover+.tp-fldv_c{border-left-color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_c{border-left-color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_c{border-left-color:var(--cnt-bg-a)}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--bld-us) * 3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left 0.05s, top 0.05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:0.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-h-p);padding-right:var(--cnt-h-p)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:0.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:160px}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding:0 4px}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:0.5}.tp-mllv_i{display:block;height:calc(var(--bld-us) * 3);line-height:var(--bld-us);padding:0 4px;resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:0.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--bld-us);margin-right:4px;position:relative;width:var(--bld-us)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--bld-s);opacity:1}.tp-p2dv .tp-popv{left:calc(-1 * var(--cnt-h-p));right:calc(-1 * var(--cnt-h-p));top:var(--bld-us)}.tp-p2dpv{padding-left:calc(var(--bld-us) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:0.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:0.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:6px;box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:168px;padding:var(--cnt-v-p) var(--cnt-h-p);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sldv.tp-v-disabled{opacity:0.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--bld-us);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:'';display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:'';display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--elm-br);bottom:0;content:'';display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv.tp-v-disabled{opacity:0.5}.tp-tabv_i{align-items:flex-end;display:flex;overflow:hidden}.tp-tabv.tp-tabv-nop .tp-tabv_i{height:calc(var(--bld-us) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_i::before{background-color:var(--cnt-bg);bottom:0;content:'';height:2px;left:0;position:absolute;right:0}.tp-tabv_c{border-left:var(--cnt-bg) solid 4px;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p)}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv::before{background-color:var(--cnt-bg);bottom:0;content:'';height:2px;left:-2px;position:absolute;width:2px}.tp-tbiv_b{background-color:var(--cnt-bg);display:block;padding-left:calc(var(--cnt-h-p) + 4px);padding-right:calc(var(--cnt-h-p) + 4px);width:100%}.tp-tbiv_b:hover{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active{background-color:var(--cnt-bg-a)}.tp-tbiv_b:disabled{opacity:0.5}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);opacity:0.5;overflow:hidden;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-txtv{position:relative}.tp-txtv_i{padding:0 4px}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:0.3}.tp-txtv_k{cursor:pointer;height:100%;left:-3px;position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:'';height:calc(var(--bld-us) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:0.1;position:absolute;top:0;transition:border-radius 0.1s, height 0.1s, transform 0.1s, width 0.1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--elm-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) transparent transparent transparent;border-style:solid;border-width:2px;box-sizing:border-box;content:'';font-size:0.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--font-family);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(2px * 2 + var(--bld-us) + var(--cnt-h-p));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0}.tp-rotv.tp-rotv-not .tp-rotv_b{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c,.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1 * var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1 * var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_i{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}");this.pool_.getAll().forEach(t=>{this.embedPluginStyle_(t)});this.registerPlugin({plugins:[Js,qs,ae,Qs]})}}const no=new e("3.0.5");t.BladeApi=n,t.ButtonApi=d,t.FolderApi=Pt,t.InputBindingApi=bt,t.ListApi=Ws,t.MonitorBindingApi=Mt,t.Pane=eo,t.SeparatorApi=Gt,t.SliderApi=Gs,t.TabApi=ie,t.TabPageApi=ne,t.TextApi=js,t.TpChangeEvent=s,t.VERSION=no,Object.defineProperty(t,"__esModule",{value:true})}(e)}},i={};function fv(t){var e=i[t];if(void 0!==e)return e.exports;e=i[t]={exports:{}};return n[t].call(e.exports,e,e.exports,fv),e.exports}fv.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return fv.d(e,{a:e}),e},fv.d=(t,e)=>{for(var n in e)fv.o(e,n)&&!fv.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},fv.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),fv.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t;fv.g.importScripts&&(t=fv.g.location+"");var e=fv.g.document;if(!t&&e&&((t=e.currentScript?e.currentScript.src:t)||(e=e.getElementsByTagName("script")).length&&(t=e[e.length-1].src)),!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),fv.p=t+"../"})();(()=>{"use strict";const z={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2};const j=0,q=1,X=2;const T=1,A=3,Pt=0,Lt=1,Rt=2;const Y=0,Z=1,K=2,J=3,Q=4,$=5,tt=100,et=101,nt=102,it=103,rt=104,st=200,ot=201,at=202,lt=203,ht=204,ct=205,ut=206,dt=207,pt=208,mt=209,ft=210,vt=0,gt=1,yt=2,xt=3,_t=4,bt=5,wt=6,Mt=7,It=0,M=301,S=302,l=303,h=304,C=306,P=307,O=1e3,zt=1001,V=1002,Nt=1003,U=1004;const H=1005;const W=1006,t=1007;const Bt=1008;const Dt=1009,r=1010,s=1011,G=1012,o=1013,St=1014,Ft=1015,kt=1016,a=1017,c=1018,u=1019,Et=1020,d=1021,Tt=1022,Ot=1023,p=1024,m=1025,i=Ot,At=1026,Ct=1027,f=1028,v=1029,g=1030,y=1031,x=1032,_=1033,b=33776,w=33777,E=33778,L=33779,R=35840,I=35841,N=35842,B=35843,D=36196,F=37492,k=37496,Vt=37808,Ut=37809,Ht=37810,Wt=37811,Gt=37812,jt=37813,qt=37814,Xt=37815,Yt=37816,Zt=37817,Kt=37818,Jt=37819,Qt=37820,$t=37821,te=36492,ee=37840,ne=37841,ie=37842,re=37843,se=37844,oe=37845,ae=37846,le=37847,he=37848,ce=37849,ue=37850,de=37851,pe=37852,me=37853,fe=3e3,ve=3001,n=3201,ge=0,ye=1;const xe="300 es";class e{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e)}hasEventListener(t,e){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[t]&&-1!==n[t].indexOf(e)}removeEventListener(t,e){if(void 0!==this._listeners){const n=this._listeners[t];void 0===n||-1!==(e=n.indexOf(e))&&n.splice(e,1)}}dispatchEvent(n){if(void 0!==this._listeners){const t=this._listeners[n.type];if(void 0!==t){n.target=this;const i=t.slice(0);for(let t=0,e=i.length;t<e;t++)i[t].call(this,n);n.target=null}}}}const _e=[];for(let t=0;t<256;t++)_e[t]=(t<16?"0":"")+t.toString(16);let be=1234567;const we=Math.PI/180,Me=180/Math.PI;function Se(){var t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;const r=_e[255&t]+_e[t>>8&255]+_e[t>>16&255]+_e[t>>24&255]+"-"+_e[255&e]+_e[e>>8&255]+"-"+_e[e>>16&15|64]+_e[e>>24&255]+"-"+_e[63&n|128]+_e[n>>8&255]+"-"+_e[n>>16&255]+_e[n>>24&255]+_e[255&i]+_e[i>>8&255]+_e[i>>16&255]+_e[i>>24&255];return r.toUpperCase()}function Ee(t,e,n){return Math.max(e,Math.min(n,t))}function Te(t,e){return(t%e+e)%e}function Ae(t,e,n){return(1-n)*t+n*e}function Ce(t){return 0==(t&t-1)&&0!==t}function Pe(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function Le(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}var Re=Object.freeze({__proto__:null,DEG2RAD:we,RAD2DEG:Me,generateUUID:Se,clamp:Ee,euclideanModulo:Te,mapLinear:function(t,e,n,i,r){return i+(t-e)*(r-i)/(n-e)},inverseLerp:function(t,e,n){return t!==e?(n-t)/(e-t):0},lerp:Ae,damp:function(t,e,n,i){return Ae(t,e,1-Math.exp(-n*i))},pingpong:function(t,e=1){return e-Math.abs(Te(t,2*e)-e)},smoothstep:function(t,e,n){return t<=e?0:n<=t?1:(t=(t-e)/(n-e))*t*(3-2*t)},smootherstep:function(t,e,n){return t<=e?0:n<=t?1:(t=(t-e)/(n-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},seededRandom:function(t){return void 0!==t&&(be=t%2147483647),be=16807*be%2147483647,(be-1)/2147483646},degToRad:function(t){return t*we},radToDeg:function(t){return t*Me},isPowerOfTwo:Ce,ceilPowerOfTwo:Pe,floorPowerOfTwo:Le,setQuaternionFromProperEuler:function(t,e,n,i,r){const s=Math.cos,o=Math.sin;var a=s(n/2),l=o(n/2),h=s((e+i)/2),c=o((e+i)/2),u=s((e-i)/2),d=o((e-i)/2),p=s((i-e)/2),m=o((i-e)/2);switch(r){case"XYX":t.set(a*c,l*u,l*d,a*h);break;case"YZY":t.set(l*d,a*c,l*u,a*h);break;case"ZXZ":t.set(l*u,l*d,a*c,a*h);break;case"XZX":t.set(a*c,l*m,l*p,a*h);break;case"YXY":t.set(l*p,a*c,l*m,a*h);break;case"ZYZ":t.set(l*m,l*p,a*c,a*h);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}});class Ie{constructor(t=0,e=0){this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){var e=this.x,n=this.y,t=t.elements;return this.x=t[0]*e+t[3]*n+t[6],this.y=t[1]*e+t[4]*n+t[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){var e=this.x-t.x,t=this.y-t.y;return e*e+t*t}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){var n=Math.cos(e),i=Math.sin(e),r=this.x-t.x,e=this.y-t.y;return this.x=r*n-e*i+t.x,this.y=r*i+e*n+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}}Ie.prototype.isVector2=!0;class ze{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],0<arguments.length&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(t,e,n,i,r,s,o,a,l){const h=this.elements;return h[0]=t,h[1]=i,h[2]=o,h[3]=e,h[4]=r,h[5]=a,h[6]=n,h[7]=s,h[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements;t=t.elements;return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],this}extractBasis(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(t){t=t.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){var n=t.elements,i=e.elements;const r=this.elements;var s=n[0],o=n[3],a=n[6],l=n[1],h=n[4],c=n[7],u=n[2],d=n[5],p=n[8],m=i[0],f=i[3],v=i[6],g=i[1],y=i[4],t=i[7],e=i[2],n=i[5],i=i[8];return r[0]=s*m+o*g+a*e,r[3]=s*f+o*y+a*n,r[6]=s*v+o*t+a*i,r[1]=l*m+h*g+c*e,r[4]=l*f+h*y+c*n,r[7]=l*v+h*t+c*i,r[2]=u*m+d*g+p*e,r[5]=u*f+d*y+p*n,r[8]=u*v+d*t+p*i,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){var t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],o=t[5],a=t[6],l=t[7],t=t[8];return e*s*t-e*o*l-n*r*t+n*o*a+i*r*l-i*s*a}invert(){const t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],o=t[5],a=t[6],l=t[7],h=t[8],c=h*s-o*l,u=o*a-h*r,d=l*r-s*a,p=e*c+n*u+i*d;if(0==p)return this.set(0,0,0,0,0,0,0,0,0);var m=1/p;return t[0]=c*m,t[1]=(i*l-h*n)*m,t[2]=(o*n-i*s)*m,t[3]=u*m,t[4]=(h*e-i*a)*m,t[5]=(i*r-o*e)*m,t[6]=d*m,t[7]=(n*a-l*e)*m,t[8]=(s*e-n*r)*m,this}transpose(){var t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){var e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,n,i,r,s,o){var a=Math.cos(r),r=Math.sin(r);return this.set(n*a,n*r,-n*(a*s+r*o)+s+t,-i*r,i*a,-i*(-r*s+a*o)+o+e,0,0,1),this}scale(t,e){const n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=e,n[4]*=e,n[7]*=e,this}rotate(t){var e=Math.cos(t),n=Math.sin(t);const i=this.elements;var r=i[0],s=i[3],o=i[6],a=i[1],l=i[4],t=i[7];return i[0]=e*r+n*a,i[3]=e*s+n*l,i[6]=e*o+n*t,i[1]=-n*r+e*a,i[4]=-n*s+e*l,i[7]=-n*o+e*t,this}translate(t,e){const n=this.elements;return n[0]+=t*n[2],n[3]+=t*n[5],n[6]+=t*n[8],n[1]+=e*n[2],n[4]+=e*n[5],n[7]+=e*n[8],this}equals(t){var e=this.elements,n=t.elements;for(let t=0;t<9;t++)if(e[t]!==n[t])return!1;return!0}fromArray(e,n=0){for(let t=0;t<9;t++)this.elements[t]=e[t+n];return this}toArray(t=[],e=0){var n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}ze.prototype.isMatrix3=!0;let Ne;class Be{static getDataURL(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===Ne&&(Ne=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),Ne.width=t.width,Ne.height=t.height;const n=Ne.getContext("2d");t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0,t.width,t.height),e=Ne}return 2048<e.width||2048<e.height?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}}let De=0;class Fe extends e{constructor(t=Fe.DEFAULT_IMAGE,e=Fe.DEFAULT_MAPPING,n=zt,i=zt,r=W,s=Bt,o=Ot,a=Dt,l=1,h=fe){super(),Object.defineProperty(this,"id",{value:De++}),this.uuid=Se(),this.name="",this.image=t,this.mipmaps=[],this.mapping=e,this.wrapS=n,this.wrapT=i,this.magFilter=r,this.minFilter=s,this.anisotropy=l,this.format=o,this.internalFormat=null,this.type=a,this.offset=new Ie(0,0),this.repeat=new Ie(1,1),this.center=new Ie(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new ze,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=h,this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this}toJSON(t){var e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){const i=this.image;if(void 0===i.uuid&&(i.uuid=Se()),!e&&void 0===t.images[i.uuid]){let n;if(Array.isArray(i)){n=[];for(let t=0,e=i.length;t<e;t++)i[t].isDataTexture?n.push(ke(i[t].image)):n.push(ke(i[t]))}else n=ke(i);t.images[i.uuid]={uuid:i.uuid,url:n}}n.image=i.uuid}return e||(t.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||1<t.x)switch(this.wrapS){case O:t.x=t.x-Math.floor(t.x);break;case zt:t.x=t.x<0?0:1;break;case V:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||1<t.y)switch(this.wrapT){case O:t.y=t.y-Math.floor(t.y);break;case zt:t.y=t.y<0?0:1;break;case V:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&this.version++}}function ke(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?Be.getDataURL(t):t.data?{data:Array.prototype.slice.call(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}Fe.DEFAULT_IMAGE=void 0,Fe.DEFAULT_MAPPING=300,Fe.prototype.isTexture=!0;class Oe{constructor(t=0,e=0,n=0,i=1){this.x=t,this.y=e,this.z=n,this.w=i}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,n,i){return this.x=t,this.y=e,this.z=n,this.w=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){var e=this.x,n=this.y,i=this.z,r=this.w,t=t.elements;return this.x=t[0]*e+t[4]*n+t[8]*i+t[12]*r,this.y=t[1]*e+t[5]*n+t[9]*i+t[13]*r,this.z=t[2]*e+t[6]*n+t[10]*i+t[14]*r,this.w=t[3]*e+t[7]*n+t[11]*i+t[15]*r,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);var e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,n,i,r;var s=t.elements,o=s[0],a=s[4],l=s[8],h=s[1],c=s[5],u=s[9],d=s[2],p=s[6],m=s[10];if(Math.abs(a-h)<.01&&Math.abs(l-d)<.01&&Math.abs(u-p)<.01){if(Math.abs(a+h)<.1&&Math.abs(l+d)<.1&&Math.abs(u+p)<.1&&Math.abs(o+c+m-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;var f=(o+1)/2,v=(c+1)/2,g=(m+1)/2,y=(a+h)/4,t=(l+d)/4,s=(u+p)/4;return v<f&&g<f?r=f<.01?(n=0,i=.707106781):(n=Math.sqrt(f),i=y/n,t/n):g<v?r=v<.01?(n=.707106781,i=0,.707106781):(i=Math.sqrt(v),n=y/i,s/i):g<.01?(n=.707106781,i=.707106781,r=0):(r=Math.sqrt(g),n=t/r,i=s/r),this.set(n,i,r,e),this}let x=Math.sqrt((p-u)*(p-u)+(l-d)*(l-d)+(h-a)*(h-a));return Math.abs(x)<.001&&(x=1),this.x=(p-u)/x,this.y=(l-d)/x,this.z=(h-a)/x,this.w=Math.acos((o+c+m-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this.w=t.w+(e.w-t.w)*n,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}Oe.prototype.isVector4=!0;class Ve extends e{constructor(t,e,n={}){super(),this.width=t,this.height=e,this.depth=1,this.scissor=new Oe(0,0,t,e),this.scissorTest=!1,this.viewport=new Oe(0,0,t,e),this.texture=new Fe(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.isRenderTargetTexture=!0,this.texture.image={width:t,height:e,depth:1},this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.internalFormat=void 0!==n.internalFormat?n.internalFormat:null,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:W,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0!==n.stencilBuffer&&n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null}setTexture(t){t.image={width:this.width,height:this.height,depth:this.depth},this.texture=t}setSize(t,e,n=1){this.width===t&&this.height===e&&this.depth===n||(this.width=t,this.height=e,this.depth=n,this.texture.image.width=t,this.texture.image.height=e,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.texture.image={...this.texture.image},this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}}Ve.prototype.isWebGLRenderTarget=!0;(class extends Ve{});class Ue extends Ve{constructor(t,e,n){super(t,e,n),this.samples=4}copy(t){return super.copy.call(this,t),this.samples=t.samples,this}}Ue.prototype.isWebGLMultisampleRenderTarget=!0;class He{constructor(t=0,e=0,n=0,i=1){this._x=t,this._y=e,this._z=n,this._w=i}static slerp(t,e,n,i){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),n.slerpQuaternions(t,e,i)}static slerpFlat(t,e,n,i,r,s,o){let a=n[i+0],l=n[i+1],h=n[i+2],c=n[i+3];var u=r[s+0],d=r[s+1],p=r[s+2],n=r[s+3];if(0===o)return t[e+0]=a,t[e+1]=l,t[e+2]=h,void(t[e+3]=c);if(1===o)return t[e+0]=u,t[e+1]=d,t[e+2]=p,void(t[e+3]=n);if(c!==n||a!==u||l!==d||h!==p){let t=1-o;i=a*u+l*d+h*p+c*n,r=0<=i?1:-1,s=1-i*i;s>Number.EPSILON&&(s=Math.sqrt(s),i=Math.atan2(s,i*r),t=Math.sin(t*i)/s,o=Math.sin(o*i)/s);r=o*r;a=a*t+u*r,l=l*t+d*r,h=h*t+p*r,c=c*t+n*r,t===1-o&&(o=1/Math.sqrt(a*a+l*l+h*h+c*c),a*=o,l*=o,h*=o,c*=o)}t[e]=a,t[e+1]=l,t[e+2]=h,t[e+3]=c}static multiplyQuaternionsFlat(t,e,n,i,r,s){var o=n[i],a=n[i+1],l=n[i+2],h=n[i+3],c=r[s],n=r[s+1],i=r[s+2],s=r[s+3];return t[e]=o*s+h*c+a*i-l*n,t[e+1]=a*s+h*n+l*c-o*i,t[e+2]=l*s+h*i+o*n-a*c,t[e+3]=h*s-o*c-a*n-l*i,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,n,i){return this._x=t,this._y=e,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var n=t._x,i=t._y,r=t._z,s=t._order;const o=Math.cos,a=Math.sin;var l=o(n/2),h=o(i/2),c=o(r/2),u=a(n/2),d=a(i/2),p=a(r/2);switch(s){case"XYZ":this._x=u*h*c+l*d*p,this._y=l*d*c-u*h*p,this._z=l*h*p+u*d*c,this._w=l*h*c-u*d*p;break;case"YXZ":this._x=u*h*c+l*d*p,this._y=l*d*c-u*h*p,this._z=l*h*p-u*d*c,this._w=l*h*c+u*d*p;break;case"ZXY":this._x=u*h*c-l*d*p,this._y=l*d*c+u*h*p,this._z=l*h*p+u*d*c,this._w=l*h*c-u*d*p;break;case"ZYX":this._x=u*h*c-l*d*p,this._y=l*d*c+u*h*p,this._z=l*h*p-u*d*c,this._w=l*h*c+u*d*p;break;case"YZX":this._x=u*h*c+l*d*p,this._y=l*d*c+u*h*p,this._z=l*h*p-u*d*c,this._w=l*h*c-u*d*p;break;case"XZY":this._x=u*h*c-l*d*p,this._y=l*d*c-u*h*p,this._z=l*h*p+u*d*c,this._w=l*h*c+u*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!1!==e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){var n=e/2,e=Math.sin(n);return this._x=t.x*e,this._y=t.y*e,this._z=t.z*e,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(t){var e,n=t.elements,i=n[0],r=n[4],s=n[8],o=n[1],a=n[5],l=n[9],h=n[2],c=n[6],t=n[10],n=i+a+t;return 0<n?(n=.5/Math.sqrt(n+1),this._w=.25/n,this._x=(c-l)*n,this._y=(s-h)*n,this._z=(o-r)*n):a<i&&t<i?(e=2*Math.sqrt(1+i-a-t),this._w=(c-l)/e,this._x=.25*e,this._y=(r+o)/e,this._z=(s+h)/e):t<a?(e=2*Math.sqrt(1+a-i-t),this._w=(s-h)/e,this._x=(r+o)/e,this._y=.25*e,this._z=(l+c)/e):(a=2*Math.sqrt(1+t-i-a),this._w=(o-r)/a,this._x=(s+h)/a,this._y=(l+c)/a,this._z=.25*a),this._onChangeCallback(),this}setFromUnitVectors(t,e){let n=t.dot(e)+1;return n<Number.EPSILON?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0):(this._x=0,this._y=-t.z,this._z=t.y)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x),this._w=n,this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(Ee(this.dot(t),-1,1)))}rotateTowards(t,e){var n=this.angleTo(t);if(0===n)return this;n=Math.min(1,e/n);return this.slerp(t,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){var t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(this._x=this._x*(t=1/t),this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){var n=t._x,i=t._y,r=t._z,s=t._w,o=e._x,a=e._y,t=e._z,e=e._w;return this._x=n*e+s*o+i*t-r*a,this._y=i*e+s*a+r*o-n*t,this._z=r*e+s*t+n*a-i*o,this._w=s*e-n*o-i*a-r*t,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);var n=this._x,i=this._y,r=this._z,s=this._w;let o=s*t._w+n*t._x+i*t._y+r*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),1<=o)return this._w=s,this._x=n,this._y=i,this._z=r,this;var a=1-o*o;if(a<=Number.EPSILON){var l=1-e;return this._w=l*s+e*this._w,this._x=l*n+e*this._x,this._y=l*i+e*this._y,this._z=l*r+e*this._z,this.normalize(),this._onChangeCallback(),this}t=Math.sqrt(a),l=Math.atan2(t,o),a=Math.sin((1-e)*l)/t,t=Math.sin(e*l)/t;return this._w=s*a+this._w*t,this._x=n*a+this._x*t,this._y=i*a+this._y*t,this._z=r*a+this._z*t,this._onChangeCallback(),this}slerpQuaternions(t,e,n){this.copy(t).slerp(e,n)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}He.prototype.isQuaternion=!0;class We{constructor(t=0,e=0,n=0){this.x=t,this.y=e,this.z=n}set(t,e,n){return void 0===n&&(n=this.z),this.x=t,this.y=e,this.z=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(je.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(je.setFromAxisAngle(t,e))}applyMatrix3(t){var e=this.x,n=this.y,i=this.z,t=t.elements;return this.x=t[0]*e+t[3]*n+t[6]*i,this.y=t[1]*e+t[4]*n+t[7]*i,this.z=t[2]*e+t[5]*n+t[8]*i,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){var e=this.x,n=this.y,i=this.z,r=t.elements,t=1/(r[3]*e+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*e+r[4]*n+r[8]*i+r[12])*t,this.y=(r[1]*e+r[5]*n+r[9]*i+r[13])*t,this.z=(r[2]*e+r[6]*n+r[10]*i+r[14])*t,this}applyQuaternion(t){var e=this.x,n=this.y,i=this.z,r=t.x,s=t.y,o=t.z,a=t.w,l=a*e+s*i-o*n,h=a*n+o*e-r*i,t=a*i+r*n-s*e,i=-r*e-s*n-o*i;return this.x=l*a+i*-r+h*-o-t*-s,this.y=h*a+i*-s+t*-r-l*-o,this.z=t*a+i*-o+l*-s-h*-r,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){var e=this.x,n=this.y,i=this.z,t=t.elements;return this.x=t[0]*e+t[4]*n+t[8]*i,this.y=t[1]*e+t[5]*n+t[9]*i,this.z=t[2]*e+t[6]*n+t[10]*i,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this}cross(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)}crossVectors(t,e){var n=t.x,i=t.y,r=t.z,s=e.x,t=e.y,e=e.z;return this.x=i*e-r*t,this.y=r*s-n*e,this.z=n*t-i*s,this}projectOnVector(t){var e=t.lengthSq();if(0===e)return this.set(0,0,0);e=t.dot(this)/e;return this.copy(t).multiplyScalar(e)}projectOnPlane(t){return Ge.copy(this).projectOnVector(t),this.sub(Ge)}reflect(t){return this.sub(Ge.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){var e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;e=this.dot(t)/e;return Math.acos(Ee(e,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){var e=this.x-t.x,n=this.y-t.y,t=this.z-t.z;return e*e+n*n+t*t}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,n){var i=Math.sin(e)*t;return this.x=i*Math.sin(n),this.y=Math.cos(e)*t,this.z=i*Math.cos(n),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){t=t.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(t){var e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),t=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=t,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}}We.prototype.isVector3=!0;const Ge=new We,je=new He;class qe{constructor(t=new We(1/0,1/0,1/0),e=new We(-1/0,-1/0,-1/0)){this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(n){let i=1/0,r=1/0,s=1/0,o=-1/0,a=-1/0,l=-1/0;for(let t=0,e=n.length;t<e;t+=3){var h=n[t],c=n[t+1],u=n[t+2];h<i&&(i=h),c<r&&(r=c),u<s&&(s=u),h>o&&(o=h),c>a&&(a=c),u>l&&(l=u)}return this.min.set(i,r,s),this.max.set(o,a,l),this}setFromBufferAttribute(n){let i=1/0,r=1/0,s=1/0,o=-1/0,a=-1/0,l=-1/0;for(let t=0,e=n.count;t<e;t++){var h=n.getX(t),c=n.getY(t),u=n.getZ(t);h<i&&(i=h),c<r&&(r=c),u<s&&(s=u),h>o&&(o=h),c>a&&(a=c),u>l&&(l=u)}return this.min.set(i,r,s),this.max.set(o,a,l),this}setFromPoints(n){this.makeEmpty();for(let t=0,e=n.length;t<e;t++)this.expandByPoint(n[t]);return this}setFromCenterAndSize(t,e){e=Ye.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(e),this.max.copy(t).add(e),this}setFromObject(t){return this.makeEmpty(),this.expandByObject(t)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t){t.updateWorldMatrix(!1,!1);const e=t.geometry;void 0!==e&&(null===e.boundingBox&&e.computeBoundingBox(),Ze.copy(e.boundingBox),Ze.applyMatrix4(t.matrixWorld),this.union(Ze));var n=t.children;for(let t=0,e=n.length;t<e;t++)this.expandByObject(n[t]);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,Ye),Ye.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,n;return n=0<t.normal.x?(e=t.normal.x*this.min.x,t.normal.x*this.max.x):(e=t.normal.x*this.max.x,t.normal.x*this.min.x),0<t.normal.y?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),0<t.normal.z?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant}intersectsTriangle(t){return!this.isEmpty()&&(this.getCenter(nn),rn.subVectors(this.max,nn),Ke.subVectors(t.a,nn),Je.subVectors(t.b,nn),Qe.subVectors(t.c,nn),$e.subVectors(Je,Ke),tn.subVectors(Qe,Je),en.subVectors(Ke,Qe),!!an([0,-$e.z,$e.y,0,-tn.z,tn.y,0,-en.z,en.y,$e.z,0,-$e.x,tn.z,0,-tn.x,en.z,0,-en.x,-$e.y,$e.x,0,-tn.y,tn.x,0,-en.y,en.x,0],Ke,Je,Qe,rn)&&(!!an([1,0,0,0,1,0,0,0,1],Ke,Je,Qe,rn)&&(sn.crossVectors($e,tn),an([sn.x,sn.y,sn.z],Ke,Je,Qe,rn))))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){const e=Ye.copy(t).clamp(this.min,this.max);return e.sub(t).length()}getBoundingSphere(t){return this.getCenter(t.center),t.radius=.5*this.getSize(Ye).length(),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(Xe[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Xe[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),Xe[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),Xe[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),Xe[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),Xe[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),Xe[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),Xe[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(Xe)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}qe.prototype.isBox3=!0;const Xe=[new We,new We,new We,new We,new We,new We,new We,new We],Ye=new We,Ze=new qe,Ke=new We,Je=new We,Qe=new We,$e=new We,tn=new We,en=new We,nn=new We,rn=new We,sn=new We,on=new We;function an(n,i,r,s,o){for(let t=0,e=n.length-3;t<=e;t+=3){on.fromArray(n,t);var a=o.x*Math.abs(on.x)+o.y*Math.abs(on.y)+o.z*Math.abs(on.z),l=i.dot(on),h=r.dot(on),c=s.dot(on);if(Math.max(-Math.max(l,h,c),Math.min(l,h,c))>a)return!1}return!0}const ln=new qe,hn=new We,cn=new We,un=new We;class dn{constructor(t=new We,e=-1){this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(n,t){const i=this.center;void 0!==t?i.copy(t):ln.setFromPoints(n).getCenter(i);let r=0;for(let t=0,e=n.length;t<e;t++)r=Math.max(r,i.distanceToSquared(n[t]));return this.radius=Math.sqrt(r),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){var e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){var n=this.center.distanceToSquared(t);return e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?t.makeEmpty():(t.set(this.center,this.center),t.expandByScalar(this.radius)),t}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){un.subVectors(t,this.center);var e=un.lengthSq();return e>this.radius*this.radius&&(e=.5*((t=Math.sqrt(e))-this.radius),this.center.add(un.multiplyScalar(e/t)),this.radius+=e),this}union(t){return cn.subVectors(t.center,this.center).normalize().multiplyScalar(t.radius),this.expandByPoint(hn.copy(t.center).add(cn)),this.expandByPoint(hn.copy(t.center).sub(cn)),this}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const pn=new We,mn=new We,fn=new We,vn=new We,gn=new We,yn=new We,xn=new We;class _n{constructor(t=new We,e=new We(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.direction).multiplyScalar(t).add(this.origin)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,pn)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);t=e.dot(this.direction);return t<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(t).add(this.origin)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){var e=pn.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(pn.copy(this.direction).multiplyScalar(e).add(this.origin),pn.distanceToSquared(t))}distanceSqToSegment(t,e,n,i){mn.copy(t).add(e).multiplyScalar(.5),fn.copy(e).sub(t).normalize(),vn.copy(this.origin).sub(mn);var r=.5*t.distanceTo(e),s=-this.direction.dot(fn),o=vn.dot(this.direction),a=-vn.dot(fn),t=vn.lengthSq(),e=Math.abs(1-s*s);let l,h,c,u;return c=0<e?(l=s*a-o,h=s*o-a,u=r*e,0<=l?h>=-u?h<=u?(e=1/e,l*=e,h*=e,l*(l+s*h+2*o)+h*(s*l+h+2*a)+t):(h=r,l=Math.max(0,-(s*h+o)),-l*l+h*(h+2*a)+t):(h=-r,l=Math.max(0,-(s*h+o)),-l*l+h*(h+2*a)+t):h<=-u?(l=Math.max(0,-(-s*r+o)),h=0<l?-r:Math.min(Math.max(-r,-a),r),-l*l+h*(h+2*a)+t):h<=u?(l=0,h=Math.min(Math.max(-r,-a),r),h*(h+2*a)+t):(l=Math.max(0,-(s*r+o)),h=0<l?r:Math.min(Math.max(-r,-a),r),-l*l+h*(h+2*a)+t)):(h=0<s?-r:r,l=Math.max(0,-(s*h+o)),-l*l+h*(h+2*a)+t),n&&n.copy(this.direction).multiplyScalar(l).add(this.origin),i&&i.copy(fn).multiplyScalar(h).add(mn),c}intersectSphere(t,e){pn.subVectors(t.center,this.origin);var n=pn.dot(this.direction),i=pn.dot(pn)-n*n,t=t.radius*t.radius;if(t<i)return null;t=Math.sqrt(t-i),i=n-t,t=n+t;return i<0&&t<0?null:i<0?this.at(t,e):this.at(i,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){var e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;e=-(this.origin.dot(t.normal)+t.constant)/e;return 0<=e?e:null}intersectPlane(t,e){t=this.distanceToPlane(t);return null===t?null:this.at(t,e)}intersectsPlane(t){var e=t.distanceToPoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let n,i,r,s,o,a;var l=1/this.direction.x,h=1/this.direction.y,c=1/this.direction.z,u=this.origin;return i=0<=l?(n=(t.min.x-u.x)*l,(t.max.x-u.x)*l):(n=(t.max.x-u.x)*l,(t.min.x-u.x)*l),s=0<=h?(r=(t.min.y-u.y)*h,(t.max.y-u.y)*h):(r=(t.max.y-u.y)*h,(t.min.y-u.y)*h),n>s||r>i?null:((r>n||n!=n)&&(n=r),(s<i||i!=i)&&(i=s),a=0<=c?(o=(t.min.z-u.z)*c,(t.max.z-u.z)*c):(o=(t.max.z-u.z)*c,(t.min.z-u.z)*c),n>a||o>i?null:((o>n||n!=n)&&(n=o),(a<i||i!=i)&&(i=a),i<0?null:this.at(0<=n?n:i,e)))}intersectsBox(t){return null!==this.intersectBox(t,pn)}intersectTriangle(t,e,n,i,r){gn.subVectors(e,t),yn.subVectors(n,t),xn.crossVectors(gn,yn);let s=this.direction.dot(xn),o;if(0<s){if(i)return null;o=1}else{if(!(s<0))return null;o=-1,s=-s}vn.subVectors(this.origin,t);i=o*this.direction.dot(yn.crossVectors(vn,yn));if(i<0)return null;t=o*this.direction.dot(gn.cross(vn));if(t<0)return null;if(i+t>s)return null;t=-o*vn.dot(xn);return t<0?null:this.at(t/s,r)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class bn{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],0<arguments.length&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(t,e,n,i,r,s,o,a,l,h,c,u,d,p,m,f){const v=this.elements;return v[0]=t,v[4]=e,v[8]=n,v[12]=i,v[1]=r,v[5]=s,v[9]=o,v[13]=a,v[2]=l,v[6]=h,v[10]=c,v[14]=u,v[3]=d,v[7]=p,v[11]=m,v[15]=f,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new bn).fromArray(this.elements)}copy(t){const e=this.elements;t=t.elements;return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],this}copyPosition(t){const e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this}setFromMatrix3(t){t=t.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements;var n=t.elements,i=1/wn.setFromMatrixColumn(t,0).length(),r=1/wn.setFromMatrixColumn(t,1).length(),t=1/wn.setFromMatrixColumn(t,2).length();return e[0]=n[0]*i,e[1]=n[1]*i,e[2]=n[2]*i,e[3]=0,e[4]=n[4]*r,e[5]=n[5]*r,e[6]=n[6]*r,e[7]=0,e[8]=n[8]*t,e[9]=n[9]*t,e[10]=n[10]*t,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const e=this.elements;var n,i,r,s,o,a,l,h,c,u,d,p=t.x,m=t.y,f=t.z,v=Math.cos(p),g=Math.sin(p),y=Math.cos(m),x=Math.sin(m),p=Math.cos(f),m=Math.sin(f);return"XYZ"===t.order?(n=v*p,r=v*m,i=g*p,f=g*m,e[0]=y*p,e[4]=-y*m,e[8]=x,e[1]=r+i*x,e[5]=n-f*x,e[9]=-g*y,e[2]=f-n*x,e[6]=i+r*x,e[10]=v*y):"YXZ"===t.order?(s=y*p,n=y*m,i=x*p,r=x*m,e[0]=s+r*g,e[4]=i*g-n,e[8]=v*x,e[1]=v*m,e[5]=v*p,e[9]=-g,e[2]=n*g-i,e[6]=r+s*g,e[10]=v*y):"ZXY"===t.order?(l=y*p,s=y*m,o=x*p,a=x*m,e[0]=l-a*g,e[4]=-v*m,e[8]=o+s*g,e[1]=s+o*g,e[5]=v*p,e[9]=a-l*g,e[2]=-v*x,e[6]=g,e[10]=v*y):"ZYX"===t.order?(o=v*p,a=v*m,h=g*p,l=g*m,e[0]=y*p,e[4]=h*x-a,e[8]=o*x+l,e[1]=y*m,e[5]=l*x+o,e[9]=a*x-h,e[2]=-x,e[6]=g*y,e[10]=v*y):"YZX"===t.order?(u=v*y,h=v*x,c=g*y,d=g*x,e[0]=y*p,e[4]=d-u*m,e[8]=c*m+h,e[1]=m,e[5]=v*p,e[9]=-g*p,e[2]=-x*p,e[6]=h*m+c,e[10]=u-d*m):"XZY"===t.order&&(c=v*y,u=v*x,d=g*y,t=g*x,e[0]=y*p,e[4]=-m,e[8]=x*p,e[1]=c*m+t,e[5]=v*p,e[9]=u*m-d,e[2]=d*m-u,e[6]=g*p,e[10]=t*m+c),e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(Sn,t,En)}lookAt(t,e,n){const i=this.elements;return Cn.subVectors(t,e),0===Cn.lengthSq()&&(Cn.z=1),Cn.normalize(),Tn.crossVectors(n,Cn),0===Tn.lengthSq()&&(1===Math.abs(n.z)?Cn.x+=1e-4:Cn.z+=1e-4,Cn.normalize(),Tn.crossVectors(n,Cn)),Tn.normalize(),An.crossVectors(Cn,Tn),i[0]=Tn.x,i[4]=An.x,i[8]=Cn.x,i[1]=Tn.y,i[5]=An.y,i[9]=Cn.y,i[2]=Tn.z,i[6]=An.z,i[10]=Cn.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){var n=t.elements,i=e.elements;const r=this.elements;var s=n[0],o=n[4],a=n[8],l=n[12],h=n[1],c=n[5],u=n[9],d=n[13],p=n[2],m=n[6],f=n[10],v=n[14],g=n[3],y=n[7],x=n[11],_=n[15],b=i[0],w=i[4],M=i[8],S=i[12],E=i[1],T=i[5],A=i[9],C=i[13],P=i[2],L=i[6],R=i[10],I=i[14],t=i[3],e=i[7],n=i[11],i=i[15];return r[0]=s*b+o*E+a*P+l*t,r[4]=s*w+o*T+a*L+l*e,r[8]=s*M+o*A+a*R+l*n,r[12]=s*S+o*C+a*I+l*i,r[1]=h*b+c*E+u*P+d*t,r[5]=h*w+c*T+u*L+d*e,r[9]=h*M+c*A+u*R+d*n,r[13]=h*S+c*C+u*I+d*i,r[2]=p*b+m*E+f*P+v*t,r[6]=p*w+m*T+f*L+v*e,r[10]=p*M+m*A+f*R+v*n,r[14]=p*S+m*C+f*I+v*i,r[3]=g*b+y*E+x*P+_*t,r[7]=g*w+y*T+x*L+_*e,r[11]=g*M+y*A+x*R+_*n,r[15]=g*S+y*C+x*I+_*i,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){var t=this.elements,e=t[0],n=t[4],i=t[8],r=t[12],s=t[1],o=t[5],a=t[9],l=t[13],h=t[2],c=t[6],u=t[10],d=t[14];return t[3]*(+r*a*c-i*l*c-r*o*u+n*l*u+i*o*d-n*a*d)+t[7]*(+e*a*d-e*l*u+r*s*u-i*s*d+i*l*h-r*a*h)+t[11]*(+e*l*c-e*o*d-r*s*c+n*s*d+r*o*h-n*l*h)+t[15]*(-i*o*h-e*a*c+e*o*u+i*s*c-n*s*u+n*a*h)}transpose(){const t=this.elements;var e=t[1];return t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,n){const i=this.elements;return t.isVector3?(i[12]=t.x,i[13]=t.y,i[14]=t.z):(i[12]=t,i[13]=e,i[14]=n),this}invert(){const t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],o=t[5],a=t[6],l=t[7],h=t[8],c=t[9],u=t[10],d=t[11],p=t[12],m=t[13],f=t[14],v=t[15],g=c*f*l-m*u*l+m*a*d-o*f*d-c*a*v+o*u*v,y=p*u*l-h*f*l-p*a*d+s*f*d+h*a*v-s*u*v,x=h*m*l-p*c*l+p*o*d-s*m*d-h*o*v+s*c*v,_=p*c*a-h*m*a-p*o*u+s*m*u+h*o*f-s*c*f;var b=e*g+n*y+i*x+r*_;if(0==b)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);b=1/b;return t[0]=g*b,t[1]=(m*u*r-c*f*r-m*i*d+n*f*d+c*i*v-n*u*v)*b,t[2]=(o*f*r-m*a*r+m*i*l-n*f*l-o*i*v+n*a*v)*b,t[3]=(c*a*r-o*u*r-c*i*l+n*u*l+o*i*d-n*a*d)*b,t[4]=y*b,t[5]=(h*f*r-p*u*r+p*i*d-e*f*d-h*i*v+e*u*v)*b,t[6]=(p*a*r-s*f*r-p*i*l+e*f*l+s*i*v-e*a*v)*b,t[7]=(s*u*r-h*a*r+h*i*l-e*u*l-s*i*d+e*a*d)*b,t[8]=x*b,t[9]=(p*c*r-h*m*r-p*n*d+e*m*d+h*n*v-e*c*v)*b,t[10]=(s*m*r-p*o*r+p*n*l-e*m*l-s*n*v+e*o*v)*b,t[11]=(h*o*r-s*c*r-h*n*l+e*c*l+s*n*d-e*o*d)*b,t[12]=_*b,t[13]=(h*m*i-p*c*i+p*n*u-e*m*u-h*n*f+e*c*f)*b,t[14]=(p*o*i-s*m*i-p*n*a+e*m*a+s*n*f-e*o*f)*b,t[15]=(s*c*i-h*o*i+h*n*a-e*c*a-s*n*u+e*o*u)*b,this}scale(t){const e=this.elements;var n=t.x,i=t.y,t=t.z;return e[0]*=n,e[4]*=i,e[8]*=t,e[1]*=n,e[5]*=i,e[9]*=t,e[2]*=n,e[6]*=i,e[10]*=t,e[3]*=n,e[7]*=i,e[11]*=t,this}getMaxScaleOnAxis(){var t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],t=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,t))}makeTranslation(t,e,n){return this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this}makeRotationX(t){var e=Math.cos(t),t=Math.sin(t);return this.set(1,0,0,0,0,e,-t,0,0,t,e,0,0,0,0,1),this}makeRotationY(t){var e=Math.cos(t),t=Math.sin(t);return this.set(e,0,t,0,0,1,0,0,-t,0,e,0,0,0,0,1),this}makeRotationZ(t){var e=Math.cos(t),t=Math.sin(t);return this.set(e,-t,0,0,t,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){var n=Math.cos(e),i=Math.sin(e),r=1-n,s=t.x,o=t.y,a=t.z,e=r*s,t=r*o;return this.set(e*s+n,e*o-i*a,e*a+i*o,0,e*o+i*a,t*o+n,t*a-i*s,0,e*a-i*o,t*a+i*s,r*a*a+n,0,0,0,0,1),this}makeScale(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this}makeShear(t,e,n,i,r,s){return this.set(1,n,r,0,t,1,s,0,e,i,1,0,0,0,0,1),this}compose(t,e,n){const i=this.elements;var r=e._x,s=e._y,o=e._z,a=e._w,l=r+r,h=s+s,c=o+o,u=r*l,d=r*h,p=r*c,e=s*h,r=s*c,s=o*c,o=a*l,l=a*h,h=a*c,a=n.x,c=n.y,n=n.z;return i[0]=(1-(e+s))*a,i[1]=(d+h)*a,i[2]=(p-l)*a,i[3]=0,i[4]=(d-h)*c,i[5]=(1-(u+s))*c,i[6]=(r+o)*c,i[7]=0,i[8]=(p+l)*n,i[9]=(r-o)*n,i[10]=(1-(u+e))*n,i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1,this}decompose(t,e,n){var i=this.elements;let r=wn.set(i[0],i[1],i[2]).length();var s=wn.set(i[4],i[5],i[6]).length(),o=wn.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),t.x=i[12],t.y=i[13],t.z=i[14],Mn.copy(this);var a=1/r,t=1/s,i=1/o;return Mn.elements[0]*=a,Mn.elements[1]*=a,Mn.elements[2]*=a,Mn.elements[4]*=t,Mn.elements[5]*=t,Mn.elements[6]*=t,Mn.elements[8]*=i,Mn.elements[9]*=i,Mn.elements[10]*=i,e.setFromRotationMatrix(Mn),n.x=r,n.y=s,n.z=o,this}makePerspective(t,e,n,i,r,s){void 0===s&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const o=this.elements;var a=2*r/(n-i),l=(e+t)/(e-t),n=(n+i)/(n-i),i=-(s+r)/(s-r),s=-2*s*r/(s-r);return o[0]=2*r/(e-t),o[4]=0,o[8]=l,o[12]=0,o[1]=0,o[5]=a,o[9]=n,o[13]=0,o[2]=0,o[6]=0,o[10]=i,o[14]=s,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(t,e,n,i,r,s){const o=this.elements;var a=1/(e-t),l=1/(n-i),h=1/(s-r),t=(e+t)*a,i=(n+i)*l,r=(s+r)*h;return o[0]=2*a,o[4]=0,o[8]=0,o[12]=-t,o[1]=0,o[5]=2*l,o[9]=0,o[13]=-i,o[2]=0,o[6]=0,o[10]=-2*h,o[14]=-r,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(t){var e=this.elements,n=t.elements;for(let t=0;t<16;t++)if(e[t]!==n[t])return!1;return!0}fromArray(e,n=0){for(let t=0;t<16;t++)this.elements[t]=e[t+n];return this}toArray(t=[],e=0){var n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}}bn.prototype.isMatrix4=!0;const wn=new We,Mn=new bn,Sn=new We(0,0,0),En=new We(1,1,1),Tn=new We,An=new We,Cn=new We,Pn=new bn,Ln=new He;class Rn{constructor(t=0,e=0,n=0,i=Rn.DefaultOrder){this._x=t,this._y=e,this._z=n,this._order=i}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,n,i=this._order){return this._x=t,this._y=e,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,n=!0){var t=t.elements,i=t[0],r=t[4],s=t[8],o=t[1],a=t[5],l=t[9],h=t[2],c=t[6],u=t[10];switch(e){case"XYZ":this._y=Math.asin(Ee(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-l,u),this._z=Math.atan2(-r,i)):(this._x=Math.atan2(c,a),this._z=0);break;case"YXZ":this._x=Math.asin(-Ee(l,-1,1)),Math.abs(l)<.9999999?(this._y=Math.atan2(s,u),this._z=Math.atan2(o,a)):(this._y=Math.atan2(-h,i),this._z=0);break;case"ZXY":this._x=Math.asin(Ee(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(-h,u),this._z=Math.atan2(-r,a)):(this._y=0,this._z=Math.atan2(o,i));break;case"ZYX":this._y=Math.asin(-Ee(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(c,u),this._z=Math.atan2(o,i)):(this._x=0,this._z=Math.atan2(-r,a));break;case"YZX":this._z=Math.asin(Ee(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-l,a),this._y=Math.atan2(-h,i)):(this._x=0,this._y=Math.atan2(s,u));break;case"XZY":this._z=Math.asin(-Ee(r,-1,1)),Math.abs(r)<.9999999?(this._x=Math.atan2(c,a),this._y=Math.atan2(s,i)):(this._x=Math.atan2(-l,u),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!0===n&&this._onChangeCallback(),this}setFromQuaternion(t,e,n){return Pn.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Pn,e,n)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return Ln.setFromEuler(this),this.setFromQuaternion(Ln,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}toVector3(t){return t?t.set(this._x,this._y,this._z):new We(this._x,this._y,this._z)}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}Rn.prototype.isEuler=!0,Rn.DefaultOrder="XYZ",Rn.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class In{constructor(){this.mask=1}set(t){this.mask=1<<t|0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return 0!=(this.mask&t.mask)}}let zn=0;const Nn=new We,Bn=new He,Dn=new bn,Fn=new We,kn=new We,On=new We,Vn=new He,Un=new We(1,0,0),Hn=new We(0,1,0),Wn=new We(0,0,1),Gn={type:"added"},jn={type:"removed"};class qn extends e{constructor(){super(),Object.defineProperty(this,"id",{value:zn++}),this.uuid=Se(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=qn.DefaultUp.clone();var t=new We;const e=new Rn,n=new He;var i=new We(1,1,1);e._onChange(function(){n.setFromEuler(e,!1)}),n._onChange(function(){e.setFromQuaternion(n,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new bn},normalMatrix:{value:new ze}}),this.matrix=new bn,this.matrixWorld=new bn,this.matrixAutoUpdate=qn.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new In,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return Bn.setFromAxisAngle(t,e),this.quaternion.multiply(Bn),this}rotateOnWorldAxis(t,e){return Bn.setFromAxisAngle(t,e),this.quaternion.premultiply(Bn),this}rotateX(t){return this.rotateOnAxis(Un,t)}rotateY(t){return this.rotateOnAxis(Hn,t)}rotateZ(t){return this.rotateOnAxis(Wn,t)}translateOnAxis(t,e){return Nn.copy(t).applyQuaternion(this.quaternion),this.position.add(Nn.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(Un,t)}translateY(t){return this.translateOnAxis(Hn,t)}translateZ(t){return this.translateOnAxis(Wn,t)}localToWorld(t){return t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return t.applyMatrix4(Dn.copy(this.matrixWorld).invert())}lookAt(t,e,n){t.isVector3?Fn.copy(t):Fn.set(t,e,n);n=this.parent;this.updateWorldMatrix(!0,!1),kn.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Dn.lookAt(kn,Fn,this.up):Dn.lookAt(Fn,kn,this.up),this.quaternion.setFromRotationMatrix(Dn),n&&(Dn.extractRotation(n.matrixWorld),Bn.setFromRotationMatrix(Dn),this.quaternion.premultiply(Bn.invert()))}add(t){if(1<arguments.length){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?console.error("THREE.Object3D.add: object can't be added as a child of itself.",t):t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),(t.parent=this).children.push(t),t.dispatchEvent(Gn)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this}remove(t){if(1<arguments.length){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(jn)),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){const e=this.children[t];e.parent=null,e.dispatchEvent(jn)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),Dn.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),Dn.multiply(t.parent.matrixWorld)),t.applyMatrix4(Dn),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(n,i){if(this[n]===i)return this;for(let t=0,e=this.children.length;t<e;t++){const s=this.children[t];var r=s.getObjectByProperty(n,i);if(void 0!==r)return r}}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(kn,t,On),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(kn,Vn,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);var e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(n){n(this);const i=this.children;for(let t=0,e=i.length;t<e;t++)i[t].traverse(n)}traverseVisible(n){if(!1!==this.visible){n(this);const i=this.children;for(let t=0,e=i.length;t<e;t++)i[t].traverseVisible(n)}}traverseAncestors(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(n){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||n)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),n=!(this.matrixWorldNeedsUpdate=!1));const i=this.children;for(let t=0,e=i.length;t<e;t++)i[t].updateMatrixWorld(n)}updateWorldMatrix(t,e){const n=this.parent;if(!0===t&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e){const i=this.children;for(let t=0,e=i.length;t<e;t++)i[t].updateWorldMatrix(!1,!0)}}toJSON(n){var t,e,i,r,s,o=void 0===n||"string"==typeof n;const a={};o&&(n={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},a.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const l={};function h(t,e){return void 0===t[e.uuid]&&(t[e.uuid]=e.toJSON(n)),e.uuid}if(l.uuid=this.uuid,l.type=this.type,""!==this.name&&(l.name=this.name),!0===this.castShadow&&(l.castShadow=!0),!0===this.receiveShadow&&(l.receiveShadow=!0),!1===this.visible&&(l.visible=!1),!1===this.frustumCulled&&(l.frustumCulled=!1),0!==this.renderOrder&&(l.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(l.userData=this.userData),l.layers=this.layers.mask,l.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(l.matrixAutoUpdate=!1),this.isInstancedMesh&&(l.type="InstancedMesh",l.count=this.count,l.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(l.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?l.background=this.background.toJSON():this.background.isTexture&&(l.background=this.background.toJSON(n).uuid)),this.environment&&this.environment.isTexture&&(l.environment=this.environment.toJSON(n).uuid);else if(this.isMesh||this.isLine||this.isPoints){l.geometry=h(n.geometries,this.geometry);var c=this.geometry.parameters;if(void 0!==c&&void 0!==c.shapes){var u=c.shapes;if(Array.isArray(u))for(let t=0,e=u.length;t<e;t++){var d=u[t];h(n.shapes,d)}else h(n.shapes,u)}}if(this.isSkinnedMesh&&(l.bindMode=this.bindMode,l.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(h(n.skeletons,this.skeleton),l.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const f=[];for(let t=0,e=this.material.length;t<e;t++)f.push(h(n.materials,this.material[t]));l.material=f}else l.material=h(n.materials,this.material);if(0<this.children.length){l.children=[];for(let t=0;t<this.children.length;t++)l.children.push(this.children[t].toJSON(n).object)}if(0<this.animations.length){l.animations=[];for(let t=0;t<this.animations.length;t++){var p=this.animations[t];l.animations.push(h(n.animations,p))}}return o&&(t=m(n.geometries),e=m(n.materials),i=m(n.textures),r=m(n.images),s=m(n.shapes),c=m(n.skeletons),o=m(n.animations),0<t.length&&(a.geometries=t),0<e.length&&(a.materials=e),0<i.length&&(a.textures=i),0<r.length&&(a.images=r),0<s.length&&(a.shapes=s),0<c.length&&(a.skeletons=c),0<o.length&&(a.animations=o)),a.object=l,a;function m(t){const e=[];for(const n in t){const i=t[n];delete i.metadata,e.push(i)}return e}}clone(t){return(new this.constructor).copy(this,t)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let t=0;t<e.children.length;t++){const n=e.children[t];this.add(n.clone())}return this}}qn.DefaultUp=new We(0,1,0),qn.DefaultMatrixAutoUpdate=!0,qn.prototype.isObject3D=!0;const Xn=new We,Yn=new We,Zn=new We,Kn=new We,Jn=new We,Qn=new We,$n=new We,ti=new We,ei=new We,ni=new We;class ii{constructor(t=new We,e=new We,n=new We){this.a=t,this.b=e,this.c=n}static getNormal(t,e,n,i){i.subVectors(n,e),Xn.subVectors(t,e),i.cross(Xn);e=i.lengthSq();return 0<e?i.multiplyScalar(1/Math.sqrt(e)):i.set(0,0,0)}static getBarycoord(t,e,n,i,r){Xn.subVectors(i,e),Yn.subVectors(n,e),Zn.subVectors(t,e);var s=Xn.dot(Xn),o=Xn.dot(Yn),i=Xn.dot(Zn),n=Yn.dot(Yn),t=Yn.dot(Zn),e=s*n-o*o;if(0==e)return r.set(-2,-1,-1);e=1/e,n=(n*i-o*t)*e,e*=s*t-o*i;return r.set(1-n-e,e,n)}static containsPoint(t,e,n,i){return this.getBarycoord(t,e,n,i,Kn),0<=Kn.x&&0<=Kn.y&&Kn.x+Kn.y<=1}static getUV(t,e,n,i,r,s,o,a){return this.getBarycoord(t,e,n,i,Kn),a.set(0,0),a.addScaledVector(r,Kn.x),a.addScaledVector(s,Kn.y),a.addScaledVector(o,Kn.z),a}static isFrontFacing(t,e,n,i){return Xn.subVectors(n,e),Yn.subVectors(t,e),Xn.cross(Yn).dot(i)<0}set(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this}setFromPointsAndIndices(t,e,n,i){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[i]),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return Xn.subVectors(this.c,this.b),Yn.subVectors(this.a,this.b),.5*Xn.cross(Yn).length()}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return ii.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return ii.getBarycoord(t,this.a,this.b,this.c,e)}getUV(t,e,n,i,r){return ii.getUV(t,this.a,this.b,this.c,e,n,i,r)}containsPoint(t){return ii.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return ii.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){var n=this.a,i=this.b,r=this.c;let s,o;Jn.subVectors(i,n),Qn.subVectors(r,n),ti.subVectors(t,n);var a=Jn.dot(ti),l=Qn.dot(ti);if(a<=0&&l<=0)return e.copy(n);ei.subVectors(t,i);var h=Jn.dot(ei),c=Qn.dot(ei);if(0<=h&&c<=h)return e.copy(i);var u=a*c-h*l;if(u<=0&&0<=a&&h<=0)return s=a/(a-h),e.copy(n).addScaledVector(Jn,s);ni.subVectors(t,r);var d=Jn.dot(ni),t=Qn.dot(ni);if(0<=t&&d<=t)return e.copy(r);a=d*l-a*t;if(a<=0&&0<=l&&t<=0)return o=l/(l-t),e.copy(n).addScaledVector(Qn,o);l=h*t-d*c;if(l<=0&&0<=c-h&&0<=d-t)return $n.subVectors(r,i),o=(c-h)/(c-h+(d-t)),e.copy(i).addScaledVector($n,o);l=1/(l+a+u);return s=a*l,o=u*l,e.copy(n).addScaledVector(Jn,s).addScaledVector(Qn,o)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}let ri=0;class si extends e{constructor(){super(),Object.defineProperty(this,"id",{value:ri++}),this.uuid=Se(),this.name="",this.type="Material",this.fog=!0,this.blending=Z,this.side=Pt,this.vertexColors=!1,this.opacity=1,this.format=Ot,this.transparent=!1,this.blendSrc=ht,this.blendDst=ct,this.blendEquation=tt,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=xt,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=7680,this.stencilZFail=7680,this.stencilZPass=7680,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){0<this._alphaTest!=0<t&&this.version++,this._alphaTest=t}onBuild(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(void 0!==t)for(const n in t){var e=t[n];if(void 0!==e)if("shading"!==n){const i=this[n];void 0!==i?i&&i.isColor?i.set(e):i&&i.isVector3&&e&&e.isVector3?i.copy(e):this[n]=e:console.warn("THREE."+this.type+": '"+n+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===e;else console.warn("THREE.Material: '"+n+"' parameter is undefined.")}}toJSON(t){var e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});const n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function i(t){const e=[];for(const n in t){const i=t[n];delete i.metadata,e.push(i)}return e}return n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),this.sheenTint&&this.sheenTint.isColor&&(n.sheenTint=this.sheenTint.getHex()),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularTint&&this.specularTint.isColor&&(n.specularTint=this.specularTint.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(t).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(t).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(t).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(t).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(t).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularTintMap&&this.specularTintMap.isTexture&&(n.specularTintMap=this.specularTintMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(t).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(t).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(t).uuid),void 0!==this.attenuationDistance&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationTint&&(n.attenuationTint=this.attenuationTint.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==Z&&(n.blending=this.blending),this.side!==Pt&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.format!==Ot&&(n.format=this.format),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),0<this.alphaTest&&(n.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(n.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),1<this.wireframeLinewidth&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=this.flatShading),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),e&&(e=i(t.textures),t=i(t.images),0<e.length&&(n.textures=e),0<t.length&&(n.images=t)),n}clone(){return(new this.constructor).copy(this)}copy(t){this.name=t.name,this.fog=t.fog,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.format=t.format,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let n=null;if(null!==e){var i=e.length;n=new Array(i);for(let t=0;t!==i;++t)n[t]=e[t].clone()}return this.clippingPlanes=n,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){!0===t&&this.version++}}si.prototype.isMaterial=!0;const oi={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},ai={h:0,s:0,l:0},li={h:0,s:0,l:0};function hi(t,e,n){return n<0&&(n+=1),1<n&&--n,n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+6*(e-t)*(2/3-n):t}function ci(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function ui(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}class di{constructor(t,e,n){return void 0===e&&void 0===n?this.set(t):this.setRGB(t,e,n)}set(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this}setRGB(t,e,n){return this.r=t,this.g=e,this.b=n,this}setHSL(t,e,n){return t=Te(t,1),e=Ee(e,0,1),n=Ee(n,0,1),0===e?this.r=this.g=this.b=n:(this.r=hi(e=2*n-(n=n<=.5?n*(1+e):n+e-n*e),n,t+1/3),this.g=hi(e,n,t),this.b=hi(e,n,t-1/3)),this}setStyle(e){function n(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let t;var r=i[1],s=i[2];switch(r){case"rgb":case"rgba":if(t=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,n(t[4]),this;if(t=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,n(t[4]),this;break;case"hsl":case"hsla":if(t=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s)){var o=parseFloat(t[1])/360,a=parseInt(t[2],10)/100,l=parseInt(t[3],10)/100;return n(t[4]),this.setHSL(o,a,l)}}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const t=i[1];r=t.length;if(3===r)return this.r=parseInt(t.charAt(0)+t.charAt(0),16)/255,this.g=parseInt(t.charAt(1)+t.charAt(1),16)/255,this.b=parseInt(t.charAt(2)+t.charAt(2),16)/255,this;if(6===r)return this.r=parseInt(t.charAt(0)+t.charAt(1),16)/255,this.g=parseInt(t.charAt(2)+t.charAt(3),16)/255,this.b=parseInt(t.charAt(4)+t.charAt(5),16)/255,this}return e&&0<e.length?this.setColorName(e):this}setColorName(t){var e=oi[t.toLowerCase()];return void 0!==e?this.setHex(e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copyGammaToLinear(t,e=2){return this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this}copyLinearToGamma(t,e=2){e=0<e?1/e:1;return this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this}convertGammaToLinear(t){return this.copyGammaToLinear(this,t),this}convertLinearToGamma(t){return this.copyLinearToGamma(this,t),this}copySRGBToLinear(t){return this.r=ci(t.r),this.g=ci(t.g),this.b=ci(t.b),this}copyLinearToSRGB(t){return this.r=ui(t.r),this.g=ui(t.g),this.b=ui(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(t){var e=this.r,n=this.g,i=this.b,r=Math.max(e,n,i),s=Math.min(e,n,i);let o,a;var l=(s+r)/2;if(s===r)o=0,a=0;else{var h=r-s;switch(a=l<=.5?h/(r+s):h/(2-r-s),r){case e:o=(n-i)/h+(n<i?6:0);break;case n:o=(i-e)/h+2;break;case i:o=(e-n)/h+4}o/=6}return t.h=o,t.s=a,t.l=l,t}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(t,e,n){return this.getHSL(ai),ai.h+=t,ai.s+=e,ai.l+=n,this.setHSL(ai.h,ai.s,ai.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,n){return this.r=t.r+(e.r-t.r)*n,this.g=t.g+(e.g-t.g)*n,this.b=t.b+(e.b-t.b)*n,this}lerpHSL(t,e){this.getHSL(ai),t.getHSL(li);var n=Ae(ai.h,li.h,e),t=Ae(ai.s,li.s,e),e=Ae(ai.l,li.l,e);return this.setHSL(n,t,e),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),!0===t.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}di.NAMES=oi,di.prototype.isColor=!0,di.prototype.r=1,di.prototype.g=1,di.prototype.b=1;class pi extends si{constructor(t){super(),this.type="MeshBasicMaterial",this.color=new di(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this}}pi.prototype.isMeshBasicMaterial=!0;const mi=new We,fi=new Ie;class vi{constructor(t,e,n){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===n,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this}copyAt(n,i,r){n*=this.itemSize,r*=i.itemSize;for(let t=0,e=this.itemSize;t<e;t++)this.array[n+t]=i.array[r+t];return this}copyArray(t){return this.array.set(t),this}copyColorsArray(n){const i=this.array;let r=0;for(let e=0,t=n.length;e<t;e++){let t=n[e];void 0===t&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",e),t=new di),i[r++]=t.r,i[r++]=t.g,i[r++]=t.b}return this}copyVector2sArray(n){const i=this.array;let r=0;for(let e=0,t=n.length;e<t;e++){let t=n[e];void 0===t&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",e),t=new Ie),i[r++]=t.x,i[r++]=t.y}return this}copyVector3sArray(n){const i=this.array;let r=0;for(let e=0,t=n.length;e<t;e++){let t=n[e];void 0===t&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",e),t=new We),i[r++]=t.x,i[r++]=t.y,i[r++]=t.z}return this}copyVector4sArray(n){const i=this.array;let r=0;for(let e=0,t=n.length;e<t;e++){let t=n[e];void 0===t&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",e),t=new Oe),i[r++]=t.x,i[r++]=t.y,i[r++]=t.z,i[r++]=t.w}return this}applyMatrix3(n){if(2===this.itemSize)for(let t=0,e=this.count;t<e;t++)fi.fromBufferAttribute(this,t),fi.applyMatrix3(n),this.setXY(t,fi.x,fi.y);else if(3===this.itemSize)for(let t=0,e=this.count;t<e;t++)mi.fromBufferAttribute(this,t),mi.applyMatrix3(n),this.setXYZ(t,mi.x,mi.y,mi.z);return this}applyMatrix4(n){for(let t=0,e=this.count;t<e;t++)mi.x=this.getX(t),mi.y=this.getY(t),mi.z=this.getZ(t),mi.applyMatrix4(n),this.setXYZ(t,mi.x,mi.y,mi.z);return this}applyNormalMatrix(n){for(let t=0,e=this.count;t<e;t++)mi.x=this.getX(t),mi.y=this.getY(t),mi.z=this.getZ(t),mi.applyNormalMatrix(n),this.setXYZ(t,mi.x,mi.y,mi.z);return this}transformDirection(n){for(let t=0,e=this.count;t<e;t++)mi.x=this.getX(t),mi.y=this.getY(t),mi.z=this.getZ(t),mi.transformDirection(n),this.setXYZ(t,mi.x,mi.y,mi.z);return this}set(t,e=0){return this.array.set(t,e),this}getX(t){return this.array[t*this.itemSize]}setX(t,e){return this.array[t*this.itemSize]=e,this}getY(t){return this.array[t*this.itemSize+1]}setY(t,e){return this.array[t*this.itemSize+1]=e,this}getZ(t){return this.array[t*this.itemSize+2]}setZ(t,e){return this.array[t*this.itemSize+2]=e,this}getW(t){return this.array[t*this.itemSize+3]}setW(t,e){return this.array[t*this.itemSize+3]=e,this}setXY(t,e,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this}setXYZ(t,e,n,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=i,this}setXYZW(t,e,n,i,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=i,this.array[t+3]=r,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return""!==this.name&&(t.name=this.name),35044!==this.usage&&(t.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(t.updateRange=this.updateRange),t}}vi.prototype.isBufferAttribute=!0;(class extends null{});(class extends null{});(class extends null{});(class extends null{});class gi extends vi{constructor(t,e,n){super(new Uint16Array(t),e,n)}}(class extends null{});class yi extends vi{constructor(t,e,n){super(new Uint32Array(t),e,n)}}(class extends vi{});class xi extends vi{constructor(t,e,n){super(new Float32Array(t),e,n)}}(class extends null{});function _i(n){if(0===n.length)return-1/0;let i=n[0];for(let t=1,e=n.length;t<e;++t)n[t]>i&&(i=n[t]);return i}Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;let bi=0;const wi=new bn,Mi=new qn,Si=new We,Ei=new qe,Ti=new qe,Ai=new We;class Ci extends e{constructor(){super(),Object.defineProperty(this,"id",{value:bi++}),this.uuid=Se(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(65535<_i(t)?yi:gi)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return void 0!==this.attributes[t]}addGroup(t,e,n=0){this.groups.push({start:t,count:e,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const n=this.attributes.normal;var i;void 0!==n&&(i=(new ze).getNormalMatrix(t),n.applyNormalMatrix(i),n.needsUpdate=!0);const r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(t),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(t){return wi.makeRotationFromQuaternion(t),this.applyMatrix4(wi),this}rotateX(t){return wi.makeRotationX(t),this.applyMatrix4(wi),this}rotateY(t){return wi.makeRotationY(t),this.applyMatrix4(wi),this}rotateZ(t){return wi.makeRotationZ(t),this.applyMatrix4(wi),this}translate(t,e,n){return wi.makeTranslation(t,e,n),this.applyMatrix4(wi),this}scale(t,e,n){return wi.makeScale(t,e,n),this.applyMatrix4(wi),this}lookAt(t){return Mi.lookAt(t),Mi.updateMatrix(),this.applyMatrix4(Mi.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Si).negate(),this.translate(Si.x,Si.y,Si.z),this}setFromPoints(n){const i=[];for(let t=0,e=n.length;t<e;t++){var r=n[t];i.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new xi(i,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new qe);var t=this.attributes.position,n=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new We(-1/0,-1/0,-1/0),new We(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),n)for(let t=0,e=n.length;t<e;t++){var i=n[t];Ei.setFromBufferAttribute(i),this.morphTargetsRelative?(Ai.addVectors(this.boundingBox.min,Ei.min),this.boundingBox.expandByPoint(Ai),Ai.addVectors(this.boundingBox.max,Ei.max),this.boundingBox.expandByPoint(Ai)):(this.boundingBox.expandByPoint(Ei.min),this.boundingBox.expandByPoint(Ei.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new dn);var i=this.attributes.position,r=this.morphAttributes.position;if(i&&i.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new We,1/0);if(i){const l=this.boundingSphere.center;if(Ei.setFromBufferAttribute(i),r)for(let t=0,e=r.length;t<e;t++){var s=r[t];Ti.setFromBufferAttribute(s),this.morphTargetsRelative?(Ai.addVectors(Ei.min,Ti.min),Ei.expandByPoint(Ai),Ai.addVectors(Ei.max,Ti.max),Ei.expandByPoint(Ai)):(Ei.expandByPoint(Ti.min),Ei.expandByPoint(Ti.max))}Ei.getCenter(l);let n=0;for(let t=0,e=i.count;t<e;t++)Ai.fromBufferAttribute(i,t),n=Math.max(n,l.distanceToSquared(Ai));if(r)for(let t=0,e=r.length;t<e;t++){var o=r[t],a=this.morphTargetsRelative;for(let t=0,e=o.count;t<e;t++)Ai.fromBufferAttribute(o,t),a&&(Si.fromBufferAttribute(i,t),Ai.add(Si)),n=Math.max(n,l.distanceToSquared(Ai))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){var t=this.index,e=this.attributes;if(null!==t&&void 0!==e.position&&void 0!==e.normal&&void 0!==e.uv){var i=t.array;const c=e.position.array,u=e.normal.array,d=e.uv.array;var r=c.length/3;void 0===e.tangent&&this.setAttribute("tangent",new vi(new Float32Array(4*r),4));const p=e.tangent.array,m=[],f=[];for(let t=0;t<r;t++)m[t]=new We,f[t]=new We;const v=new We,g=new We,y=new We,x=new Ie,_=new Ie,b=new Ie,w=new We,M=new We;let n=this.groups;0===n.length&&(n=[{start:0,count:i.length}]);for(let t=0,e=n.length;t<e;++t){var s=n[t],o=s.start;for(let t=o,e=o+s.count;t<e;t+=3)!function(t,e,n){v.fromArray(c,3*t),g.fromArray(c,3*e),y.fromArray(c,3*n),x.fromArray(d,2*t),_.fromArray(d,2*e),b.fromArray(d,2*n),g.sub(v),y.sub(v),_.sub(x),b.sub(x);var i=1/(_.x*b.y-b.x*_.y);isFinite(i)&&(w.copy(g).multiplyScalar(b.y).addScaledVector(y,-_.y).multiplyScalar(i),M.copy(y).multiplyScalar(_.x).addScaledVector(g,-b.x).multiplyScalar(i),m[t].add(w),m[e].add(w),m[n].add(w),f[t].add(M),f[e].add(M),f[n].add(M))}(i[t+0],i[t+1],i[t+2])}const S=new We,E=new We,T=new We,A=new We;for(let t=0,e=n.length;t<e;++t){var a=n[t],l=a.start;for(let t=l,e=l+a.count;t<e;t+=3)h(i[t+0]),h(i[t+1]),h(i[t+2])}function h(t){T.fromArray(u,3*t),A.copy(T);var e=m[t];S.copy(e),S.sub(T.multiplyScalar(T.dot(e))).normalize(),E.crossVectors(A,e);e=E.dot(f[t])<0?-1:1;p[4*t]=S.x,p[4*t+1]=S.y,p[4*t+2]=S.z,p[4*t+3]=e}}else console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)")}computeVertexNormals(){const i=this.index;var r=this.getAttribute("position");if(void 0!==r){let n=this.getAttribute("normal");if(void 0===n)n=new vi(new Float32Array(3*r.count),3),this.setAttribute("normal",n);else for(let t=0,e=n.count;t<e;t++)n.setXYZ(t,0,0,0);const l=new We,h=new We,c=new We,u=new We,d=new We,p=new We,m=new We,f=new We;if(i)for(let t=0,e=i.count;t<e;t+=3){var s=i.getX(t+0),o=i.getX(t+1),a=i.getX(t+2);l.fromBufferAttribute(r,s),h.fromBufferAttribute(r,o),c.fromBufferAttribute(r,a),m.subVectors(c,h),f.subVectors(l,h),m.cross(f),u.fromBufferAttribute(n,s),d.fromBufferAttribute(n,o),p.fromBufferAttribute(n,a),u.add(m),d.add(m),p.add(m),n.setXYZ(s,u.x,u.y,u.z),n.setXYZ(o,d.x,d.y,d.z),n.setXYZ(a,p.x,p.y,p.z)}else for(let t=0,e=r.count;t<e;t+=3)l.fromBufferAttribute(r,t+0),h.fromBufferAttribute(r,t+1),c.fromBufferAttribute(r,t+2),m.subVectors(c,h),f.subVectors(l,h),m.cross(f),n.setXYZ(t+0,m.x,m.y,m.z),n.setXYZ(t+1,m.x,m.y,m.z),n.setXYZ(t+2,m.x,m.y,m.z);this.normalizeNormals(),n.needsUpdate=!0}}merge(t,e){if(t&&t.isBufferGeometry){void 0===e&&(e=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var n=this.attributes;for(const o in n)if(void 0!==t.attributes[o]){const a=n[o].array;var i=t.attributes[o],r=i.array,i=i.itemSize*e,s=Math.min(r.length,a.length-i);for(let t=0,e=i;t<s;t++,e++)a[e]=r[t]}return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t)}normalizeNormals(){const n=this.attributes.normal;for(let t=0,e=n.count;t<e;t++)Ai.fromBufferAttribute(n,t),Ai.normalize(),n.setXYZ(t,Ai.x,Ai.y,Ai.z)}toNonIndexed(){function n(n,i){const r=n.array;var s=n.itemSize,t=n.normalized;const o=new r.constructor(i.length*s);let a=0,l=0;for(let t=0,e=i.length;t<e;t++){a=n.isInterleavedBufferAttribute?i[t]*n.data.stride+n.offset:i[t]*s;for(let t=0;t<s;t++)o[l++]=r[a++]}return new vi(o,s,t)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const i=new Ci;var r=this.index.array,t=this.attributes;for(const c in t){var e=n(t[c],r);i.setAttribute(c,e)}var s=this.morphAttributes;for(const u in s){const d=[];var o=s[u];for(let t=0,e=o.length;t<e;t++){var a=n(o[t],r);d.push(a)}i.morphAttributes[u]=d}i.morphTargetsRelative=this.morphTargetsRelative;var l=this.groups;for(let t=0,e=l.length;t<e;t++){var h=l[t];i.addGroup(h.start,h.count,h.materialIndex)}return i}toJSON(){const n={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),0<Object.keys(this.userData).length&&(n.userData=this.userData),void 0!==this.parameters){var t=this.parameters;for(const l in t)void 0!==t[l]&&(n[l]=t[l]);return n}n.data={attributes:{}};var e=this.index;null!==e&&(n.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});var i=this.attributes;for(const h in i){const c=i[h];n.data.attributes[h]=c.toJSON(n.data)}const r={};let s=!1;for(const u in this.morphAttributes){var o=this.morphAttributes[u];const d=[];for(let t=0,e=o.length;t<e;t++){const p=o[t];d.push(p.toJSON(n.data))}0<d.length&&(r[u]=d,s=!0)}s&&(n.data.morphAttributes=r,n.data.morphTargetsRelative=this.morphTargetsRelative);e=this.groups;0<e.length&&(n.data.groups=JSON.parse(JSON.stringify(e)));const a=this.boundingSphere;return null!==a&&(n.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),n}clone(){return(new Ci).copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;var n={};this.name=t.name;const e=t.index;null!==e&&this.setIndex(e.clone(n));var i=t.attributes;for(const h in i){const c=i[h];this.setAttribute(h,c.clone(n))}var r=t.morphAttributes;for(const u in r){const d=[],p=r[u];for(let t=0,e=p.length;t<e;t++)d.push(p[t].clone(n));this.morphAttributes[u]=d}this.morphTargetsRelative=t.morphTargetsRelative;var s=t.groups;for(let t=0,e=s.length;t<e;t++){var o=s[t];this.addGroup(o.start,o.count,o.materialIndex)}const a=t.boundingBox;null!==a&&(this.boundingBox=a.clone());const l=t.boundingSphere;return null!==l&&(this.boundingSphere=l.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}Ci.prototype.isBufferGeometry=!0;const Pi=new bn,Li=new _n,Ri=new dn,Ii=new We,zi=new We,Ni=new We,Bi=new We,Di=new We,Fi=new We,ki=new We,Oi=new We,Vi=new We,Ui=new Ie,Hi=new Ie,Wi=new Ie,Gi=new We,ji=new We;class qi extends qn{constructor(t=new Ci,e=new pi){super(),this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this}updateMorphTargets(){var t=this.geometry;if(t.isBufferGeometry){var e=t.morphAttributes,n=Object.keys(e);if(0<n.length){var i=e[n[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=i.length;t<e;t++){var r=i[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=t}}}}else{t=t.morphTargets;void 0!==t&&0<t.length&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(i,r){const t=this.geometry;var s=this.material,e=this.matrixWorld;if(void 0!==s&&(null===t.boundingSphere&&t.computeBoundingSphere(),Ri.copy(t.boundingSphere),Ri.applyMatrix4(e),!1!==i.ray.intersectsSphere(Ri)&&(Pi.copy(e).invert(),Li.copy(i.ray).applyMatrix4(Pi),null===t.boundingBox||!1!==Li.intersectsBox(t.boundingBox)))){let n;if(t.isBufferGeometry){const P=t.index;var o=t.attributes.position,a=t.morphAttributes.position,l=t.morphTargetsRelative,h=t.attributes.uv,c=t.attributes.uv2,u=t.groups,d=t.drawRange;if(null!==P)if(Array.isArray(s))for(let t=0,e=u.length;t<e;t++){var p=u[t],m=s[p.materialIndex];for(let t=Math.max(p.start,d.start),e=Math.min(p.start+p.count,d.start+d.count);t<e;t+=3){var f=P.getX(t),v=P.getX(t+1),g=P.getX(t+2);n=Xi(this,m,i,Li,o,a,l,h,c,f,v,g),n&&(n.faceIndex=Math.floor(t/3),n.face.materialIndex=p.materialIndex,r.push(n))}}else for(let t=Math.max(0,d.start),e=Math.min(P.count,d.start+d.count);t<e;t+=3){var y=P.getX(t),x=P.getX(t+1),_=P.getX(t+2);n=Xi(this,s,i,Li,o,a,l,h,c,y,x,_),n&&(n.faceIndex=Math.floor(t/3),r.push(n))}else if(void 0!==o)if(Array.isArray(s))for(let t=0,e=u.length;t<e;t++){var b=u[t],w=s[b.materialIndex];for(let t=Math.max(b.start,d.start),e=Math.min(b.start+b.count,d.start+d.count);t<e;t+=3){var M=t,S=t+1,E=t+2;n=Xi(this,w,i,Li,o,a,l,h,c,M,S,E),n&&(n.faceIndex=Math.floor(t/3),n.face.materialIndex=b.materialIndex,r.push(n))}}else for(let t=Math.max(0,d.start),e=Math.min(o.count,d.start+d.count);t<e;t+=3){var T=t,A=t+1,C=t+2;n=Xi(this,s,i,Li,o,a,l,h,c,T,A,C),n&&(n.faceIndex=Math.floor(t/3),r.push(n))}}else t.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}}function Xi(t,e,n,i,r,s,o,a,l,h,c,u){Ii.fromBufferAttribute(r,h),zi.fromBufferAttribute(r,c),Ni.fromBufferAttribute(r,u);var d=t.morphTargetInfluences;if(s&&d){ki.set(0,0,0),Oi.set(0,0,0),Vi.set(0,0,0);for(let t=0,e=s.length;t<e;t++){var p=d[t],m=s[t];0!==p&&(Bi.fromBufferAttribute(m,h),Di.fromBufferAttribute(m,c),Fi.fromBufferAttribute(m,u),o?(ki.addScaledVector(Bi,p),Oi.addScaledVector(Di,p),Vi.addScaledVector(Fi,p)):(ki.addScaledVector(Bi.sub(Ii),p),Oi.addScaledVector(Di.sub(zi),p),Vi.addScaledVector(Fi.sub(Ni),p)))}Ii.add(ki),zi.add(Oi),Ni.add(Vi)}t.isSkinnedMesh&&(t.boneTransform(h,Ii),t.boneTransform(c,zi),t.boneTransform(u,Ni));const f=function(t,e,n,i,r,s,o,a){let l;return l=e.side===Lt?i.intersectTriangle(o,s,r,!0,a):i.intersectTriangle(r,s,o,e.side!==Rt,a),null===l?null:(ji.copy(a),ji.applyMatrix4(t.matrixWorld),(a=n.ray.origin.distanceTo(ji))<n.near||a>n.far?null:{distance:a,point:ji.clone(),object:t})}(t,e,n,i,Ii,zi,Ni,Gi);return f&&(a&&(Ui.fromBufferAttribute(a,h),Hi.fromBufferAttribute(a,c),Wi.fromBufferAttribute(a,u),f.uv=ii.getUV(Gi,Ii,zi,Ni,Ui,Hi,Wi,new Ie)),l&&(Ui.fromBufferAttribute(l,h),Hi.fromBufferAttribute(l,c),Wi.fromBufferAttribute(l,u),f.uv2=ii.getUV(Gi,Ii,zi,Ni,Ui,Hi,Wi,new Ie)),l={a:h,b:c,c:u,normal:new We,materialIndex:0},ii.getNormal(Ii,zi,Ni,l.normal),f.face=l),f}qi.prototype.isMesh=!0;class Yi extends Ci{constructor(t=1,e=1,n=1,i=1,r=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:n,widthSegments:i,heightSegments:r,depthSegments:s};const A=this;i=Math.floor(i),r=Math.floor(r),s=Math.floor(s);const C=[],P=[],L=[],R=[];let I=0,z=0;function o(n,i,r,s,o,t,e,a,l,h,c){var u=t/l,d=e/h,p=t/2,m=e/2,f=a/2,v=l+1,g=h+1;let y=0,x=0;const _=new We;for(let e=0;e<g;e++){var b=e*d-m;for(let t=0;t<v;t++){var w=t*u-p;_[n]=w*s,_[i]=b*o,_[r]=f,P.push(_.x,_.y,_.z),_[n]=0,_[i]=0,_[r]=0<a?1:-1,L.push(_.x,_.y,_.z),R.push(t/l),R.push(1-e/h),y+=1}}for(let e=0;e<h;e++)for(let t=0;t<l;t++){var M=I+t+v*e,S=I+t+v*(e+1),E=I+(t+1)+v*(e+1),T=I+(t+1)+v*e;C.push(M,S,T),C.push(S,E,T),x+=6}A.addGroup(z,x,c),z+=x,I+=y}o("z","y","x",-1,-1,n,e,t,s,r,0),o("z","y","x",1,-1,n,e,-t,s,r,1),o("x","z","y",1,1,t,n,e,i,s,2),o("x","z","y",1,-1,t,n,-e,i,s,3),o("x","y","z",1,-1,t,e,n,i,r,4),o("x","y","z",-1,-1,t,e,-n,i,r,5),this.setIndex(C),this.setAttribute("position",new xi(P,3)),this.setAttribute("normal",new xi(L,3)),this.setAttribute("uv",new xi(R,2))}static fromJSON(t){return new Yi(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function Zi(t){const e={};for(const n in t){e[n]={};for(const i in t[n]){const r=t[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?e[n][i]=r.clone():Array.isArray(r)?e[n][i]=r.slice():e[n][i]=r}}return e}function Ki(e){const n={};for(let t=0;t<e.length;t++){var i=Zi(e[t]);for(const r in i)n[r]=i[r]}return n}const Ji={clone:Zi,merge:Ki};class Qi extends si{constructor(t){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==t&&(void 0!==t.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=Zi(t.uniforms),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const i in this.uniforms){const r=this.uniforms[i].value;r&&r.isTexture?e.uniforms[i]={type:"t",value:r.toJSON(t).uuid}:r&&r.isColor?e.uniforms[i]={type:"c",value:r.getHex()}:r&&r.isVector2?e.uniforms[i]={type:"v2",value:r.toArray()}:r&&r.isVector3?e.uniforms[i]={type:"v3",value:r.toArray()}:r&&r.isVector4?e.uniforms[i]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?e.uniforms[i]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?e.uniforms[i]={type:"m4",value:r.toArray()}:e.uniforms[i]={value:r}}0<Object.keys(this.defines).length&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;const n={};for(const s in this.extensions)!0===this.extensions[s]&&(n[s]=!0);return 0<Object.keys(n).length&&(e.extensions=n),e}}Qi.prototype.isShaderMaterial=!0;class $i extends qn{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new bn,this.projectionMatrix=new bn,this.projectionMatrixInverse=new bn}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this}getWorldDirection(t){this.updateWorldMatrix(!0,!1);var e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}$i.prototype.isCamera=!0;class tr extends $i{constructor(t=50,e=1,n=.1,i=2e3){super(),this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){t=.5*this.getFilmHeight()/t;this.fov=2*Me*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){var t=Math.tan(.5*we*this.fov);return.5*this.getFilmHeight()/t}getEffectiveFOV(){return 2*Me*Math.atan(Math.tan(.5*we*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(t,e,n,i,r,s){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){var t=this.near;let e=t*Math.tan(.5*we*this.fov)/this.zoom,n=2*e,i=this.aspect*n,r=-.5*i;var s,o=this.view;null!==this.view&&this.view.enabled&&(s=o.fullWidth,a=o.fullHeight,r+=o.offsetX*i/s,e-=o.offsetY*n/a,i*=o.width/s,n*=o.height/a);var a=this.filmOffset;0!==a&&(r+=t*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,e,e-n,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}tr.prototype.isPerspectiveCamera=!0;class er extends qn{constructor(t,e,n){if(super(),this.type="CubeCamera",!0===n.isWebGLCubeRenderTarget){this.renderTarget=n;const i=new tr(90,1,t,e);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new We(1,0,0)),this.add(i);const r=new tr(90,1,t,e);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new We(-1,0,0)),this.add(r);const s=new tr(90,1,t,e);s.layers=this.layers,s.up.set(0,0,1),s.lookAt(new We(0,1,0)),this.add(s);const o=new tr(90,1,t,e);o.layers=this.layers,o.up.set(0,0,-1),o.lookAt(new We(0,-1,0)),this.add(o);const a=new tr(90,1,t,e);a.layers=this.layers,a.up.set(0,-1,0),a.lookAt(new We(0,0,1)),this.add(a);const l=new tr(90,1,t,e);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new We(0,0,-1)),this.add(l)}else console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.")}update(t,e){null===this.parent&&this.updateMatrixWorld();const n=this.renderTarget;var[i,r,s,o,a,l]=this.children,h=t.xr.enabled,c=t.getRenderTarget();t.xr.enabled=!1;var u=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,t.setRenderTarget(n,0),t.render(e,i),t.setRenderTarget(n,1),t.render(e,r),t.setRenderTarget(n,2),t.render(e,s),t.setRenderTarget(n,3),t.render(e,o),t.setRenderTarget(n,4),t.render(e,a),n.texture.generateMipmaps=u,t.setRenderTarget(n,5),t.render(e,l),t.setRenderTarget(c),t.xr.enabled=h}}class nr extends Fe{constructor(t,e,n,i,r,s,o,a,l,h){super(t=void 0!==t?t:[],e=void 0!==e?e:M,n,i,r,s,o=void 0!==o?o:Tt,a,l,h),this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}nr.prototype.isCubeTexture=!0;class ir extends Ve{constructor(t,e,n){Number.isInteger(e)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),e=n),super(t,t,e),e=e||{},this.texture=new nr(void 0,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==e.generateMipmaps&&e.generateMipmaps,this.texture.minFilter=void 0!==e.minFilter?e.minFilter:W,this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.format=Ot,this.texture.encoding=e.encoding,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;var n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},i=new Yi(5,5,5);const r=new Qi({name:"CubemapFromEquirect",uniforms:Zi(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:Lt,blending:Y});r.uniforms.tEquirect.value=e;const s=new qi(i,r);i=e.minFilter;e.minFilter===Bt&&(e.minFilter=W);const o=new er(1,10,this);return o.update(t,s),e.minFilter=i,s.geometry.dispose(),s.material.dispose(),this}clear(e,n,i,r){var t=e.getRenderTarget();for(let t=0;t<6;t++)e.setRenderTarget(this,t),e.clear(n,i,r);e.setRenderTarget(t)}}ir.prototype.isWebGLCubeRenderTarget=!0;const rr=new We,sr=new We,or=new ze;class ar{constructor(t=new We(1,0,0),e=0){this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,n,i){return this.normal.set(t,e,n),this.constant=i,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,n){e=rr.subVectors(n,e).cross(sr.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(e,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}intersectLine(t,e){var n=t.delta(rr),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(t.start)?e.copy(t.start):null;i=-(t.start.dot(this.normal)+this.constant)/i;return i<0||1<i?null:e.copy(n).multiplyScalar(i).add(t.start)}intersectsLine(t){var e=this.distanceToPoint(t.start),t=this.distanceToPoint(t.end);return e<0&&0<t||t<0&&0<e}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){e=e||or.getNormalMatrix(t);const n=this.coplanarPoint(rr).applyMatrix4(t);e=this.normal.applyMatrix3(e).normalize();return this.constant=-n.dot(e),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return(new this.constructor).copy(this)}}ar.prototype.isPlane=!0;const lr=new dn,hr=new We;class cr{constructor(t=new ar,e=new ar,n=new ar,i=new ar,r=new ar,s=new ar){this.planes=[t,e,n,i,r,s]}set(t,e,n,i,r,s){const o=this.planes;return o[0].copy(t),o[1].copy(e),o[2].copy(n),o[3].copy(i),o[4].copy(r),o[5].copy(s),this}copy(e){const n=this.planes;for(let t=0;t<6;t++)n[t].copy(e.planes[t]);return this}setFromProjectionMatrix(t){const e=this.planes;var n=t.elements,i=n[0],r=n[1],s=n[2],o=n[3],a=n[4],l=n[5],h=n[6],c=n[7],u=n[8],d=n[9],p=n[10],m=n[11],f=n[12],v=n[13],t=n[14],n=n[15];return e[0].setComponents(o-i,c-a,m-u,n-f).normalize(),e[1].setComponents(o+i,c+a,m+u,n+f).normalize(),e[2].setComponents(o+r,c+l,m+d,n+v).normalize(),e[3].setComponents(o-r,c-l,m-d,n-v).normalize(),e[4].setComponents(o-s,c-h,m-p,n-t).normalize(),e[5].setComponents(o+s,c+h,m+p,n+t).normalize(),this}intersectsObject(t){const e=t.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),lr.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(lr)}intersectsSprite(t){return lr.center.set(0,0,0),lr.radius=.7071067811865476,lr.applyMatrix4(t.matrixWorld),this.intersectsSphere(lr)}intersectsSphere(t){const e=this.planes;var n=t.center,i=-t.radius;for(let t=0;t<6;t++)if(e[t].distanceToPoint(n)<i)return!1;return!0}intersectsBox(e){var n=this.planes;for(let t=0;t<6;t++){const i=n[t];if(hr.x=(0<i.normal.x?e.max:e.min).x,hr.y=(0<i.normal.y?e.max:e.min).y,hr.z=(0<i.normal.z?e.max:e.min).z,i.distanceToPoint(hr)<0)return!1}return!0}containsPoint(e){const n=this.planes;for(let t=0;t<6;t++)if(n[t].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function ur(){let n=null,t=!1,i=null,r=null;function s(t,e){i(t,e),r=n.requestAnimationFrame(s)}return{start:function(){!0!==t&&null!==i&&(r=n.requestAnimationFrame(s),t=!0)},stop:function(){n.cancelAnimationFrame(r),t=!1},setAnimationLoop:function(t){i=t},setContext:function(t){n=t}}}function dr(o,t){const a=t.isWebGL2,r=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),r.get(t)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);var e=r.get(t);e&&(o.deleteBuffer(e.buffer),r.delete(t))},update:function(t,e){if(t.isGLBufferAttribute){var n=r.get(t);(!n||n.version<t.version)&&r.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version})}else{t.isInterleavedBufferAttribute&&(t=t.data);const i=r.get(t);void 0===i?r.set(t,function(t,e){var n=t.array,i=t.usage,r=o.createBuffer();o.bindBuffer(e,r),o.bufferData(e,n,i),t.onUploadCallback();let s=5126;return n instanceof Float32Array?s=5126:n instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):n instanceof Uint16Array?t.isFloat16BufferAttribute?a?s=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):s=5123:n instanceof Int16Array?s=5122:n instanceof Uint32Array?s=5125:n instanceof Int32Array?s=5124:n instanceof Int8Array?s=5120:(n instanceof Uint8Array||n instanceof Uint8ClampedArray)&&(s=5121),{buffer:r,type:s,bytesPerElement:n.BYTES_PER_ELEMENT,version:t.version}}(t,e)):i.version<t.version&&(function(t,e,n){const i=e.array,r=e.updateRange;o.bindBuffer(n,t),-1===r.count?o.bufferSubData(n,0,i):(a?o.bufferSubData(n,r.offset*i.BYTES_PER_ELEMENT,i,r.offset,r.count):o.bufferSubData(n,r.offset*i.BYTES_PER_ELEMENT,i.subarray(r.offset,r.offset+r.count)),r.count=-1)}(i.buffer,t,e),i.version=t.version)}}}}class pr extends Ci{constructor(t=1,e=1,n=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:i};var r=t/2,s=e/2,o=Math.floor(n),a=Math.floor(i),l=o+1,h=a+1,c=t/o,u=e/a;const d=[],p=[],m=[],f=[];for(let e=0;e<h;e++){var v=e*u-s;for(let t=0;t<l;t++){var g=t*c-r;p.push(g,-v,0),m.push(0,0,1),f.push(t/o),f.push(1-e/a)}}for(let e=0;e<a;e++)for(let t=0;t<o;t++){var y=t+l*e,x=t+l*(e+1),_=t+1+l*(e+1),b=t+1+l*e;d.push(y,x,b),d.push(x,_,b)}this.setIndex(d),this.setAttribute("position",new xi(p,3)),this.setAttribute("normal",new xi(m,3)),this.setAttribute("uv",new xi(f,2))}static fromJSON(t){return new pr(t.width,t.height,t.widthSegments,t.heightSegments)}}const mr={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotVH = saturate( dot( geometry.viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float NoH ) {\n\tfloat invAlpha = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float NoV, float NoL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( NoL + NoV - NoL * NoV ) ) );\n}\nvec3 BRDF_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n\t\tvec2 f = fract( uv );\n\t\tuv += 0.5 - f;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t}\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\t\tuv *= texelSize;\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x += texelSize;\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.y += texelSize;\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x -= texelSize;\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tvec3 tm = mix( tl, tr, f.x );\n\t\tvec3 bm = mix( bl, br, f.x );\n\t\treturn mix( tm, bm, f.y );\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value ) {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getIBLIrradiance( const in GeometricContext geometry ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec;\n\t\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\t\treflectVec = reflect( - viewDir, normal );\n\t\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\t#else\n\t\t\t\treflectVec = refract( - viewDir, normal, refractionRatio );\n\t\t\t#endif\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tlightMapIrradiance *= PI;\n\t#endif\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularTintFactor = specularTint;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARTINTMAP\n\t\t\tspecularTintFactor *= specularTintMapTexelToLinear( texture2D( specularTintMap, vUv ) ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularTintFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularTintFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenTint = sheenTint;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenTint;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\tvec3 FssEss = specularColor * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += irradiance * BRDF_Sheen( material.roughness, directLight.direction, geometry, material.sheenTint );\n\t#else\n\t\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\t\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\t\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tfloat transmissionAlpha = 1.0;\n\tfloat transmissionFactor = transmission;\n\tfloat thicknessFactor = thickness;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\ttransmissionFactor *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tthicknessFactor *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\n\t\tattenuationTint, attenuationDistance );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );\n\ttransmissionAlpha = transmission.a;\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationTint;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( float roughness, float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( vec2 fragCoord, float roughness, float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( vec3 radiance, float transmissionDistance, vec3 attenuationColor, float attenuationDistance ) {\n\t\tif ( attenuationDistance == 0.0 ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 diffuseColor, vec3 specularColor, float specularF90,\n\t\tvec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness,\n\t\tvec3 attenuationColor, float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularTint;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARTINTMAP\n\t\tuniform sampler2D specularTintMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenTint;\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - clearcoat * Fcc ) + clearcoatSpecular * clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},fr={common:{diffuse:{value:new di(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new ze},uv2Transform:{value:new ze},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Ie(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new di(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new di(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new ze}},sprite:{diffuse:{value:new di(16777215)},opacity:{value:1},center:{value:new Ie(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new ze}}},vr={basic:{uniforms:Ki([fr.common,fr.specularmap,fr.envmap,fr.aomap,fr.lightmap,fr.fog]),vertexShader:mr.meshbasic_vert,fragmentShader:mr.meshbasic_frag},lambert:{uniforms:Ki([fr.common,fr.specularmap,fr.envmap,fr.aomap,fr.lightmap,fr.emissivemap,fr.fog,fr.lights,{emissive:{value:new di(0)}}]),vertexShader:mr.meshlambert_vert,fragmentShader:mr.meshlambert_frag},phong:{uniforms:Ki([fr.common,fr.specularmap,fr.envmap,fr.aomap,fr.lightmap,fr.emissivemap,fr.bumpmap,fr.normalmap,fr.displacementmap,fr.fog,fr.lights,{emissive:{value:new di(0)},specular:{value:new di(1118481)},shininess:{value:30}}]),vertexShader:mr.meshphong_vert,fragmentShader:mr.meshphong_frag},standard:{uniforms:Ki([fr.common,fr.envmap,fr.aomap,fr.lightmap,fr.emissivemap,fr.bumpmap,fr.normalmap,fr.displacementmap,fr.roughnessmap,fr.metalnessmap,fr.fog,fr.lights,{emissive:{value:new di(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:mr.meshphysical_vert,fragmentShader:mr.meshphysical_frag},toon:{uniforms:Ki([fr.common,fr.aomap,fr.lightmap,fr.emissivemap,fr.bumpmap,fr.normalmap,fr.displacementmap,fr.gradientmap,fr.fog,fr.lights,{emissive:{value:new di(0)}}]),vertexShader:mr.meshtoon_vert,fragmentShader:mr.meshtoon_frag},matcap:{uniforms:Ki([fr.common,fr.bumpmap,fr.normalmap,fr.displacementmap,fr.fog,{matcap:{value:null}}]),vertexShader:mr.meshmatcap_vert,fragmentShader:mr.meshmatcap_frag},points:{uniforms:Ki([fr.points,fr.fog]),vertexShader:mr.points_vert,fragmentShader:mr.points_frag},dashed:{uniforms:Ki([fr.common,fr.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:mr.linedashed_vert,fragmentShader:mr.linedashed_frag},depth:{uniforms:Ki([fr.common,fr.displacementmap]),vertexShader:mr.depth_vert,fragmentShader:mr.depth_frag},normal:{uniforms:Ki([fr.common,fr.bumpmap,fr.normalmap,fr.displacementmap,{opacity:{value:1}}]),vertexShader:mr.meshnormal_vert,fragmentShader:mr.meshnormal_frag},sprite:{uniforms:Ki([fr.sprite,fr.fog]),vertexShader:mr.sprite_vert,fragmentShader:mr.sprite_frag},background:{uniforms:{uvTransform:{value:new ze},t2D:{value:null}},vertexShader:mr.background_vert,fragmentShader:mr.background_frag},cube:{uniforms:Ki([fr.envmap,{opacity:{value:1}}]),vertexShader:mr.cube_vert,fragmentShader:mr.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:mr.equirect_vert,fragmentShader:mr.equirect_frag},distanceRGBA:{uniforms:Ki([fr.common,fr.displacementmap,{referencePosition:{value:new We},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:mr.distanceRGBA_vert,fragmentShader:mr.distanceRGBA_frag},shadow:{uniforms:Ki([fr.lights,fr.fog,{color:{value:new di(0)},opacity:{value:1}}]),vertexShader:mr.shadow_vert,fragmentShader:mr.shadow_frag}};function gr(s,o,n,a,i){const l=new di(0);let h=0,c,u,d=null,p=0,m=null;function f(t,e){n.buffers.color.setClear(t.r,t.g,t.b,e,i)}return{getClearColor:function(){return l},setClearColor:function(t,e=1){l.set(t),h=e,f(l,h)},getClearAlpha:function(){return h},setClearAlpha:function(t){h=t,f(l,h)},render:function(t,e){let n=!1,i=!0===e.isScene?e.background:null;i&&i.isTexture&&(i=o.get(i));const r=s.xr;(e=r.getSession&&r.getSession())&&"additive"===e.environmentBlendMode&&(i=null),null===i?f(l,h):i&&i.isColor&&(f(i,1),n=!0),(s.autoClear||n)&&s.clear(s.autoClearColor,s.autoClearDepth,s.autoClearStencil),i&&(i.isCubeTexture||i.mapping===C)?(void 0===u&&(u=new qi(new Yi(1,1,1),new Qi({name:"BackgroundCubeMaterial",uniforms:Zi(vr.cube.uniforms),vertexShader:vr.cube.vertexShader,fragmentShader:vr.cube.fragmentShader,side:Lt,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(t,e,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),a.update(u)),u.material.uniforms.envMap.value=i,u.material.uniforms.flipEnvMap.value=i.isCubeTexture&&!1===i.isRenderTargetTexture?-1:1,d===i&&p===i.version&&m===s.toneMapping||(u.material.needsUpdate=!0,d=i,p=i.version,m=s.toneMapping),t.unshift(u,u.geometry,u.material,0,0,null)):i&&i.isTexture&&(void 0===c&&(c=new qi(new pr(2,2),new Qi({name:"BackgroundMaterial",uniforms:Zi(vr.background.uniforms),vertexShader:vr.background.vertexShader,fragmentShader:vr.background.fragmentShader,side:Pt,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),a.update(c)),c.material.uniforms.t2D.value=i,!0===i.matrixAutoUpdate&&i.updateMatrix(),c.material.uniforms.uvTransform.value.copy(i.matrix),d===i&&p===i.version&&m===s.toneMapping||(c.material.needsUpdate=!0,d=i,p=i.version,m=s.toneMapping),t.unshift(c,c.geometry,c.material,0,0,null))}}}function yr(x,_,b,w){const r=x.getParameter(34921),a=w.isWebGL2?null:_.get("OES_vertex_array_object"),l=w.isWebGL2||null!==a,h={},t=d(null);let c=t;function u(t){return w.isWebGL2?x.bindVertexArray(t):a.bindVertexArrayOES(t)}function s(t){return w.isWebGL2?x.deleteVertexArray(t):a.deleteVertexArrayOES(t)}function d(t){const e=[],n=[],i=[];for(let t=0;t<r;t++)e[t]=0,n[t]=0,i[t]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:e,enabledAttributes:n,attributeDivisors:i,object:t,attributes:{},index:null}}function M(){const n=c.newAttributes;for(let t=0,e=n.length;t<e;t++)n[t]=0}function S(t){E(t,0)}function E(t,e){const n=c.newAttributes,i=c.enabledAttributes,r=c.attributeDivisors;if(n[t]=1,0===i[t]&&(x.enableVertexAttribArray(t),i[t]=1),r[t]!==e){const s=w.isWebGL2?x:_.get("ANGLE_instanced_arrays");s[w.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](t,e),r[t]=e}}function T(){var n=c.newAttributes;const i=c.enabledAttributes;for(let t=0,e=i.length;t<e;t++)i[t]!==n[t]&&(x.disableVertexAttribArray(t),i[t]=0)}function A(t,e,n,i,r,s){!0!==w.isWebGL2||5124!==n&&5125!==n?x.vertexAttribPointer(t,e,n,i,r,s):x.vertexAttribIPointer(t,e,n,r,s)}function o(){e(),c!==t&&(c=t,u(c.object))}function e(){t.geometry=null,t.program=null,t.wireframe=!1}return{setup:function(t,e,n,i,r){let s=!1;var o;l?(o=function(t,e,n){n=!0===n.wireframe;let i=h[t.id];void 0===i&&(i={},h[t.id]=i);let r=i[e.id];void 0===r&&(r={},i[e.id]=r);let s=r[n];void 0===s&&(s=d(w.isWebGL2?x.createVertexArray():a.createVertexArrayOES()),r[n]=s);return s}(i,n,e),c!==o&&(c=o,u(c.object)),s=function(t,e){var n=c.attributes,i=t.attributes;let r=0;for(const a in i){var s=n[a],o=i[a];if(void 0===s)return!0;if(s.attribute!==o)return!0;if(s.data!==o.data)return!0;r++}return c.attributesNum!==r||c.index!==e}(i,r),s&&function(t,e){const n={},i=t.attributes;let r=0;for(const o in i){var s=i[o];const a={};(a.attribute=s).data&&(a.data=s.data),n[o]=a,r++}c.attributes=n,c.attributesNum=r,c.index=e}(i,r)):(o=!0===e.wireframe,c.geometry===i.id&&c.program===n.id&&c.wireframe===o||(c.geometry=i.id,c.program=n.id,c.wireframe=o,s=!0)),!0===t.isInstancedMesh&&(s=!0),null!==r&&b.update(r,34963),s&&(function(t,e,n,i){if(!1===w.isWebGL2&&(t.isInstancedMesh||i.isInstancedBufferGeometry)&&null===_.get("ANGLE_instanced_arrays"))return;M();var r=i.attributes,s=n.getAttributes(),o=e.defaultAttributeValues;for(const y in s){var a=s[y];if(0<=a.location){let e=r[y];if(void 0===e&&("instanceMatrix"===y&&t.instanceMatrix&&(e=t.instanceMatrix),"instanceColor"===y&&t.instanceColor&&(e=t.instanceColor)),void 0!==e){var l=e.normalized,h=e.itemSize,c=b.get(e);if(void 0!==c){var u=c.buffer,d=c.type,p=c.bytesPerElement;if(e.isInterleavedBufferAttribute){var m=e.data,f=m.stride,v=e.offset;if(m&&m.isInstancedInterleavedBuffer){for(let t=0;t<a.locationSize;t++)E(a.location+t,m.meshPerAttribute);!0!==t.isInstancedMesh&&void 0===i._maxInstanceCount&&(i._maxInstanceCount=m.meshPerAttribute*m.count)}else for(let t=0;t<a.locationSize;t++)S(a.location+t);x.bindBuffer(34962,u);for(let t=0;t<a.locationSize;t++)A(a.location+t,h/a.locationSize,d,l,f*p,(v+h/a.locationSize*t)*p)}else{if(e.isInstancedBufferAttribute){for(let t=0;t<a.locationSize;t++)E(a.location+t,e.meshPerAttribute);!0!==t.isInstancedMesh&&void 0===i._maxInstanceCount&&(i._maxInstanceCount=e.meshPerAttribute*e.count)}else for(let t=0;t<a.locationSize;t++)S(a.location+t);x.bindBuffer(34962,u);for(let t=0;t<a.locationSize;t++)A(a.location+t,h/a.locationSize,d,l,h*p,h/a.locationSize*t*p)}}}else if(void 0!==o){var g=o[y];if(void 0!==g)switch(g.length){case 2:x.vertexAttrib2fv(a.location,g);break;case 3:x.vertexAttrib3fv(a.location,g);break;case 4:x.vertexAttrib4fv(a.location,g);break;default:x.vertexAttrib1fv(a.location,g)}}}}T()}(t,e,n,i),null!==r&&x.bindBuffer(34963,b.get(r).buffer))},reset:o,resetDefaultState:e,dispose:function(){o();for(const t in h){const e=h[t];for(const n in e){const i=e[n];for(const r in i)s(i[r].object),delete i[r];delete e[n]}delete h[t]}},releaseStatesOfGeometry:function(t){if(void 0!==h[t.id]){const e=h[t.id];for(const n in e){const i=e[n];for(const r in i)s(i[r].object),delete i[r];delete e[n]}delete h[t.id]}},releaseStatesOfProgram:function(t){for(const e in h){const n=h[e];if(void 0!==n[t.id]){const i=n[t.id];for(const r in i)s(i[r].object),delete i[r];delete n[t.id]}}},initAttributes:M,enableAttribute:S,disableUnusedAttributes:T}}function xr(s,o,a,t){const l=t.isWebGL2;let h;this.setMode=function(t){h=t},this.render=function(t,e){s.drawArrays(h,t,e),a.update(e,h,1)},this.renderInstances=function(n,i,r){if(0!==r){let t,e;if(l)t=s,e="drawArraysInstanced";else if(t=o.get("ANGLE_instanced_arrays"),e="drawArraysInstancedANGLE",null===t)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");t[e](h,n,i,r),a.update(i,h,r)}}}function _r(e,n,t){let i;function r(t){if("highp"===t){if(0<e.getShaderPrecisionFormat(35633,36338).precision&&0<e.getShaderPrecisionFormat(35632,36338).precision)return"highp";t="mediump"}return"mediump"===t&&0<e.getShaderPrecisionFormat(35633,36337).precision&&0<e.getShaderPrecisionFormat(35632,36337).precision?"mediump":"lowp"}var s="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext;let o=void 0!==t.precision?t.precision:"highp";var a=r(o);a!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",a,"instead."),o=a);var l=s||n.has("WEBGL_draw_buffers"),h=!0===t.logarithmicDepthBuffer,c=e.getParameter(34930),u=e.getParameter(35660),d=e.getParameter(3379),p=e.getParameter(34076),m=e.getParameter(34921),f=e.getParameter(36347),v=e.getParameter(36348),g=e.getParameter(36349),y=0<u,x=s||n.has("OES_texture_float"),a=y&&x,t=s?e.getParameter(36183):0;return{isWebGL2:s,drawBuffers:l,getMaxAnisotropy:function(){return void 0!==i||(i=!0===n.has("EXT_texture_filter_anisotropic")?(t=n.get("EXT_texture_filter_anisotropic"),e.getParameter(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT)):0),i;var t},getMaxPrecision:r,precision:o,logarithmicDepthBuffer:h,maxTextures:c,maxVertexTextures:u,maxTextureSize:d,maxCubemapSize:p,maxAttributes:m,maxVertexUniforms:f,maxVaryings:v,maxFragmentUniforms:g,vertexTextures:y,floatFragmentTextures:x,floatVertexTextures:a,maxSamples:t}}function br(e){const a=this;let h=null,c=0,u=!1,d=!1;const l=new ar,p=new ze,m={value:null,needsUpdate:!1};function f(){m.value!==h&&(m.value=h,m.needsUpdate=0<c),a.numPlanes=c,a.numIntersection=0}function v(n,t,i,e){var r=null!==n?n.length:0;let s=null;if(0!==r){if(s=m.value,!0!==e||null===s){var e=i+4*r,o=t.matrixWorldInverse;p.getNormalMatrix(o),(null===s||s.length<e)&&(s=new Float32Array(e));for(let t=0,e=i;t!==r;++t,e+=4)l.copy(n[t]).applyMatrix4(o,p),l.normal.toArray(s,e),s[e+3]=l.constant}m.value=s,m.needsUpdate=!0}return a.numPlanes=r,a.numIntersection=0,s}this.uniform=m,this.numPlanes=0,this.numIntersection=0,this.init=function(t,e,n){var i=0!==t.length||e||0!==c||u;return u=e,h=v(t,n,0),c=t.length,i},this.beginShadows=function(){d=!0,v(null)},this.endShadows=function(){d=!1,f()},this.setState=function(t,n,i){var r=t.clippingPlanes,s=t.clipIntersection,o=t.clipShadows;const a=e.get(t);if(!u||null===r||0===r.length||d&&!o)d?v(null):f();else{var o=d?0:c,l=4*o;let e=a.clippingState||null;m.value=e,e=v(r,n,l,i);for(let t=0;t!==l;++t)e[t]=h[t];a.clippingState=e,this.numIntersection=s?this.numPlanes:0,this.numPlanes+=o}}}function wr(r){let s=new WeakMap;function o(t,e){return e===l?t.mapping=M:e===h&&(t.mapping=S),t}function a(t){const e=t.target;e.removeEventListener("dispose",a);const n=s.get(e);void 0!==n&&(s.delete(e),n.dispose())}return{get:function(t){if(t&&t.isTexture&&!1===t.isRenderTargetTexture){var e=t.mapping;if(e===l||e===h){if(s.has(t))return o(s.get(t).texture,t.mapping);var n=t.image;if(n&&0<n.height){e=r.getRenderTarget();const i=new ir(n.height/2);return i.fromEquirectangularTexture(r,t),s.set(t,i),r.setRenderTarget(e),t.addEventListener("dispose",a),o(i.texture,t.mapping)}return null}}return t},dispose:function(){s=new WeakMap}}}vr.physical={uniforms:Ki([vr.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Ie(1,1)},clearcoatNormalMap:{value:null},sheenTint:{value:new di(0)},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Ie},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationTint:{value:new di(0)},specularIntensity:{value:0},specularIntensityMap:{value:null},specularTint:{value:new di(1,1,1)},specularTintMap:{value:null}}]),vertexShader:mr.meshphysical_vert,fragmentShader:mr.meshphysical_frag};class Mr extends $i{constructor(t=-1,e=1,n=1,i=-1,r=.1,s=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=n,this.bottom=i,this.near=r,this.far=s,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this}setViewOffset(t,e,n,i,r,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){var t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let r=n-t,s=n+t,o=i+e,a=i-e;null!==this.view&&this.view.enabled&&(i=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom,r+=i*this.view.offsetX,s=r+i*this.view.width,o-=e*this.view.offsetY,a=o-e*this.view.height),this.projectionMatrix.makeOrthographic(r,s,o,a,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}Mr.prototype.isOrthographicCamera=!0;class Sr extends Qi{constructor(t){super(t),this.type="RawShaderMaterial"}}Sr.prototype.isRawShaderMaterial=!0;const Er=Math.pow(2,8),Tr=[.125,.215,.35,.446,.526,.582],Ar=5+Tr.length,Cr={[fe]:0,3001:1,3002:2,3004:3,3005:4,3006:5,3007:6},Pr=new Mr,{_lodPlanes:Lr,_sizeLods:Rr,_sigmas:Ir}=Or(),zr=new di;let Nr=null;var Br=(1+Math.sqrt(5))/2,Dr=1/Br;const Fr=[new We(1,1,1),new We(-1,1,1),new We(1,1,-1),new We(-1,1,-1),new We(0,Br,Dr),new We(0,Br,-Dr),new We(Dr,0,Br),new We(-Dr,0,Br),new We(Br,Dr,0),new We(-Br,Dr,0)];class kr{constructor(t){var e,n;this._renderer=t,this._pingPongRenderTarget=null,this._blurMaterial=(e=20,n=new Float32Array(e),t=new We(0,1,0),t=new Sr({name:"SphericalGaussianBlur",defines:{n:e},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:t},inputEncoding:{value:Cr[fe]},outputEncoding:{value:Cr[fe]}},vertexShader:Gr(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			${jr()}

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:Y,depthTest:!1,depthWrite:!1})),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,n=.1,i=100){Nr=this._renderer.getRenderTarget();var r=this._allocateTargets();return this._sceneToCubeUV(t,n,i,r),0<e&&this._blur(r,0,0,e),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(t){return this._fromTexture(t)}fromCubemap(t){return this._fromTexture(t)}compileCubemapShader(){null===this._cubemapShader&&(this._cubemapShader=Wr(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){null===this._equirectShader&&(this._equirectShader=Hr(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(let t=0;t<Lr.length;t++)Lr[t].dispose()}_cleanup(t){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(Nr),t.scissorTest=!1,Ur(t,0,0,t.width,t.height)}_fromTexture(t){Nr=this._renderer.getRenderTarget();var e=this._allocateTargets(t);return this._textureToCubeUV(t,e),this._applyPMREM(e),this._cleanup(e),e}_allocateTargets(t){var e,e={magFilter:Nt,minFilter:Nt,generateMipmaps:!1,type:Dt,format:i,encoding:void 0===(e=t)||e.type!==Dt||e.encoding!==fe&&e.encoding!==ve&&3007!==e.encoding?3002:t.encoding,depthBuffer:!1};const n=Vr(e);return n.depthBuffer=!t,this._pingPongRenderTarget=Vr(e),n}_compileMaterial(t){t=new qi(Lr[0],t);this._renderer.compile(t,Pr)}_sceneToCubeUV(e,t,n,i){const r=new tr(90,1,t,n);var s=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1];const a=this._renderer;var l=a.autoClear,h=a.outputEncoding,t=a.toneMapping;a.getClearColor(zr),a.toneMapping=It,a.outputEncoding=fe,a.autoClear=!1;const c=new pi({name:"PMREM.Background",side:Lt,depthWrite:!1,depthTest:!1}),u=new qi(new Yi,c);let d=!1;n=e.background;n?n.isColor&&(c.color.copy(n),e.background=null,d=!0):(c.color.copy(zr),d=!0);for(let t=0;t<6;t++){var p=t%3;0==p?(r.up.set(0,s[t],0),r.lookAt(o[t],0,0)):1==p?(r.up.set(0,0,s[t]),r.lookAt(0,o[t],0)):(r.up.set(0,s[t],0),r.lookAt(0,0,o[t])),Ur(i,p*Er,2<t?Er:0,Er,Er),a.setRenderTarget(i),d&&a.render(u,r),a.render(e,r)}u.geometry.dispose(),u.material.dispose(),a.toneMapping=t,a.outputEncoding=h,a.autoClear=l,e.background=n}_textureToCubeUV(t,e){const n=this._renderer;t.isCubeTexture?null==this._cubemapShader&&(this._cubemapShader=Wr()):null==this._equirectShader&&(this._equirectShader=Hr());var i=t.isCubeTexture?this._cubemapShader:this._equirectShader,r=new qi(Lr[0],i);const s=i.uniforms;(s.envMap.value=t).isCubeTexture||s.texelSize.value.set(1/t.image.width,1/t.image.height),s.inputEncoding.value=Cr[t.encoding],s.outputEncoding.value=Cr[e.texture.encoding],Ur(e,0,0,3*Er,2*Er),n.setRenderTarget(e),n.render(r,Pr)}_applyPMREM(e){const t=this._renderer;var n=t.autoClear;t.autoClear=!1;for(let t=1;t<Ar;t++){var i=Math.sqrt(Ir[t]*Ir[t]-Ir[t-1]*Ir[t-1]),r=Fr[(t-1)%Fr.length];this._blur(e,t-1,t,i,r)}t.autoClear=n}_blur(t,e,n,i,r){var s=this._pingPongRenderTarget;this._halfBlur(t,s,e,n,i,"latitudinal",r),this._halfBlur(s,t,n,n,i,"longitudinal",r)}_halfBlur(t,e,n,i,r,s,o){const a=this._renderer;var l=this._blurMaterial;"latitudinal"!==s&&"longitudinal"!==s&&console.error("blur direction must be either latitudinal or longitudinal!");var h=new qi(Lr[i],l);const c=l.uniforms;var l=Rr[n]-1,l=isFinite(r)?Math.PI/(2*l):2*Math.PI/39,u=r/l,d=isFinite(r)?1+Math.floor(3*u):20;20<d&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${d} samples when the maximum is set to 20`);const p=[];let m=0;for(let t=0;t<20;++t){const v=t/u;var f=Math.exp(-v*v/2);p.push(f),0==t?m+=f:t<d&&(m+=2*f)}for(let t=0;t<p.length;t++)p[t]=p[t]/m;c.envMap.value=t.texture,c.samples.value=d,c.weights.value=p,c.latitudinal.value="latitudinal"===s,o&&(c.poleAxis.value=o),c.dTheta.value=l,c.mipInt.value=8-n,c.inputEncoding.value=Cr[t.texture.encoding],c.outputEncoding.value=Cr[t.texture.encoding];t=Rr[i];const v=3*Math.max(0,Er-2*t);i=(0===i?0:2*Er)+2*t*(4<i?i-8+4:0);Ur(e,v,i,3*t,2*t),a.setRenderTarget(e),a.render(h,Pr)}}function Or(){const n=[],i=[],r=[];let s=8;for(let e=0;e<Ar;e++){var o=Math.pow(2,s);i.push(o);let t=1/o;4<e?t=Tr[e-8+4-1]:0==e&&(t=0),r.push(t);var a=1/(o-1),o=-a/2,a=1+a/2,l=[o,o,a,o,a,a,o,o,a,a,o,a];const u=new Float32Array(108),d=new Float32Array(72),p=new Float32Array(36);for(let t=0;t<6;t++){var h=t%3*2/3-1,c=2<t?0:-1;u.set([h,c,0,h+2/3,c,0,h+2/3,1+c,0,h,c,0,h+2/3,1+c,0,h,1+c,0],18*t),d.set(l,12*t);c=[t,t,t,t,t,t];p.set(c,6*t)}const m=new Ci;m.setAttribute("position",new vi(u,3)),m.setAttribute("uv",new vi(d,2)),m.setAttribute("faceIndex",new vi(p,1)),n.push(m),4<s&&s--}return{_lodPlanes:n,_sizeLods:i,_sigmas:r}}function Vr(t){const e=new Ve(3*Er,3*Er,t);return e.texture.mapping=C,e.texture.name="PMREM.cubeUv",e.scissorTest=!0,e}function Ur(t,e,n,i,r){t.viewport.set(e,n,i,r),t.scissor.set(e,n,i,r)}function Hr(){var t=new Ie(1,1);return new Sr({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:t},inputEncoding:{value:Cr[fe]},outputEncoding:{value:Cr[fe]}},vertexShader:Gr(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform vec2 texelSize;

			${jr()}

			#include <common>

			void main() {

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				vec2 f = fract( uv / texelSize - 0.5 );
				uv -= f * texelSize;
				vec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.x += texelSize.x;
				vec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.y += texelSize.y;
				vec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.x -= texelSize.x;
				vec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;

				vec3 tm = mix( tl, tr, f.x );
				vec3 bm = mix( bl, br, f.x );
				gl_FragColor.rgb = mix( tm, bm, f.y );

				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:Y,depthTest:!1,depthWrite:!1})}function Wr(){return new Sr({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:Cr[fe]},outputEncoding:{value:Cr[fe]}},vertexShader:Gr(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			${jr()}

			void main() {

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;
				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:Y,depthTest:!1,depthWrite:!1})}function Gr(){return`

		precision mediump float;
		precision mediump int;

		attribute vec3 position;
		attribute vec2 uv;
		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function jr(){return`

		uniform int inputEncoding;
		uniform int outputEncoding;

		#include <encodings_pars_fragment>

		vec4 inputTexelToLinear( vec4 value ) {

			if ( inputEncoding == 0 ) {

				return value;

			} else if ( inputEncoding == 1 ) {

				return sRGBToLinear( value );

			} else if ( inputEncoding == 2 ) {

				return RGBEToLinear( value );

			} else if ( inputEncoding == 3 ) {

				return RGBMToLinear( value, 7.0 );

			} else if ( inputEncoding == 4 ) {

				return RGBMToLinear( value, 16.0 );

			} else if ( inputEncoding == 5 ) {

				return RGBDToLinear( value, 256.0 );

			} else {

				return GammaToLinear( value, 2.2 );

			}

		}

		vec4 linearToOutputTexel( vec4 value ) {

			if ( outputEncoding == 0 ) {

				return value;

			} else if ( outputEncoding == 1 ) {

				return LinearTosRGB( value );

			} else if ( outputEncoding == 2 ) {

				return LinearToRGBE( value );

			} else if ( outputEncoding == 3 ) {

				return LinearToRGBM( value, 7.0 );

			} else if ( outputEncoding == 4 ) {

				return LinearToRGBM( value, 16.0 );

			} else if ( outputEncoding == 5 ) {

				return LinearToRGBD( value, 256.0 );

			} else {

				return LinearToGamma( value, 2.2 );

			}

		}

		vec4 envMapTexelToLinear( vec4 color ) {

			return inputTexelToLinear( color );

		}
	`}function qr(r){let s=new WeakMap,o=null;function a(t){const e=t.target;e.removeEventListener("dispose",a);const n=s.get(e);void 0!==n&&(s.delete(e),n.dispose())}return{get:function(t){if(t&&t.isTexture&&!1===t.isRenderTargetTexture){var e=t.mapping,n=e===l||e===h,i=e===M||e===S;if(n||i){if(s.has(t))return s.get(t).texture;e=t.image;if(n&&e&&0<e.height||i&&e&&function(e){let n=0;for(let t=0;t<6;t++)void 0!==e[t]&&n++;return 6===n}(e)){e=r.getRenderTarget();null===o&&(o=new kr(r));n=n?o.fromEquirectangular(t):o.fromCubemap(t);return s.set(t,n),r.setRenderTarget(e),t.addEventListener("dispose",a),n.texture}return null}}return t},dispose:function(){s=new WeakMap,null!==o&&(o.dispose(),o=null)}}}function Xr(n){const i={};function r(t){if(void 0!==i[t])return i[t];let e;switch(t){case"WEBGL_depth_texture":e=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":e=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":e=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":e=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:e=n.getExtension(t)}return i[t]=e,e}return{has:function(t){return null!==r(t)},init:function(t){t.isWebGL2?r("EXT_color_buffer_float"):(r("WEBGL_depth_texture"),r("OES_texture_float"),r("OES_texture_half_float"),r("OES_texture_half_float_linear"),r("OES_standard_derivatives"),r("OES_element_index_uint"),r("OES_vertex_array_object"),r("ANGLE_instanced_arrays")),r("OES_texture_float_linear"),r("EXT_color_buffer_half_float")},get:function(t){var e=r(t);return null===e&&console.warn("THREE.WebGLRenderer: "+t+" extension not supported."),e}}}function Yr(t,m,i,r){const s={},f=new WeakMap;function o(t){const e=t.target;null!==e.index&&m.remove(e.index);for(const n in e.attributes)m.remove(e.attributes[n]);e.removeEventListener("dispose",o),delete s[e.id];t=f.get(e);t&&(m.remove(t),f.delete(e)),r.releaseStatesOfGeometry(e),!0===e.isInstancedBufferGeometry&&delete e._maxInstanceCount,i.memory.geometries--}function a(t){const n=[];var e=t.index,i=t.attributes.position;let r=0;if(null!==e){var s=e.array;r=e.version;for(let t=0,e=s.length;t<e;t+=3){var o=s[t+0],a=s[t+1],l=s[t+2];n.push(o,a,a,l,l,o)}}else{var h=i.array;r=i.version;for(let t=0,e=h.length/3-1;t<e;t+=3){var c=t+0,u=t+1,d=t+2;n.push(c,u,u,d,d,c)}}const p=new(65535<_i(n)?yi:gi)(n,1);p.version=r;h=f.get(t);h&&m.remove(h),f.set(t,p)}return{get:function(t,e){return!0===s[e.id]||(e.addEventListener("dispose",o),s[e.id]=!0,i.memory.geometries++),e},update:function(t){var e=t.attributes;for(const r in e)m.update(e[r],34962);var n=t.morphAttributes;for(const s in n){var i=n[s];for(let t=0,e=i.length;t<e;t++)m.update(i[t],34962)}},getWireframeAttribute:function(t){var e,n=f.get(t);return(!n||null!==(e=t.index)&&n.version<e.version)&&a(t),f.get(t)}}}function Zr(s,o,a,t){const l=t.isWebGL2;let h;let c,u;this.setMode=function(t){h=t},this.setIndex=function(t){c=t.type,u=t.bytesPerElement},this.render=function(t,e){s.drawElements(h,e,c,t*u),a.update(e,h,1)},this.renderInstances=function(n,i,r){if(0!==r){let t,e;if(l)t=s,e="drawElementsInstanced";else if(t=o.get("ANGLE_instanced_arrays"),e="drawElementsInstancedANGLE",null===t)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");t[e](h,i,c,n*u,r),a.update(i,h,r)}}}function Kr(t){const i={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:i,programs:null,autoReset:!0,reset:function(){i.frame++,i.calls=0,i.triangles=0,i.points=0,i.lines=0},update:function(t,e,n){switch(i.calls++,e){case 4:i.triangles+=n*(t/3);break;case 1:i.lines+=n*(t/2);break;case 3:i.lines+=n*(t-1);break;case 2:i.lines+=n*t;break;case 0:i.points+=n*t;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",e)}}}}function Jr(t,e){return t[0]-e[0]}function Qr(t,e){return Math.abs(e[1])-Math.abs(t[1])}function $r(p){const m={},f=new Float32Array(8),v=[];for(let t=0;t<8;t++)v[t]=[t,0];return{update:function(t,e,n,i){var r=t.morphTargetInfluences,s=void 0===r?0:r.length;let o=m[e.id];if(void 0===o||o.length!==s){o=[];for(let t=0;t<s;t++)o[t]=[t,0];m[e.id]=o}for(let t=0;t<s;t++){const d=o[t];d[0]=t,d[1]=r[t]}o.sort(Qr);for(let t=0;t<8;t++)t<s&&o[t][1]?(v[t][0]=o[t][0],v[t][1]=o[t][1]):(v[t][0]=Number.MAX_SAFE_INTEGER,v[t][1]=0);v.sort(Jr);var a=e.morphAttributes.position,l=e.morphAttributes.normal;let h=0;for(let t=0;t<8;t++){var c=v[t],u=c[0],c=c[1];u!==Number.MAX_SAFE_INTEGER&&c?(a&&e.getAttribute("morphTarget"+t)!==a[u]&&e.setAttribute("morphTarget"+t,a[u]),l&&e.getAttribute("morphNormal"+t)!==l[u]&&e.setAttribute("morphNormal"+t,l[u]),f[t]=c,h+=c):(a&&!0===e.hasAttribute("morphTarget"+t)&&e.deleteAttribute("morphTarget"+t),l&&!0===e.hasAttribute("morphNormal"+t)&&e.deleteAttribute("morphNormal"+t),f[t]=0)}t=e.morphTargetsRelative?1:1-h,i.getUniforms().setValue(p,"morphTargetBaseInfluence",t),i.getUniforms().setValue(p,"morphTargetInfluences",f)}}}function ts(t,i,r,s){let o=new WeakMap;function a(t){const e=t.target;e.removeEventListener("dispose",a),r.remove(e.instanceMatrix),null!==e.instanceColor&&r.remove(e.instanceColor)}return{update:function(t){var e=s.render.frame,n=t.geometry,n=i.get(t,n);return o.get(n)!==e&&(i.update(n),o.set(n,e)),t.isInstancedMesh&&(!1===t.hasEventListener("dispose",a)&&t.addEventListener("dispose",a),r.update(t.instanceMatrix,34962),null!==t.instanceColor&&r.update(t.instanceColor,34962)),n},dispose:function(){o=new WeakMap}}}class es extends Fe{constructor(t=null,e=1,n=1,i=1){super(null),this.image={data:t,width:e,height:n,depth:i},this.magFilter=Nt,this.minFilter=Nt,this.wrapR=zt,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}class ns extends Fe{constructor(t=null,e=1,n=1,i=1){super(null),this.image={data:t,width:e,height:n,depth:i},this.magFilter=Nt,this.minFilter=Nt,this.wrapR=zt,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}ns.prototype.isDataTexture3D=es.prototype.isDataTexture2DArray=!0;const is=new Fe,rs=new es,ss=new ns,os=new nr,as=[],ls=[],hs=new Float32Array(16),cs=new Float32Array(9),us=new Float32Array(4);function ds(n,i,r){const t=n[0];if(t<=0||0<t)return n;var e=i*r;let s=as[e];if(void 0===s&&(s=new Float32Array(e),as[e]=s),0!==i){t.toArray(s,0);for(let t=1,e=0;t!==i;++t)e+=r,n[t].toArray(s,e)}return s}function ps(n,i){if(n.length===i.length){for(let t=0,e=n.length;t<e;t++)if(n[t]!==i[t])return;return 1}}function ms(n,i){for(let t=0,e=i.length;t<e;t++)n[t]=i[t]}function fs(e,n){let i=ls[n];void 0===i&&(i=new Int32Array(n),ls[n]=i);for(let t=0;t!==n;++t)i[t]=e.allocateTextureUnit();return i}function vs(t,e){const n=this.cache;n[0]!==e&&(t.uniform1f(this.addr,e),n[0]=e)}function gs(t,e){const n=this.cache;void 0!==e.x?n[0]===e.x&&n[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y):ps(n,e)||(t.uniform2fv(this.addr,e),ms(n,e))}function ys(t,e){const n=this.cache;void 0!==e.x?n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z):void 0!==e.r?n[0]===e.r&&n[1]===e.g&&n[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),n[0]=e.r,n[1]=e.g,n[2]=e.b):ps(n,e)||(t.uniform3fv(this.addr,e),ms(n,e))}function xs(t,e){const n=this.cache;void 0!==e.x?n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w):ps(n,e)||(t.uniform4fv(this.addr,e),ms(n,e))}function _s(t,e){var n=this.cache,i=e.elements;void 0===i?ps(n,e)||(t.uniformMatrix2fv(this.addr,!1,e),ms(n,e)):ps(n,i)||(us.set(i),t.uniformMatrix2fv(this.addr,!1,us),ms(n,i))}function bs(t,e){var n=this.cache,i=e.elements;void 0===i?ps(n,e)||(t.uniformMatrix3fv(this.addr,!1,e),ms(n,e)):ps(n,i)||(cs.set(i),t.uniformMatrix3fv(this.addr,!1,cs),ms(n,i))}function ws(t,e){var n=this.cache,i=e.elements;void 0===i?ps(n,e)||(t.uniformMatrix4fv(this.addr,!1,e),ms(n,e)):ps(n,i)||(hs.set(i),t.uniformMatrix4fv(this.addr,!1,hs),ms(n,i))}function Ms(t,e){const n=this.cache;n[0]!==e&&(t.uniform1i(this.addr,e),n[0]=e)}function Ss(t,e){var n=this.cache;ps(n,e)||(t.uniform2iv(this.addr,e),ms(n,e))}function Es(t,e){var n=this.cache;ps(n,e)||(t.uniform3iv(this.addr,e),ms(n,e))}function Ts(t,e){var n=this.cache;ps(n,e)||(t.uniform4iv(this.addr,e),ms(n,e))}function As(t,e){const n=this.cache;n[0]!==e&&(t.uniform1ui(this.addr,e),n[0]=e)}function Cs(t,e){var n=this.cache;ps(n,e)||(t.uniform2uiv(this.addr,e),ms(n,e))}function Ps(t,e){var n=this.cache;ps(n,e)||(t.uniform3uiv(this.addr,e),ms(n,e))}function Ls(t,e){var n=this.cache;ps(n,e)||(t.uniform4uiv(this.addr,e),ms(n,e))}function Rs(t,e,n){const i=this.cache;var r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.safeSetTexture2D(e||is,r)}function Is(t,e,n){const i=this.cache;var r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTexture3D(e||ss,r)}function zs(t,e,n){const i=this.cache;var r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.safeSetTextureCube(e||os,r)}function Ns(t,e,n){const i=this.cache;var r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTexture2DArray(e||rs,r)}function Bs(t,e){t.uniform1fv(this.addr,e)}function Ds(t,e){e=ds(e,this.size,2);t.uniform2fv(this.addr,e)}function Fs(t,e){e=ds(e,this.size,3);t.uniform3fv(this.addr,e)}function ks(t,e){e=ds(e,this.size,4);t.uniform4fv(this.addr,e)}function Os(t,e){e=ds(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,e)}function Vs(t,e){e=ds(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,e)}function Us(t,e){e=ds(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,e)}function Hs(t,e){t.uniform1iv(this.addr,e)}function Ws(t,e){t.uniform2iv(this.addr,e)}function Gs(t,e){t.uniform3iv(this.addr,e)}function js(t,e){t.uniform4iv(this.addr,e)}function qs(t,e){t.uniform1uiv(this.addr,e)}function Xs(t,e){t.uniform2uiv(this.addr,e)}function Ys(t,e){t.uniform3uiv(this.addr,e)}function Zs(t,e){t.uniform4uiv(this.addr,e)}function Ks(t,e,n){var i=e.length,r=fs(n,i);t.uniform1iv(this.addr,r);for(let t=0;t!==i;++t)n.safeSetTexture2D(e[t]||is,r[t])}function Js(t,e,n){var i=e.length,r=fs(n,i);t.uniform1iv(this.addr,r);for(let t=0;t!==i;++t)n.safeSetTextureCube(e[t]||os,r[t])}function Qs(t,e,n){this.id=t,this.addr=n,this.cache=[],this.setValue=function(t){switch(t){case 5126:return vs;case 35664:return gs;case 35665:return ys;case 35666:return xs;case 35674:return _s;case 35675:return bs;case 35676:return ws;case 5124:case 35670:return Ms;case 35667:case 35671:return Ss;case 35668:case 35672:return Es;case 35669:case 35673:return Ts;case 5125:return As;case 36294:return Cs;case 36295:return Ps;case 36296:return Ls;case 35678:case 36198:case 36298:case 36306:case 35682:return Rs;case 35679:case 36299:case 36307:return Is;case 35680:case 36300:case 36308:case 36293:return zs;case 36289:case 36303:case 36311:case 36292:return Ns}}(e.type)}function $s(t,e,n){this.id=t,this.addr=n,this.cache=[],this.size=e.size,this.setValue=function(t){switch(t){case 5126:return Bs;case 35664:return Ds;case 35665:return Fs;case 35666:return ks;case 35674:return Os;case 35675:return Vs;case 35676:return Us;case 5124:case 35670:return Hs;case 35667:case 35671:return Ws;case 35668:case 35672:return Gs;case 35669:case 35673:return js;case 5125:return qs;case 36294:return Xs;case 36295:return Ys;case 36296:return Zs;case 35678:case 36198:case 36298:case 36306:case 35682:return Ks;case 35680:case 36300:case 36308:case 36293:return Js}}(e.type)}function to(t){this.id=t,this.seq=[],this.map={}}$s.prototype.updateCache=function(t){var e=this.cache;t instanceof Float32Array&&e.length!==t.length&&(this.cache=new Float32Array(t.length)),ms(e,t)},to.prototype.setValue=function(n,i,r){var s=this.seq;for(let t=0,e=s.length;t!==e;++t){const o=s[t];o.setValue(n,i[o.id],r)}};const eo=/(\w+)(\])?(\[|\.)?/g;function no(t,e){t.seq.push(e),t.map[e.id]=e}function io(e,n){this.seq=[],this.map={};var i=e.getProgramParameter(n,35718);for(let t=0;t<i;++t){var r=e.getActiveUniform(n,t);!function(t,n,i){var r=t.name,s=r.length;for(eo.lastIndex=0;;){var o=eo.exec(r),a=eo.lastIndex;let e=o[1];var l="]"===o[2],o=o[3];if(l&&(e|=0),void 0===o||"["===o&&a+2===s){no(i,new(void 0===o?Qs:$s)(e,t,n));break}{let t=i.map[e];void 0===t&&(t=new to(e),no(i,t)),i=t}}}(r,e.getUniformLocation(n,r.name),this)}}function ro(t,e,n){e=t.createShader(e);return t.shaderSource(e,n),t.compileShader(e),e}io.prototype.setValue=function(t,e,n,i){const r=this.map[e];void 0!==r&&r.setValue(t,n,i)},io.prototype.setOptional=function(t,e,n){e=e[n];void 0!==e&&this.setValue(t,n,e)},io.upload=function(n,i,r,s){for(let t=0,e=i.length;t!==e;++t){const o=i[t],a=r[o.id];!1!==a.needsUpdate&&o.setValue(n,a.value,s)}},io.seqWithValue=function(n,i){const r=[];for(let t=0,e=n.length;t!==e;++t){var s=n[t];s.id in i&&r.push(s)}return r};let so=0;function oo(t){switch(t){case fe:return["Linear","( value )"];case ve:return["sRGB","( value )"];case 3002:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case 3007:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case 3003:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",t),["Linear","( value )"]}}function ao(t,e,n){var i=t.getShaderParameter(e,35713),r=t.getShaderInfoLog(e).trim();return i&&""===r?"":n.toUpperCase()+"\n\n"+r+"\n\n"+function(t){const e=t.split("\n");for(let t=0;t<e.length;t++)e[t]=t+1+": "+e[t];return e.join("\n")}(t.getShaderSource(e))}function lo(t,e){e=oo(e);return"vec4 "+t+"( vec4 value ) { return "+e[0]+"ToLinear"+e[1]+"; }"}function ho(t){return""!==t}function co(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function uo(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const po=/^[ \t]*#include +<([\w\d./]+)>/gm;function mo(t){return t.replace(po,fo)}function fo(t,e){var n=mr[e];if(void 0===n)throw new Error("Can not resolve #include <"+e+">");return mo(n)}const vo=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,go=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function yo(t){return t.replace(go,_o).replace(vo,xo)}function xo(t,e,n,i){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),_o(0,e,n,i)}function _o(t,e,n,i){let r="";for(let t=parseInt(e);t<parseInt(n);t++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+t+" ]").replace(/UNROLLED_LOOP_INDEX/g,t);return r}function bo(t){let e="precision "+t.precision+" float;\nprecision "+t.precision+" int;";return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function wo(n,t,e,i){const r=n.getContext();var s=e.defines,o=e.vertexShader,a=e.fragmentShader,l=function(t){let e="SHADOWMAP_TYPE_BASIC";return t.shadowMapType===T?e="SHADOWMAP_TYPE_PCF":2===t.shadowMapType?e="SHADOWMAP_TYPE_PCF_SOFT":t.shadowMapType===A&&(e="SHADOWMAP_TYPE_VSM"),e}(e),h=function(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case M:case S:e="ENVMAP_TYPE_CUBE";break;case C:case P:e="ENVMAP_TYPE_CUBE_UV"}return e}(e),c=function(t){let e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case S:case P:e="ENVMAP_MODE_REFRACTION"}return e}(e),u=function(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case 0:e="ENVMAP_BLENDING_MULTIPLY";break;case 1:e="ENVMAP_BLENDING_MIX";break;case 2:e="ENVMAP_BLENDING_ADD"}return e}(e),d=0<n.gammaFactor?n.gammaFactor:1;const p=e.isWebGL2?"":function(t){const e=[t.extensionDerivatives||t.envMapCubeUV||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading||"physical"===t.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap||t.transmission)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""];return e.filter(ho).join("\n")}(e),m=function(t){const e=[];for(const i in t){var n=t[i];!1!==n&&e.push("#define "+i+" "+n)}return e.join("\n")}(s),f=r.createProgram();let v,g,y=e.glslVersion?"#version "+e.glslVersion+"\n":"";e.isRawShaderMaterial?(v=[m].filter(ho).join("\n"),0<v.length&&(v+="\n"),g=[p,m].filter(ho).join("\n"),0<g.length&&(g+="\n")):(v=[bo(e),"#define SHADER_NAME "+e.shaderName,m,e.instancing?"#define USE_INSTANCING":"",e.instancingColor?"#define USE_INSTANCING_COLOR":"",e.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+d,"#define MAX_BONES "+e.maxBones,e.useFog&&e.fog?"#define USE_FOG":"",e.useFog&&e.fogExp2?"#define FOG_EXP2":"",e.map?"#define USE_MAP":"",e.envMap?"#define USE_ENVMAP":"",e.envMap?"#define "+c:"",e.lightMap?"#define USE_LIGHTMAP":"",e.aoMap?"#define USE_AOMAP":"",e.emissiveMap?"#define USE_EMISSIVEMAP":"",e.bumpMap?"#define USE_BUMPMAP":"",e.normalMap?"#define USE_NORMALMAP":"",e.normalMap&&e.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",e.normalMap&&e.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",e.clearcoatMap?"#define USE_CLEARCOATMAP":"",e.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",e.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",e.displacementMap&&e.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",e.specularMap?"#define USE_SPECULARMAP":"",e.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",e.specularTintMap?"#define USE_SPECULARTINTMAP":"",e.roughnessMap?"#define USE_ROUGHNESSMAP":"",e.metalnessMap?"#define USE_METALNESSMAP":"",e.alphaMap?"#define USE_ALPHAMAP":"",e.transmission?"#define USE_TRANSMISSION":"",e.transmissionMap?"#define USE_TRANSMISSIONMAP":"",e.thicknessMap?"#define USE_THICKNESSMAP":"",e.vertexTangents?"#define USE_TANGENT":"",e.vertexColors?"#define USE_COLOR":"",e.vertexAlphas?"#define USE_COLOR_ALPHA":"",e.vertexUvs?"#define USE_UV":"",e.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",e.flatShading?"#define FLAT_SHADED":"",e.skinning?"#define USE_SKINNING":"",e.useVertexTexture?"#define BONE_TEXTURE":"",e.morphTargets?"#define USE_MORPHTARGETS":"",e.morphNormals&&!1===e.flatShading?"#define USE_MORPHNORMALS":"",e.doubleSided?"#define DOUBLE_SIDED":"",e.flipSided?"#define FLIP_SIDED":"",e.shadowMapEnabled?"#define USE_SHADOWMAP":"",e.shadowMapEnabled?"#define "+l:"",e.sizeAttenuation?"#define USE_SIZEATTENUATION":"",e.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",e.logarithmicDepthBuffer&&e.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(ho).join("\n"),g=[p,bo(e),"#define SHADER_NAME "+e.shaderName,m,"#define GAMMA_FACTOR "+d,e.useFog&&e.fog?"#define USE_FOG":"",e.useFog&&e.fogExp2?"#define FOG_EXP2":"",e.map?"#define USE_MAP":"",e.matcap?"#define USE_MATCAP":"",e.envMap?"#define USE_ENVMAP":"",e.envMap?"#define "+h:"",e.envMap?"#define "+c:"",e.envMap?"#define "+u:"",e.lightMap?"#define USE_LIGHTMAP":"",e.aoMap?"#define USE_AOMAP":"",e.emissiveMap?"#define USE_EMISSIVEMAP":"",e.bumpMap?"#define USE_BUMPMAP":"",e.normalMap?"#define USE_NORMALMAP":"",e.normalMap&&e.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",e.normalMap&&e.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",e.clearcoat?"#define USE_CLEARCOAT":"",e.clearcoatMap?"#define USE_CLEARCOATMAP":"",e.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",e.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",e.specularMap?"#define USE_SPECULARMAP":"",e.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",e.specularTintMap?"#define USE_SPECULARTINTMAP":"",e.roughnessMap?"#define USE_ROUGHNESSMAP":"",e.metalnessMap?"#define USE_METALNESSMAP":"",e.alphaMap?"#define USE_ALPHAMAP":"",e.alphaTest?"#define USE_ALPHATEST":"",e.sheenTint?"#define USE_SHEEN":"",e.transmission?"#define USE_TRANSMISSION":"",e.transmissionMap?"#define USE_TRANSMISSIONMAP":"",e.thicknessMap?"#define USE_THICKNESSMAP":"",e.vertexTangents?"#define USE_TANGENT":"",e.vertexColors||e.instancingColor?"#define USE_COLOR":"",e.vertexAlphas?"#define USE_COLOR_ALPHA":"",e.vertexUvs?"#define USE_UV":"",e.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",e.gradientMap?"#define USE_GRADIENTMAP":"",e.flatShading?"#define FLAT_SHADED":"",e.doubleSided?"#define DOUBLE_SIDED":"",e.flipSided?"#define FLIP_SIDED":"",e.shadowMapEnabled?"#define USE_SHADOWMAP":"",e.shadowMapEnabled?"#define "+l:"",e.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",e.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",e.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",e.logarithmicDepthBuffer&&e.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(e.extensionShaderTextureLOD||e.envMap)&&e.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",e.toneMapping!==It?"#define TONE_MAPPING":"",e.toneMapping!==It?mr.tonemapping_pars_fragment:"",e.toneMapping!==It?function(t,e){let n;switch(e){case 1:n="Linear";break;case 2:n="Reinhard";break;case 3:n="OptimizedCineon";break;case 4:n="ACESFilmic";break;case 5:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),n="Linear"}return"vec3 "+t+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}("toneMapping",e.toneMapping):"",e.dithering?"#define DITHERING":"",e.format===Tt?"#define OPAQUE":"",mr.encodings_pars_fragment,e.map?lo("mapTexelToLinear",e.mapEncoding):"",e.matcap?lo("matcapTexelToLinear",e.matcapEncoding):"",e.envMap?lo("envMapTexelToLinear",e.envMapEncoding):"",e.emissiveMap?lo("emissiveMapTexelToLinear",e.emissiveMapEncoding):"",e.specularTintMap?lo("specularTintMapTexelToLinear",e.specularTintMapEncoding):"",e.lightMap?lo("lightMapTexelToLinear",e.lightMapEncoding):"",(x="linearToOutputTexel",_=oo(_=e.outputEncoding),"vec4 "+x+"( vec4 value ) { return LinearTo"+_[0]+_[1]+"; }"),e.depthPacking?"#define DEPTH_PACKING "+e.depthPacking:"","\n"].filter(ho).join("\n")),o=uo(co(mo(o),e),e),a=uo(co(mo(a),e),e),o=yo(o),a=yo(a),e.isWebGL2&&!0!==e.isRawShaderMaterial&&(y="#version 300 es\n",v=["#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+v,g=["#define varying in",e.glslVersion===xe?"":"out highp vec4 pc_fragColor;",e.glslVersion===xe?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+g);var u=y+v+o,l=y+g+a,x=ro(r,35633,u),_=ro(r,35632,l);if(r.attachShader(f,x),r.attachShader(f,_),void 0!==e.index0AttributeName?r.bindAttribLocation(f,0,e.index0AttributeName):!0===e.morphTargets&&r.bindAttribLocation(f,0,"position"),r.linkProgram(f),n.debug.checkShaderErrors){o=r.getProgramInfoLog(f).trim(),a=r.getShaderInfoLog(x).trim(),u=r.getShaderInfoLog(_).trim();let t=!0,e=!0;!1===r.getProgramParameter(f,35714)?(t=!1,l=ao(r,x,"vertex"),n=ao(r,_,"fragment"),console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(f,35715)+"\n\nProgram Info Log: "+o+"\n"+l+"\n"+n)):""!==o?console.warn("THREE.WebGLProgram: Program Info Log:",o):""!==a&&""!==u||(e=!1),e&&(this.diagnostics={runnable:t,programLog:o,vertexShader:{log:a,prefix:v},fragmentShader:{log:u,prefix:g}})}r.deleteShader(x),r.deleteShader(_);let b;this.getUniforms=function(){return void 0===b&&(b=new io(r,f)),b};let w;return this.getAttributes=function(){return void 0===w&&(w=function(n,i){const r={};var t=n.getProgramParameter(i,35721);for(let e=0;e<t;e++){var s=n.getActiveAttrib(i,e),o=s.name;let t=1;35674===s.type&&(t=2),35675===s.type&&(t=3),35676===s.type&&(t=4),r[o]={type:s.type,location:n.getAttribLocation(i,o),locationSize:t}}return r}(r,f)),w},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(f),this.program=void 0},this.name=e.shaderName,this.id=so++,this.cacheKey=t,this.usedTimes=1,this.program=f,this.vertexShader=x,this.fragmentShader=_,this}function Mo(p,m,f,v,g,e,y){const s=[],x=g.isWebGL2,_=g.logarithmicDepthBuffer,b=g.floatVertexTextures,w=g.maxVertexUniforms,M=g.vertexTextures;let S=g.precision;const E={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},i=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoat","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","specularIntensityMap","specularTintMap","specularTintMapEncoding","roughnessMap","metalnessMap","gradientMap","alphaMap","alphaTest","combine","vertexColors","vertexAlphas","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","format","sheenTint","transmission","transmissionMap","thicknessMap"];function T(t){let e;return e=t&&t.isTexture?t.encoding:t&&t.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),t.texture.encoding):fe,e}return{getParameters:function(t,e,n,i,r){var s=i.fog,o=t.isMeshStandardMaterial?i.environment:null,a=(t.isMeshStandardMaterial?f:m).get(t.envMap||o),i=E[t.type],o=r.isSkinnedMesh?(c=(u=r).skeleton.bones,b?1024:(u=w,u=Math.floor((u-20)/4),(u=Math.min(u,c.length))<c.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+c.length+" bones. This GPU supports "+u+"."),0):u)):0;null!==t.precision&&(S=g.getMaxPrecision(t.precision),S!==t.precision&&console.warn("THREE.WebGLProgram.getParameters:",t.precision,"not supported, using",S,"instead."));let l,h;h=i?(d=vr[i],l=d.vertexShader,d.fragmentShader):(l=t.vertexShader,t.fragmentShader);var c=p.getRenderTarget(),u=0<t.alphaTest,d=0<t.clearcoat;return{isWebGL2:x,shaderID:i,shaderName:t.type,vertexShader:l,fragmentShader:h,defines:t.defines,isRawShaderMaterial:!0===t.isRawShaderMaterial,glslVersion:t.glslVersion,precision:S,instancing:!0===r.isInstancedMesh,instancingColor:!0===r.isInstancedMesh&&null!==r.instanceColor,supportsVertexTextures:M,outputEncoding:null!==c?T(c.texture):p.outputEncoding,map:!!t.map,mapEncoding:T(t.map),matcap:!!t.matcap,matcapEncoding:T(t.matcap),envMap:!!a,envMapMode:a&&a.mapping,envMapEncoding:T(a),envMapCubeUV:!!a&&(a.mapping===C||a.mapping===P),lightMap:!!t.lightMap,lightMapEncoding:T(t.lightMap),aoMap:!!t.aoMap,emissiveMap:!!t.emissiveMap,emissiveMapEncoding:T(t.emissiveMap),bumpMap:!!t.bumpMap,normalMap:!!t.normalMap,objectSpaceNormalMap:t.normalMapType===ye,tangentSpaceNormalMap:t.normalMapType===ge,clearcoat:d,clearcoatMap:d&&!!t.clearcoatMap,clearcoatRoughnessMap:d&&!!t.clearcoatRoughnessMap,clearcoatNormalMap:d&&!!t.clearcoatNormalMap,displacementMap:!!t.displacementMap,roughnessMap:!!t.roughnessMap,metalnessMap:!!t.metalnessMap,specularMap:!!t.specularMap,specularIntensityMap:!!t.specularIntensityMap,specularTintMap:!!t.specularTintMap,specularTintMapEncoding:T(t.specularTintMap),alphaMap:!!t.alphaMap,alphaTest:u,gradientMap:!!t.gradientMap,sheenTint:!!t.sheenTint&&(0<t.sheenTint.r||0<t.sheenTint.g||0<t.sheenTint.b),transmission:0<t.transmission,transmissionMap:!!t.transmissionMap,thicknessMap:!!t.thicknessMap,combine:t.combine,vertexTangents:!!t.normalMap&&!!r.geometry&&!!r.geometry.attributes.tangent,vertexColors:t.vertexColors,vertexAlphas:!0===t.vertexColors&&!!r.geometry&&!!r.geometry.attributes.color&&4===r.geometry.attributes.color.itemSize,vertexUvs:!!(t.map||t.bumpMap||t.normalMap||t.specularMap||t.alphaMap||t.emissiveMap||t.roughnessMap||t.metalnessMap||t.clearcoatMap||t.clearcoatRoughnessMap||t.clearcoatNormalMap||t.displacementMap||t.transmissionMap||t.thicknessMap||t.specularIntensityMap||t.specularTintMap),uvsVertexOnly:!(t.map||t.bumpMap||t.normalMap||t.specularMap||t.alphaMap||t.emissiveMap||t.roughnessMap||t.metalnessMap||t.clearcoatNormalMap||0<t.transmission||t.transmissionMap||t.thicknessMap||t.specularIntensityMap||t.specularTintMap||!t.displacementMap),fog:!!s,useFog:t.fog,fogExp2:s&&s.isFogExp2,flatShading:!!t.flatShading,sizeAttenuation:t.sizeAttenuation,logarithmicDepthBuffer:_,skinning:!0===r.isSkinnedMesh&&0<o,maxBones:o,useVertexTexture:b,morphTargets:!!r.geometry&&!!r.geometry.morphAttributes.position,morphNormals:!!r.geometry&&!!r.geometry.morphAttributes.normal,numDirLights:e.directional.length,numPointLights:e.point.length,numSpotLights:e.spot.length,numRectAreaLights:e.rectArea.length,numHemiLights:e.hemi.length,numDirLightShadows:e.directionalShadowMap.length,numPointLightShadows:e.pointShadowMap.length,numSpotLightShadows:e.spotShadowMap.length,numClippingPlanes:y.numPlanes,numClipIntersection:y.numIntersection,format:t.format,dithering:t.dithering,shadowMapEnabled:p.shadowMap.enabled&&0<n.length,shadowMapType:p.shadowMap.type,toneMapping:t.toneMapped?p.toneMapping:It,physicallyCorrectLights:p.physicallyCorrectLights,premultipliedAlpha:t.premultipliedAlpha,doubleSided:t.side===Rt,flipSided:t.side===Lt,depthPacking:void 0!==t.depthPacking&&t.depthPacking,index0AttributeName:t.index0AttributeName,extensionDerivatives:t.extensions&&t.extensions.derivatives,extensionFragDepth:t.extensions&&t.extensions.fragDepth,extensionDrawBuffers:t.extensions&&t.extensions.drawBuffers,extensionShaderTextureLOD:t.extensions&&t.extensions.shaderTextureLOD,rendererExtensionFragDepth:x||v.has("EXT_frag_depth"),rendererExtensionDrawBuffers:x||v.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:x||v.has("EXT_shader_texture_lod"),customProgramCacheKey:t.customProgramCacheKey()}},getProgramCacheKey:function(e){const n=[];if(e.shaderID?n.push(e.shaderID):(n.push(e.fragmentShader),n.push(e.vertexShader)),void 0!==e.defines)for(const t in e.defines)n.push(t),n.push(e.defines[t]);if(!1===e.isRawShaderMaterial){for(let t=0;t<i.length;t++)n.push(e[i[t]]);n.push(p.outputEncoding),n.push(p.gammaFactor)}return n.push(e.customProgramCacheKey),n.join()},getUniforms:function(t){var e=E[t.type];let n;return n=e?(e=vr[e],Ji.clone(e.uniforms)):t.uniforms,n},acquireProgram:function(t,n){let i;for(let t=0,e=s.length;t<e;t++){var r=s[t];if(r.cacheKey===n){i=r,++i.usedTimes;break}}return void 0===i&&(i=new wo(p,n,t,e),s.push(i)),i},releaseProgram:function(t){var e;0==--t.usedTimes&&(e=s.indexOf(t),s[e]=s[s.length-1],s.pop(),t.destroy())},programs:s}}function So(){let i=new WeakMap;return{get:function(t){let e=i.get(t);return void 0===e&&(e={},i.set(t,e)),e},remove:function(t){i.delete(t)},update:function(t,e,n){i.get(t)[e]=n},dispose:function(){i=new WeakMap}}}function Eo(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program!==e.program?t.program.id-e.program.id:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function To(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function Ao(l){const h=[];let c=0;const o=[],a=[],u=[],d={id:-1};function p(t,e,n,i,r,s){let o=h[c];var a=l.get(n);return void 0===o?(o={id:t.id,object:t,geometry:e,material:n,program:a.program||d,groupOrder:i,renderOrder:t.renderOrder,z:r,group:s},h[c]=o):(o.id=t.id,o.object=t,o.geometry=e,o.material=n,o.program=a.program||d,o.groupOrder=i,o.renderOrder=t.renderOrder,o.z=r,o.group=s),c++,o}return{opaque:o,transmissive:a,transparent:u,init:function(){c=0,o.length=0,a.length=0,u.length=0},push:function(t,e,n,i,r,s){s=p(t,e,n,i,r,s),(0<n.transmission?a:!0===n.transparent?u:o).push(s)},unshift:function(t,e,n,i,r,s){s=p(t,e,n,i,r,s),(0<n.transmission?a:!0===n.transparent?u:o).unshift(s)},finish:function(){for(let t=c,e=h.length;t<e;t++){const n=h[t];if(null===n.id)break;n.id=null,n.object=null,n.geometry=null,n.material=null,n.program=null,n.group=null}},sort:function(t,e){1<o.length&&o.sort(t||Eo),1<a.length&&a.sort(e||To),1<u.length&&u.sort(e||To)}}}function Co(i){let r=new WeakMap;return{get:function(t,e){let n;return!1===r.has(t)?(n=new Ao(i),r.set(t,[n])):e>=r.get(t).length?(n=new Ao(i),r.get(t).push(n)):n=r.get(t)[e],n},dispose:function(){r=new WeakMap}}}function Po(){const n={};return{get:function(t){if(void 0!==n[t.id])return n[t.id];let e;switch(t.type){case"DirectionalLight":e={direction:new We,color:new di};break;case"SpotLight":e={position:new We,direction:new We,color:new di,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":e={position:new We,color:new di,distance:0,decay:0};break;case"HemisphereLight":e={direction:new We,skyColor:new di,groundColor:new di};break;case"RectAreaLight":e={color:new di,position:new We,halfWidth:new We,halfHeight:new We}}return n[t.id]=e,e}}}let Lo=0;function Ro(t,e){return(e.castShadow?1:0)-(t.castShadow?1:0)}function Io(P,L){const R=new Po,I=function(){const n={};return{get:function(t){if(void 0!==n[t.id])return n[t.id];let e;switch(t.type){case"DirectionalLight":case"SpotLight":e={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ie};break;case"PointLight":e={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ie,shadowCameraNear:1,shadowCameraFar:1e3}}return n[t.id]=e,e}}}(),z={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let t=0;t<9;t++)z.probe.push(new We);const f=new We,v=new bn,g=new bn;return{setup:function(n,t){let i=0,r=0,s=0;for(let t=0;t<9;t++)z.probe[t].set(0,0,0);let o=0,a=0,l=0,h=0,c=0,u=0,d=0,p=0;n.sort(Ro);var m=!0!==t?Math.PI:1;for(let t=0,e=n.length;t<e;t++){var f=n[t],v=f.color,g=f.intensity,y=f.distance,x=f.shadow&&f.shadow.map?f.shadow.map.texture:null;if(f.isAmbientLight)i+=v.r*g*m,r+=v.g*g*m,s+=v.b*g*m;else if(f.isLightProbe)for(let t=0;t<9;t++)z.probe[t].addScaledVector(f.sh.coefficients[t],g);else if(f.isDirectionalLight){const b=R.get(f);if(b.color.copy(f.color).multiplyScalar(f.intensity*m),f.castShadow){var _=f.shadow;const w=I.get(f);w.shadowBias=_.bias,w.shadowNormalBias=_.normalBias,w.shadowRadius=_.radius,w.shadowMapSize=_.mapSize,z.directionalShadow[o]=w,z.directionalShadowMap[o]=x,z.directionalShadowMatrix[o]=f.shadow.matrix,u++}z.directional[o]=b,o++}else if(f.isSpotLight){const M=R.get(f);if(M.position.setFromMatrixPosition(f.matrixWorld),M.color.copy(v).multiplyScalar(g*m),M.distance=y,M.coneCos=Math.cos(f.angle),M.penumbraCos=Math.cos(f.angle*(1-f.penumbra)),M.decay=f.decay,f.castShadow){y=f.shadow;const S=I.get(f);S.shadowBias=y.bias,S.shadowNormalBias=y.normalBias,S.shadowRadius=y.radius,S.shadowMapSize=y.mapSize,z.spotShadow[l]=S,z.spotShadowMap[l]=x,z.spotShadowMatrix[l]=f.shadow.matrix,p++}z.spot[l]=M,l++}else if(f.isRectAreaLight){const E=R.get(f);E.color.copy(v).multiplyScalar(g),E.halfWidth.set(.5*f.width,0,0),E.halfHeight.set(0,.5*f.height,0),z.rectArea[h]=E,h++}else if(f.isPointLight){const T=R.get(f);if(T.color.copy(f.color).multiplyScalar(f.intensity*m),T.distance=f.distance,T.decay=f.decay,f.castShadow){v=f.shadow;const A=I.get(f);A.shadowBias=v.bias,A.shadowNormalBias=v.normalBias,A.shadowRadius=v.radius,A.shadowMapSize=v.mapSize,A.shadowCameraNear=v.camera.near,A.shadowCameraFar=v.camera.far,z.pointShadow[a]=A,z.pointShadowMap[a]=x,z.pointShadowMatrix[a]=f.shadow.matrix,d++}z.point[a]=T,a++}else if(f.isHemisphereLight){const C=R.get(f);C.skyColor.copy(f.color).multiplyScalar(g*m),C.groundColor.copy(f.groundColor).multiplyScalar(g*m),z.hemi[c]=C,c++}}0<h&&(L.isWebGL2||!0===P.has("OES_texture_float_linear")?(z.rectAreaLTC1=fr.LTC_FLOAT_1,z.rectAreaLTC2=fr.LTC_FLOAT_2):!0===P.has("OES_texture_half_float_linear")?(z.rectAreaLTC1=fr.LTC_HALF_1,z.rectAreaLTC2=fr.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),z.ambient[0]=i,z.ambient[1]=r,z.ambient[2]=s;const e=z.hash;e.directionalLength===o&&e.pointLength===a&&e.spotLength===l&&e.rectAreaLength===h&&e.hemiLength===c&&e.numDirectionalShadows===u&&e.numPointShadows===d&&e.numSpotShadows===p||(z.directional.length=o,z.spot.length=l,z.rectArea.length=h,z.point.length=a,z.hemi.length=c,z.directionalShadow.length=u,z.directionalShadowMap.length=u,z.pointShadow.length=d,z.pointShadowMap.length=d,z.spotShadow.length=p,z.spotShadowMap.length=p,z.directionalShadowMatrix.length=u,z.pointShadowMatrix.length=d,z.spotShadowMatrix.length=p,e.directionalLength=o,e.pointLength=a,e.spotLength=l,e.rectAreaLength=h,e.hemiLength=c,e.numDirectionalShadows=u,e.numPointShadows=d,e.numSpotShadows=p,z.version=Lo++)},setupView:function(n,t){let i=0,r=0,s=0,o=0,a=0;var l=t.matrixWorldInverse;for(let t=0,e=n.length;t<e;t++){var h=n[t];if(h.isDirectionalLight){const c=z.directional[i];c.direction.setFromMatrixPosition(h.matrixWorld),f.setFromMatrixPosition(h.target.matrixWorld),c.direction.sub(f),c.direction.transformDirection(l),i++}else if(h.isSpotLight){const u=z.spot[s];u.position.setFromMatrixPosition(h.matrixWorld),u.position.applyMatrix4(l),u.direction.setFromMatrixPosition(h.matrixWorld),f.setFromMatrixPosition(h.target.matrixWorld),u.direction.sub(f),u.direction.transformDirection(l),s++}else if(h.isRectAreaLight){const d=z.rectArea[o];d.position.setFromMatrixPosition(h.matrixWorld),d.position.applyMatrix4(l),g.identity(),v.copy(h.matrixWorld),v.premultiply(l),g.extractRotation(v),d.halfWidth.set(.5*h.width,0,0),d.halfHeight.set(0,.5*h.height,0),d.halfWidth.applyMatrix4(g),d.halfHeight.applyMatrix4(g),o++}else if(h.isPointLight){const p=z.point[r];p.position.setFromMatrixPosition(h.matrixWorld),p.position.applyMatrix4(l),r++}else if(h.isHemisphereLight){const m=z.hemi[a];m.direction.setFromMatrixPosition(h.matrixWorld),m.direction.transformDirection(l),m.direction.normalize(),a++}}},state:z}}function zo(t,e){const n=new Io(t,e),i=[],r=[];return{init:function(){i.length=0,r.length=0},state:{lightsArray:i,shadowsArray:r,lights:n},setupLights:function(t){n.setup(i,t)},setupLightsView:function(t){n.setupView(i,t)},pushLight:function(t){i.push(t)},pushShadow:function(t){r.push(t)}}}function No(i,r){let s=new WeakMap;return{get:function(t,e=0){let n;return!1===s.has(t)?(n=new zo(i,r),s.set(t,[n])):e>=s.get(t).length?(n=new zo(i,r),s.get(t).push(n)):n=s.get(t)[e],n},dispose:function(){s=new WeakMap}}}class Bo extends si{constructor(t){super(),this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}Bo.prototype.isMeshDepthMaterial=!0;class Do extends si{constructor(t){super(),this.type="MeshDistanceMaterial",this.referencePosition=new We,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(t)}copy(t){return super.copy(t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}Do.prototype.isMeshDistanceMaterial=!0;var Fo="uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\nuniform float samples;\n#include <packing>\nvoid main() {\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}",ko="void main() {\n\tgl_Position = vec4( position, 1.0 );\n}";function Oo(f,v,t){let g=new cr;const m=new Ie,y=new Ie,x=new Oe,h=new Bo({depthPacking:n}),c=new Do,u={},_=t.maxTextureSize,d={0:Lt,1:Pt,2:Rt},b=new Qi({uniforms:{shadow_pass:{value:null},resolution:{value:new Ie},radius:{value:4},samples:{value:8}},vertexShader:ko,fragmentShader:Fo}),w=b.clone();w.defines.HORIZONTAL_PASS=1;const e=new Ci;e.setAttribute("position",new vi(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const M=new qi(e,b),S=this;function E(n,t,i,e,r,s,o){let a=null;var l=!0===e.isPointLight?n.customDistanceMaterial:n.customDepthMaterial;if(a=void 0!==l?l:!0===e.isPointLight?c:h,f.localClippingEnabled&&!0===i.clipShadows&&0!==i.clippingPlanes.length||i.displacementMap&&0!==i.displacementScale||i.alphaMap&&0<i.alphaTest){n=a.uuid,l=i.uuid;let t=u[n];void 0===t&&(t={},u[n]=t);let e=t[l];void 0===e&&(e=a.clone(),t[l]=e),a=e}return a.visible=i.visible,a.wireframe=i.wireframe,o===A?a.side=null!==i.shadowSide?i.shadowSide:i.side:a.side=null!==i.shadowSide?i.shadowSide:d[i.side],a.alphaMap=i.alphaMap,a.alphaTest=i.alphaTest,a.clipShadows=i.clipShadows,a.clippingPlanes=i.clippingPlanes,a.clipIntersection=i.clipIntersection,a.displacementMap=i.displacementMap,a.displacementScale=i.displacementScale,a.displacementBias=i.displacementBias,a.wireframeLinewidth=i.wireframeLinewidth,a.linewidth=i.linewidth,!0===e.isPointLight&&!0===a.isMeshDistanceMaterial&&(a.referencePosition.setFromMatrixPosition(e.matrixWorld),a.nearDistance=r,a.farDistance=s),a}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=T,this.render=function(n,i,r){if(!1!==S.enabled&&(!1!==S.autoUpdate||!1!==S.needsUpdate)&&0!==n.length){var t=f.getRenderTarget(),e=f.getActiveCubeFace(),s=f.getActiveMipmapLevel();const d=f.state;d.setBlending(Y),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);for(let t=0,e=n.length;t<e;t++){var o=n[t];const p=o.shadow;if(void 0!==p){if(!1!==p.autoUpdate||!1!==p.needsUpdate){m.copy(p.mapSize);var a,l,h=p.getFrameExtents();m.multiply(h),y.copy(p.mapSize),(m.x>_||m.y>_)&&(m.x>_&&(y.x=Math.floor(_/h.x),m.x=y.x*h.x,p.mapSize.x=y.x),m.y>_&&(y.y=Math.floor(_/h.y),m.y=y.y*h.y,p.mapSize.y=y.y)),null!==p.map||p.isPointLightShadow||this.type!==A||(a={minFilter:W,magFilter:W,format:Ot},p.map=new Ve(m.x,m.y,a),p.map.texture.name=o.name+".shadowMap",p.mapPass=new Ve(m.x,m.y,a),p.camera.updateProjectionMatrix()),null===p.map&&(l={minFilter:Nt,magFilter:Nt,format:Ot},p.map=new Ve(m.x,m.y,l),p.map.texture.name=o.name+".shadowMap",p.camera.updateProjectionMatrix()),f.setRenderTarget(p.map),f.clear();var c=p.getViewportCount();for(let t=0;t<c;t++){var u=p.getViewport(t);x.set(y.x*u.x,y.y*u.y,y.x*u.z,y.y*u.w),d.viewport(x),p.updateMatrices(o,t),g=p.getFrustum(),function n(i,r,s,o,a){if(!1===i.visible)return;const t=i.layers.test(r.layers);if(t&&(i.isMesh||i.isLine||i.isPoints)&&(i.castShadow||i.receiveShadow&&a===A)&&(!i.frustumCulled||g.intersectsObject(i))){i.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,i.matrixWorld);const h=v.update(i),c=i.material;if(Array.isArray(c)){const u=h.groups;for(let t=0,e=u.length;t<e;t++){const d=u[t],p=c[d.materialIndex];if(p&&p.visible){const m=E(i,h,p,o,s.near,s.far,a);f.renderBufferDirect(s,null,h,m,i,d)}}}else if(c.visible){const e=E(i,h,c,o,s.near,s.far,a);f.renderBufferDirect(s,null,h,e,i,null)}}const l=i.children;for(let t=0,e=l.length;t<e;t++)n(l[t],r,s,o,a)}(i,r,p.camera,o,this.type)}p.isPointLightShadow||this.type!==A||(h=p,a=r,l=void 0,l=v.update(M),b.uniforms.shadow_pass.value=h.map.texture,b.uniforms.resolution.value=h.mapSize,b.uniforms.radius.value=h.radius,b.uniforms.samples.value=h.blurSamples,f.setRenderTarget(h.mapPass),f.clear(),f.renderBufferDirect(a,null,l,b,M,null),w.uniforms.shadow_pass.value=h.mapPass.texture,w.uniforms.resolution.value=h.mapSize,w.uniforms.radius.value=h.radius,w.uniforms.samples.value=h.blurSamples,f.setRenderTarget(h.map),f.clear(),f.renderBufferDirect(a,null,l,w,M,null)),p.needsUpdate=!1}}else console.warn("THREE.WebGLShadowMap:",o,"has no shadow.")}S.needsUpdate=!1,f.setRenderTarget(t,e,s)}}}function Vo(c,t,e){const n=e.isWebGL2;const i=new function(){let e=!1;const s=new Oe;let n=null;const o=new Oe(0,0,0,0);return{setMask:function(t){n===t||e||(c.colorMask(t,t,t,t),n=t)},setLocked:function(t){e=t},setClear:function(t,e,n,i,r){!0===r&&(t*=i,e*=i,n*=i),s.set(t,e,n,i),!1===o.equals(s)&&(c.clearColor(t,e,n,i),o.copy(s))},reset:function(){e=!1,n=null,o.set(-1,0,0,0)}}},r=new function(){let e=!1,n=null,i=null,r=null;return{setTest:function(t){(t?D:F)(2929)},setMask:function(t){n===t||e||(c.depthMask(t),n=t)},setFunc:function(t){if(i!==t){if(t)switch(t){case vt:c.depthFunc(512);break;case gt:c.depthFunc(519);break;case yt:c.depthFunc(513);break;case xt:c.depthFunc(515);break;case _t:c.depthFunc(514);break;case bt:c.depthFunc(518);break;case wt:c.depthFunc(516);break;case Mt:c.depthFunc(517);break;default:c.depthFunc(515)}else c.depthFunc(515);i=t}},setLocked:function(t){e=t},setClear:function(t){r!==t&&(c.clearDepth(t),r=t)},reset:function(){e=!1,n=null,i=null,r=null}}},s=new function(){let e=!1,n=null,i=null,r=null,s=null,o=null,a=null,l=null,h=null;return{setTest:function(t){e||(t?D:F)(2960)},setMask:function(t){n===t||e||(c.stencilMask(t),n=t)},setFunc:function(t,e,n){i===t&&r===e&&s===n||(c.stencilFunc(t,e,n),i=t,r=e,s=n)},setOp:function(t,e,n){o===t&&a===e&&l===n||(c.stencilOp(t,e,n),o=t,a=e,l=n)},setLocked:function(t){e=t},setClear:function(t){h!==t&&(c.clearStencil(t),h=t)},reset:function(){e=!1,n=null,i=null,r=null,s=null,o=null,a=null,l=null,h=null}}};let o={},a=null,l={},h=null,u=!1,d=null,p=null,m=null,f=null,v=null,g=null,y=null,x=!1,_=null,b=null,w=null,M=null,S=null;const E=c.getParameter(35661);let T=!1,A=0;const C=c.getParameter(7938);-1!==C.indexOf("WebGL")?(A=parseFloat(/^WebGL (\d)/.exec(C)[1]),T=1<=A):-1!==C.indexOf("OpenGL ES")&&(A=parseFloat(/^OpenGL ES (\d)/.exec(C)[1]),T=2<=A);let P=null,L={};var R=c.getParameter(3088),e=c.getParameter(2978);const I=(new Oe).fromArray(R),z=(new Oe).fromArray(e);function N(t,e,n){var i=new Uint8Array(4),r=c.createTexture();c.bindTexture(t,r),c.texParameteri(t,10241,9728),c.texParameteri(t,10240,9728);for(let t=0;t<n;t++)c.texImage2D(e+t,0,6408,1,1,0,6408,5121,i);return r}const B={};function D(t){!0!==o[t]&&(c.enable(t),o[t]=!0)}function F(t){!1!==o[t]&&(c.disable(t),o[t]=!1)}B[3553]=N(3553,3553,1),B[34067]=N(34067,34069,6),i.setClear(0,0,0,1),r.setClear(1),s.setClear(0),D(2929),r.setFunc(xt),U(!1),H(q),D(2884),V(Y);const k={[tt]:32774,[et]:32778,[nt]:32779};n?(k[it]=32775,k[rt]=32776):null!==(t=t.get("EXT_blend_minmax"))&&(k[it]=t.MIN_EXT,k[rt]=t.MAX_EXT);const O={[st]:0,[ot]:1,[at]:768,[ht]:770,[ft]:776,[pt]:774,[ut]:772,[lt]:769,[ct]:771,[mt]:775,[dt]:773};function V(t,e,n,i,r,s,o,a){if(t!==Y){if(!1===u&&(D(3042),u=!0),t===$)r=r||e,s=s||n,o=o||i,e===p&&r===v||(c.blendEquationSeparate(k[e],k[r]),p=e,v=r),n===m&&i===f&&s===g&&o===y||(c.blendFuncSeparate(O[n],O[i],O[s],O[o]),m=n,f=i,g=s,y=o),d=t,x=null;else if(t!==d||a!==x){if(p===tt&&v===tt||(c.blendEquation(32774),p=tt,v=tt),a)switch(t){case Z:c.blendFuncSeparate(1,771,1,771);break;case K:c.blendFunc(1,1);break;case J:c.blendFuncSeparate(0,0,769,771);break;case Q:c.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case Z:c.blendFuncSeparate(770,771,1,771);break;case K:c.blendFunc(770,1);break;case J:c.blendFunc(0,769);break;case Q:c.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}m=null,f=null,g=null,y=null,d=t,x=a}}else!0===u&&(F(3042),u=!1)}function U(t){_!==t&&(t?c.frontFace(2304):c.frontFace(2305),_=t)}function H(t){t!==j?(D(2884),t!==b&&(t===q?c.cullFace(1029):t===X?c.cullFace(1028):c.cullFace(1032))):F(2884),b=t}function W(t,e,n){t?(D(32823),M===e&&S===n||(c.polygonOffset(e,n),M=e,S=n)):F(32823)}function G(t){void 0===t&&(t=33984+E-1),P!==t&&(c.activeTexture(t),P=t)}return{buffers:{color:i,depth:r,stencil:s},enable:D,disable:F,bindFramebuffer:function(t,e){return null===e&&null!==a&&(e=a),l[t]!==e&&(c.bindFramebuffer(t,e),l[t]=e,n&&(36009===t&&(l[36160]=e),36160===t&&(l[36009]=e)),!0)},bindXRFramebuffer:function(t){t!==a&&(c.bindFramebuffer(36160,t),a=t)},useProgram:function(t){return h!==t&&(c.useProgram(t),h=t,!0)},setBlending:V,setMaterial:function(t,e){(t.side===Rt?F:D)(2884);let n=t.side===Lt;e&&(n=!n),U(n),t.blending===Z&&!1===t.transparent?V(Y):V(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),r.setFunc(t.depthFunc),r.setTest(t.depthTest),r.setMask(t.depthWrite),i.setMask(t.colorWrite),e=t.stencilWrite,s.setTest(e),e&&(s.setMask(t.stencilWriteMask),s.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),s.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),W(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),(!0===t.alphaToCoverage?D:F)(32926)},setFlipSided:U,setCullFace:H,setLineWidth:function(t){t!==w&&(T&&c.lineWidth(t),w=t)},setPolygonOffset:W,setScissorTest:function(t){(t?D:F)(3089)},activeTexture:G,bindTexture:function(t,e){null===P&&G();let n=L[P];void 0===n&&(n={type:void 0,texture:void 0},L[P]=n),n.type===t&&n.texture===e||(c.bindTexture(t,e||B[t]),n.type=t,n.texture=e)},unbindTexture:function(){const t=L[P];void 0!==t&&void 0!==t.type&&(c.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{c.compressedTexImage2D.apply(c,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{c.texImage2D.apply(c,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{c.texImage3D.apply(c,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(t){!1===I.equals(t)&&(c.scissor(t.x,t.y,t.z,t.w),I.copy(t))},viewport:function(t){!1===z.equals(t)&&(c.viewport(t.x,t.y,t.z,t.w),z.copy(t))},reset:function(){c.disable(3042),c.disable(2884),c.disable(2929),c.disable(32823),c.disable(3089),c.disable(2960),c.disable(32926),c.blendEquation(32774),c.blendFunc(1,0),c.blendFuncSeparate(1,0,1,0),c.colorMask(!0,!0,!0,!0),c.clearColor(0,0,0,0),c.depthMask(!0),c.depthFunc(513),c.clearDepth(1),c.stencilMask(4294967295),c.stencilFunc(519,0,4294967295),c.stencilOp(7680,7680,7680),c.clearStencil(0),c.cullFace(1029),c.frontFace(2305),c.polygonOffset(0,0),c.activeTexture(33984),c.bindFramebuffer(36160,null),!0===n&&(c.bindFramebuffer(36009,null),c.bindFramebuffer(36008,null)),c.useProgram(null),c.lineWidth(1),c.scissor(0,0,c.canvas.width,c.canvas.height),c.viewport(0,0,c.canvas.width,c.canvas.height),o={},P=null,L={},a=null,l={},h=null,u=!1,d=null,p=null,m=null,f=null,v=null,g=null,y=null,x=!1,_=null,b=null,w=null,M=null,S=null,I.set(0,0,c.canvas.width,c.canvas.height),z.set(0,0,c.canvas.width,c.canvas.height),i.reset(),r.reset(),s.reset()}}}function Uo(f,r,v,g,y,x,_){const b=y.isWebGL2,e=y.maxTextures,m=y.maxCubemapSize,c=y.maxTextureSize,n=y.maxSamples,s=new WeakMap;let l,i=!1;try{i="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(t){}function h(t,e){return i?new OffscreenCanvas(t,e):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function w(t,e,n,i){let r=1;if((t.width>i||t.height>i)&&(r=i/Math.max(t.width,t.height)),r<1||!0===e){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const s=e?Le:Math.floor;i=s(r*t.width),e=s(r*t.height);void 0===l&&(l=h(i,e));const o=n?h(i,e):l;o.width=i,o.height=e;const a=o.getContext("2d");return a.drawImage(t,0,0,i,e),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+t.width+"x"+t.height+") to ("+i+"x"+e+")."),o}return"data"in t&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+t.width+"x"+t.height+")."),t}return t}function M(t){return Ce(t.width)&&Ce(t.height)}function S(t,e){return t.generateMipmaps&&e&&t.minFilter!==Nt&&t.minFilter!==W}function E(t,e,n,i,r=1){f.generateMipmap(t);const s=g.get(e);s.__maxMipLevel=Math.log2(Math.max(n,i,r))}function T(t,e,n){if(!1===b)return e;if(null!==t){if(void 0!==f[t])return f[t];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+t+"'")}let i=e;return 6403===e&&(5126===n&&(i=33326),5131===n&&(i=33325),5121===n&&(i=33321)),6407===e&&(5126===n&&(i=34837),5131===n&&(i=34843),5121===n&&(i=32849)),6408===e&&(5126===n&&(i=34836),5131===n&&(i=34842),5121===n&&(i=32856)),33325!==i&&33326!==i&&34842!==i&&34836!==i||r.get("EXT_color_buffer_float"),i}function o(t){return t===Nt||t===U||t===H?9728:9729}function a(t){const e=t.target;var n;e.removeEventListener("dispose",a),n=e,void 0!==(t=g.get(n)).__webglInit&&(f.deleteTexture(t.__webglTexture),g.remove(n)),e.isVideoTexture&&s.delete(e),_.memory.textures--}function A(t){const e=t.target;e.removeEventListener("dispose",A),function(t){var n=t.texture,e=g.get(t),i=g.get(n);if(t){if(void 0!==i.__webglTexture&&(f.deleteTexture(i.__webglTexture),_.memory.textures--),t.depthTexture&&t.depthTexture.dispose(),t.isWebGLCubeRenderTarget)for(let t=0;t<6;t++)f.deleteFramebuffer(e.__webglFramebuffer[t]),e.__webglDepthbuffer&&f.deleteRenderbuffer(e.__webglDepthbuffer[t]);else f.deleteFramebuffer(e.__webglFramebuffer),e.__webglDepthbuffer&&f.deleteRenderbuffer(e.__webglDepthbuffer),e.__webglMultisampledFramebuffer&&f.deleteFramebuffer(e.__webglMultisampledFramebuffer),e.__webglColorRenderbuffer&&f.deleteRenderbuffer(e.__webglColorRenderbuffer),e.__webglDepthRenderbuffer&&f.deleteRenderbuffer(e.__webglDepthRenderbuffer);if(t.isWebGLMultipleRenderTargets)for(let t=0,e=n.length;t<e;t++){var r=g.get(n[t]);r.__webglTexture&&(f.deleteTexture(r.__webglTexture),_.memory.textures--),g.remove(n[t])}g.remove(n),g.remove(t)}}(e)}let u=0;function d(t,e){var n,i=g.get(t);if(t.isVideoTexture&&(r=t,n=_.render.frame,s.get(r)!==n&&(s.set(r,n),r.update())),0<t.version&&i.__version!==t.version){var r=t.image;if(void 0===r)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==r.complete)return void I(i,t,e);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}v.activeTexture(33984+e),v.bindTexture(3553,i.__webglTexture)}function p(t,e){var n=g.get(t);0<t.version&&n.__version!==t.version?function(t,i,e){if(6===i.image.length){R(t,i),v.activeTexture(33984+e),v.bindTexture(34067,t.__webglTexture),f.pixelStorei(37440,i.flipY),f.pixelStorei(37441,i.premultiplyAlpha),f.pixelStorei(3317,i.unpackAlignment),f.pixelStorei(37443,0);var r=i&&(i.isCompressedTexture||i.image[0].isCompressedTexture),s=i.image[0]&&i.image[0].isDataTexture;const p=[];for(let t=0;t<6;t++)p[t]=r||s?s?i.image[t].image:i.image[t]:w(i.image[t],!1,!0,m);var o=p[0],e=M(o)||b,a=x.convert(i.format),l=x.convert(i.type),h=T(i.internalFormat,a,l);L(34067,i,e);let n;if(r){for(let e=0;e<6;e++){n=p[e].mipmaps;for(let t=0;t<n.length;t++){var c=n[t];i.format!==Ot&&i.format!==Tt?null!==a?v.compressedTexImage2D(34069+e,t,h,c.width,c.height,0,c.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):v.texImage2D(34069+e,t,h,c.width,c.height,0,a,l,c.data)}}t.__maxMipLevel=n.length-1}else{n=i.mipmaps;for(let e=0;e<6;e++)if(s){v.texImage2D(34069+e,0,h,p[e].width,p[e].height,0,a,l,p[e].data);for(let t=0;t<n.length;t++){var u=n[t].image[e].image;v.texImage2D(34069+e,t+1,h,u.width,u.height,0,a,l,u.data)}}else{v.texImage2D(34069+e,0,h,a,l,p[e]);for(let t=0;t<n.length;t++){var d=n[t];v.texImage2D(34069+e,t+1,h,a,l,d.image[e])}}t.__maxMipLevel=n.length}S(i,e)&&E(34067,i,o.width,o.height),t.__version=i.version,i.onUpdate&&i.onUpdate(i)}}(n,t,e):(v.activeTexture(33984+e),v.bindTexture(34067,n.__webglTexture))}const C={[O]:10497,[zt]:33071,[V]:33648},P={[Nt]:9728,[U]:9984,[H]:9986,[W]:9729,[t]:9985,[Bt]:9987};function L(t,e,n){n?(f.texParameteri(t,10242,C[e.wrapS]),f.texParameteri(t,10243,C[e.wrapT]),32879!==t&&35866!==t||f.texParameteri(t,32882,C[e.wrapR]),f.texParameteri(t,10240,P[e.magFilter]),f.texParameteri(t,10241,P[e.minFilter])):(f.texParameteri(t,10242,33071),f.texParameteri(t,10243,33071),32879!==t&&35866!==t||f.texParameteri(t,32882,33071),e.wrapS===zt&&e.wrapT===zt||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),f.texParameteri(t,10240,o(e.magFilter)),f.texParameteri(t,10241,o(e.minFilter)),e.minFilter!==Nt&&e.minFilter!==W&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===r.has("EXT_texture_filter_anisotropic")&&(n=r.get("EXT_texture_filter_anisotropic"),e.type===Ft&&!1===r.has("OES_texture_float_linear")||!1===b&&e.type===kt&&!1===r.has("OES_texture_half_float_linear")||(1<e.anisotropy||g.get(e).__currentAnisotropy)&&(f.texParameterf(t,n.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(e.anisotropy,y.getMaxAnisotropy())),g.get(e).__currentAnisotropy=e.anisotropy))}function R(t,e){void 0===t.__webglInit&&(t.__webglInit=!0,e.addEventListener("dispose",a),t.__webglTexture=f.createTexture(),_.memory.textures++)}function I(t,n,e){let i=3553;n.isDataTexture2DArray&&(i=35866),n.isDataTexture3D&&(i=32879),R(t,n),v.activeTexture(33984+e),v.bindTexture(i,t.__webglTexture),f.pixelStorei(37440,n.flipY),f.pixelStorei(37441,n.premultiplyAlpha),f.pixelStorei(3317,n.unpackAlignment),f.pixelStorei(37443,0);var e=(r=n,!b&&(r.wrapS!==zt||r.wrapT!==zt||r.minFilter!==Nt&&r.minFilter!==W)&&!1===M(n.image)),r=w(n.image,e,!1,c),e=M(r)||b,s=x.convert(n.format);let o=x.convert(n.type),a=T(n.internalFormat,s,o);L(i,n,e);let l;var h=n.mipmaps;if(n.isDepthTexture)a=6402,b?a=n.type===Ft?36012:n.type===St?33190:n.type===Et?35056:33189:n.type===Ft&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),n.format===At&&6402===a&&n.type!==G&&n.type!==St&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),n.type=G,o=x.convert(n.type)),n.format===Ct&&6402===a&&(a=34041,n.type!==Et&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),n.type=Et,o=x.convert(n.type))),v.texImage2D(3553,0,a,r.width,r.height,0,s,o,null);else if(n.isDataTexture)if(0<h.length&&e){for(let t=0,e=h.length;t<e;t++)l=h[t],v.texImage2D(3553,t,a,l.width,l.height,0,s,o,l.data);n.generateMipmaps=!1,t.__maxMipLevel=h.length-1}else v.texImage2D(3553,0,a,r.width,r.height,0,s,o,r.data),t.__maxMipLevel=0;else if(n.isCompressedTexture){for(let t=0,e=h.length;t<e;t++)l=h[t],n.format!==Ot&&n.format!==Tt?null!==s?v.compressedTexImage2D(3553,t,a,l.width,l.height,0,l.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):v.texImage2D(3553,t,a,l.width,l.height,0,s,o,l.data);t.__maxMipLevel=h.length-1}else if(n.isDataTexture2DArray)v.texImage3D(35866,0,a,r.width,r.height,r.depth,0,s,o,r.data),t.__maxMipLevel=0;else if(n.isDataTexture3D)v.texImage3D(32879,0,a,r.width,r.height,r.depth,0,s,o,r.data),t.__maxMipLevel=0;else if(0<h.length&&e){for(let t=0,e=h.length;t<e;t++)l=h[t],v.texImage2D(3553,t,a,s,o,l);n.generateMipmaps=!1,t.__maxMipLevel=h.length-1}else v.texImage2D(3553,0,a,s,o,r),t.__maxMipLevel=0;S(n,e)&&E(i,n,r.width,r.height),t.__version=n.version,n.onUpdate&&n.onUpdate(n)}function z(t,e,n,i,r){var s=x.convert(n.format),o=x.convert(n.type),a=T(n.internalFormat,s,o);32879===r||35866===r?v.texImage3D(r,0,a,e.width,e.height,e.depth,0,s,o,null):v.texImage2D(r,0,a,e.width,e.height,0,s,o,null),v.bindFramebuffer(36160,t),f.framebufferTexture2D(36160,i,r,g.get(n).__webglTexture,0),v.bindFramebuffer(36160,null)}function N(e,n,i){if(f.bindRenderbuffer(36161,e),n.depthBuffer&&!n.stencilBuffer){let t=33189;i?((r=n.depthTexture)&&r.isDepthTexture&&(r.type===Ft?t=36012:r.type===St&&(t=33190)),r=D(n),f.renderbufferStorageMultisample(36161,r,t,n.width,n.height)):f.renderbufferStorage(36161,t,n.width,n.height),f.framebufferRenderbuffer(36160,36096,36161,e)}else{var r,t;n.depthBuffer&&n.stencilBuffer?(i?(t=D(n),f.renderbufferStorageMultisample(36161,t,35056,n.width,n.height)):f.renderbufferStorage(36161,34041,n.width,n.height),f.framebufferRenderbuffer(36160,33306,36161,e)):(r=!0===n.isWebGLMultipleRenderTargets?n.texture[0]:n.texture,t=x.convert(r.format),e=x.convert(r.type),e=T(r.internalFormat,t,e),i?(i=D(n),f.renderbufferStorageMultisample(36161,i,e,n.width,n.height)):f.renderbufferStorage(36161,e,n.width,n.height))}f.bindRenderbuffer(36161,null)}function B(e){const n=g.get(e);var t=!0===e.isWebGLCubeRenderTarget;if(e.depthTexture){if(t)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,e){if(e&&e.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(v.bindFramebuffer(36160,t),!e.depthTexture||!e.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");if(g.get(e.depthTexture).__webglTexture&&e.depthTexture.image.width===e.width&&e.depthTexture.image.height===e.height||(e.depthTexture.image.width=e.width,e.depthTexture.image.height=e.height,e.depthTexture.needsUpdate=!0),d(e.depthTexture,0),t=g.get(e.depthTexture).__webglTexture,e.depthTexture.format===At)f.framebufferTexture2D(36160,36096,3553,t,0);else{if(e.depthTexture.format!==Ct)throw new Error("Unknown depthTexture format");f.framebufferTexture2D(36160,33306,3553,t,0)}}(n.__webglFramebuffer,e)}else if(t){n.__webglDepthbuffer=[];for(let t=0;t<6;t++)v.bindFramebuffer(36160,n.__webglFramebuffer[t]),n.__webglDepthbuffer[t]=f.createRenderbuffer(),N(n.__webglDepthbuffer[t],e,!1)}else v.bindFramebuffer(36160,n.__webglFramebuffer),n.__webglDepthbuffer=f.createRenderbuffer(),N(n.__webglDepthbuffer,e,!1);v.bindFramebuffer(36160,null)}function D(t){return b&&t.isWebGLMultisampleRenderTarget?Math.min(n,t.samples):0}let F=!1,k=!1;this.allocateTextureUnit=function(){var t=u;return t>=e&&console.warn("THREE.WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+e),u+=1,t},this.resetTextureUnits=function(){u=0},this.setTexture2D=d,this.setTexture2DArray=function(t,e){var n=g.get(t);0<t.version&&n.__version!==t.version?I(n,t,e):(v.activeTexture(33984+e),v.bindTexture(35866,n.__webglTexture))},this.setTexture3D=function(t,e){var n=g.get(t);0<t.version&&n.__version!==t.version?I(n,t,e):(v.activeTexture(33984+e),v.bindTexture(32879,n.__webglTexture))},this.setTextureCube=p,this.setupRenderTarget=function(n){const e=n.texture,i=g.get(n),r=g.get(e);n.addEventListener("dispose",A),!0!==n.isWebGLMultipleRenderTargets&&(r.__webglTexture=f.createTexture(),r.__version=e.version,_.memory.textures++);var t,s=!0===n.isWebGLCubeRenderTarget,o=!0===n.isWebGLMultipleRenderTargets,a=!0===n.isWebGLMultisampleRenderTarget,l=e.isDataTexture3D||e.isDataTexture2DArray,h=M(n)||b;if(!b||e.format!==Tt||e.type!==Ft&&e.type!==kt||(e.format=Ot,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),s){i.__webglFramebuffer=[];for(let t=0;t<6;t++)i.__webglFramebuffer[t]=f.createFramebuffer()}else if(i.__webglFramebuffer=f.createFramebuffer(),o)if(y.drawBuffers){var c=n.texture;for(let t=0,e=c.length;t<e;t++){const m=g.get(c[t]);void 0===m.__webglTexture&&(m.__webglTexture=f.createTexture(),_.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else a&&(b?(i.__webglMultisampledFramebuffer=f.createFramebuffer(),i.__webglColorRenderbuffer=f.createRenderbuffer(),f.bindRenderbuffer(36161,i.__webglColorRenderbuffer),t=x.convert(e.format),a=x.convert(e.type),t=T(e.internalFormat,t,a),a=D(n),f.renderbufferStorageMultisample(36161,a,t,n.width,n.height),v.bindFramebuffer(36160,i.__webglMultisampledFramebuffer),f.framebufferRenderbuffer(36160,36064,36161,i.__webglColorRenderbuffer),f.bindRenderbuffer(36161,null),n.depthBuffer&&(i.__webglDepthRenderbuffer=f.createRenderbuffer(),N(i.__webglDepthRenderbuffer,n,!0)),v.bindFramebuffer(36160,null)):console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2."));if(s){v.bindTexture(34067,r.__webglTexture),L(34067,e,h);for(let t=0;t<6;t++)z(i.__webglFramebuffer[t],n,e,36064,34069+t);S(e,h)&&E(34067,e,n.width,n.height),v.unbindTexture()}else if(o){var u=n.texture;for(let t=0,e=u.length;t<e;t++){var d=u[t],p=g.get(d);v.bindTexture(3553,p.__webglTexture),L(3553,d,h),z(i.__webglFramebuffer,n,d,36064+t,3553),S(d,h)&&E(3553,d,n.width,n.height)}v.unbindTexture()}else{let t=3553;l&&(b?(l=e.isDataTexture3D,t=l?32879:35866):console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.")),v.bindTexture(t,r.__webglTexture),L(t,e,h),z(i.__webglFramebuffer,n,e,36064,t),S(e,h)&&E(t,e,n.width,n.height,n.depth),v.unbindTexture()}n.depthBuffer&&B(n)},this.updateRenderTargetMipmap=function(n){var i=M(n)||b,r=!0===n.isWebGLMultipleRenderTargets?n.texture:[n.texture];for(let t=0,e=r.length;t<e;t++){var s,o,a=r[t];S(a,i)&&(s=n.isWebGLCubeRenderTarget?34067:3553,o=g.get(a).__webglTexture,v.bindTexture(s,o),E(s,a,n.width,n.height),v.unbindTexture())}},this.updateMultisampleRenderTarget=function(e){if(e.isWebGLMultisampleRenderTarget)if(b){var n=e.width,i=e.height;let t=16384;e.depthBuffer&&(t|=256),e.stencilBuffer&&(t|=1024);e=g.get(e);v.bindFramebuffer(36008,e.__webglMultisampledFramebuffer),v.bindFramebuffer(36009,e.__webglFramebuffer),f.blitFramebuffer(0,0,n,i,0,0,n,i,t,9728),v.bindFramebuffer(36008,null),v.bindFramebuffer(36009,e.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(t,e){t&&t.isWebGLRenderTarget&&(!1===F&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),F=!0),t=t.texture),d(t,e)},this.safeSetTextureCube=function(t,e){t&&t.isWebGLCubeRenderTarget&&(!1===k&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),k=!0),t=t.texture),p(t,e)}}function Ho(t,n,e){const i=e.isWebGL2;return{convert:function(t){let e;if(t===Dt)return 5121;if(t===a)return 32819;if(t===c)return 32820;if(t===u)return 33635;if(t===r)return 5120;if(t===s)return 5122;if(t===G)return 5123;if(t===o)return 5124;if(t===St)return 5125;if(t===Ft)return 5126;if(t===kt)return i?5131:(e=n.get("OES_texture_half_float"),null!==e?e.HALF_FLOAT_OES:null);if(t===d)return 6406;if(t===Tt)return 6407;if(t===Ot)return 6408;if(t===p)return 6409;if(t===m)return 6410;if(t===At)return 6402;if(t===Ct)return 34041;if(t===f)return 6403;if(t===v)return 36244;if(t===g)return 33319;if(t===y)return 33320;if(t===x)return 36248;if(t===_)return 36249;if(t===b||t===w||t===E||t===L){if(e=n.get("WEBGL_compressed_texture_s3tc"),null===e)return null;if(t===b)return e.COMPRESSED_RGB_S3TC_DXT1_EXT;if(t===w)return e.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(t===E)return e.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(t===L)return e.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(t===R||t===I||t===N||t===B){if(e=n.get("WEBGL_compressed_texture_pvrtc"),null===e)return null;if(t===R)return e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(t===I)return e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(t===N)return e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(t===B)return e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(t===D)return e=n.get("WEBGL_compressed_texture_etc1"),null!==e?e.COMPRESSED_RGB_ETC1_WEBGL:null;if((t===F||t===k)&&(e=n.get("WEBGL_compressed_texture_etc"),null!==e)){if(t===F)return e.COMPRESSED_RGB8_ETC2;if(t===k)return e.COMPRESSED_RGBA8_ETC2_EAC}return t===Vt||t===Ut||t===Ht||t===Wt||t===Gt||t===jt||t===qt||t===Xt||t===Yt||t===Zt||t===Kt||t===Jt||t===Qt||t===$t||t===ee||t===ne||t===ie||t===re||t===se||t===oe||t===ae||t===le||t===he||t===ce||t===ue||t===de||t===pe||t===me?(e=n.get("WEBGL_compressed_texture_astc"),null!==e?t:null):t===te?(e=n.get("EXT_texture_compression_bptc"),null!==e?t:null):t===Et?i?34042:(e=n.get("WEBGL_depth_texture"),null!==e?e.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}class Wo extends tr{constructor(t=[]){super(),this.cameras=t}}Wo.prototype.isArrayCamera=!0;class Go extends qn{constructor(){super(),this.type="Group"}}Go.prototype.isGroup=!0;const jo={type:"move"};class qo{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Go,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Go,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new We,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new We),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Go,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new We,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new We),this._grip}dispatchEvent(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),null!==this._hand&&this._hand.dispatchEvent(t),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(t,e,n){let i=null,r=null,s=null;const o=this._targetRay,a=this._grip,l=this._hand;if(t&&"visible-blurred"!==e.session.visibilityState)if(null!==o&&(i=e.getPose(t.targetRaySpace,n),null!==i&&(o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),i.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(i.linearVelocity)):o.hasLinearVelocity=!1,i.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(i.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(jo))),l&&t.hand){s=!0;for(const d of t.hand.values()){var h=e.getJointPose(d,n);if(void 0===l.joints[d.jointName]){const m=new Go;m.matrixAutoUpdate=!1,m.visible=!1,l.joints[d.jointName]=m,l.add(m)}const p=l.joints[d.jointName];null!==h&&(p.matrix.fromArray(h.transform.matrix),p.matrix.decompose(p.position,p.rotation,p.scale),p.jointRadius=h.radius),p.visible=null!==h}const u=l.joints["index-finger-tip"];var c=l.joints["thumb-tip"],c=u.position.distanceTo(c.position);l.inputState.pinching&&.025<c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!l.inputState.pinching&&c<=.015&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else null!==a&&t.gripSpace&&(r=e.getPose(t.gripSpace,n),null!==r&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1));return null!==o&&(o.visible=null!==i),null!==a&&(a.visible=null!==r),null!==l&&(l.visible=null!==s),this}}class Xo extends e{constructor(t,c){super();const n=this,u=t.state;let d=null,i=1,p=null,r="local-floor",m=null,f=null,v=null,g=null,y=null,x=!1,_=null,s=null,o=null,b=null,w=null,M=null;const S=[],a=new Map,l=new tr;l.layers.enable(1),l.viewport=new Oe;const h=new tr;h.layers.enable(2),h.viewport=new Oe;const E=[l,h],T=new Wo;T.layers.enable(1),T.layers.enable(2);let A=null,C=null;function P(t){const e=a.get(t.inputSource);e&&e.dispatchEvent({type:t.type,data:t.inputSource})}function L(){a.forEach(function(t,e){t.disconnect(e)}),a.clear(),A=null,C=null,u.bindXRFramebuffer(null),t.setRenderTarget(t.getRenderTarget()),v&&c.deleteFramebuffer(v),_&&c.deleteFramebuffer(_),s&&c.deleteRenderbuffer(s),o&&c.deleteRenderbuffer(o),v=null,_=null,s=null,o=null,y=null,g=null,f=null,d=null,D.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function R(e){var n=d.inputSources;for(let t=0;t<S.length;t++)a.set(n[t],S[t]);for(let t=0;t<e.removed.length;t++){var i=e.removed[t];const s=a.get(i);s&&(s.dispatchEvent({type:"disconnected",data:i}),a.delete(i))}for(let t=0;t<e.added.length;t++){var r=e.added[t];const o=a.get(r);o&&o.dispatchEvent({type:"connected",data:r})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(t){let e=S[t];return void 0===e&&(e=new qo,S[t]=e),e.getTargetRaySpace()},this.getControllerGrip=function(t){let e=S[t];return void 0===e&&(e=new qo,S[t]=e),e.getGripSpace()},this.getHand=function(t){let e=S[t];return void 0===e&&(e=new qo,S[t]=e),e.getHandSpace()},this.setFramebufferScaleFactor=function(t){i=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(t){r=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return p},this.getBaseLayer=function(){return null!==g?g:y},this.getBinding=function(){return f},this.getFrame=function(){return b},this.getSession=function(){return d},this.setSession=async function(e){if(d=e,null!==d){d.addEventListener("select",P),d.addEventListener("selectstart",P),d.addEventListener("selectend",P),d.addEventListener("squeeze",P),d.addEventListener("squeezestart",P),d.addEventListener("squeezeend",P),d.addEventListener("end",L),d.addEventListener("inputsourceschange",R);e=c.getContextAttributes();if(!0!==e.xrCompatible&&await c.makeXRCompatible(),void 0===d.renderState.layers){var t={antialias:e.antialias,alpha:e.alpha,depth:e.depth,stencil:e.stencil,framebufferScaleFactor:i};y=new XRWebGLLayer(d,c,t),d.updateRenderState({baseLayer:y})}else if(c instanceof WebGLRenderingContext){t={antialias:!0,alpha:e.alpha,depth:e.depth,stencil:e.stencil,framebufferScaleFactor:i};y=new XRWebGLLayer(d,c,t),d.updateRenderState({layers:[y]})}else{x=e.antialias;let t=null;e.depth&&(M=256,e.stencil&&(M|=1024),w=e.stencil?33306:36096,t=e.stencil?35056:33190);e={colorFormat:e.alpha?32856:32849,depthFormat:t,scaleFactor:i};f=new XRWebGLBinding(d,c),g=f.createProjectionLayer(e),v=c.createFramebuffer(),d.updateRenderState({layers:[g]}),x&&(_=c.createFramebuffer(),s=c.createRenderbuffer(),c.bindRenderbuffer(36161,s),c.renderbufferStorageMultisample(36161,4,32856,g.textureWidth,g.textureHeight),u.bindFramebuffer(36160,_),c.framebufferRenderbuffer(36160,36064,36161,s),c.bindRenderbuffer(36161,null),null!==t&&(o=c.createRenderbuffer(),c.bindRenderbuffer(36161,o),c.renderbufferStorageMultisample(36161,4,t,g.textureWidth,g.textureHeight),c.framebufferRenderbuffer(36160,w,36161,o),c.bindRenderbuffer(36161,null)),u.bindFramebuffer(36160,null))}p=await d.requestReferenceSpace(r),D.setContext(d),D.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}};const I=new We,z=new We;function N(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.copy(t.matrixWorld).invert()}this.updateCamera=function(t){if(null!==d){T.near=h.near=l.near=t.near,T.far=h.far=l.far=t.far,A===T.near&&C===T.far||(d.updateRenderState({depthNear:T.near,depthFar:T.far}),A=T.near,C=T.far);var e=t.parent,n=T.cameras;N(T,e);for(let t=0;t<n.length;t++)N(n[t],e);T.matrixWorld.decompose(T.position,T.quaternion,T.scale),t.position.copy(T.position),t.quaternion.copy(T.quaternion),t.scale.copy(T.scale),t.matrix.copy(T.matrix),t.matrixWorld.copy(T.matrixWorld);const i=t.children;for(let t=0,e=i.length;t<e;t++)i[t].updateMatrixWorld(!0);2===n.length?function(t,e,n){I.setFromMatrixPosition(e.matrixWorld),z.setFromMatrixPosition(n.matrixWorld);var i=I.distanceTo(z),r=e.projectionMatrix.elements,s=n.projectionMatrix.elements,o=r[14]/(r[10]-1),a=r[14]/(r[10]+1),l=(r[9]+1)/r[5],h=(r[9]-1)/r[5],c=(r[8]-1)/r[0],n=(s[8]+1)/s[0],r=o*c,s=o*n,c=(n=i/(n-c))*-c;e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(c),t.translateZ(n),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.copy(t.matrixWorld).invert(),o+=n,n=a+n,t.projectionMatrix.makePerspective(r-c,i-c+s,l*a/n*o,h*a/n*o,o,n)}(T,l,h):T.projectionMatrix.copy(l.projectionMatrix)}},this.getCamera=function(){return T},this.getFoveation=function(){return null!==g?g.fixedFoveation:null!==y?y.fixedFoveation:void 0},this.setFoveation=function(t){null!==g&&(g.fixedFoveation=t),null!==y&&void 0!==y.fixedFoveation&&(y.fixedFoveation=t)};let B=null;const D=new ur;D.setAnimationLoop(function(t,e){if(m=e.getViewerPose(p),b=e,null!==m){var i=m.views;null!==y&&u.bindXRFramebuffer(y.framebuffer);let n=!1;i.length!==T.cameras.length&&(T.cameras.length=0,n=!0);for(let e=0;e<i.length;e++){var r,s=i[e];let t=null;t=null!==y?y.getViewport(s):(r=f.getViewSubImage(g,s),u.bindXRFramebuffer(v),void 0!==r.depthStencilTexture&&c.framebufferTexture2D(36160,w,3553,r.depthStencilTexture,0),c.framebufferTexture2D(36160,36064,3553,r.colorTexture,0),r.viewport);const l=E[e];l.matrix.fromArray(s.transform.matrix),l.projectionMatrix.fromArray(s.projectionMatrix),l.viewport.set(t.x,t.y,t.width,t.height),0===e&&T.matrix.copy(l.matrix),!0===n&&T.cameras.push(l)}x&&(u.bindXRFramebuffer(_),null!==M&&c.clear(M))}var n,o=d.inputSources;for(let t=0;t<S.length;t++){const h=S[t];var a=o[t];h.update(a,e,p)}B&&B(t,e),x&&(n=g.textureWidth,t=g.textureHeight,u.bindFramebuffer(36008,_),u.bindFramebuffer(36009,v),c.invalidateFramebuffer(36008,[w]),c.invalidateFramebuffer(36009,[w]),c.blitFramebuffer(0,0,n,t,0,0,n,t,16384,9728),c.invalidateFramebuffer(36008,[36064]),u.bindFramebuffer(36008,null),u.bindFramebuffer(36009,null),u.bindFramebuffer(36160,_)),b=null}),this.setAnimationLoop=function(t){B=t},this.dispose=function(){}}}function Yo(s){function h(t,e){t.opacity.value=e.opacity,e.color&&t.diffuse.value.copy(e.color),e.emissive&&t.emissive.value.copy(e.emissive).multiplyScalar(e.emissiveIntensity),e.map&&(t.map.value=e.map),e.alphaMap&&(t.alphaMap.value=e.alphaMap),e.specularMap&&(t.specularMap.value=e.specularMap),0<e.alphaTest&&(t.alphaTest.value=e.alphaTest);var n=s.get(e).envMap;n&&(t.envMap.value=n,t.flipEnvMap.value=n.isCubeTexture&&!1===n.isRenderTargetTexture?-1:1,t.reflectivity.value=e.reflectivity,t.ior.value=e.ior,t.refractionRatio.value=e.refractionRatio,void 0!==(n=s.get(n).__maxMipLevel)&&(t.maxMipLevel.value=n)),e.lightMap&&(t.lightMap.value=e.lightMap,t.lightMapIntensity.value=e.lightMapIntensity),e.aoMap&&(t.aoMap.value=e.aoMap,t.aoMapIntensity.value=e.aoMapIntensity);let i;e.map?i=e.map:e.specularMap?i=e.specularMap:e.displacementMap?i=e.displacementMap:e.normalMap?i=e.normalMap:e.bumpMap?i=e.bumpMap:e.roughnessMap?i=e.roughnessMap:e.metalnessMap?i=e.metalnessMap:e.alphaMap?i=e.alphaMap:e.emissiveMap?i=e.emissiveMap:e.clearcoatMap?i=e.clearcoatMap:e.clearcoatNormalMap?i=e.clearcoatNormalMap:e.clearcoatRoughnessMap?i=e.clearcoatRoughnessMap:e.specularIntensityMap?i=e.specularIntensityMap:e.specularTintMap?i=e.specularTintMap:e.transmissionMap?i=e.transmissionMap:e.thicknessMap&&(i=e.thicknessMap),void 0!==i&&(i.isWebGLRenderTarget&&(i=i.texture),!0===i.matrixAutoUpdate&&i.updateMatrix(),t.uvTransform.value.copy(i.matrix));let r;e.aoMap?r=e.aoMap:e.lightMap&&(r=e.lightMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),t.uv2Transform.value.copy(r.matrix))}function c(t,e){t.roughness.value=e.roughness,t.metalness.value=e.metalness,e.roughnessMap&&(t.roughnessMap.value=e.roughnessMap),e.metalnessMap&&(t.metalnessMap.value=e.metalnessMap),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===Lt&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===Lt&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias),s.get(e).envMap&&(t.envMapIntensity.value=e.envMapIntensity)}return{refreshFogUniforms:function(t,e){t.fogColor.value.copy(e.color),e.isFog?(t.fogNear.value=e.near,t.fogFar.value=e.far):e.isFogExp2&&(t.fogDensity.value=e.density)},refreshMaterialUniforms:function(t,e,n,i,r){var s,o,a,l;e.isMeshBasicMaterial?h(t,e):e.isMeshLambertMaterial?(h(t,e),a=t,(l=e).emissiveMap&&(a.emissiveMap.value=l.emissiveMap)):e.isMeshToonMaterial?(h(t,e),function(t,e){e.gradientMap&&(t.gradientMap.value=e.gradientMap);e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===Lt&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===Lt&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,e)):e.isMeshPhongMaterial?(h(t,e),function(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===Lt&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===Lt&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,e)):e.isMeshStandardMaterial?(h(t,e),e.isMeshPhysicalMaterial?function(t,e,n){c(t,e),t.ior.value=e.ior,e.sheenTint&&t.sheenTint.value.copy(e.sheenTint);0<e.clearcoat&&(t.clearcoat.value=e.clearcoat,t.clearcoatRoughness.value=e.clearcoatRoughness,e.clearcoatMap&&(t.clearcoatMap.value=e.clearcoatMap),e.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=e.clearcoatRoughnessMap),e.clearcoatNormalMap&&(t.clearcoatNormalScale.value.copy(e.clearcoatNormalScale),t.clearcoatNormalMap.value=e.clearcoatNormalMap,e.side===Lt&&t.clearcoatNormalScale.value.negate()));0<e.transmission&&(t.transmission.value=e.transmission,t.transmissionSamplerMap.value=n.texture,t.transmissionSamplerSize.value.set(n.width,n.height),e.transmissionMap&&(t.transmissionMap.value=e.transmissionMap),t.thickness.value=e.thickness,e.thicknessMap&&(t.thicknessMap.value=e.thicknessMap),t.attenuationDistance.value=e.attenuationDistance,t.attenuationTint.value.copy(e.attenuationTint));t.specularIntensity.value=e.specularIntensity,t.specularTint.value.copy(e.specularTint),e.specularIntensityMap&&(t.specularIntensityMap.value=e.specularIntensityMap);e.specularTintMap&&(t.specularTintMap.value=e.specularTintMap)}(t,e,r):c(t,e)):e.isMeshMatcapMaterial?(h(t,e),function(t,e){e.matcap&&(t.matcap.value=e.matcap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===Lt&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===Lt&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,e)):e.isMeshDepthMaterial?(h(t,e),s=t,(o=e).displacementMap&&(s.displacementMap.value=o.displacementMap,s.displacementScale.value=o.displacementScale,s.displacementBias.value=o.displacementBias)):e.isMeshDistanceMaterial?(h(t,e),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias);t.referencePosition.value.copy(e.referencePosition),t.nearDistance.value=e.nearDistance,t.farDistance.value=e.farDistance}(t,e)):e.isMeshNormalMaterial?(h(t,e),function(t,e){e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===Lt&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===Lt&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,e)):e.isLineBasicMaterial?(s=e,(o=t).diffuse.value.copy(s.color),o.opacity.value=s.opacity,e.isLineDashedMaterial&&(o=e,(s=t).dashSize.value=o.dashSize,s.totalSize.value=o.dashSize+o.gapSize,s.scale.value=o.scale)):e.isPointsMaterial?function(t,e,n,i){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*n,t.scale.value=.5*i,e.map&&(t.map.value=e.map);e.alphaMap&&(t.alphaMap.value=e.alphaMap);0<e.alphaTest&&(t.alphaTest.value=e.alphaTest);let r;e.map?r=e.map:e.alphaMap&&(r=e.alphaMap);void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),t.uvTransform.value.copy(r.matrix))}(t,e,n,i):e.isSpriteMaterial?function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,e.map&&(t.map.value=e.map);e.alphaMap&&(t.alphaMap.value=e.alphaMap);0<e.alphaTest&&(t.alphaTest.value=e.alphaTest);let n;e.map?n=e.map:e.alphaMap&&(n=e.alphaMap);void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),t.uvTransform.value.copy(n.matrix))}(t,e):e.isShadowMaterial?(t.color.value.copy(e.color),t.opacity.value=e.opacity):e.isShaderMaterial&&(e.uniformsNeedUpdate=!1)}}}function Zo(t={}){const r=void 0!==t.canvas?t.canvas:function(){const t=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return t.style.display="block",t}(),e=void 0!==t.context?t.context:null,n=void 0!==t.alpha&&t.alpha,i=void 0===t.depth||t.depth,s=void 0===t.stencil||t.stencil,o=void 0!==t.antialias&&t.antialias,a=void 0===t.premultipliedAlpha||t.premultipliedAlpha,l=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,h=void 0!==t.powerPreference?t.powerPreference:"default",c=void 0!==t.failIfMajorPerformanceCaveat&&t.failIfMajorPerformanceCaveat;let m=null,M=null;const u=[],d=[];this.domElement=r,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=fe,this.physicallyCorrectLights=!1,this.toneMapping=It,this.toneMappingExposure=1;const S=this;let p=!1,f=0,v=0,E=null,T=-1,A=null;const g=new Oe,y=new Oe;let x=null,_=r.width,C=r.height,P=1,b=null,w=null;const L=new Oe(0,0,_,C),R=new Oe(0,0,_,C);let I=!1;const z=[],N=new cr;let B=!1,D=!1,F=null;const k=new bn,O=new We,V={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function U(){return null===E?P:1}let H=e;function W(e,n){for(let t=0;t<e.length;t++){var i=e[t],i=r.getContext(i,n);if(null!==i)return i}return null}try{var G={alpha:n,depth:i,stencil:s,antialias:o,premultipliedAlpha:a,preserveDrawingBuffer:l,powerPreference:h,failIfMajorPerformanceCaveat:c};if(r.addEventListener("webglcontextlost",vt,!1),r.addEventListener("webglcontextrestored",gt,!1),null===H){const Ct=["webgl2","webgl","experimental-webgl"];if(!0===S.isWebGL1Renderer&&Ct.shift(),H=W(Ct,G),null===H)throw W(Ct)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===H.getShaderPrecisionFormat&&(H.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(t){throw console.error("THREE.WebGLRenderer: "+t.message),t}let j,q,X,Y,Z,K,J,Q,$,tt,et,nt,it,rt,st,ot,at,lt,ht,ct,ut,dt,pt;function mt(){j=new Xr(H),q=new _r(H,j,t),j.init(q),dt=new Ho(H,j,q),X=new Vo(H,j,q),z[0]=1029,Y=new Kr(H),Z=new So,K=new Uo(H,j,X,Z,q,dt,Y),J=new wr(S),Q=new qr(S),$=new dr(H,q),pt=new yr(H,j,$,q),tt=new Yr(H,$,Y,pt),et=new ts(H,tt,$,Y),ht=new $r(H),ot=new br(Z),nt=new Mo(S,J,Q,j,q,pt,ot),it=new Yo(Z),rt=new Co(Z),st=new No(j,q),lt=new gr(S,J,X,et,a),at=new Oo(S,et,q),ct=new xr(H,j,Y,q),ut=new Zr(H,j,Y,q),Y.programs=nt.programs,S.capabilities=q,S.extensions=j,S.properties=Z,S.renderLists=rt,S.shadowMap=at,S.state=X,S.info=Y}mt();const ft=new Xo(S,H);function vt(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),p=!0}function gt(){console.log("THREE.WebGLRenderer: Context Restored."),p=!1;var t=Y.autoReset,e=at.enabled,n=at.autoUpdate,i=at.needsUpdate,r=at.type;mt(),Y.autoReset=t,at.enabled=e,at.autoUpdate=n,at.needsUpdate=i,at.type=r}function yt(t){const e=t.target;e.removeEventListener("dispose",yt),function(t){const e=Z.get(t).programs;void 0!==e&&e.forEach(function(t){nt.releaseProgram(t)})}(t=e),Z.remove(t)}this.xr=ft,this.getContext=function(){return H},this.getContextAttributes=function(){return H.getContextAttributes()},this.forceContextLoss=function(){const t=j.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){const t=j.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return P},this.setPixelRatio=function(t){void 0!==t&&(P=t,this.setSize(_,C,!1))},this.getSize=function(t){return t.set(_,C)},this.setSize=function(t,e,n){ft.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(_=t,C=e,r.width=Math.floor(t*P),r.height=Math.floor(e*P),!1!==n&&(r.style.width=t+"px",r.style.height=e+"px"),this.setViewport(0,0,t,e))},this.getDrawingBufferSize=function(t){return t.set(_*P,C*P).floor()},this.setDrawingBufferSize=function(t,e,n){_=t,C=e,P=n,r.width=Math.floor(t*n),r.height=Math.floor(e*n),this.setViewport(0,0,t,e)},this.getCurrentViewport=function(t){return t.copy(g)},this.getViewport=function(t){return t.copy(L)},this.setViewport=function(t,e,n,i){t.isVector4?L.set(t.x,t.y,t.z,t.w):L.set(t,e,n,i),X.viewport(g.copy(L).multiplyScalar(P).floor())},this.getScissor=function(t){return t.copy(R)},this.setScissor=function(t,e,n,i){t.isVector4?R.set(t.x,t.y,t.z,t.w):R.set(t,e,n,i),X.scissor(y.copy(R).multiplyScalar(P).floor())},this.getScissorTest=function(){return I},this.setScissorTest=function(t){X.setScissorTest(I=t)},this.setOpaqueSort=function(t){b=t},this.setTransparentSort=function(t){w=t},this.getClearColor=function(t){return t.copy(lt.getClearColor())},this.setClearColor=function(){lt.setClearColor.apply(lt,arguments)},this.getClearAlpha=function(){return lt.getClearAlpha()},this.setClearAlpha=function(){lt.setClearAlpha.apply(lt,arguments)},this.clear=function(t,e,n){let i=0;void 0!==t&&!t||(i|=16384),void 0!==e&&!e||(i|=256),void 0!==n&&!n||(i|=1024),H.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){r.removeEventListener("webglcontextlost",vt,!1),r.removeEventListener("webglcontextrestored",gt,!1),rt.dispose(),st.dispose(),Z.dispose(),J.dispose(),Q.dispose(),et.dispose(),pt.dispose(),ft.dispose(),ft.removeEventListener("sessionstart",_t),ft.removeEventListener("sessionend",bt),F&&(F.dispose(),F=null),wt.stop()},this.renderBufferImmediate=function(t,e){pt.initAttributes();const n=Z.get(t);t.hasPositions&&!n.position&&(n.position=H.createBuffer()),t.hasNormals&&!n.normal&&(n.normal=H.createBuffer()),t.hasUvs&&!n.uv&&(n.uv=H.createBuffer()),t.hasColors&&!n.color&&(n.color=H.createBuffer());e=e.getAttributes();t.hasPositions&&(H.bindBuffer(34962,n.position),H.bufferData(34962,t.positionArray,35048),pt.enableAttribute(e.position.location),H.vertexAttribPointer(e.position.location,3,5126,!1,0,0)),t.hasNormals&&(H.bindBuffer(34962,n.normal),H.bufferData(34962,t.normalArray,35048),pt.enableAttribute(e.normal.location),H.vertexAttribPointer(e.normal.location,3,5126,!1,0,0)),t.hasUvs&&(H.bindBuffer(34962,n.uv),H.bufferData(34962,t.uvArray,35048),pt.enableAttribute(e.uv.location),H.vertexAttribPointer(e.uv.location,2,5126,!1,0,0)),t.hasColors&&(H.bindBuffer(34962,n.color),H.bufferData(34962,t.colorArray,35048),pt.enableAttribute(e.color.location),H.vertexAttribPointer(e.color.location,3,5126,!1,0,0)),pt.disableUnusedAttributes(),H.drawArrays(4,0,t.count),t.count=0},this.renderBufferDirect=function(t,e,n,i,r,s){null===e&&(e=V);var o=r.isMesh&&r.matrixWorld.determinant()<0,a=At(t,e,i,r);X.setMaterial(i,o);let l=n.index;t=n.attributes.position;if(null===l){if(void 0===t||0===t.count)return}else if(0===l.count)return;let h=1;!0===i.wireframe&&(l=tt.getWireframeAttribute(n),h=2),void 0===n.morphAttributes.position&&void 0===n.morphAttributes.normal||ht.update(r,n,i,a),pt.setup(r,i,a,n,l);let c=ct;null!==l&&(u=$.get(l),c=ut,c.setIndex(u));var e=(null!==l?l:t).count,o=n.drawRange.start*h,a=n.drawRange.count*h,u=null!==s?s.start*h:0,t=null!==s?s.count*h:1/0,s=Math.max(o,u),t=Math.min(e,o+a,u+t)-1,t=Math.max(0,t-s+1);if(0!==t){if(r.isMesh)!0===i.wireframe?(X.setLineWidth(i.wireframeLinewidth*U()),c.setMode(1)):c.setMode(4);else if(r.isLine){let t=i.linewidth;void 0===t&&(t=1),X.setLineWidth(t*U()),r.isLineSegments?c.setMode(1):r.isLineLoop?c.setMode(2):c.setMode(3)}else r.isPoints?c.setMode(0):r.isSprite&&c.setMode(4);r.isInstancedMesh?c.renderInstances(s,t,r.count):n.isInstancedBufferGeometry?(n=Math.min(n.instanceCount,n._maxInstanceCount),c.renderInstances(s,t,n)):c.render(s,t)}},this.compile=function(i,e){M=st.get(i),M.init(),d.push(M),i.traverseVisible(function(t){t.isLight&&t.layers.test(e.layers)&&(M.pushLight(t),t.castShadow&&M.pushShadow(t))}),M.setupLights(S.physicallyCorrectLights),i.traverse(function(e){var n=e.material;if(n)if(Array.isArray(n))for(let t=0;t<n.length;t++)Et(n[t],i,e);else Et(n,i,e)}),d.pop(),M=null};let xt=null;function _t(){wt.stop()}function bt(){wt.start()}const wt=new ur;function Mt(t,e,n,i){var r=t.opaque,s=t.transmissive,t=t.transparent;M.setupLightsView(n),0<s.length&&function(t,e,n){if(null===F){const s=!0===o&&!0===q.isWebGL2?Ue:Ve;F=new s(1024,1024,{generateMipmaps:!0,type:null!==dt.convert(kt)?kt:Dt,minFilter:Bt,magFilter:Nt,wrapS:zt,wrapT:zt})}var i=S.getRenderTarget();S.setRenderTarget(F),S.clear();var r=S.toneMapping;S.toneMapping=It,St(t,e,n),S.toneMapping=r,K.updateMultisampleRenderTarget(F),K.updateRenderTargetMipmap(F),S.setRenderTarget(i)}(r,e,n),i&&X.viewport(g.copy(i)),0<r.length&&St(r,e,n),0<s.length&&St(s,e,n),0<t.length&&St(t,e,n)}function St(n,i,r){var s=!0===i.isScene?i.overrideMaterial:null;for(let t=0,e=n.length;t<e;t++){var o=n[t];const h=o.object;var a=o.geometry,l=null===s?o.material:s,o=o.group;h.layers.test(r.layers)&&function(t,e,n,i,r,s){{var o;t.onBeforeRender(S,e,n,i,r,s),t.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),t.isImmediateRenderObject?(o=At(n,e,r,t),X.setMaterial(r),pt.reset(),function(t,e){t.render(function(t){S.renderBufferImmediate(t,e)})}(t,o)):!0===r.transparent&&r.side===Rt?(r.side=Lt,r.needsUpdate=!0,S.renderBufferDirect(n,e,i,r,t,s),r.side=Pt,r.needsUpdate=!0,S.renderBufferDirect(n,e,i,r,t,s),r.side=Rt):S.renderBufferDirect(n,e,i,r,t,s)}t.onAfterRender(S,e,n,i,r,s)}(h,i,r,a,l,o)}}function Et(t,e,n){!0!==e.isScene&&(e=V);const i=Z.get(t);var r=M.state.lights,s=M.state.shadowsArray,o=r.state.version;const a=nt.getParameters(t,r.state,s,e,n);n=nt.getProgramCacheKey(a);let l=i.programs;i.environment=t.isMeshStandardMaterial?e.environment:null,i.fog=e.fog,i.envMap=(t.isMeshStandardMaterial?Q:J).get(t.envMap||i.environment),void 0===l&&(t.addEventListener("dispose",yt),l=new Map,i.programs=l);let h=l.get(n);if(void 0!==h){if(i.currentProgram===h&&i.lightsStateVersion===o)return Tt(t,a),h}else a.uniforms=nt.getUniforms(t),t.onBuild(a,S),t.onBeforeCompile(a,S),h=nt.acquireProgram(a,n),l.set(n,h),i.uniforms=a.uniforms;const c=i.uniforms;(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(c.clippingPlanes=ot.uniform),Tt(t,a),i.needsLights=(t=t).isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights,i.lightsStateVersion=o,i.needsLights&&(c.ambientLightColor.value=r.state.ambient,c.lightProbe.value=r.state.probe,c.directionalLights.value=r.state.directional,c.directionalLightShadows.value=r.state.directionalShadow,c.spotLights.value=r.state.spot,c.spotLightShadows.value=r.state.spotShadow,c.rectAreaLights.value=r.state.rectArea,c.ltc_1.value=r.state.rectAreaLTC1,c.ltc_2.value=r.state.rectAreaLTC2,c.pointLights.value=r.state.point,c.pointLightShadows.value=r.state.pointShadow,c.hemisphereLights.value=r.state.hemi,c.directionalShadowMap.value=r.state.directionalShadowMap,c.directionalShadowMatrix.value=r.state.directionalShadowMatrix,c.spotShadowMap.value=r.state.spotShadowMap,c.spotShadowMatrix.value=r.state.spotShadowMatrix,c.pointShadowMap.value=r.state.pointShadowMap,c.pointShadowMatrix.value=r.state.pointShadowMatrix);r=h.getUniforms(),r=io.seqWithValue(r.seq,c);return i.currentProgram=h,i.uniformsList=r,h}function Tt(t,e){const n=Z.get(t);n.outputEncoding=e.outputEncoding,n.instancing=e.instancing,n.skinning=e.skinning,n.morphTargets=e.morphTargets,n.morphNormals=e.morphNormals,n.numClippingPlanes=e.numClippingPlanes,n.numIntersection=e.numClipIntersection,n.vertexAlphas=e.vertexAlphas,n.vertexTangents=e.vertexTangents}function At(t,e,n,i){!0!==e.isScene&&(e=V),K.resetTextureUnits();var r=e.fog,s=n.isMeshStandardMaterial?e.environment:null,o=null===E?S.outputEncoding:E.texture.encoding,a=(n.isMeshStandardMaterial?Q:J).get(n.envMap||s),l=!0===n.vertexColors&&!!i.geometry&&!!i.geometry.attributes.color&&4===i.geometry.attributes.color.itemSize,h=!!i.geometry&&!!i.geometry.attributes.tangent,c=!!i.geometry&&!!i.geometry.morphAttributes.position,u=!!i.geometry&&!!i.geometry.morphAttributes.normal;const d=Z.get(n);var p=M.state.lights;!0===B&&(!0!==D&&t===A||(s=t===A&&n.id===T,ot.setState(n,t,s)));let m=!1;n.version===d.__version?(d.needsLights&&d.lightsStateVersion!==p.state.version||d.outputEncoding!==o||i.isInstancedMesh&&!1===d.instancing||!i.isInstancedMesh&&!0===d.instancing||i.isSkinnedMesh&&!1===d.skinning||!i.isSkinnedMesh&&!0===d.skinning||d.envMap!==a||n.fog&&d.fog!==r||void 0!==d.numClippingPlanes&&(d.numClippingPlanes!==ot.numPlanes||d.numIntersection!==ot.numIntersection)||d.vertexAlphas!==l||d.vertexTangents!==h||d.morphTargets!==c||d.morphNormals!==u)&&(m=!0):(m=!0,d.__version=n.version);let f=d.currentProgram;!0===m&&(f=Et(n,e,i));let v=!1,g=!1,y=!1;const x=f.getUniforms(),_=d.uniforms;if(X.useProgram(f.program)&&(v=!0,g=!0,y=!0),n.id!==T&&(T=n.id,g=!0),v||A!==t){if(x.setValue(H,"projectionMatrix",t.projectionMatrix),q.logarithmicDepthBuffer&&x.setValue(H,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),A!==t&&(A=t,g=!0,y=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshStandardMaterial||n.envMap){const b=x.map.cameraPosition;void 0!==b&&b.setValue(H,O.setFromMatrixPosition(t.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&x.setValue(H,"isOrthographic",!0===t.isOrthographicCamera),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.isShadowMaterial||i.isSkinnedMesh)&&x.setValue(H,"viewMatrix",t.matrixWorldInverse)}if(i.isSkinnedMesh){x.setOptional(H,i,"bindMatrix"),x.setOptional(H,i,"bindMatrixInverse");const w=i.skeleton;w&&(q.floatVertexTextures?(null===w.boneTexture&&w.computeBoneTexture(),x.setValue(H,"boneTexture",w.boneTexture,K),x.setValue(H,"boneTextureSize",w.boneTextureSize)):x.setOptional(H,w,"boneMatrices"))}return!g&&d.receiveShadow===i.receiveShadow||(d.receiveShadow=i.receiveShadow,x.setValue(H,"receiveShadow",i.receiveShadow)),g&&(x.setValue(H,"toneMappingExposure",S.toneMappingExposure),d.needsLights&&(e=_,t=y,e.ambientLightColor.needsUpdate=t,e.lightProbe.needsUpdate=t,e.directionalLights.needsUpdate=t,e.directionalLightShadows.needsUpdate=t,e.pointLights.needsUpdate=t,e.pointLightShadows.needsUpdate=t,e.spotLights.needsUpdate=t,e.spotLightShadows.needsUpdate=t,e.rectAreaLights.needsUpdate=t,e.hemisphereLights.needsUpdate=t),r&&n.fog&&it.refreshFogUniforms(_,r),it.refreshMaterialUniforms(_,n,P,C,F),io.upload(H,d.uniformsList,_,K)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(io.upload(H,d.uniformsList,_,K),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&x.setValue(H,"center",i.center),x.setValue(H,"modelViewMatrix",i.modelViewMatrix),x.setValue(H,"normalMatrix",i.normalMatrix),x.setValue(H,"modelMatrix",i.matrixWorld),f}wt.setAnimationLoop(function(t){xt&&xt(t)}),"undefined"!=typeof window&&wt.setContext(window),this.setAnimationLoop=function(t){xt=t,ft.setAnimationLoop(t),null===t?wt.stop():wt.start()},ft.addEventListener("sessionstart",_t),ft.addEventListener("sessionend",bt),this.render=function(n,t){if(void 0===t||!0===t.isCamera){if(!0!==p){!0===n.autoUpdate&&n.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),!0===ft.enabled&&!0===ft.isPresenting&&(!0===ft.cameraAutoUpdate&&ft.updateCamera(t),t=ft.getCamera()),!0===n.isScene&&n.onBeforeRender(S,n,t,E),M=st.get(n,d.length),M.init(),d.push(M),k.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),N.setFromProjectionMatrix(k),D=this.localClippingEnabled,B=ot.init(this.clippingPlanes,D,t),m=rt.get(n,u.length),m.init(),u.push(m),function n(i,r,s,o){if(!1===i.visible)return;const t=i.layers.test(r.layers);if(t)if(i.isGroup)s=i.renderOrder;else if(i.isLOD)!0===i.autoUpdate&&i.update(r);else if(i.isLight)M.pushLight(i),i.castShadow&&M.pushShadow(i);else if(i.isSprite){if(!i.frustumCulled||N.intersectsSprite(i)){o&&O.setFromMatrixPosition(i.matrixWorld).applyMatrix4(k);const e=et.update(i),l=i.material;l.visible&&m.push(i,e,l,s,O.z,null)}}else if(i.isImmediateRenderObject)o&&O.setFromMatrixPosition(i.matrixWorld).applyMatrix4(k),m.push(i,null,i.material,s,O.z,null);else if((i.isMesh||i.isLine||i.isPoints)&&(i.isSkinnedMesh&&i.skeleton.frame!==Y.render.frame&&(i.skeleton.update(),i.skeleton.frame=Y.render.frame),!i.frustumCulled||N.intersectsObject(i))){o&&O.setFromMatrixPosition(i.matrixWorld).applyMatrix4(k);const h=et.update(i),c=i.material;if(Array.isArray(c)){const u=h.groups;for(let t=0,e=u.length;t<e;t++){const d=u[t],p=c[d.materialIndex];p&&p.visible&&m.push(i,h,p,s,O.z,d)}}else c.visible&&m.push(i,h,c,s,O.z,null)}const a=i.children;for(let t=0,e=a.length;t<e;t++)n(a[t],r,s,o)}(n,t,0,S.sortObjects),m.finish(),!0===S.sortObjects&&m.sort(b,w),!0===B&&ot.beginShadows();var e=M.state.shadowsArray;if(at.render(e,n,t),!0===B&&ot.endShadows(),!0===this.info.autoReset&&this.info.reset(),lt.render(m,n),M.setupLights(S.physicallyCorrectLights),t.isArrayCamera){var i=t.cameras;for(let t=0,e=i.length;t<e;t++){var r=i[t];Mt(m,n,r,r.viewport)}}else Mt(m,n,t);null!==E&&(K.updateMultisampleRenderTarget(E),K.updateRenderTargetMipmap(E)),!0===n.isScene&&n.onAfterRender(S,n,t),X.buffers.depth.setTest(!0),X.buffers.depth.setMask(!0),X.buffers.color.setMask(!0),X.setPolygonOffset(!1),pt.resetDefaultState(),T=-1,A=null,d.pop(),M=0<d.length?d[d.length-1]:null,u.pop(),m=0<u.length?u[u.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.getActiveCubeFace=function(){return f},this.getActiveMipmapLevel=function(){return v},this.getRenderTarget=function(){return E},this.setRenderTarget=function(e,t=0,n=0){E=e,f=t,v=n,e&&void 0===Z.get(e).__webglFramebuffer&&K.setupRenderTarget(e);let i=null,r=!1,s=!1;var o;if(x=e?(((o=e.texture).isDataTexture3D||o.isDataTexture2DArray)&&(s=!0),o=Z.get(e).__webglFramebuffer,e.isWebGLCubeRenderTarget?(i=o[t],r=!0):i=e.isWebGLMultisampleRenderTarget?Z.get(e).__webglMultisampledFramebuffer:o,g.copy(e.viewport),y.copy(e.scissor),e.scissorTest):(g.copy(L).multiplyScalar(P).floor(),y.copy(R).multiplyScalar(P).floor(),I),X.bindFramebuffer(36160,i)&&q.drawBuffers){let t=!1;if(e)if(e.isWebGLMultipleRenderTargets){const K=e.texture;if(z.length!==K.length||36064!==z[0]){for(let t=0,e=K.length;t<e;t++)z[t]=36064+t;z.length=K.length,t=!0}}else 1===z.length&&36064===z[0]||(z[0]=36064,z.length=1,t=!0);else 1===z.length&&1029===z[0]||(z[0]=1029,z.length=1,t=!0);t&&(q.isWebGL2?H.drawBuffers(z):j.get("WEBGL_draw_buffers").drawBuffersWEBGL(z))}X.viewport(g),X.scissor(y),X.setScissorTest(x),r?(o=Z.get(e.texture),H.framebufferTexture2D(36160,36064,34069+t,o.__webglTexture,n)):s&&(e=Z.get(e.texture),t=t||0,H.framebufferTextureLayer(36160,36064,e.__webglTexture,n||0,t)),T=-1},this.readRenderTargetPixels=function(e,n,i,r,s,o,a){if(e&&e.isWebGLRenderTarget){let t=Z.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==a&&(t=t[a]),t){X.bindFramebuffer(36160,t);try{var l=e.texture,h=l.format,c=l.type;if(h!==Ot&&dt.convert(h)!==H.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");var u=c===kt&&(j.has("EXT_color_buffer_half_float")||q.isWebGL2&&j.has("EXT_color_buffer_float"));if(!(c===Dt||dt.convert(c)===H.getParameter(35738)||c===Ft&&(q.isWebGL2||j.has("OES_texture_float")||j.has("WEBGL_color_buffer_float"))||u))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===H.checkFramebufferStatus(36160)?0<=n&&n<=e.width-r&&0<=i&&i<=e.height-s&&H.readPixels(n,i,r,s,dt.convert(h),dt.convert(c),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{const t=null!==E?Z.get(E).__webglFramebuffer:null;X.bindFramebuffer(36160,t)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(t,e,n=0){var i=Math.pow(2,-n),r=Math.floor(e.image.width*i),i=Math.floor(e.image.height*i);let s=dt.convert(e.format);q.isWebGL2&&(6407===s&&(s=32849),6408===s&&(s=32856)),K.setTexture2D(e,0),H.copyTexImage2D(3553,n,s,t.x,t.y,r,i,0),X.unbindTexture()},this.copyTextureToTexture=function(t,e,n,i=0){var r=e.image.width,s=e.image.height,o=dt.convert(n.format),a=dt.convert(n.type);K.setTexture2D(n,0),H.pixelStorei(37440,n.flipY),H.pixelStorei(37441,n.premultiplyAlpha),H.pixelStorei(3317,n.unpackAlignment),e.isDataTexture?H.texSubImage2D(3553,i,t.x,t.y,r,s,o,a,e.image.data):e.isCompressedTexture?H.compressedTexSubImage2D(3553,i,t.x,t.y,e.mipmaps[0].width,e.mipmaps[0].height,o,e.mipmaps[0].data):H.texSubImage2D(3553,i,t.x,t.y,o,a,e.image),0===i&&n.generateMipmaps&&H.generateMipmap(3553),X.unbindTexture()},this.copyTextureToTexture3D=function(e,n,i,r,s=0){if(S.isWebGL1Renderer)console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");else{var o=e.max.x-e.min.x+1,a=e.max.y-e.min.y+1,l=e.max.z-e.min.z+1,h=dt.convert(r.format),c=dt.convert(r.type);let t;if(r.isDataTexture3D)K.setTexture3D(r,0),t=32879;else{if(!r.isDataTexture2DArray)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");K.setTexture2DArray(r,0),t=35866}H.pixelStorei(37440,r.flipY),H.pixelStorei(37441,r.premultiplyAlpha),H.pixelStorei(3317,r.unpackAlignment);var u=H.getParameter(3314),d=H.getParameter(32878),p=H.getParameter(3316),m=H.getParameter(3315),f=H.getParameter(32877),v=i.isCompressedTexture?i.mipmaps[0]:i.image;H.pixelStorei(3314,v.width),H.pixelStorei(32878,v.height),H.pixelStorei(3316,e.min.x),H.pixelStorei(3315,e.min.y),H.pixelStorei(32877,e.min.z),i.isDataTexture||i.isDataTexture3D?H.texSubImage3D(t,s,n.x,n.y,n.z,o,a,l,h,c,v.data):i.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),H.compressedTexSubImage3D(t,s,n.x,n.y,n.z,o,a,l,h,v.data)):H.texSubImage3D(t,s,n.x,n.y,n.z,o,a,l,h,c,v),H.pixelStorei(3314,u),H.pixelStorei(32878,d),H.pixelStorei(3316,p),H.pixelStorei(3315,m),H.pixelStorei(32877,f),0===s&&r.generateMipmaps&&H.generateMipmap(t),X.unbindTexture()}},this.initTexture=function(t){K.setTexture2D(t,0),X.unbindTexture()},this.resetState=function(){f=0,v=0,E=null,X.reset(),pt.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}class Ko{constructor(t,e=25e-5){this.name="",this.color=new di(t),this.density=e}clone(){return new Ko(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}Ko.prototype.isFogExp2=class extends Zo{}.prototype.isWebGL1Renderer=!0;class Jo{constructor(t,e=1,n=1e3){this.name="",this.color=new di(t),this.near=e,this.far=n}clone(){return new Jo(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}Jo.prototype.isFog=!0;class Qo extends qn{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return null!==this.fog&&(e.object.fog=this.fog.toJSON()),e}}Qo.prototype.isScene=!0;class $o{constructor(t,e){this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Se()}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(n,i,r){n*=this.stride,r*=i.stride;for(let t=0,e=this.stride;t<e;t++)this.array[n+t]=i.array[r+t];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Se()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);t=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]);const e=new this.constructor(t,this.stride);return e.setUsage(this.usage),e}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Se()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}$o.prototype.isInterleavedBuffer=!0;const ta=new We;class ea{constructor(t,e,n,i=!1){this.name="",this.data=t,this.itemSize=e,this.offset=n,this.normalized=!0===i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(n){for(let t=0,e=this.data.count;t<e;t++)ta.x=this.getX(t),ta.y=this.getY(t),ta.z=this.getZ(t),ta.applyMatrix4(n),this.setXYZ(t,ta.x,ta.y,ta.z);return this}applyNormalMatrix(n){for(let t=0,e=this.count;t<e;t++)ta.x=this.getX(t),ta.y=this.getY(t),ta.z=this.getZ(t),ta.applyNormalMatrix(n),this.setXYZ(t,ta.x,ta.y,ta.z);return this}transformDirection(n){for(let t=0,e=this.count;t<e;t++)ta.x=this.getX(t),ta.y=this.getY(t),ta.z=this.getZ(t),ta.transformDirection(n),this.setXYZ(t,ta.x,ta.y,ta.z);return this}setX(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){return this.data.array[t*this.data.stride+this.offset]}getY(t){return this.data.array[t*this.data.stride+this.offset+1]}getZ(t){return this.data.array[t*this.data.stride+this.offset+2]}getW(t){return this.data.array[t*this.data.stride+this.offset+3]}setXY(t,e,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this}setXYZ(t,e,n,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=i,this}setXYZW(t,e,n,i,r){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=i,this.data.array[t+3]=r,this}clone(t){if(void 0!==t)return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new ea(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized);{console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const n=[];for(let t=0;t<this.count;t++){var e=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)n.push(this.data.array[e+t])}return new vi(new this.array.constructor(n),this.itemSize,this.normalized)}}toJSON(t){if(void 0!==t)return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized};{console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const n=[];for(let t=0;t<this.count;t++){var e=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)n.push(this.data.array[e+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:n,normalized:this.normalized}}}}ea.prototype.isInterleavedBufferAttribute=!0;class na extends si{constructor(t){super(),this.type="SpriteMaterial",this.color=new di(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this}}na.prototype.isSpriteMaterial=!0;let ia;const ra=new We,sa=new We,oa=new We,aa=new Ie,la=new Ie,ha=new bn,ca=new We,ua=new We,da=new We,pa=new Ie,ma=new Ie,fa=new Ie;class va extends qn{constructor(t){var e;super(),this.type="Sprite",void 0===ia&&(ia=new Ci,e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),e=new $o(e,5),ia.setIndex([0,1,2,0,2,3]),ia.setAttribute("position",new ea(e,3,0,!1)),ia.setAttribute("uv",new ea(e,2,3,!1))),this.geometry=ia,this.material=void 0!==t?t:new na,this.center=new Ie(.5,.5)}raycast(t,e){null===t.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),sa.setFromMatrixScale(this.matrixWorld),ha.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),oa.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&sa.multiplyScalar(-oa.z);var n=this.material.rotation;let i,r;0!==n&&(r=Math.cos(n),i=Math.sin(n));n=this.center;ga(ca.set(-.5,-.5,0),oa,n,sa,i,r),ga(ua.set(.5,-.5,0),oa,n,sa,i,r),ga(da.set(.5,.5,0),oa,n,sa,i,r),pa.set(0,0),ma.set(1,0),fa.set(1,1),null===t.ray.intersectTriangle(ca,ua,da,!1,ra)&&(ga(ua.set(-.5,.5,0),oa,n,sa,i,r),ma.set(0,1),null===t.ray.intersectTriangle(ca,da,ua,!1,ra))||((n=t.ray.origin.distanceTo(ra))<t.near||n>t.far||e.push({distance:n,point:ra.clone(),uv:ii.getUV(ra,ca,ua,da,pa,ma,fa,new Ie),face:null,object:this}))}copy(t){return super.copy(t),void 0!==t.center&&this.center.copy(t.center),this.material=t.material,this}}function ga(t,e,n,i,r,s){aa.subVectors(t,n).addScalar(.5).multiply(i),void 0!==r?(la.x=s*aa.x-r*aa.y,la.y=r*aa.x+s*aa.y):la.copy(aa),t.copy(e),t.x+=la.x,t.y+=la.y,t.applyMatrix4(ha)}va.prototype.isSprite=!0;(class extends null{});const ya=new We,xa=new Oe,_a=new Oe,ba=new We,wa=new bn;class Ma extends qi{constructor(t,e){super(t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new bn,this.bindMatrixInverse=new bn}copy(t){return super.copy(t),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,this}bind(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const n=new Oe,i=this.geometry.attributes.skinWeight;for(let t=0,e=i.count;t<e;t++){n.x=i.getX(t),n.y=i.getY(t),n.z=i.getZ(t),n.w=i.getW(t);var r=1/n.manhattanLength();r!=1/0?n.multiplyScalar(r):n.set(1,0,0,0),i.setXYZW(t,n.x,n.y,n.z,n.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(t,e){var n=this.skeleton,i=this.geometry;xa.fromBufferAttribute(i.attributes.skinIndex,t),_a.fromBufferAttribute(i.attributes.skinWeight,t),ya.fromBufferAttribute(i.attributes.position,t).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let t=0;t<4;t++){var r,s=_a.getComponent(t);0!==s&&(r=xa.getComponent(t),wa.multiplyMatrices(n.bones[r].matrixWorld,n.boneInverses[r]),e.addScaledVector(ba.copy(ya).applyMatrix4(wa),s))}return e.applyMatrix4(this.bindMatrixInverse)}}Ma.prototype.isSkinnedMesh=!0;class Sa extends qn{constructor(){super(),this.type="Bone"}}Sa.prototype.isBone=!0;class Ea extends Fe{constructor(t=null,e=1,n=1,i,r,s,o,a,l=Nt,h=Nt,c,u){super(null,s,o,a,l,h,i,r,c,u),this.image={data:t,width:e,height:n},this.magFilter=l,this.minFilter=h,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}Ea.prototype.isDataTexture=!0;const Ta=new bn,Aa=new bn;class Ca{constructor(t=[],e=[]){this.uuid=Se(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){var t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(16*t.length),0===e.length)this.calculateInverses();else if(t.length!==e.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let t=0,e=this.bones.length;t<e;t++)this.boneInverses.push(new bn)}}calculateInverses(){for(let t=this.boneInverses.length=0,e=this.bones.length;t<e;t++){const n=new bn;this.bones[t]&&n.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(n)}}pose(){for(let t=0,e=this.bones.length;t<e;t++){const n=this.bones[t];n&&n.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,e=this.bones.length;t<e;t++){const i=this.bones[t];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){var n=this.bones,i=this.boneInverses,r=this.boneMatrices;const t=this.boneTexture;for(let t=0,e=n.length;t<e;t++){var s=n[t]?n[t].matrixWorld:Aa;Ta.multiplyMatrices(s,i[t]),Ta.toArray(r,16*t)}null!==t&&(t.needsUpdate=!0)}clone(){return new Ca(this.bones,this.boneInverses)}computeBoneTexture(){var t=Pe(t=Math.sqrt(4*this.bones.length));t=Math.max(t,4);const e=new Float32Array(t*t*4);e.set(this.boneMatrices);var n=new Ea(e,t,t,Ot,Ft);return this.boneMatrices=e,this.boneTexture=n,this.boneTextureSize=t,this}getBoneByName(n){for(let t=0,e=this.bones.length;t<e;t++){var i=this.bones[t];if(i.name===n)return i}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(n,i){this.uuid=n.uuid;for(let e=0,t=n.bones.length;e<t;e++){var r=n.bones[e];let t=i[r];void 0===t&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),t=new Sa),this.bones.push(t),this.boneInverses.push((new bn).fromArray(n.boneInverses[e]))}return this.init(),this}toJSON(){const n={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};n.uuid=this.uuid;var i=this.bones,r=this.boneInverses;for(let t=0,e=i.length;t<e;t++){var s=i[t];n.bones.push(s.uuid);const o=r[t];n.boneInverses.push(o.toArray())}return n}}class Pa extends vi{constructor(t,e,n,i=1){"number"==typeof n&&(i=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(t,e,n),this.meshPerAttribute=i}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}Pa.prototype.isInstancedBufferAttribute=!0;const La=new bn,Ra=new bn,Ia=[],za=new qi;class Na extends qi{constructor(t,e,n){super(t,e),this.instanceMatrix=new Pa(new Float32Array(16*n),16),this.instanceColor=null,this.count=n,this.frustumCulled=!1}copy(t){return super.copy(t),this.instanceMatrix.copy(t.instanceMatrix),null!==t.instanceColor&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,this}getColorAt(t,e){e.fromArray(this.instanceColor.array,3*t)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,16*t)}raycast(t,i){var e=this.matrixWorld,r=this.count;if(za.geometry=this.geometry,za.material=this.material,void 0!==za.material)for(let n=0;n<r;n++){this.getMatrixAt(n,La),Ra.multiplyMatrices(e,La),za.matrixWorld=Ra,za.raycast(t,Ia);for(let t=0,e=Ia.length;t<e;t++){const s=Ia[t];s.instanceId=n,s.object=this,i.push(s)}Ia.length=0}}setColorAt(t,e){null===this.instanceColor&&(this.instanceColor=new Pa(new Float32Array(3*this.instanceMatrix.count),3)),e.toArray(this.instanceColor.array,3*t)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,16*t)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}Na.prototype.isInstancedMesh=!0;class Ba extends si{constructor(t){super(),this.type="LineBasicMaterial",this.color=new di(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this}}Ba.prototype.isLineBasicMaterial=!0;const Da=new We,Fa=new We,ka=new bn,Oa=new _n,Va=new dn;class Ua extends qn{constructor(t=new Ci,e=new Ba){super(),this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),this.material=t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){var n=t.attributes.position;const i=[0];for(let t=1,e=n.count;t<e;t++)Da.fromBufferAttribute(n,t-1),Fa.fromBufferAttribute(n,t),i[t]=i[t-1],i[t]+=Da.distanceTo(Fa);t.setAttribute("lineDistance",new xi(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else t.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(n,i){const t=this.geometry;var e=this.matrixWorld,r=n.params.Line.threshold,s=t.drawRange;if(null===t.boundingSphere&&t.computeBoundingSphere(),Va.copy(t.boundingSphere),Va.applyMatrix4(e),Va.radius+=r,!1!==n.ray.intersectsSphere(Va)){ka.copy(e).invert(),Oa.copy(n.ray).applyMatrix4(ka);var r=r/((this.scale.x+this.scale.y+this.scale.z)/3),o=r*r;const d=new We,p=new We,m=new We,f=new We;var a=this.isLineSegments?2:1;if(t.isBufferGeometry){const v=t.index;var l,h=t.attributes.position;if(null!==v)for(let t=Math.max(0,s.start),e=Math.min(v.count,s.start+s.count)-1;t<e;t+=a){var c=v.getX(t),u=v.getX(t+1);d.fromBufferAttribute(h,c),p.fromBufferAttribute(h,u),o<Oa.distanceSqToSegment(d,p,f,m)||(f.applyMatrix4(this.matrixWorld),(u=n.ray.origin.distanceTo(f))<n.near||u>n.far||i.push({distance:u,point:m.clone().applyMatrix4(this.matrixWorld),index:t,face:null,faceIndex:null,object:this}))}else for(let t=Math.max(0,s.start),e=Math.min(h.count,s.start+s.count)-1;t<e;t+=a)d.fromBufferAttribute(h,t),p.fromBufferAttribute(h,t+1),o<Oa.distanceSqToSegment(d,p,f,m)||(f.applyMatrix4(this.matrixWorld),(l=n.ray.origin.distanceTo(f))<n.near||l>n.far||i.push({distance:l,point:m.clone().applyMatrix4(this.matrixWorld),index:t,face:null,faceIndex:null,object:this}))}else t.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}updateMorphTargets(){var t=this.geometry;if(t.isBufferGeometry){var e=t.morphAttributes,n=Object.keys(e);if(0<n.length){var i=e[n[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=i.length;t<e;t++){var r=i[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=t}}}}else{t=t.morphTargets;void 0!==t&&0<t.length&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}Ua.prototype.isLine=!0;const Ha=new We,Wa=new We;class Ga extends Ua{constructor(t,e){super(t,e),this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){var n=t.attributes.position;const i=[];for(let t=0,e=n.count;t<e;t+=2)Ha.fromBufferAttribute(n,t),Wa.fromBufferAttribute(n,t+1),i[t]=0===t?0:i[t-1],i[t+1]=i[t]+Ha.distanceTo(Wa);t.setAttribute("lineDistance",new xi(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else t.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}Ga.prototype.isLineSegments=!0;class ja extends Ua{constructor(t,e){super(t,e),this.type="LineLoop"}}ja.prototype.isLineLoop=!0;class qa extends si{constructor(t){super(),this.type="PointsMaterial",this.color=new di(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this}}qa.prototype.isPointsMaterial=!0;const Xa=new bn,Ya=new _n,Za=new dn,Ka=new We;class Ja extends qn{constructor(t=new Ci,e=new qa){super(),this.type="Points",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),this.material=t.material,this.geometry=t.geometry,this}raycast(n,i){const t=this.geometry;var r=this.matrixWorld,e=n.params.Points.threshold,s=t.drawRange;if(null===t.boundingSphere&&t.computeBoundingSphere(),Za.copy(t.boundingSphere),Za.applyMatrix4(r),Za.radius+=e,!1!==n.ray.intersectsSphere(Za)){Xa.copy(r).invert(),Ya.copy(n.ray).applyMatrix4(Xa);var e=e/((this.scale.x+this.scale.y+this.scale.z)/3),o=e*e;if(t.isBufferGeometry){const h=t.index;var a=t.attributes.position;if(null!==h)for(let t=Math.max(0,s.start),e=Math.min(h.count,s.start+s.count);t<e;t++){var l=h.getX(t);Ka.fromBufferAttribute(a,l),Qa(Ka,l,o,r,n,i,this)}else for(let t=Math.max(0,s.start),e=Math.min(a.count,s.start+s.count);t<e;t++)Ka.fromBufferAttribute(a,t),Qa(Ka,t,o,r,n,i,this)}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}updateMorphTargets(){var t=this.geometry;if(t.isBufferGeometry){var e=t.morphAttributes,n=Object.keys(e);if(0<n.length){var i=e[n[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=i.length;t<e;t++){var r=i[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=t}}}}else{t=t.morphTargets;void 0!==t&&0<t.length&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}function Qa(t,e,n,i,r,s,o){var a=Ya.distanceSqToPoint(t);if(a<n){const l=new We;Ya.closestPointToPoint(t,l),l.applyMatrix4(i);i=r.ray.origin.distanceTo(l);i<r.near||i>r.far||s.push({distance:i,distanceToRay:Math.sqrt(a),point:l,index:e,face:null,object:o})}}Ja.prototype.isPoints=!0;Fe;(class extends Fe{constructor(e,t,n,i,r,s,o,a,l){super(e,t,n,i,r,s,o,a,l),this.format=void 0!==o?o:Tt,this.minFilter=void 0!==s?s:W,this.magFilter=void 0!==r?r:W,this.generateMipmaps=!1;const h=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(function t(){h.needsUpdate=!0,e.requestVideoFrameCallback(t)})}clone(){return new this.constructor(this.image).copy(this)}update(){var t=this.image;!1=="requestVideoFrameCallback"in t&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}).prototype.isVideoTexture=!0;class $a extends Fe{constructor(t,e,n,i,r,s,o,a,l,h,c,u){super(null,s,o,a,l,h,i,r,c,u),this.image={width:e,height:n},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}}$a.prototype.isCompressedTexture=!0;Fe;Fe;(class extends Fe{constructor(t,e,n,i,r,s,o,a,l,h){if((h=void 0!==h?h:At)!==At&&h!==Ct)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");super(null,i,r,s,o,a,h,n=void 0===(n=void 0===n&&h===At?G:n)&&h===Ct?Et:n,l),this.image={width:t,height:e},this.magFilter=void 0!==o?o:Nt,this.minFilter=void 0!==a?a:Nt,this.flipY=!1,this.generateMipmaps=!1}}).prototype.isDepthTexture=class extends Fe{constructor(t,e,n,i,r,s,o,a,l){super(t,e,n,i,r,s,o,a,l),this.needsUpdate=!0}}.prototype.isCanvasTexture=!0;class tl extends Ci{constructor(n=1,i=8,r=0,s=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:n,segments:i,thetaStart:r,thetaLength:s},i=Math.max(3,i);const e=[],o=[],a=[],l=[],h=new We,c=new Ie;o.push(0,0,0),a.push(0,0,1),l.push(.5,.5);for(let t=0,e=3;t<=i;t++,e+=3){var u=r+t/i*s;h.x=n*Math.cos(u),h.y=n*Math.sin(u),o.push(h.x,h.y,h.z),a.push(0,0,1),c.x=(o[e]/n+1)/2,c.y=(o[e+1]/n+1)/2,l.push(c.x,c.y)}for(let t=1;t<=i;t++)e.push(t,t+1,0);this.setIndex(e),this.setAttribute("position",new xi(o,3)),this.setAttribute("normal",new xi(a,3)),this.setAttribute("uv",new xi(l,2))}static fromJSON(t){return new tl(t.radius,t.segments,t.thetaStart,t.thetaLength)}}class el extends Ci{constructor(f=1,v=1,g=1,y=8,x=1,t=!1,_=0,b=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:f,radiusBottom:v,height:g,radialSegments:y,heightSegments:x,openEnded:t,thetaStart:_,thetaLength:b};const w=this;y=Math.floor(y),x=Math.floor(x);const M=[],S=[],E=[],T=[];let A=0;const C=[],P=g/2;let L=0;function e(e){var n=A;const i=new Ie,r=new We;let s=0;var o=!0===e?f:v,a=!0===e?1:-1;for(let t=1;t<=y;t++)S.push(0,P*a,0),E.push(0,a,0),T.push(.5,.5),A++;var l=A;for(let t=0;t<=y;t++){var h=t/y*b+_,c=Math.cos(h),h=Math.sin(h);r.x=o*h,r.y=P*a,r.z=o*c,S.push(r.x,r.y,r.z),E.push(0,a,0),i.x=.5*c+.5,i.y=.5*h*a+.5,T.push(i.x,i.y),A++}for(let t=0;t<y;t++){var u=n+t,d=l+t;!0===e?M.push(d,d+1,u):M.push(d+1,d,u),s+=3}w.addGroup(L,s,!0===e?1:2),L+=s}!function(){const e=new We,n=new We;let i=0;var r=(v-f)/g;for(let t=0;t<=x;t++){const m=[];var s=t/x,o=s*(v-f)+f;for(let t=0;t<=y;t++){var a=t/y,l=a*b+_,h=Math.sin(l),l=Math.cos(l);n.x=o*h,n.y=-s*g+P,n.z=o*l,S.push(n.x,n.y,n.z),e.set(h,r,l).normalize(),E.push(e.x,e.y,e.z),T.push(a,1-s),m.push(A++)}C.push(m)}for(let e=0;e<y;e++)for(let t=0;t<x;t++){var c=C[t][e],u=C[t+1][e],d=C[t+1][e+1],p=C[t][e+1];M.push(c,u,p),M.push(u,d,p),i+=6}w.addGroup(L,i,0),L+=i}(),!1===t&&(0<f&&e(!0),0<v&&e(!1)),this.setIndex(M),this.setAttribute("position",new xi(S,3)),this.setAttribute("normal",new xi(E,3)),this.setAttribute("uv",new xi(T,2))}static fromJSON(t){return new el(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class nl extends el{constructor(t=1,e=1,n=8,i=1,r=!1,s=0,o=2*Math.PI){super(0,t,e,n,i,r,s,o),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:n,heightSegments:i,openEnded:r,thetaStart:s,thetaLength:o}}static fromJSON(t){return new nl(t.radius,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class il extends Ci{constructor(n,s,t=1,e=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:n,indices:s,radius:t,detail:e};const c=[],u=[];function d(t){c.push(t.x,t.y,t.z)}function o(t,e){t*=3;e.x=n[0+t],e.y=n[1+t],e.z=n[2+t]}function p(t,e,n,i){i<0&&1===t.x&&(u[e]=t.x-1),0===n.x&&0===n.z&&(u[e]=i/2/Math.PI+.5)}function m(t){return Math.atan2(t.z,-t.x)}!function(e){var n=new We,i=new We,r=new We;for(let t=0;t<s.length;t+=3)o(s[t+0],n),o(s[t+1],i),o(s[t+2],r),function(t,n,i,e){const r=e+1,s=[];for(let e=0;e<=r;e++){s[e]=[];const h=t.clone().lerp(i,e/r);var o=n.clone().lerp(i,e/r),a=r-e;for(let t=0;t<=a;t++)0===t&&e===r?s[e][t]=h:s[e][t]=h.clone().lerp(o,t/a)}for(let e=0;e<r;e++)for(let t=0;t<2*(r-e)-1;t++){var l=Math.floor(t/2);t%2==0?(d(s[e][l+1]),d(s[e+1][l]),d(s[e][l])):(d(s[e][l+1]),d(s[e+1][l+1]),d(s[e+1][l]))}}(n,i,r,e)}(e),function(e){const n=new We;for(let t=0;t<c.length;t+=3)n.x=c[t+0],n.y=c[t+1],n.z=c[t+2],n.normalize().multiplyScalar(e),c[t+0]=n.x,c[t+1]=n.y,c[t+2]=n.z}(t),function(){const e=new We;for(let t=0;t<c.length;t+=3){e.x=c[t+0],e.y=c[t+1],e.z=c[t+2];var n=m(e)/2/Math.PI+.5,i=function(t){return Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))}(e)/Math.PI+.5;u.push(n,1-i)}(function(){const n=new We,i=new We,r=new We,s=new We,o=new Ie,a=new Ie,l=new Ie;for(let t=0,e=0;t<c.length;t+=9,e+=6){n.set(c[t+0],c[t+1],c[t+2]),i.set(c[t+3],c[t+4],c[t+5]),r.set(c[t+6],c[t+7],c[t+8]),o.set(u[e+0],u[e+1]),a.set(u[e+2],u[e+3]),l.set(u[e+4],u[e+5]),s.copy(n).add(i).add(r).divideScalar(3);var h=m(s);p(o,e+0,n,h),p(a,e+2,i,h),p(l,e+4,r,h)}})(),function(){for(let t=0;t<u.length;t+=6){var e=u[t+0],n=u[t+2],i=u[t+4],r=Math.max(e,n,i),s=Math.min(e,n,i);.9<r&&s<.1&&(e<.2&&(u[t+0]+=1),n<.2&&(u[t+2]+=1),i<.2&&(u[t+4]+=1))}}()}(),this.setAttribute("position",new xi(c,3)),this.setAttribute("normal",new xi(c.slice(),3)),this.setAttribute("uv",new xi(u,2)),0===e?this.computeVertexNormals():this.normalizeNormals()}static fromJSON(t){return new il(t.vertices,t.indices,t.radius,t.details)}}class rl extends il{constructor(t=1,e=0){var n=(1+Math.sqrt(5))/2,i=1/n;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-n,0,-i,n,0,i,-n,0,i,n,-i,-n,0,-i,n,0,i,-n,0,i,n,0,-n,0,-i,n,0,-i,-n,0,i,n,0,i],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,e),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new rl(t.radius,t.detail)}}const sl=new We,ol=new We,al=new We,ll=new ii;class hl extends Ci{constructor(t,e){if(super(),this.type="EdgesGeometry",this.parameters={thresholdAngle:e},e=void 0!==e?e:1,!0!==t.isGeometry){var n=Math.pow(10,4),i=Math.cos(we*e);const f=t.getIndex();var r=t.getAttribute("position"),s=(f||r).count;const v=[0,0,0];var o,a,l=["a","b","c"];const g=new Array(3),y={},x=[];for(let t=0;t<s;t+=3){f?(v[0]=f.getX(t),v[1]=f.getX(t+1),v[2]=f.getX(t+2)):(v[0]=t,v[1]=t+1,v[2]=t+2);const{a:_,b,c:w}=ll;if(_.fromBufferAttribute(r,v[0]),b.fromBufferAttribute(r,v[1]),w.fromBufferAttribute(r,v[2]),ll.getNormal(al),g[0]=`${Math.round(_.x*n)},${Math.round(_.y*n)},${Math.round(_.z*n)}`,g[1]=`${Math.round(b.x*n)},${Math.round(b.y*n)},${Math.round(b.z*n)}`,g[2]=`${Math.round(w.x*n)},${Math.round(w.y*n)},${Math.round(w.z*n)}`,g[0]!==g[1]&&g[1]!==g[2]&&g[2]!==g[0])for(let t=0;t<3;t++){var h=(t+1)%3,c=g[t],u=g[h],d=ll[l[t]],p=ll[l[h]],m=`${c}_${u}`,c=`${u}_${c}`;c in y&&y[c]?(al.dot(y[c].normal)<=i&&(x.push(d.x,d.y,d.z),x.push(p.x,p.y,p.z)),y[c]=null):m in y||(y[m]={index0:v[t],index1:v[h],normal:al.clone()})}}for(const M in y)y[M]&&({index0:o,index1:a}=y[M],sl.fromBufferAttribute(r,o),ol.fromBufferAttribute(r,a),x.push(sl.x,sl.y,sl.z),x.push(ol.x,ol.y,ol.z));this.setAttribute("position",new xi(x,3))}else console.error("THREE.EdgesGeometry no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}class cl{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(t,e){t=this.getUtoTmapping(t);return this.getPoint(t,e)}getPoints(e=5){const n=[];for(let t=0;t<=e;t++)n.push(this.getPoint(t/e));return n}getSpacedPoints(e=5){const n=[];for(let t=0;t<=e;t++)n.push(this.getPointAt(t/e));return n}getLength(){var t=this.getLengths();return t[t.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const n=[];let i,r=this.getPoint(0),s=0;n.push(0);for(let t=1;t<=e;t++)i=this.getPoint(t/e),s+=i.distanceTo(r),n.push(s),r=i;return this.cacheArcLengths=n,n}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e){var n=this.getLengths();let i=0;var r=n.length;let s;s=e||t*n[r-1];let o=0,a=r-1,l;for(;o<=a;)if(i=Math.floor(o+(a-o)/2),(l=n[i]-s)<0)o=i+1;else{if(!(0<l)){a=i;break}a=i-1}if(i=a,n[i]===s)return i/(r-1);e=n[i],t=n[i+1],e=(s-e)/(t-e);return(i+e)/(r-1)}getTangent(t,e){let n=t-1e-4,i=t+1e-4;n<0&&(n=0),1<i&&(i=1);var r=this.getPoint(n),t=this.getPoint(i);const s=e||new(r.isVector2?Ie:We);return s.copy(t).sub(r).normalize(),s}getTangentAt(t,e){t=this.getUtoTmapping(t);return this.getTangent(t,e)}computeFrenetFrames(n,t){const e=new We,i=[],r=[],s=[],o=new We,a=new bn;for(let t=0;t<=n;t++){var l=t/n;i[t]=this.getTangentAt(l,new We),i[t].normalize()}r[0]=new We,s[0]=new We;let h=Number.MAX_VALUE;var c,u=Math.abs(i[0].x),d=Math.abs(i[0].y),p=Math.abs(i[0].z);u<=h&&(h=u,e.set(1,0,0)),d<=h&&(h=d,e.set(0,1,0)),p<=h&&e.set(0,0,1),o.crossVectors(i[0],e).normalize(),r[0].crossVectors(i[0],o),s[0].crossVectors(i[0],r[0]);for(let t=1;t<=n;t++)r[t]=r[t-1].clone(),s[t]=s[t-1].clone(),o.crossVectors(i[t-1],i[t]),o.length()>Number.EPSILON&&(o.normalize(),c=Math.acos(Ee(i[t-1].dot(i[t]),-1,1)),r[t].applyMatrix4(a.makeRotationAxis(o,c))),s[t].crossVectors(i[t],r[t]);if(!0===t){let e=Math.acos(Ee(r[0].dot(r[n]),-1,1));e/=n,0<i[0].dot(o.crossVectors(r[0],r[n]))&&(e=-e);for(let t=1;t<=n;t++)r[t].applyMatrix4(a.makeRotationAxis(i[t],e*t)),s[t].crossVectors(i[t],r[t])}return{tangents:i,normals:r,binormals:s}}clone(){return(new this.constructor).copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class ul extends cl{constructor(t=0,e=0,n=1,i=1,r=0,s=2*Math.PI,o=!1,a=0){super(),this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=n,this.yRadius=i,this.aStartAngle=r,this.aEndAngle=s,this.aClockwise=o,this.aRotation=a}getPoint(t,e){const n=e||new Ie;var i=2*Math.PI;let r=this.aEndAngle-this.aStartAngle;for(var s=Math.abs(r)<Number.EPSILON;r<0;)r+=i;for(;r>i;)r-=i;r<Number.EPSILON&&(r=s?0:i),!0!==this.aClockwise||s||(r===i?r=-i:r-=i);var o=this.aStartAngle+t*r;let a=this.aX+this.xRadius*Math.cos(o),l=this.aY+this.yRadius*Math.sin(o);return 0!==this.aRotation&&(e=Math.cos(this.aRotation),s=Math.sin(this.aRotation),t=a-this.aX,o=l-this.aY,a=t*e-o*s+this.aX,l=t*s+o*e+this.aY),n.set(a,l)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}ul.prototype.isEllipseCurve=!0;class dl extends ul{constructor(t,e,n,i,r,s){super(t,e,n,n,i,r,s),this.type="ArcCurve"}}function pl(){let r=0,s=0,o=0,a=0;function l(t,e,n,i){r=t,s=n,o=-3*t+3*e-2*n-i,a=2*t-2*e+n+i}return{initCatmullRom:function(t,e,n,i,r){l(e,n,r*(n-t),r*(i-e))},initNonuniformCatmullRom:function(t,e,n,i,r,s,o){r=(e-t)/r-(n-t)/(r+s)+(n-e)/s,o=(n-e)/s-(i-e)/(s+o)+(i-n)/o;l(e,n,r*=s,o*=s)},calc:function(t){var e=t*t,n=e*t;return r+s*t+o*e+a*n}}}dl.prototype.isArcCurve=!0;const ml=new We,fl=new pl,vl=new pl,gl=new pl;class yl extends cl{constructor(t=[],e=!1,n="centripetal",i=.5){super(),this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=n,this.tension=i}getPoint(t,i=new We){const e=i;var n=this.points,i=n.length,t=(i-(this.closed?0:1))*t;let r=Math.floor(t),s=t-r;this.closed?r+=0<r?0:(Math.floor(Math.abs(r)/i)+1)*i:0===s&&r===i-1&&(r=i-2,s=1);let o,a;o=this.closed||0<r?n[(r-1)%i]:(ml.subVectors(n[0],n[1]).add(n[0]),ml);const l=n[r%i],h=n[(r+1)%i];if(a=this.closed||r+2<i?n[(r+2)%i]:(ml.subVectors(n[i-1],n[i-2]).add(n[i-1]),ml),"centripetal"===this.curveType||"chordal"===this.curveType){i="chordal"===this.curveType?.5:.25;let t=Math.pow(o.distanceToSquared(l),i),e=Math.pow(l.distanceToSquared(h),i),n=Math.pow(h.distanceToSquared(a),i);e<1e-4&&(e=1),t<1e-4&&(t=e),n<1e-4&&(n=e),fl.initNonuniformCatmullRom(o.x,l.x,h.x,a.x,t,e,n),vl.initNonuniformCatmullRom(o.y,l.y,h.y,a.y,t,e,n),gl.initNonuniformCatmullRom(o.z,l.z,h.z,a.z,t,e,n)}else"catmullrom"===this.curveType&&(fl.initCatmullRom(o.x,l.x,h.x,a.x,this.tension),vl.initCatmullRom(o.y,l.y,h.y,a.y,this.tension),gl.initCatmullRom(o.z,l.z,h.z,a.z,this.tension));return e.set(fl.calc(s),vl.calc(s),gl.calc(s)),e}copy(n){super.copy(n),this.points=[];for(let t=0,e=n.points.length;t<e;t++){const i=n.points[t];this.points.push(i.clone())}return this.closed=n.closed,this.curveType=n.curveType,this.tension=n.tension,this}toJSON(){const n=super.toJSON();n.points=[];for(let t=0,e=this.points.length;t<e;t++){const i=this.points[t];n.points.push(i.toArray())}return n.closed=this.closed,n.curveType=this.curveType,n.tension=this.tension,n}fromJSON(n){super.fromJSON(n),this.points=[];for(let t=0,e=n.points.length;t<e;t++){var i=n.points[t];this.points.push((new We).fromArray(i))}return this.closed=n.closed,this.curveType=n.curveType,this.tension=n.tension,this}}function xl(t,e,n,i,r){var s=.5*(i-e),e=.5*(r-n),r=t*t;return(2*n-2*i+s+e)*(t*r)+(-3*n+3*i-2*s-e)*r+s*t+n}function _l(t,e,n,i){return(r=1-(r=t))*r*e+2*(1-t)*t*n+t*t*i;var r}function bl(t,e,n,i,r){return(s=1-(s=t))*s*s*e+3*(e=1-t)*e*t*n+3*(1-t)*t*t*i+t*t*t*r;var s}class wl extends cl{constructor(t=new Ie,e=new Ie,n=new Ie,i=new Ie){super(),this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=n,this.v3=i}getPoint(t,e=new Ie){const n=e;var i=this.v0,r=this.v1,s=this.v2,e=this.v3;return n.set(bl(t,i.x,r.x,s.x,e.x),bl(t,i.y,r.y,s.y,e.y)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}wl.prototype.isCubicBezierCurve=yl.prototype.isCatmullRomCurve3=!0;class Ml extends cl{constructor(t=new We,e=new We,n=new We,i=new We){super(),this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=n,this.v3=i}getPoint(t,e=new We){const n=e;var i=this.v0,r=this.v1,s=this.v2,e=this.v3;return n.set(bl(t,i.x,r.x,s.x,e.x),bl(t,i.y,r.y,s.y,e.y),bl(t,i.z,r.z,s.z,e.z)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class Sl extends cl{constructor(t=new Ie,e=new Ie){super(),this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t,e=new Ie){const n=e;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e){const n=e||new Ie;return n.copy(this.v2).sub(this.v1).normalize(),n}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}Sl.prototype.isLineCurve=Ml.prototype.isCubicBezierCurve3=!0;cl;class El extends cl{constructor(t=new Ie,e=new Ie,n=new Ie){super(),this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=n}getPoint(t,e=new Ie){const n=e;var i=this.v0,r=this.v1,e=this.v2;return n.set(_l(t,i.x,r.x,e.x),_l(t,i.y,r.y,e.y)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}El.prototype.isQuadraticBezierCurve=!0;class Tl extends cl{constructor(t=new We,e=new We,n=new We){super(),this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=n}getPoint(t,e=new We){const n=e;var i=this.v0,r=this.v1,e=this.v2;return n.set(_l(t,i.x,r.x,e.x),_l(t,i.y,r.y,e.y),_l(t,i.z,r.z,e.z)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class Al extends cl{constructor(t=[]){super(),this.type="SplineCurve",this.points=t}getPoint(t,e=new Ie){const n=e;var i=this.points,r=(i.length-1)*t,s=Math.floor(r),o=r-s,e=i[0===s?s:s-1],t=i[s],r=i[s>i.length-2?i.length-1:s+1],s=i[s>i.length-3?i.length-1:s+2];return n.set(xl(o,e.x,t.x,r.x,s.x),xl(o,e.y,t.y,r.y,s.y)),n}copy(n){super.copy(n),this.points=[];for(let t=0,e=n.points.length;t<e;t++){const i=n.points[t];this.points.push(i.clone())}return this}toJSON(){const n=super.toJSON();n.points=[];for(let t=0,e=this.points.length;t<e;t++){const i=this.points[t];n.points.push(i.toArray())}return n}fromJSON(n){super.fromJSON(n),this.points=[];for(let t=0,e=n.points.length;t<e;t++){var i=n.points[t];this.points.push((new Ie).fromArray(i))}return this}}Al.prototype.isSplineCurve=Tl.prototype.isQuadraticBezierCurve3=!0;var Cl=Object.freeze({__proto__:null,ArcCurve:dl,CatmullRomCurve3:yl,CubicBezierCurve:wl,CubicBezierCurve3:Ml,EllipseCurve:ul,LineCurve:Sl,LineCurve3:class extends cl{constructor(t=new We,e=new We){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=t,this.v2=e}getPoint(t,e=new We){const n=e;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n}getPointAt(t,e){return this.getPoint(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}},QuadraticBezierCurve:El,QuadraticBezierCurve3:Tl,SplineCurve:Al});const Pl={triangulate:function(e,t,n=2){var i=t&&t.length,r=i?t[0]*n:e.length;let s=Ll(e,0,r,n,!0);var o=[];if(!s||s.next===s.prev)return o;let a,l,h,c,u,d,p;if(i&&(s=function(t,e,n,i){const r=[];let s,o,a,l,h;for(s=0,o=e.length;s<o;s++)a=e[s]*i,l=s<o-1?e[s+1]*i:t.length,h=Ll(t,a,l,i,!1),h===h.next&&(h.steiner=!0),r.push(function(t){let e=t,n=t;for(;(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next,e!==t;);return n}(h));for(r.sort(zl),s=0;s<r.length;s++)!function(t,e){(e=function(t,e){let n=e;var i=t.x,r=t.y;let s=-1/0,o;do{if(r<=n.y&&r>=n.next.y&&n.next.y!==n.y){var a=n.x+(r-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=i&&a>s){if((s=a)===i){if(r===n.y)return n;if(r===n.next.y)return n.next}o=n.x<n.next.x?n:n.next}}}while(n=n.next,n!==e);if(!o)return null;if(i===s)return o;var l=o,h=o.x,c=o.y;let u=1/0,d;n=o;for(;i>=n.x&&n.x>=h&&i!==n.x&&Bl(r<c?i:s,r,h,c,r<c?s:i,r,n.x,n.y)&&(d=Math.abs(r-n.y)/(i-n.x),Ul(n,t)&&(d<u||d===u&&(n.x>o.x||n.x===o.x&&function(t,e){return Dl(t.prev,t,e.prev)<0&&Dl(e.next,t,t.next)<0}(o,n)))&&(o=n,u=d)),n=n.next,n!==l;);return o}(t,e))&&(t=Hl(e,t),Rl(e,e.next),Rl(t,t.next))}(r[s],n),n=Rl(n,n.next);return n}(e,t,s,n)),e.length>80*n){a=h=e[0],l=c=e[1];for(let t=n;t<r;t+=n)u=e[t],d=e[t+1],u<a&&(a=u),d<l&&(l=d),u>h&&(h=u),d>c&&(c=d);p=Math.max(h-a,c-l),p=0!==p?1/p:0}return Il(s,o,n,a,l,p),o}};function Ll(t,e,n,i,r){let s,o;if(r===0<function(n,i,r,s){let o=0;for(let t=i,e=r-s;t<r;t+=s)o+=(n[e]-n[t])*(n[t+1]+n[e+1]),e=t;return o}(t,e,n,i))for(s=e;s<n;s+=i)o=Wl(s,t[s],t[s+1],o);else for(s=n-i;s>=e;s-=i)o=Wl(s,t[s],t[s+1],o);return o&&Fl(o,o.next)&&(Gl(o),o=o.next),o}function Rl(t,e){if(!t)return t;e=e||t;let n=t,i;do{if(i=!1,n.steiner||!Fl(n,n.next)&&0!==Dl(n.prev,n,n.next))n=n.next;else{if(Gl(n),n=e=n.prev,n===n.next)break;i=!0}}while(i||n!==e);return e}function Il(i,r,s,o,a,l,h){if(i){!h&&l&&function(t,e,n,i){let r=t;for(;null===r.z&&(r.z=Nl(r.x,r.y,e,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next,r!==t;);r.prevZ.nextZ=null,r.prevZ=null,function(t){let e,n,i,r,s,o,a,l,h=1;do{for(n=t,t=null,s=null,o=0;n;){for(o++,i=n,a=0,e=0;e<h&&(a++,i=i.nextZ,i);e++);for(l=h;0<a||0<l&&i;)0!==a&&(0===l||!i||n.z<=i.z)?(r=n,n=n.nextZ,a--):(r=i,i=i.nextZ,l--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;n=i}}while(s.nextZ=null,h*=2,1<o)}(r)}(i,o,a,l);let t=i,e,n;for(;i.prev!==i.next;)if(e=i.prev,n=i.next,l?function(t,e,n,i){var r=t.prev,s=t,o=t.next;if(0<=Dl(r,s,o))return!1;var a=(r.x<s.x?r.x<o.x?r:o:s.x<o.x?s:o).x,l=(r.y<s.y?r.y<o.y?r:o:s.y<o.y?s:o).y,h=(r.x>s.x?r.x>o.x?r:o:s.x>o.x?s:o).x,c=(r.y>s.y?r.y>o.y?r:o:s.y>o.y?s:o).y,u=Nl(a,l,e,n,i),d=Nl(h,c,e,n,i);let p=t.prevZ,m=t.nextZ;for(;p&&p.z>=u&&m&&m.z<=d;){if(p!==t.prev&&p!==t.next&&Bl(r.x,r.y,s.x,s.y,o.x,o.y,p.x,p.y)&&0<=Dl(p.prev,p,p.next))return!1;if(p=p.prevZ,m!==t.prev&&m!==t.next&&Bl(r.x,r.y,s.x,s.y,o.x,o.y,m.x,m.y)&&0<=Dl(m.prev,m,m.next))return!1;m=m.nextZ}for(;p&&p.z>=u;){if(p!==t.prev&&p!==t.next&&Bl(r.x,r.y,s.x,s.y,o.x,o.y,p.x,p.y)&&0<=Dl(p.prev,p,p.next))return!1;p=p.prevZ}for(;m&&m.z<=d;){if(m!==t.prev&&m!==t.next&&Bl(r.x,r.y,s.x,s.y,o.x,o.y,m.x,m.y)&&0<=Dl(m.prev,m,m.next))return!1;m=m.nextZ}return!0}(i,o,a,l):function(t){var e=t.prev,n=t,i=t.next;if(0<=Dl(e,n,i))return!1;let r=t.next.next;for(;r!==t.prev;){if(Bl(e.x,e.y,n.x,n.y,i.x,i.y,r.x,r.y)&&0<=Dl(r.prev,r,r.next))return!1;r=r.next}return!0}(i))r.push(e.i/s),r.push(i.i/s),r.push(n.i/s),Gl(i),i=n.next,t=n.next;else if((i=n)===t){h?1===h?Il(i=function(t,e,n){let i=t;do{var r=i.prev,s=i.next.next;!Fl(r,s)&&kl(r,i,i.next,s)&&Ul(r,s)&&Ul(s,r)&&(e.push(r.i/n),e.push(i.i/n),e.push(s.i/n),Gl(i),Gl(i.next),i=t=s),i=i.next}while(i!==t);return Rl(i)}(Rl(i),r,s),r,s,o,a,l,2):2===h&&function(t,e,n,i,r,s){let o=t;do{let t=o.next.next;for(;t!==o.prev;){if(o.i!==t.i&&function(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&kl(n,n.next,t,e))return!0}while(n=n.next,n!==t);return!1}(t,e)&&(Ul(t,e)&&Ul(e,t)&&function(t,e){let n=t,i=!1;var r=(t.x+e.x)/2,s=(t.y+e.y)/2;for(;n.y>s!=n.next.y>s&&n.next.y!==n.y&&r<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next,n!==t;);return i}(t,e)&&(Dl(t.prev,t,e.prev)||Dl(t,e.prev,e))||Fl(t,e)&&0<Dl(t.prev,t,t.next)&&0<Dl(e.prev,e,e.next))}(o,t)){var a=Hl(o,t);return o=Rl(o,o.next),a=Rl(a,a.next),Il(o,e,n,i,r,s),Il(a,e,n,i,r,s)}t=t.next}}while(o=o.next,o!==t)}(i,r,s,o,a,l):Il(Rl(i),r,s,o,a,l,1);break}}}function zl(t,e){return t.x-e.x}function Nl(t,e,n,i,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Bl(t,e,n,i,r,s,o,a){return 0<=(r-o)*(e-a)-(t-o)*(s-a)&&0<=(t-o)*(i-a)-(n-o)*(e-a)&&0<=(n-o)*(s-a)-(r-o)*(i-a)}function Dl(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Fl(t,e){return t.x===e.x&&t.y===e.y}function kl(t,e,n,i){var r=Vl(Dl(t,e,n)),s=Vl(Dl(t,e,i)),o=Vl(Dl(n,i,t)),a=Vl(Dl(n,i,e));return r!==s&&o!==a||(0===r&&Ol(t,n,e)||(0===s&&Ol(t,i,e)||(0===o&&Ol(n,t,i)||!(0!==a||!Ol(n,e,i)))))}function Ol(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function Vl(t){return 0<t?1:t<0?-1:0}function Ul(t,e){return Dl(t.prev,t,t.next)<0?0<=Dl(t,e,t.next)&&0<=Dl(t,t.prev,e):Dl(t,e,t.prev)<0||Dl(t,t.next,e)<0}function Hl(t,e){const n=new jl(t.i,t.x,t.y),i=new jl(e.i,e.x,e.y),r=t.next,s=e.prev;return(t.next=e).prev=t,n.next=r,r.prev=n,i.next=n,n.prev=i,s.next=i,i.prev=s,i}function Wl(t,e,n,i){const r=new jl(t,e,n);return i?(r.next=i.next,(r.prev=i).next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function Gl(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function jl(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class ql{static area(n){var i=n.length;let r=0;for(let t=i-1,e=0;e<i;t=e++)r+=n[t].x*n[e].y-n[e].x*n[t].y;return.5*r}static isClockWise(t){return ql.area(t)<0}static triangulateShape(t,e){var n=[];const i=[],r=[];Xl(t),Yl(n,t);let s=t.length;e.forEach(Xl);for(let t=0;t<e.length;t++)i.push(s),s+=e[t].length,Yl(n,e[t]);const o=Pl.triangulate(n,i);for(let t=0;t<o.length;t+=3)r.push(o.slice(t,t+3));return r}}function Xl(t){var e=t.length;2<e&&t[e-1].equals(t[0])&&t.pop()}function Yl(e,n){for(let t=0;t<n.length;t++)e.push(n[t].x),e.push(n[t].y)}class Zl extends Ci{constructor(n,Q){super(),this.type="ExtrudeGeometry",this.parameters={shapes:n,options:Q},n=Array.isArray(n)?n:[n];const $=this,tt=[],et=[];for(let t=0,e=n.length;t<e;t++)!function(t){const i=[],e=void 0!==Q.curveSegments?Q.curveSegments:12,a=void 0!==Q.steps?Q.steps:1;let n=void 0!==Q.depth?Q.depth:100,o=void 0===Q.bevelEnabled||Q.bevelEnabled,r=void 0!==Q.bevelThickness?Q.bevelThickness:6,s=void 0!==Q.bevelSize?Q.bevelSize:r-2,l=void 0!==Q.bevelOffset?Q.bevelOffset:0,h=void 0!==Q.bevelSegments?Q.bevelSegments:3;const c=Q.extrudePath,u=void 0!==Q.UVGenerator?Q.UVGenerator:Kl;void 0!==Q.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),n=Q.amount);let d,p=!1,m,f,v,g;c&&(d=c.getSpacedPoints(a),p=!0,o=!1,m=c.computeFrenetFrames(a,!1),f=new We,v=new We,g=new We);o||(h=0,r=0,s=0,l=0);t=t.extractPoints(e);let y=t.shape;const x=t.holes,_=!ql.isClockWise(y);if(_){y=y.reverse();for(let t=0,e=x.length;t<e;t++){const J=x[t];ql.isClockWise(J)&&(x[t]=J.reverse())}}const b=ql.triangulateShape(y,x),w=y;for(let t=0,e=x.length;t<e;t++){var M=x[t];y=y.concat(M)}function S(t,e,n){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().multiplyScalar(n).add(t)}const E=y.length,T=b.length;function A(t,e,n){let i,r,s;var o=t.x-e.x,a=t.y-e.y,l=n.x-t.x,h=n.y-t.y,c=o*o+a*a;if(Math.abs(o*h-a*l)>Number.EPSILON){var u=Math.sqrt(c),d=Math.sqrt(l*l+h*h),p=e.x-a/u,u=e.y+o/u,d=((n.x-h/d-p)*h-(n.y+l/d-u)*l)/(o*h-a*l);i=p+o*d-t.x,r=u+a*d-t.y;t=i*i+r*r;if(t<=2)return new Ie(i,r);s=Math.sqrt(t/2)}else{let t=!1;o>Number.EPSILON?l>Number.EPSILON&&(t=!0):o<-Number.EPSILON?l<-Number.EPSILON&&(t=!0):Math.sign(a)===Math.sign(h)&&(t=!0),s=t?(i=-a,r=o,Math.sqrt(c)):(i=o,r=a,Math.sqrt(c/2))}return new Ie(i/s,r/s)}const C=[];for(let t=0,e=w.length,n=e-1,i=t+1;t<e;t++,n++,i++)n===e&&(n=0),i===e&&(i=0),C[t]=A(w[t],w[n],w[i]);const P=[];let L,R=C.concat();for(let t=0,e=x.length;t<e;t++){var I=x[t];L=[];for(let t=0,e=I.length,n=e-1,i=t+1;t<e;t++,n++,i++)n===e&&(n=0),i===e&&(i=0),L[t]=A(I[t],I[n],I[i]);P.push(L),R=R.concat(L)}for(let t=0;t<h;t++){var z=t/h,N=r*Math.cos(z*Math.PI/2);const k=s*Math.sin(z*Math.PI/2)+l;for(let t=0,e=w.length;t<e;t++){var B=S(w[t],C[t],k);X(B.x,B.y,-N)}for(let t=0,e=x.length;t<e;t++){var D=x[t];L=P[t];for(let t=0,e=D.length;t<e;t++){var F=S(D[t],L[t],k);X(F.x,F.y,-N)}}}const k=s+l;for(let t=0;t<E;t++){var O=o?S(y[t],R[t],k):y[t];p?(v.copy(m.normals[0]).multiplyScalar(O.x),f.copy(m.binormals[0]).multiplyScalar(O.y),g.copy(d[0]).add(v).add(f),X(g.x,g.y,g.z)):X(O.x,O.y,0)}for(let e=1;e<=a;e++)for(let t=0;t<E;t++){var V=o?S(y[t],R[t],k):y[t];p?(v.copy(m.normals[e]).multiplyScalar(V.x),f.copy(m.binormals[e]).multiplyScalar(V.y),g.copy(d[e]).add(v).add(f),X(g.x,g.y,g.z)):X(V.x,V.y,n/a*e)}for(let t=h-1;0<=t;t--){var U=t/h,H=r*Math.cos(U*Math.PI/2);const k=s*Math.sin(U*Math.PI/2)+l;for(let t=0,e=w.length;t<e;t++){var W=S(w[t],C[t],k);X(W.x,W.y,n+H)}for(let t=0,e=x.length;t<e;t++){var G=x[t];L=P[t];for(let t=0,e=G.length;t<e;t++){var j=S(G[t],L[t],k);p?X(j.x,j.y+d[a-1].y,d[a-1].x+H):X(j.x,j.y,n+H)}}}function q(t,i){let e=t.length;for(;0<=--e;){var r=e;let n=e-1;n<0&&(n=t.length-1);for(let t=0,e=a+2*h;t<e;t++){var s=E*t,o=E*(t+1);!function(t,e,n,i){Z(t),Z(e),Z(i),Z(e),Z(n),Z(i);i=tt.length/3,i=u.generateSideWallUV($,tt,i-6,i-3,i-2,i-1);K(i[0]),K(i[1]),K(i[3]),K(i[1]),K(i[2]),K(i[3])}(i+r+s,i+n+s,i+n+o,i+r+o)}}}function X(t,e,n){i.push(t),i.push(e),i.push(n)}function Y(t,e,n){Z(t),Z(e),Z(n);n=tt.length/3,n=u.generateTopUV($,tt,n-3,n-2,n-1);K(n[0]),K(n[1]),K(n[2])}function Z(t){tt.push(i[3*t+0]),tt.push(i[3*t+1]),tt.push(i[3*t+2])}function K(t){et.push(t.x),et.push(t.y)}(function(){var t,e=tt.length/3;if(o){let e=0*E;for(let t=0;t<T;t++){var n=b[t];Y(n[2]+e,n[1]+e,n[0]+e)}t=a+2*h,e=E*t;for(let t=0;t<T;t++){var i=b[t];Y(i[0]+e,i[1]+e,i[2]+e)}}else{for(let t=0;t<T;t++){var r=b[t];Y(r[2],r[1],r[0])}for(let t=0;t<T;t++){var s=b[t];Y(s[0]+E*a,s[1]+E*a,s[2]+E*a)}}$.addGroup(e,tt.length/3-e,0)})(),function(){var t=tt.length/3;let n=0;q(w,n),n+=w.length;for(let t=0,e=x.length;t<e;t++){var i=x[t];q(i,n),n+=i.length}$.addGroup(t,tt.length/3-t,1)}()}(n[t]);this.setAttribute("position",new xi(tt,3)),this.setAttribute("uv",new xi(et,2)),this.computeVertexNormals()}toJSON(){var t=super.toJSON();return function(n,t,i){if(i.shapes=[],Array.isArray(n))for(let t=0,e=n.length;t<e;t++){var r=n[t];i.shapes.push(r.uuid)}else i.shapes.push(n.uuid);void 0!==t.extrudePath&&(i.options.extrudePath=t.extrudePath.toJSON());return i}(this.parameters.shapes,this.parameters.options,t)}static fromJSON(n,i){const r=[];for(let t=0,e=n.shapes.length;t<e;t++){var s=i[n.shapes[t]];r.push(s)}var t=n.options.extrudePath;return void 0!==t&&(n.options.extrudePath=(new Cl[t.type]).fromJSON(t)),new Zl(r,n.options)}}const Kl={generateTopUV:function(t,e,n,i,r){var s=e[3*n],o=e[3*n+1],a=e[3*i],n=e[3*i+1],i=e[3*r],r=e[3*r+1];return[new Ie(s,o),new Ie(a,n),new Ie(i,r)]},generateSideWallUV:function(t,e,n,i,r,s){var o=e[3*n],a=e[3*n+1],l=e[3*n+2],h=e[3*i],c=e[3*i+1],u=e[3*i+2],d=e[3*r],p=e[3*r+1],n=e[3*r+2],i=e[3*s],r=e[3*s+1],s=e[3*s+2];return Math.abs(a-c)<Math.abs(o-h)?[new Ie(o,1-l),new Ie(h,1-u),new Ie(d,1-n),new Ie(i,1-s)]:[new Ie(a,1-l),new Ie(c,1-u),new Ie(p,1-n),new Ie(r,1-s)]}};class Jl extends il{constructor(t=1,e=0){var n=(1+Math.sqrt(5))/2;super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new Jl(t.radius,t.detail)}}class Ql extends Ci{constructor(n,i=12,t=0,r=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:n,segments:i,phiStart:t,phiLength:r},i=Math.floor(i),r=Ee(r,0,2*Math.PI);const s=[],o=[],a=[];var l=1/i;const h=new We,c=new Ie;for(let e=0;e<=i;e++){var u=t+e*l*r,d=Math.sin(u),p=Math.cos(u);for(let t=0;t<=n.length-1;t++)h.x=n[t].x*d,h.y=n[t].y,h.z=n[t].x*p,o.push(h.x,h.y,h.z),c.x=e/i,c.y=t/(n.length-1),a.push(c.x,c.y)}for(let e=0;e<i;e++)for(let t=0;t<n.length-1;t++){var m=t+e*n.length,f=m+n.length,v=m+n.length+1,g=m+1;s.push(m,f,g),s.push(f,v,g)}if(this.setIndex(s),this.setAttribute("position",new xi(o,3)),this.setAttribute("uv",new xi(a,2)),this.computeVertexNormals(),r===2*Math.PI){const x=this.attributes.normal.array,_=new We,b=new We,w=new We;var y=i*n.length*3;for(let t=0,e=0;t<n.length;t++,e+=3)_.x=x[e+0],_.y=x[e+1],_.z=x[e+2],b.x=x[y+e+0],b.y=x[y+e+1],b.z=x[y+e+2],w.addVectors(_,b).normalize(),x[e+0]=x[y+e+0]=w.x,x[e+1]=x[y+e+1]=w.y,x[e+2]=x[y+e+2]=w.z}}static fromJSON(t){return new Ql(t.points,t.segments,t.phiStart,t.phiLength)}}class $l extends il{constructor(t=1,e=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new $l(t.radius,t.detail)}}class th extends Ci{constructor(e,n,i){super(),this.type="ParametricGeometry",this.parameters={func:e,slices:n,stacks:i};const r=[],s=[],o=[],a=[];const l=new We;var h=new We,c=new We;const u=new We,d=new We;e.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");var p=n+1;for(let t=0;t<=i;t++){var m=t/i;for(let t=0;t<=n;t++){var f=t/n;e(f,m,h),s.push(h.x,h.y,h.z),0<=f-1e-5?(e(f-1e-5,m,c),u.subVectors(h,c)):(e(1e-5+f,m,c),u.subVectors(c,h)),0<=m-1e-5?(e(f,m-1e-5,c),d.subVectors(h,c)):(e(f,1e-5+m,c),d.subVectors(c,h)),l.crossVectors(u,d).normalize(),o.push(l.x,l.y,l.z),a.push(f,m)}}for(let e=0;e<i;e++)for(let t=0;t<n;t++){var v=e*p+t,g=e*p+t+1,y=(e+1)*p+t+1,x=(e+1)*p+t;r.push(v,g,x),r.push(g,y,x)}this.setIndex(r),this.setAttribute("position",new xi(s,3)),this.setAttribute("normal",new xi(o,3)),this.setAttribute("uv",new xi(a,2))}}class eh extends Ci{constructor(t=.5,e=1,n=8,i=1,r=0,s=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:n,phiSegments:i,thetaStart:r,thetaLength:s},n=Math.max(3,n);const o=[],a=[],l=[],h=[];let c=t;var u=(e-t)/(i=Math.max(1,i));const d=new We,p=new Ie;for(let t=0;t<=i;t++){for(let t=0;t<=n;t++){var m=r+t/n*s;d.x=c*Math.cos(m),d.y=c*Math.sin(m),a.push(d.x,d.y,d.z),l.push(0,0,1),p.x=(d.x/e+1)/2,p.y=(d.y/e+1)/2,h.push(p.x,p.y)}c+=u}for(let t=0;t<i;t++){var f=t*(n+1);for(let t=0;t<n;t++){var v=t+f,g=v+n+1,y=v+n+2,x=v+1;o.push(v,g,x),o.push(g,y,x)}}this.setIndex(o),this.setAttribute("position",new xi(a,3)),this.setAttribute("normal",new xi(l,3)),this.setAttribute("uv",new xi(h,2))}static fromJSON(t){return new eh(t.innerRadius,t.outerRadius,t.thetaSegments,t.phiSegments,t.thetaStart,t.thetaLength)}}class nh extends Ci{constructor(e,d=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:d};const p=[],m=[],f=[],v=[];let n=0,g=0;if(!1===Array.isArray(e))i(e);else for(let t=0;t<e.length;t++)i(e[t]),this.addGroup(n,g,t),n+=g,g=0;function i(t){var n=m.length/3,t=t.extractPoints(d);let i=t.shape;const r=t.holes;!1===ql.isClockWise(i)&&(i=i.reverse());for(let t=0,e=r.length;t<e;t++){const u=r[t];!0===ql.isClockWise(u)&&(r[t]=u.reverse())}var s=ql.triangulateShape(i,r);for(let t=0,e=r.length;t<e;t++){var o=r[t];i=i.concat(o)}for(let t=0,e=i.length;t<e;t++){var a=i[t];m.push(a.x,a.y,0),f.push(0,0,1),v.push(a.x,a.y)}for(let t=0,e=s.length;t<e;t++){var l=s[t],h=l[0]+n,c=l[1]+n,l=l[2]+n;p.push(h,c,l),g+=3}}this.setIndex(p),this.setAttribute("position",new xi(m,3)),this.setAttribute("normal",new xi(f,3)),this.setAttribute("uv",new xi(v,2))}toJSON(){var t=super.toJSON();return function(n,i){if(i.shapes=[],Array.isArray(n))for(let t=0,e=n.length;t<e;t++){var r=n[t];i.shapes.push(r.uuid)}else i.shapes.push(n.uuid);return i}(this.parameters.shapes,t)}static fromJSON(n,i){const r=[];for(let t=0,e=n.shapes.length;t<e;t++){var s=i[n.shapes[t]];r.push(s)}return new nh(r,n.curveSegments)}}class ih extends Ci{constructor(n=1,i=32,r=16,s=0,o=2*Math.PI,a=0,l=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:n,widthSegments:i,heightSegments:r,phiStart:s,phiLength:o,thetaStart:a,thetaLength:l},i=Math.max(3,Math.floor(i)),r=Math.max(2,Math.floor(r));var h=Math.min(a+l,Math.PI);let c=0;const u=[],d=new We,p=new We,m=[],f=[],v=[],g=[];for(let t=0;t<=r;t++){const S=[];var y=t/r;let e=0;0==t&&0==a?e=.5/i:t==r&&h==Math.PI&&(e=-.5/i);for(let t=0;t<=i;t++){var x=t/i;d.x=-n*Math.cos(s+x*o)*Math.sin(a+y*l),d.y=n*Math.cos(a+y*l),d.z=n*Math.sin(s+x*o)*Math.sin(a+y*l),f.push(d.x,d.y,d.z),p.copy(d).normalize(),v.push(p.x,p.y,p.z),g.push(x+e,1-y),S.push(c++)}u.push(S)}for(let e=0;e<r;e++)for(let t=0;t<i;t++){var _=u[e][t+1],b=u[e][t],w=u[e+1][t],M=u[e+1][t+1];(0!==e||0<a)&&m.push(_,b,M),(e!==r-1||h<Math.PI)&&m.push(b,w,M)}this.setIndex(m),this.setAttribute("position",new xi(f,3)),this.setAttribute("normal",new xi(v,3)),this.setAttribute("uv",new xi(g,2))}static fromJSON(t){return new ih(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}}class rh extends il{constructor(t=1,e=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,e),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new rh(t.radius,t.detail)}}class sh extends Zl{constructor(t,e={}){const n=e.font;if(!n||!n.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new Ci;t=n.generateShapes(t,e.size);e.depth=void 0!==e.height?e.height:50,void 0===e.bevelThickness&&(e.bevelThickness=10),void 0===e.bevelSize&&(e.bevelSize=8),void 0===e.bevelEnabled&&(e.bevelEnabled=!1),super(t,e),this.type="TextGeometry"}}class oh extends Ci{constructor(n=1,i=.4,r=8,s=6,o=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:n,tube:i,radialSegments:r,tubularSegments:s,arc:o},r=Math.floor(r),s=Math.floor(s);const a=[],l=[],h=[],c=[],u=new We,d=new We,p=new We;for(let e=0;e<=r;e++)for(let t=0;t<=s;t++){var m=t/s*o,f=e/r*Math.PI*2;d.x=(n+i*Math.cos(f))*Math.cos(m),d.y=(n+i*Math.cos(f))*Math.sin(m),d.z=i*Math.sin(f),l.push(d.x,d.y,d.z),u.x=n*Math.cos(m),u.y=n*Math.sin(m),p.subVectors(d,u).normalize(),h.push(p.x,p.y,p.z),c.push(t/s),c.push(e/r)}for(let e=1;e<=r;e++)for(let t=1;t<=s;t++){var v=(s+1)*e+t-1,g=(s+1)*(e-1)+t-1,y=(s+1)*(e-1)+t,x=(s+1)*e+t;a.push(v,g,x),a.push(g,y,x)}this.setIndex(a),this.setAttribute("position",new xi(l,3)),this.setAttribute("normal",new xi(h,3)),this.setAttribute("uv",new xi(c,2))}static fromJSON(t){return new oh(t.radius,t.tube,t.radialSegments,t.tubularSegments,t.arc)}}class ah extends Ci{constructor(t=1,n=.4,i=64,r=8,s=2,o=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:n,tubularSegments:i,radialSegments:r,p:s,q:o},i=Math.floor(i),r=Math.floor(r);const a=[],l=[],h=[],c=[],u=new We,d=new We;var p=new We,m=new We;const f=new We,v=new We,g=new We;for(let e=0;e<=i;++e){var y=e/i*s*Math.PI*2;E(y,s,o,t,p),E(.01+y,s,o,t,m),v.subVectors(m,p),g.addVectors(m,p),f.crossVectors(v,g),g.crossVectors(f,v),f.normalize(),g.normalize();for(let t=0;t<=r;++t){var x=t/r*Math.PI*2,_=-n*Math.cos(x),x=n*Math.sin(x);u.x=p.x+(_*g.x+x*f.x),u.y=p.y+(_*g.y+x*f.y),u.z=p.z+(_*g.z+x*f.z),l.push(u.x,u.y,u.z),d.subVectors(u,p).normalize(),h.push(d.x,d.y,d.z),c.push(e/i),c.push(t/r)}}for(let e=1;e<=i;e++)for(let t=1;t<=r;t++){var b=(r+1)*(e-1)+(t-1),w=(r+1)*e+(t-1),M=(r+1)*e+t,S=(r+1)*(e-1)+t;a.push(b,w,S),a.push(w,M,S)}function E(t,e,n,i,r){var s=Math.cos(t),o=Math.sin(t),e=n/e*t,t=Math.cos(e);r.x=i*(2+t)*.5*s,r.y=i*(2+t)*o*.5,r.z=i*Math.sin(e)*.5}this.setIndex(a),this.setAttribute("position",new xi(l,3)),this.setAttribute("normal",new xi(h,3)),this.setAttribute("uv",new xi(c,2))}static fromJSON(t){return new ah(t.radius,t.tube,t.tubularSegments,t.radialSegments,t.p,t.q)}}class lh extends Ci{constructor(s,o=64,a=1,l=8,t=!1){super(),this.type="TubeGeometry",this.parameters={path:s,tubularSegments:o,radius:a,radialSegments:l,closed:t};const h=s.computeFrenetFrames(o,t);this.tangents=h.tangents,this.normals=h.normals,this.binormals=h.binormals;const c=new We,u=new We,n=new Ie;let d=new We;const p=[],m=[],i=[],f=[];function e(t){d=s.getPointAt(t/o,d);var e=h.normals[t],n=h.binormals[t];for(let t=0;t<=l;t++){var i=t/l*Math.PI*2,r=Math.sin(i),i=-Math.cos(i);u.x=i*e.x+r*n.x,u.y=i*e.y+r*n.y,u.z=i*e.z+r*n.z,u.normalize(),m.push(u.x,u.y,u.z),c.x=d.x+a*u.x,c.y=d.y+a*u.y,c.z=d.z+a*u.z,p.push(c.x,c.y,c.z)}}!function(){for(let t=0;t<o;t++)e(t);e(!1===t?o:0),function(){for(let e=0;e<=o;e++)for(let t=0;t<=l;t++)n.x=e/o,n.y=t/l,i.push(n.x,n.y)}(),function(){for(let e=1;e<=o;e++)for(let t=1;t<=l;t++){var n=(l+1)*(e-1)+(t-1),i=(l+1)*e+(t-1),r=(l+1)*e+t,s=(l+1)*(e-1)+t;f.push(n,i,s),f.push(i,r,s)}}()}(),this.setIndex(f),this.setAttribute("position",new xi(p,3)),this.setAttribute("normal",new xi(m,3)),this.setAttribute("uv",new xi(i,2))}toJSON(){const t=super.toJSON();return t.path=this.parameters.path.toJSON(),t}static fromJSON(t){return new lh((new Cl[t.path.type]).fromJSON(t.path),t.tubularSegments,t.radius,t.radialSegments,t.closed)}}class hh extends Ci{constructor(t){if(super(),this.type="WireframeGeometry",!0!==t.isGeometry){const u=[];var i=new Set;const d=new We,p=new We;if(null!==t.index){var r=t.attributes.position;const m=t.index;let n=t.groups;0===n.length&&(n=[{start:0,count:m.count,materialIndex:0}]);for(let t=0,e=n.length;t<e;++t){var s=n[t],o=s.start;for(let e=o,t=o+s.count;e<t;e+=3)for(let t=0;t<3;t++){var a=m.getX(e+t),l=m.getX(e+(t+1)%3);d.fromBufferAttribute(r,a),p.fromBufferAttribute(r,l),!0===ch(d,p,i)&&(u.push(d.x,d.y,d.z),u.push(p.x,p.y,p.z))}}}else{var n=t.attributes.position;for(let e=0,t=n.count/3;e<t;e++)for(let t=0;t<3;t++){var h=3*e+t,c=3*e+(t+1)%3;d.fromBufferAttribute(n,h),p.fromBufferAttribute(n,c),!0===ch(d,p,i)&&(u.push(d.x,d.y,d.z),u.push(p.x,p.y,p.z))}}this.setAttribute("position",new xi(u,3))}else console.error("THREE.WireframeGeometry no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}function ch(t,e,n){var i=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`,t=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`;return!0!==n.has(i)&&!0!==n.has(t)&&(n.add(i,t),!0)}Yi,Yi,tl,tl,nl,nl,el,el,rl,rl,hl,Zl,Zl,Jl,Jl,Ql,Ql,$l,$l,pr,pr,il,il,eh,eh,nh,nh,ih,ih,rh,rh,sh,sh,oh,oh,ah,ah,lh,lh,hh;class uh extends si{constructor(t){super(),this.type="ShadowMaterial",this.color=new di(0),this.transparent=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this}}class dh extends si{constructor(t){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new di(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new di(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ge,this.normalScale=new Ie(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this}}dh.prototype.isMeshStandardMaterial=uh.prototype.isShadowMaterial=!0;class ph extends dh{constructor(t){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Ie(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Ee(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.sheenTint=new di(0),this.transmission=0,this.transmissionMap=null,this.thickness=.01,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationTint=new di(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularTint=new di(1,1,1),this.specularTintMap=null,this._clearcoat=0,this._transmission=0,this.setValues(t)}get clearcoat(){return this._clearcoat}set clearcoat(t){0<this._clearcoat!=0<t&&this.version++,this._clearcoat=t}get transmission(){return this._transmission}set transmission(t){0<this._transmission!=0<t&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.ior=t.ior,this.sheenTint.copy(t.sheenTint),this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationTint.copy(t.attenuationTint),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularTint.copy(t.specularTint),this.specularTintMap=t.specularTintMap,this}}ph.prototype.isMeshPhysicalMaterial=!0;class mh extends si{constructor(t){super(),this.type="MeshPhongMaterial",this.color=new di(16777215),this.specular=new di(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new di(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ge,this.normalScale=new Ie(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this}}class fh extends si{constructor(t){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new di(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new di(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ge,this.normalScale=new Ie(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this}}class vh extends si{constructor(t){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ge,this.normalScale=new Ie(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}}class gh extends si{constructor(t){super(),this.type="MeshLambertMaterial",this.color=new di(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new di(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this}}class yh extends si{constructor(t){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new di(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ge,this.normalScale=new Ie(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.flatShading=t.flatShading,this}}yh.prototype.isMeshMatcapMaterial=gh.prototype.isMeshLambertMaterial=vh.prototype.isMeshNormalMaterial=fh.prototype.isMeshToonMaterial=mh.prototype.isMeshPhongMaterial=!0;class xh extends Ba{constructor(t){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}xh.prototype.isLineDashedMaterial=!0;na,Sr,Qi,qa,ph,dh,Bo,Do,pi,yh,Ba,si;const _h={arraySlice:function(t,e,n){return _h.isTypedArray(t)?new t.constructor(t.subarray(e,void 0!==n?n:t.length)):t.slice(e,n)},convertArray:function(t,e,n){return!t||!n&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(n){var e=n.length;const i=new Array(e);for(let t=0;t!==e;++t)i[t]=t;return i.sort(function(t,e){return n[t]-n[e]}),i},sortedArray:function(n,i,r){var s=n.length;const o=new n.constructor(s);for(let t=0,e=0;e!==s;++t){var a=r[t]*i;for(let t=0;t!==i;++t)o[e++]=n[a+t]}return o},flattenJSON:function(e,n,i,r){let s=1,o=e[0];for(;void 0!==o&&void 0===o[r];)o=e[s++];if(void 0!==o){let t=o[r];if(void 0!==t)if(Array.isArray(t))for(;t=o[r],void 0!==t&&(n.push(o.time),i.push.apply(i,t)),o=e[s++],void 0!==o;);else if(void 0!==t.toArray)for(;t=o[r],void 0!==t&&(n.push(o.time),t.toArray(i,i.length)),o=e[s++],void 0!==o;);else for(;t=o[r],void 0!==t&&(n.push(o.time),i.push(t)),o=e[s++],void 0!==o;);}},subclip:function(t,e,n,i,r=30){const s=t.clone();s.name=e;const o=[];for(let t=0;t<s.tracks.length;++t){const c=s.tracks[t];var a=c.getValueSize();const u=[],d=[];for(let e=0;e<c.times.length;++e){var l=c.times[e]*r;if(!(l<n||i<=l)){u.push(c.times[e]);for(let t=0;t<a;++t)d.push(c.values[e*a+t])}}0!==u.length&&(c.times=_h.convertArray(u,c.times.constructor),c.values=_h.convertArray(d,c.values.constructor),o.push(c))}s.tracks=o;let h=1/0;for(let t=0;t<s.tracks.length;++t)h>s.tracks[t].times[0]&&(h=s.tracks[t].times[0]);for(let t=0;t<s.tracks.length;++t)s.tracks[t].shift(-1*h);return s.resetDuration(),s},makeClipAdditive:function(e,t=0,n=e,i=30){var r=n.tracks.length,s=t/(i=i<=0?30:i);for(let t=0;t<r;++t){const f=n.tracks[t],v=f.ValueTypeName;if("bool"!==v&&"string"!==v){const g=e.tracks.find(function(t){return t.name===f.name&&t.ValueTypeName===v});if(void 0!==g){let t=0;var o=f.getValueSize();f.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(t=o/3);let e=0;var a=g.getValueSize();g.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(e=a/3);var l=f.times.length-1;let n;if(s<=f.times[0]){var h=t,c=o-t;n=_h.arraySlice(f.values,h,c)}else if(s>=f.times[l]){var l=l*o+t,u=l+o-t;n=_h.arraySlice(f.values,l,u)}else{const y=f.createInterpolant();u=t,o=o-t;y.evaluate(s),n=_h.arraySlice(y.resultBuffer,u,o)}if("quaternion"===v){const x=(new He).fromArray(n).normalize().conjugate();x.toArray(n)}var d=g.times.length;for(let t=0;t<d;++t){var p=t*a+e;if("quaternion"===v)He.multiplyQuaternionsFlat(g.values,p,n,0,g.values,p);else{var m=a-2*e;for(let t=0;t<m;++t)g.values[p+t]-=n[t]}}}}}return e.blendMode=2501,e}};class bh{constructor(t,e,n,i){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new e.constructor(n),this.sampleValues=e,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){var n=this.parameterPositions;let i=this._cachedIndex,r=n[i],s=n[i-1];t:{e:{let t;n:{i:if(!(e<r)){for(var o=i+2;;){if(void 0===r){if(e<s)break i;return i=n.length,this._cachedIndex=i,this.afterEnd_(i-1,e,s)}if(i===o)break;if(s=r,r=n[++i],e<r)break e}t=n.length;break n}if(e>=s)break t;var a=n[1];e<a&&(i=2,s=a);for(var l=i-2;;){if(void 0===s)return this._cachedIndex=0,this.beforeStart_(0,e,r);if(i===l)break;if(r=s,s=n[--i-1],e>=s)break e}t=i,i=0}for(;i<t;){var h=i+t>>>1;e<n[h]?t=h:i=1+h}if(r=n[i],s=n[i-1],void 0===s)return this._cachedIndex=0,this.beforeStart_(0,e,r);if(void 0===r)return i=n.length,this._cachedIndex=i,this.afterEnd_(i-1,s,e)}this._cachedIndex=i,this.intervalChanged_(i,s,r)}return this.interpolate_(i,s,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const e=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=t*i;for(let t=0;t!==i;++t)e[t]=n[r+t];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}bh.prototype.beforeStart_=bh.prototype.copySampleValue_,bh.prototype.afterEnd_=bh.prototype.copySampleValue_;class wh extends bh{constructor(t,e,n,i){super(t,e,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:2400,endingEnd:2400}}intervalChanged_(t,e,n){var i=this.parameterPositions;let r=t-2,s=t+1,o=i[r],a=i[s];if(void 0===o)switch(this.getSettings_().endingStart){case 2401:r=t,o=2*e-n;break;case 2402:r=i.length-2,o=e+i[r]-i[r+1];break;default:r=t,o=n}if(void 0===a)switch(this.getSettings_().endingEnd){case 2401:s=t,a=2*n-e;break;case 2402:s=1,a=n+i[1]-i[0];break;default:s=t-1,a=e}var l=.5*(n-e),h=this.valueSize;this._weightPrev=l/(e-o),this._weightNext=l/(a-n),this._offsetPrev=r*h,this._offsetNext=s*h}interpolate_(t,e,n,i){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=t*o,l=a-o,h=this._offsetPrev,c=this._offsetNext,u=this._weightPrev,d=this._weightNext,p=(n-e)/(i-e),m=p*p,f=m*p;var v=-u*f+2*u*m-u*p,g=(1+u)*f+(-1.5-2*u)*m+(-.5+u)*p+1,y=(-1-d)*f+(1.5+d)*m+.5*p,x=d*f-d*m;for(let t=0;t!==o;++t)r[t]=v*s[h+t]+g*s[l+t]+y*s[a+t]+x*s[c+t];return r}}class Mh extends bh{constructor(t,e,n,i){super(t,e,n,i)}interpolate_(t,e,n,i){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=t*o,l=a-o,h=(n-e)/(i-e),c=1-h;for(let t=0;t!==o;++t)r[t]=s[l+t]*c+s[a+t]*h;return r}}class Sh extends bh{constructor(t,e,n,i){super(t,e,n,i)}interpolate_(t){return this.copySampleValue_(t-1)}}class Eh{constructor(t,e,n,i){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=_h.convertArray(e,this.TimeBufferType),this.values=_h.convertArray(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(t){const e=t.constructor;let n;var i;return e.toJSON!==this.toJSON?n=e.toJSON(t):(n={name:t.name,times:_h.convertArray(t.times,Array),values:_h.convertArray(t.values,Array)},(i=t.getInterpolation())!==t.DefaultInterpolation&&(n.interpolation=i)),n.type=t.ValueTypeName,n}InterpolantFactoryMethodDiscrete(t){return new Sh(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new Mh(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new wh(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case 2300:e=this.InterpolantFactoryMethodDiscrete;break;case 2301:e=this.InterpolantFactoryMethodLinear;break;case 2302:e=this.InterpolantFactoryMethodSmooth}if(void 0!==e)return this.createInterpolant=e,this;var n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(n);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",n),this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}}getValueSize(){return this.values.length/this.times.length}shift(n){if(0!==n){const i=this.times;for(let t=0,e=i.length;t!==e;++t)i[t]+=n}return this}scale(n){if(1!==n){const i=this.times;for(let t=0,e=i.length;t!==e;++t)i[t]*=n}return this}trim(t,e){var n,i=this.times,r=i.length;let s=0,o=r-1;for(;s!==r&&i[s]<t;)++s;for(;-1!==o&&i[o]>e;)--o;return++o,0===s&&o===r||(s>=o&&(o=Math.max(o,1),s=o-1),n=this.getValueSize(),this.times=_h.arraySlice(i,s,o),this.values=_h.arraySlice(this.values,s*n,o*n)),this}validate(){let n=!0;var t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),n=!1);var e=this.times,i=this.values,r=e.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),n=!1);let s=null;for(let t=0;t!==r;t++){var o=e[t];if("number"==typeof o&&isNaN(o)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,t,o),n=!1;break}if(null!==s&&s>o){console.error("THREE.KeyframeTrack: Out of order keys.",this,t,o,s),n=!1;break}s=o}if(void 0!==i&&_h.isTypedArray(i))for(let t=0,e=i.length;t!==e;++t){var a=i[t];if(isNaN(a)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,t,a),n=!1;break}}return n}optimize(){const n=_h.arraySlice(this.times),i=_h.arraySlice(this.values),r=this.getValueSize(),s=2302===this.getInterpolation(),o=n.length-1;let a=1;for(let t=1;t<o;++t){let e=!1;var l=n[t];if(l!==n[t+1]&&(1!==t||l!==n[0]))if(s)e=!0;else{var h=t*r,c=h-r,u=h+r;for(let t=0;t!==r;++t){var d=i[h+t];if(d!==i[c+t]||d!==i[u+t]){e=!0;break}}}if(e){if(t!==a){n[a]=n[t];var p=t*r,m=a*r;for(let t=0;t!==r;++t)i[m+t]=i[p+t]}++a}}if(0<o){n[a]=n[o];for(let t=o*r,e=a*r,n=0;n!==r;++n)i[e+n]=i[t+n];++a}return a!==n.length?(this.times=_h.arraySlice(n,0,a),this.values=_h.arraySlice(i,0,a*r)):(this.times=n,this.values=i),this}clone(){var t=_h.arraySlice(this.times,0),e=_h.arraySlice(this.values,0);const n=this.constructor,i=new n(this.name,t,e);return i.createInterpolant=this.createInterpolant,i}}Eh.prototype.TimeBufferType=Float32Array,Eh.prototype.ValueBufferType=Float32Array,Eh.prototype.DefaultInterpolation=2301;class Th extends Eh{}Th.prototype.ValueTypeName="bool",Th.prototype.ValueBufferType=Array,Th.prototype.DefaultInterpolation=2300,Th.prototype.InterpolantFactoryMethodLinear=void 0,Th.prototype.InterpolantFactoryMethodSmooth=void 0;class Ah extends Eh{}Ah.prototype.ValueTypeName="color";class Ch extends Eh{}Ch.prototype.ValueTypeName="number";class Ph extends bh{constructor(t,e,n,i){super(t,e,n,i)}interpolate_(t,e,n,i){var r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=(n-e)/(i-e);let l=t*o;for(var h=l+o;l!==h;l+=4)He.slerpFlat(r,0,s,l-o,s,l,a);return r}}class Lh extends Eh{InterpolantFactoryMethodLinear(t){return new Ph(this.times,this.values,this.getValueSize(),t)}}Lh.prototype.ValueTypeName="quaternion",Lh.prototype.DefaultInterpolation=2301,Lh.prototype.InterpolantFactoryMethodSmooth=void 0;class Rh extends Eh{}Rh.prototype.ValueTypeName="string",Rh.prototype.ValueBufferType=Array,Rh.prototype.DefaultInterpolation=2300,Rh.prototype.InterpolantFactoryMethodLinear=void 0,Rh.prototype.InterpolantFactoryMethodSmooth=void 0;class Ih extends Eh{}class zh{constructor(t,e=-1,n,i=2500){this.name=t,this.tracks=n,this.duration=e,this.blendMode=i,this.uuid=Se(),this.duration<0&&this.resetDuration()}static parse(t){const n=[],i=t.tracks,r=1/(t.fps||1);for(let t=0,e=i.length;t!==e;++t)n.push(function(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Ch;case"vector":case"vector2":case"vector3":case"vector4":return Ih;case"color":return Ah;case"quaternion":return Lh;case"bool":case"boolean":return Th;case"string":return Rh}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);{var n,i;void 0===t.times&&(n=[],i=[],_h.flattenJSON(t.keys,n,i,"value"),t.times=n,t.values=i)}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}(i[t]).scale(r));const e=new this(t.name,t.duration,n,t.blendMode);return e.uuid=t.uuid,e}static toJSON(t){const n=[],i=t.tracks;t={name:t.name,duration:t.duration,tracks:n,uuid:t.uuid,blendMode:t.blendMode};for(let t=0,e=i.length;t!==e;++t)n.push(Eh.toJSON(i[t]));return t}static CreateFromMorphTargetSequence(t,i,r,s){var o=i.length;const a=[];for(let n=0;n<o;n++){let t=[],e=[];t.push((n+o-1)%o,n,(n+1)%o),e.push(0,1,0);var l=_h.getKeyframeOrder(t);t=_h.sortedArray(t,1,l),e=_h.sortedArray(e,1,l),s||0!==t[0]||(t.push(o),e.push(e[0])),a.push(new Ch(".morphTargetInfluences["+i[n].name+"]",t,e).scale(1/r))}return new this(t,-1,a)}static findByName(t,e){let n=t;Array.isArray(t)||(n=t.geometry&&t.geometry.animations||t.animations);for(let t=0;t<n.length;t++)if(n[t].name===e)return n[t];return null}static CreateClipsFromMorphTargetSequences(n,t,e){const i={};var r=/^([\w-]*?)([\d]+)$/;for(let t=0,e=n.length;t<e;t++){const a=n[t];var s=a.name.match(r);if(s&&1<s.length){s=s[1];let t=i[s];t||(i[s]=t=[]),t.push(a)}}const o=[];for(const l in i)o.push(this.CreateFromMorphTargetSequence(l,i[l],t,e));return o}static parseAnimation(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;function n(t,e,n,i,r){var s,o;0!==n.length&&(s=[],o=[],_h.flattenJSON(n,s,o,i),0!==s.length&&r.push(new t(e,s,o)))}const i=[];var r=t.name||"default",s=t.fps||30,o=t.blendMode;let a=t.length||-1;var l=t.hierarchy||[];for(let t=0;t<l.length;t++){var h=l[t].keys;if(h&&0!==h.length)if(h[0].morphTargets){const d={};let e;for(e=0;e<h.length;e++)if(h[e].morphTargets)for(let t=0;t<h[e].morphTargets.length;t++)d[h[e].morphTargets[t]]=-1;for(const p in d){const m=[],f=[];for(let t=0;t!==h[e].morphTargets.length;++t){var c=h[e];m.push(c.time),f.push(c.morphTarget===p?1:0)}i.push(new Ch(".morphTargetInfluence["+p+"]",m,f))}a=d.length*(s||1)}else{var u=".bones["+e[t].name+"]";n(Ih,u+".position",h,"pos",i),n(Lh,u+".quaternion",h,"rot",i),n(Ih,u+".scale",h,"scl",i)}}return 0===i.length?null:new this(r,a,i,o)}resetDuration(){let n=0;for(let t=0,e=this.tracks.length;t!==e;++t){var i=this.tracks[t];n=Math.max(n,i.times[i.times.length-1])}return this.duration=n,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}const Nh={enabled:!(Ih.prototype.ValueTypeName="vector"),files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};class Bh{constructor(t,e,n){const i=this;let r=!1,s=0,o=0,a=void 0;const l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=n,this.itemStart=function(t){o++,!1===r&&void 0!==i.onStart&&i.onStart(t,s,o),r=!0},this.itemEnd=function(t){s++,void 0!==i.onProgress&&i.onProgress(t,s,o),s===o&&(r=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(t){void 0!==i.onError&&i.onError(t)},this.resolveURL=function(t){return a?a(t):t},this.setURLModifier=function(t){return a=t,this},this.addHandler=function(t,e){return l.push(t,e),this},this.removeHandler=function(t){t=l.indexOf(t);return-1!==t&&l.splice(t,2),this},this.getHandler=function(n){for(let t=0,e=l.length;t<e;t+=2){const r=l[t];var i=l[t+1];if(r.global&&(r.lastIndex=0),r.test(n))return i}return null}}}const Dh=new Bh;class Fh{constructor(t){this.manager=void 0!==t?t:Dh,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(n,i){const r=this;return new Promise(function(t,e){r.load(n,t,i,e)})}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}const kh={};class Oh extends Fh{constructor(t){super(t)}load(a,n,e,i){void 0===a&&(a=""),void 0!==this.path&&(a=this.path+a),a=this.manager.resolveURL(a);const l=this,t=Nh.get(a);if(void 0!==t)return l.manager.itemStart(a),setTimeout(function(){n&&n(t),l.manager.itemEnd(a)},0),t;if(void 0===kh[a]){var r=a.match(/^data:(.*?)(;base64)?,(.*)$/);let t;if(r){var s=r[1],o=!!r[2];let e=r[3];e=decodeURIComponent(e),o&&(e=atob(e));try{let t;var h=(this.responseType||"").toLowerCase();switch(h){case"arraybuffer":case"blob":const c=new Uint8Array(e.length);for(let t=0;t<e.length;t++)c[t]=e.charCodeAt(t);t="blob"===h?new Blob([c.buffer],{type:s}):c.buffer;break;case"document":const u=new DOMParser;t=u.parseFromString(e,s);break;case"json":t=JSON.parse(e);break;default:t=e}setTimeout(function(){n&&n(t),l.manager.itemEnd(a)},0)}catch(t){setTimeout(function(){i&&i(t),l.manager.itemError(a),l.manager.itemEnd(a)},0)}}else{kh[a]=[],kh[a].push({onLoad:n,onProgress:e,onError:i}),t=new XMLHttpRequest,t.open("GET",a,!0),t.addEventListener("load",function(n){var i=this.response,r=kh[a];if(delete kh[a],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),Nh.add(a,i);for(let t=0,e=r.length;t<e;t++){const s=r[t];s.onLoad&&s.onLoad(i)}l.manager.itemEnd(a)}else{for(let t=0,e=r.length;t<e;t++){const o=r[t];o.onError&&o.onError(n)}l.manager.itemError(a),l.manager.itemEnd(a)}},!1),t.addEventListener("progress",function(n){var i=kh[a];for(let t=0,e=i.length;t<e;t++){const r=i[t];r.onProgress&&r.onProgress(n)}},!1),t.addEventListener("error",function(n){var i=kh[a];delete kh[a];for(let t=0,e=i.length;t<e;t++){const r=i[t];r.onError&&r.onError(n)}l.manager.itemError(a),l.manager.itemEnd(a)},!1),t.addEventListener("abort",function(n){var i=kh[a];delete kh[a];for(let t=0,e=i.length;t<e;t++){const r=i[t];r.onError&&r.onError(n)}l.manager.itemError(a),l.manager.itemEnd(a)},!1),void 0!==this.responseType&&(t.responseType=this.responseType),void 0!==this.withCredentials&&(t.withCredentials=this.withCredentials),t.overrideMimeType&&t.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain");for(const d in this.requestHeader)t.setRequestHeader(d,this.requestHeader[d]);t.send(null)}return l.manager.itemStart(a),t}kh[a].push({onLoad:n,onProgress:e,onError:i})}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}(class extends null{});(class extends null{});class Vh extends Fh{constructor(t){super(t)}load(e,t,n,i){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,s=Nh.get(e);if(void 0!==s)return r.manager.itemStart(e),setTimeout(function(){t&&t(s),r.manager.itemEnd(e)},0),s;const o=document.createElementNS("http://www.w3.org/1999/xhtml","img");function a(){o.removeEventListener("load",a,!1),o.removeEventListener("error",l,!1),Nh.add(e,this),t&&t(this),r.manager.itemEnd(e)}function l(t){o.removeEventListener("load",a,!1),o.removeEventListener("error",l,!1),i&&i(t),r.manager.itemError(e),r.manager.itemEnd(e)}return o.addEventListener("load",a,!1),o.addEventListener("error",l,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),r.manager.itemStart(e),o.src=e,o}}class Uh extends Fh{constructor(t){super(t)}load(n,i,t,r){const s=new nr,o=new Vh(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let a=0;for(let t=0;t<n.length;++t)!function(e){o.load(n[e],function(t){s.images[e]=t,a++,6===a&&(s.needsUpdate=!0,i&&i(s))},void 0,r)}(t);return s}}(class extends null{});class Hh extends Fh{constructor(t){super(t)}load(e,n,t,i){const r=new Fe,s=new Vh(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(e,function(t){r.image=t;t=0<e.search(/\.jpe?g($|\?)/i)||0===e.search(/^data\:image\/jpeg/);r.format=t?Tt:Ot,r.needsUpdate=!0,void 0!==n&&n(r)},t,i),r}}class Wh extends cl{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0);var e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new Sl(e,t))}getPoint(t){var e=t*this.getLength(),n=this.getCurveLengths();let i=0;for(;i<n.length;){if(n[i]>=e){var r=n[i]-e;const o=this.curves[i];var s=o.getLength();return o.getPointAt(0===s?0:1-r/s)}i++}return null}getLength(){var t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const n=[];let i=0;for(let t=0,e=this.curves.length;t<e;t++)i+=this.curves[t].getLength(),n.push(i);return this.cacheLengths=n,n}getSpacedPoints(e=40){const n=[];for(let t=0;t<=e;t++)n.push(this.getPoint(t/e));return this.autoClose&&n.push(n[0]),n}getPoints(n=12){const i=[];let r;for(let t=0,e=this.curves;t<e.length;t++){const l=e[t];var s=l&&l.isEllipseCurve?2*n:l&&(l.isLineCurve||l.isLineCurve3)?1:l&&l.isSplineCurve?n*l.points.length:n,o=l.getPoints(s);for(let t=0;t<o.length;t++){var a=o[t];r&&r.equals(a)||(i.push(a),r=a)}}return this.autoClose&&1<i.length&&!i[i.length-1].equals(i[0])&&i.push(i[0]),i}copy(n){super.copy(n),this.curves=[];for(let t=0,e=n.curves.length;t<e;t++){const i=n.curves[t];this.curves.push(i.clone())}return this.autoClose=n.autoClose,this}toJSON(){const n=super.toJSON();n.autoClose=this.autoClose,n.curves=[];for(let t=0,e=this.curves.length;t<e;t++){const i=this.curves[t];n.curves.push(i.toJSON())}return n}fromJSON(n){super.fromJSON(n),this.autoClose=n.autoClose,this.curves=[];for(let t=0,e=n.curves.length;t<e;t++){var i=n.curves[t];this.curves.push((new Cl[i.type]).fromJSON(i))}return this}}class Gh extends Wh{constructor(t){super(),this.type="Path",this.currentPoint=new Ie,t&&this.setFromPoints(t)}setFromPoints(n){this.moveTo(n[0].x,n[0].y);for(let t=1,e=n.length;t<e;t++)this.lineTo(n[t].x,n[t].y);return this}moveTo(t,e){return this.currentPoint.set(t,e),this}lineTo(t,e){var n=new Sl(this.currentPoint.clone(),new Ie(t,e));return this.curves.push(n),this.currentPoint.set(t,e),this}quadraticCurveTo(t,e,n,i){e=new El(this.currentPoint.clone(),new Ie(t,e),new Ie(n,i));return this.curves.push(e),this.currentPoint.set(n,i),this}bezierCurveTo(t,e,n,i,r,s){i=new wl(this.currentPoint.clone(),new Ie(t,e),new Ie(n,i),new Ie(r,s));return this.curves.push(i),this.currentPoint.set(r,s),this}splineThru(t){var e=[this.currentPoint.clone()].concat(t),e=new Al(e);return this.curves.push(e),this.currentPoint.copy(t[t.length-1]),this}arc(t,e,n,i,r,s){var o=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(t+o,e+a,n,i,r,s),this}absarc(t,e,n,i,r,s){return this.absellipse(t,e,n,n,i,r,s),this}ellipse(t,e,n,i,r,s,o,a){var l=this.currentPoint.x,h=this.currentPoint.y;return this.absellipse(t+l,e+h,n,i,r,s,o,a),this}absellipse(t,e,n,i,r,s,o,a){const l=new ul(t,e,n,i,r,s,o,a);if(0<this.curves.length){const h=l.getPoint(0);h.equals(this.currentPoint)||this.lineTo(h.x,h.y)}this.curves.push(l);a=l.getPoint(1);return this.currentPoint.copy(a),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}class jh extends Gh{constructor(t){super(t),this.uuid=Se(),this.type="Shape",this.holes=[]}getPointsHoles(n){const i=[];for(let t=0,e=this.holes.length;t<e;t++)i[t]=this.holes[t].getPoints(n);return i}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(n){super.copy(n),this.holes=[];for(let t=0,e=n.holes.length;t<e;t++){const i=n.holes[t];this.holes.push(i.clone())}return this}toJSON(){const n=super.toJSON();n.uuid=this.uuid,n.holes=[];for(let t=0,e=this.holes.length;t<e;t++){const i=this.holes[t];n.holes.push(i.toJSON())}return n}fromJSON(n){super.fromJSON(n),this.uuid=n.uuid,this.holes=[];for(let t=0,e=n.holes.length;t<e;t++){var i=n.holes[t];this.holes.push((new Gh).fromJSON(i))}return this}}class qh extends qn{constructor(t,e=1){super(),this.type="Light",this.color=new di(t),this.intensity=e}dispose(){}copy(t){return super.copy(t),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}qh.prototype.isLight=!0;class Xh extends qh{constructor(t,e,n){super(t,n),this.type="HemisphereLight",this.position.copy(qn.DefaultUp),this.updateMatrix(),this.groundColor=new di(e)}copy(t){return qh.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}}Xh.prototype.isHemisphereLight=!0;const Yh=new bn,Zh=new We,Kh=new We;class Jh{constructor(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Ie(512,512),this.map=null,this.mapPass=null,this.matrix=new bn,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new cr,this._frameExtents=new Ie(1,1),this._viewportCount=1,this._viewports=[new Oe(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,n=this.matrix;Zh.setFromMatrixPosition(t.matrixWorld),e.position.copy(Zh),Kh.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(Kh),e.updateMatrixWorld(),Yh.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Yh),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(e.projectionMatrix),n.multiply(e.matrixWorldInverse)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const t={};return 0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class Qh extends Jh{constructor(){super(new tr(50,1,.5,500)),this.focus=1}updateMatrices(t){const e=this.camera;var n=2*Me*t.angle*this.focus,i=this.mapSize.width/this.mapSize.height,r=t.distance||e.far;n===e.fov&&i===e.aspect&&r===e.far||(e.fov=n,e.aspect=i,e.far=r,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}Qh.prototype.isSpotLightShadow=!0;class $h extends qh{constructor(t,e,n=0,i=Math.PI/3,r=0,s=1){super(t,e),this.type="SpotLight",this.position.copy(qn.DefaultUp),this.updateMatrix(),this.target=new qn,this.distance=n,this.angle=i,this.penumbra=r,this.decay=s,this.shadow=new Qh}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}$h.prototype.isSpotLight=!0;const tc=new bn,ec=new We,nc=new We;class ic extends Jh{constructor(){super(new tr(90,1,.5,500)),this._frameExtents=new Ie(4,2),this._viewportCount=6,this._viewports=[new Oe(2,1,1,1),new Oe(0,1,1,1),new Oe(3,1,1,1),new Oe(1,1,1,1),new Oe(3,0,1,1),new Oe(1,0,1,1)],this._cubeDirections=[new We(1,0,0),new We(-1,0,0),new We(0,0,1),new We(0,0,-1),new We(0,1,0),new We(0,-1,0)],this._cubeUps=[new We(0,1,0),new We(0,1,0),new We(0,1,0),new We(0,1,0),new We(0,0,1),new We(0,0,-1)]}updateMatrices(t,e=0){const n=this.camera,i=this.matrix;var r=t.distance||n.far;r!==n.far&&(n.far=r,n.updateProjectionMatrix()),ec.setFromMatrixPosition(t.matrixWorld),n.position.copy(ec),nc.copy(n.position),nc.add(this._cubeDirections[e]),n.up.copy(this._cubeUps[e]),n.lookAt(nc),n.updateMatrixWorld(),i.makeTranslation(-ec.x,-ec.y,-ec.z),tc.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(tc)}}ic.prototype.isPointLightShadow=!0;class rc extends qh{constructor(t,e,n=0,i=1){super(t,e),this.type="PointLight",this.distance=n,this.decay=i,this.shadow=new ic}get power(){return 4*this.intensity*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}rc.prototype.isPointLight=!0;class sc extends Jh{constructor(){super(new Mr(-5,5,5,-5,.5,500))}}sc.prototype.isDirectionalLightShadow=!0;class oc extends qh{constructor(t,e){super(t,e),this.type="DirectionalLight",this.position.copy(qn.DefaultUp),this.updateMatrix(),this.target=new qn,this.shadow=new sc}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}oc.prototype.isDirectionalLight=!0;class ac extends qh{constructor(t,e){super(t,e),this.type="AmbientLight"}}ac.prototype.isAmbientLight=!0;class lc extends qh{constructor(t,e,n=10,i=10){super(t,e),this.type="RectAreaLight",this.width=n,this.height=i}get power(){return this.intensity*this.width*this.height*Math.PI}set power(t){this.intensity=t/(this.width*this.height*Math.PI)}copy(t){return super.copy(t),this.width=t.width,this.height=t.height,this}toJSON(t){const e=super.toJSON(t);return e.object.width=this.width,e.object.height=this.height,e}}lc.prototype.isRectAreaLight=!0;class hc{constructor(){this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new We)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,e){var n=t.x,i=t.y,r=t.z,t=this.coefficients;return e.copy(t[0]).multiplyScalar(.282095),e.addScaledVector(t[1],.488603*i),e.addScaledVector(t[2],.488603*r),e.addScaledVector(t[3],.488603*n),e.addScaledVector(t[4],n*i*1.092548),e.addScaledVector(t[5],i*r*1.092548),e.addScaledVector(t[6],.315392*(3*r*r-1)),e.addScaledVector(t[7],n*r*1.092548),e.addScaledVector(t[8],.546274*(n*n-i*i)),e}getIrradianceAt(t,e){var n=t.x,i=t.y,r=t.z,t=this.coefficients;return e.copy(t[0]).multiplyScalar(.886227),e.addScaledVector(t[1],1.023328*i),e.addScaledVector(t[2],1.023328*r),e.addScaledVector(t[3],1.023328*n),e.addScaledVector(t[4],.858086*n*i),e.addScaledVector(t[5],.858086*i*r),e.addScaledVector(t[6],.743125*r*r-.247708),e.addScaledVector(t[7],.858086*n*r),e.addScaledVector(t[8],.429043*(n*n-i*i)),e}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,n){for(let t=0;t<9;t++)this.coefficients[t].addScaledVector(e.coefficients[t],n);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,n){for(let t=0;t<9;t++)this.coefficients[t].lerp(e.coefficients[t],n);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(e,n=0){const i=this.coefficients;for(let t=0;t<9;t++)i[t].fromArray(e,n+3*t);return this}toArray(e=[],n=0){const i=this.coefficients;for(let t=0;t<9;t++)i[t].toArray(e,n+3*t);return e}static getBasisAt(t,e){var n=t.x,i=t.y,t=t.z;e[0]=.282095,e[1]=.488603*i,e[2]=.488603*t,e[3]=.488603*n,e[4]=1.092548*n*i,e[5]=1.092548*i*t,e[6]=.315392*(3*t*t-1),e[7]=1.092548*n*t,e[8]=.546274*(n*n-i*i)}}hc.prototype.isSphericalHarmonics3=!0;class cc extends qh{constructor(t=new hc,e=1){super(void 0,e),this.sh=t}copy(t){return super.copy(t),this.sh.copy(t.sh),this}fromJSON(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this}toJSON(t){const e=super.toJSON(t);return e.object.sh=this.sh.toArray(),e}}cc.prototype.isLightProbe=!0;(class extends null{});class uc{static decodeText(n){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(n);let i="";for(let t=0,e=n.length;t<e;t++)i+=String.fromCharCode(n[t]);try{return decodeURIComponent(escape(i))}catch(t){return i}}static extractUrlBase(t){var e=t.lastIndexOf("/");return-1===e?"./":t.substr(0,e+1)}}class dc extends Ci{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(t){return super.copy(t),this.instanceCount=t.instanceCount,this}clone(){return(new this.constructor).copy(this)}toJSON(){const t=super.toJSON(this);return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}dc.prototype.isInstancedBufferGeometry=!0;(class extends null{});(class extends null{});M,S,l,h,C,P,O,zt,V,Nt,U,H,W,t,Bt;class pc extends Fh{constructor(t){super(t),"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(t){return this.options=t,this}load(e,n,t,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,s=Nh.get(e);if(void 0!==s)return r.manager.itemStart(e),setTimeout(function(){n&&n(s),r.manager.itemEnd(e)},0),s;const o={};o.credentials="anonymous"===this.crossOrigin?"same-origin":"include",o.headers=this.requestHeader,fetch(e,o).then(function(t){return t.blob()}).then(function(t){return createImageBitmap(t,Object.assign(r.options,{colorSpaceConversion:"none"}))}).then(function(t){Nh.add(e,t),n&&n(t),r.manager.itemEnd(e)}).catch(function(t){i&&i(t),r.manager.itemError(e),r.manager.itemEnd(e)}),r.manager.itemStart(e)}}pc.prototype.isImageBitmapLoader=!0;class mc{constructor(){this.type="ShapePath",this.color=new di,this.subPaths=[],this.currentPath=null}moveTo(t,e){return this.currentPath=new Gh,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this}lineTo(t,e){return this.currentPath.lineTo(t,e),this}quadraticCurveTo(t,e,n,i){return this.currentPath.quadraticCurveTo(t,e,n,i),this}bezierCurveTo(t,e,n,i,r,s){return this.currentPath.bezierCurveTo(t,e,n,i,r,s),this}splineThru(t){return this.currentPath.splineThru(t),this}toShapes(n,t){function e(n){const i=[];for(let t=0,e=n.length;t<e;t++){var r=n[t];const s=new jh;s.curves=r.curves,i.push(s)}return i}const i=ql.isClockWise,r=this.subPaths;if(0===r.length)return[];if(!0===t)return e(r);let s,o,a;const l=[];if(1===r.length)return o=r[0],a=new jh,a.curves=o.curves,l.push(a),l;let h=!i(r[0].getPoints());h=n?!h:h;const c=[],u=[];let d=[],p=0;var m,f;u[p]=void 0,d[p]=[];for(let t=0,e=r.length;t<e;t++)o=r[t],m=o.getPoints(),s=i(m),s=n?!s:s,s?(!h&&u[p]&&p++,u[p]={s:new jh,p:m},u[p].s.curves=o.curves,h&&p++,d[p]=[]):d[p].push({h:o,p:m[0]});if(!u[0])return e(r);if(1<u.length){let r=!1;const y=[];for(let t=0,e=u.length;t<e;t++)c[t]=[];for(let i=0,t=u.length;i<t;i++){var v=d[i];for(let n=0;n<v.length;n++){var g=v[n];let e=!0;for(let t=0;t<u.length;t++)!function(o,a){var t=a.length;let l=!1;for(let r=t-1,s=0;s<t;r=s++){let t=a[r],e=a[s],n=e.x-t.x,i=e.y-t.y;if(Math.abs(i)>Number.EPSILON){if(i<0&&(t=a[s],n=-n,e=a[r],i=-i),!(o.y<t.y||o.y>e.y))if(o.y===t.y){if(o.x===t.x)return 1}else{var h=i*(o.x-t.x)-n*(o.y-t.y);if(0==h)return 1;h<0||(l=!l)}}else if(o.y===t.y&&(e.x<=o.x&&o.x<=t.x||t.x<=o.x&&o.x<=e.x))return 1}return l}(g.p,u[t].p)||(i!==t&&y.push({froms:i,tos:t,hole:n}),e?(e=!1,c[t].push(g)):r=!0);e&&c[i].push(g)}}0<y.length&&(r||(d=c))}for(let n=0,t=u.length;n<t;n++){a=u[n].s,l.push(a);for(let t=0,e=(f=d[n]).length;t<e;t++)a.holes.push(f[t].h)}return l}}class fc{constructor(t){this.type="Font",this.data=t}generateShapes(t,e=100){var n=[];const i=function(t,e,n){const i=Array.from(t),r=e/n.resolution,s=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*r,o=[];let a=0,l=0;for(let t=0;t<i.length;t++){var h=i[t];"\n"===h?(a=0,l-=s):(h=function(t,c,u,d,e){const p=e.glyphs[t]||e.glyphs["?"];if(p){const f=new mc;let n,i,r,s,o,a,l,h;if(p.o){var m=p._cachedOutline||(p._cachedOutline=p.o.split(" "));for(let t=0,e=m.length;t<e;)switch(m[t++]){case"m":n=m[t++]*c+u,i=m[t++]*c+d,f.moveTo(n,i);break;case"l":n=m[t++]*c+u,i=m[t++]*c+d,f.lineTo(n,i);break;case"q":r=m[t++]*c+u,s=m[t++]*c+d,o=m[t++]*c+u,a=m[t++]*c+d,f.quadraticCurveTo(o,a,r,s);break;case"b":r=m[t++]*c+u,s=m[t++]*c+d,o=m[t++]*c+u,a=m[t++]*c+d,l=m[t++]*c+u,h=m[t++]*c+d,f.bezierCurveTo(o,a,l,h,r,s)}}return{offsetX:p.ha*c,path:f}}console.error('THREE.Font: character "'+t+'" does not exists in font family '+e.familyName+".")}(h,r,a,l,n),a+=h.offsetX,o.push(h.path))}return o}(t,e,this.data);for(let t=0,e=i.length;t<e;t++)Array.prototype.push.apply(n,i[t].toShapes());return n}}fc.prototype.isFont=!0;class vc extends Fh{constructor(t){super(t)}load(t,i,e,n){const r=this,s=new Oh(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(r.withCredentials),s.load(t,function(e){let n;try{n=JSON.parse(e)}catch(t){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),n=JSON.parse(e.substring(65,e.length-2))}e=r.parse(n);i&&i(e)},e,n)}parse(t){return new fc(t)}}cc;(class extends cc{constructor(t,e,n=1){super(void 0,n);var i=(new di).set(t),n=(new di).set(e),t=new We(i.r,i.g,i.b),e=new We(n.r,n.g,n.b),i=Math.sqrt(Math.PI),n=i*Math.sqrt(.75);this.sh.coefficients[0].copy(t).add(e).multiplyScalar(i),this.sh.coefficients[1].copy(t).sub(e).multiplyScalar(n)}}).prototype.isHemisphereLightProbe=!0;cc;(class extends cc{constructor(t,e=1){super(void 0,e);t=(new di).set(t);this.sh.coefficients[0].set(t.r,t.g,t.b).multiplyScalar(2*Math.sqrt(Math.PI))}}).prototype.isAmbientLightProbe=!0;class gc{constructor(t=!0){this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=yc(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;return this.autoStart&&!this.running?(this.start(),0):(this.running&&(e=yc(),t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t),t);var e}}function yc(){return("undefined"==typeof performance?Date:performance).now()}(class extends null{});(class extends qn{});(class extends null{});class xc{constructor(t,e,n){this.binding=t,this.valueSize=n;let i,r,s;switch(e){case"quaternion":i=this._slerp,r=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":i=this._select,r=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:i=this._lerp,r=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=r,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,e){const n=this.buffer,i=this.valueSize,r=t*i+i;let s=this.cumulativeWeight;if(0===s){for(let t=0;t!==i;++t)n[r+t]=n[t];s=e}else{s+=e;e=e/s;this._mixBufferRegion(n,r,0,e,i)}this.cumulativeWeight=s}accumulateAdditive(t){var e=this.buffer,n=this.valueSize,i=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(e,i,0,t,n),this.cumulativeWeightAdditive+=t}apply(t){const n=this.valueSize,i=this.buffer,r=t*n+n,e=this.cumulativeWeight,s=this.cumulativeWeightAdditive,o=this.binding;this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,e<1&&(t=n*this._origIndex,this._mixBufferRegion(i,r,t,1-e,n)),0<s&&this._mixBufferRegionAdditive(i,r,this._addIndex*n,1,n);for(let t=n,e=n+n;t!==e;++t)if(i[t]!==i[t+n]){o.setValue(i,r);break}}saveOriginalState(){const t=this.binding,n=this.buffer,i=this.valueSize,r=i*this._origIndex;t.getValue(n,r);for(let t=i,e=r;t!==e;++t)n[t]=n[r+t%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){var t=3*this.valueSize;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){var e=this._addIndex*this.valueSize,n=e+this.valueSize;for(let t=e;t<n;t++)this.buffer[t]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){var e=this._origIndex*this.valueSize,n=this._addIndex*this.valueSize;for(let t=0;t<this.valueSize;t++)this.buffer[n+t]=this.buffer[e+t]}_select(e,n,i,t,r){if(.5<=t)for(let t=0;t!==r;++t)e[n+t]=e[i+t]}_slerp(t,e,n,i){He.slerpFlat(t,e,t,e,t,n,i)}_slerpAdditive(t,e,n,i,r){r=this._workIndex*r;He.multiplyQuaternionsFlat(t,r,t,e,t,n),He.slerpFlat(t,e,t,e,t,r,i)}_lerp(e,n,i,r,s){var o=1-r;for(let t=0;t!==s;++t){var a=n+t;e[a]=e[a]*o+e[i+t]*r}}_lerpAdditive(e,n,i,r,s){for(let t=0;t!==s;++t){var o=n+t;e[o]=e[o]+e[i+t]*r}}}var _c="\\[\\]\\.:\\/";const bc=new RegExp("["+_c+"]","g");var wc="[^"+_c+"]",Mc="[^"+_c.replace("\\.","")+"]",Sc=/((?:WC+[\/:])*)/.source.replace("WC",wc),Br=/(WCOD+)?/.source.replace("WCOD",Mc),Dr=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",wc),_c=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",wc);const Ec=new RegExp("^"+Sc+Br+Dr+_c+"$"),Tc=["material","materials","bones"];class Ac{constructor(t,e,n){this.path=e,this.parsedPath=n||Ac.parseTrackName(e),this.node=Ac.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,n){return new(t&&t.isAnimationObjectGroup?Ac.Composite:Ac)(t,e,n)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(bc,"")}static parseTrackName(t){var e=Ec.exec(t);if(!e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const n={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]};var i=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i&&(e=n.nodeName.substring(i+1),-1!==Tc.indexOf(e)&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=e)),null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return n}static findNode(t,i){if(!i||""===i||"."===i||-1===i||i===t.name||i===t.uuid)return t;if(t.skeleton){var e=t.skeleton.getBoneByName(i);if(void 0!==e)return e}if(t.children){const r=function(e){for(let t=0;t<e.length;t++){var n=e[t];if(n.name===i||n.uuid===i)return n;n=r(n.children);if(n)return n}return null};t=r(t.children);if(t)return t}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(n,i){var r=this.resolvedProperty;for(let t=0,e=r.length;t!==e;++t)n[i++]=r[t]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(n,i){const r=this.resolvedProperty;for(let t=0,e=r.length;t!==e;++t)r[t]=n[i++]}_setValue_array_setNeedsUpdate(n,i){const r=this.resolvedProperty;for(let t=0,e=r.length;t!==e;++t)r[t]=n[i++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(n,i){const r=this.resolvedProperty;for(let t=0,e=r.length;t!==e;++t)r[t]=n[i++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let n=this.node;var t=this.parsedPath,i=t.objectName,r=t.propertyName;let s=t.propertyIndex;if(n||(n=Ac.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=n),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,n){if(i){let e=t.objectIndex;switch(i){case"materials":if(!n.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!n.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);n=n.material.materials;break;case"bones":if(!n.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);n=n.skeleton.bones;for(let t=0;t<n.length;t++)if(n[t].name===e){e=t;break}break;default:if(void 0===n[i])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);n=n[i]}if(void 0!==e){if(void 0===n[e])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,n);n=n[e]}}var o=n[r];if(void 0!==o){let t=this.Versioning.None;this.targetObject=n,void 0!==n.needsUpdate?t=this.Versioning.NeedsUpdate:void 0!==n.matrixWorldNeedsUpdate&&(t=this.Versioning.MatrixWorldNeedsUpdate);let e=this.BindingType.Direct;if(void 0!==s){if("morphTargetInfluences"===r){if(!n.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!n.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!n.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==n.morphTargetDictionary[s]&&(s=n.morphTargetDictionary[s])}e=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=s}else void 0!==o.fromArray&&void 0!==o.toArray?(e=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(e=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=r;this.getValue=this.GetterByBindingType[e],this.setValue=this.SetterByBindingTypeAndVersioning[e][t]}else{t=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+t+"."+r+" but it wasn't found.",n)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Ac.Composite=class{constructor(t,e,n){n=n||Ac.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,n)}getValue(t,e){this.bind();const n=this._targetGroup.nCachedObjects_,i=this._bindings[n];void 0!==i&&i.getValue(t,e)}setValue(n,i){const r=this._bindings;for(let t=this._targetGroup.nCachedObjects_,e=r.length;t!==e;++t)r[t].setValue(n,i)}bind(){const n=this._bindings;for(let t=this._targetGroup.nCachedObjects_,e=n.length;t!==e;++t)n[t].bind()}unbind(){const n=this._bindings;for(let t=this._targetGroup.nCachedObjects_,e=n.length;t!==e;++t)n[t].unbind()}},Ac.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Ac.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Ac.prototype.GetterByBindingType=[Ac.prototype._getValue_direct,Ac.prototype._getValue_array,Ac.prototype._getValue_arrayElement,Ac.prototype._getValue_toArray],Ac.prototype.SetterByBindingTypeAndVersioning=[[Ac.prototype._setValue_direct,Ac.prototype._setValue_direct_setNeedsUpdate,Ac.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Ac.prototype._setValue_array,Ac.prototype._setValue_array_setNeedsUpdate,Ac.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Ac.prototype._setValue_arrayElement,Ac.prototype._setValue_arrayElement_setNeedsUpdate,Ac.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Ac.prototype._setValue_fromArray,Ac.prototype._setValue_fromArray_setNeedsUpdate,Ac.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Cc{constructor(t,e,n=null,i=e.blendMode){this._mixer=t,this._clip=e,this._localRoot=n,this.blendMode=i;const r=e.tracks,s=r.length,o=new Array(s);var a={endingStart:2400,endingEnd:2400};for(let t=0;t!==s;++t){const l=r[t].createInterpolant(null);o[t]=l,l.settings=a}this._interpolantSettings=a,this._interpolants=o,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,e){return this.loop=t,this.repetitions=e,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,e,n){var i,r;return t.fadeOut(e),this.fadeIn(e),n&&(n=(i=this._clip.duration)/(r=t._clip.duration),t.warp(1,r/i,e),this.warp(n,1,e)),this}crossFadeTo(t,e,n){return t.crossFadeFrom(this,e,n)}stopFading(){var t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,e,n){const i=this._mixer,r=i.time,s=this.timeScale;let o=this._timeScaleInterpolant;null===o&&(o=i._lendControlInterpolant(),this._timeScaleInterpolant=o);const a=o.parameterPositions,l=o.sampleValues;return a[0]=r,a[1]=r+n,l[0]=t/s,l[1]=e/s,this}stopWarping(){var t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,e,n,i){if(this.enabled){var r=this._startTime;if(null!==r){r=(t-r)*n;if(r<0||0===n)return;this._startTime=null,e=n*r}e*=this._updateTimeScale(t);var s=this._updateTime(e),o=this._updateWeight(t);if(0<o){const a=this._interpolants,l=this._propertyBindings;if(2501===this.blendMode)for(let t=0,e=a.length;t!==e;++t)a[t].evaluate(s),l[t].accumulateAdditive(o);else for(let t=0,e=a.length;t!==e;++t)a[t].evaluate(s),l[t].accumulate(i,o)}}else this._updateWeight(t)}_updateWeight(t){let e=0;if(this.enabled){e=this.weight;const i=this._weightInterpolant;var n;null!==i&&(n=i.evaluate(t)[0],e*=n,t>i.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1)))}return this._effectiveWeight=e,e}_updateTimeScale(t){let e=0;if(!this.paused){e=this.timeScale;const i=this._timeScaleInterpolant;var n;null!==i&&(n=i.evaluate(t)[0],e*=n,t>i.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e))}return this._effectiveTimeScale=e,e}_updateTime(t){var e=this._clip.duration,n=this.loop;let i=this.time+t,r=this._loopCount;var s,o=2202===n;if(0===t)return-1!==r&&o&&1==(1&r)?e-i:i;if(2200===n){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(i>=e)i=e;else{if(!(i<0)){this.time=i;break t}i=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else if(-1===r&&(0<=t?(r=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),i>=e||i<0?(s=Math.floor(i/e),i-=e*s,r+=Math.abs(s),(n=this.repetitions-r)<=0?(this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=0<t?e:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:0<t?1:-1})):(1==n?this._setEndings(n=t<0,!n,o):this._setEndings(!1,!1,o),this._loopCount=r,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:s}))):this.time=i,o&&1==(1&r))return e-i;return i}_setEndings(t,e,n){const i=this._interpolantSettings;n?(i.endingStart=2401,i.endingEnd=2401):(i.endingStart=t?this.zeroSlopeAtStart?2401:2400:2402,i.endingEnd=e?this.zeroSlopeAtEnd?2401:2400:2402)}_scheduleFading(t,e,n){const i=this._mixer,r=i.time;let s=this._weightInterpolant;null===s&&(s=i._lendControlInterpolant(),this._weightInterpolant=s);const o=s.parameterPositions,a=s.sampleValues;return o[0]=r,a[0]=e,o[1]=r+t,a[1]=n,this}}class Pc extends e{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,n){const i=t._localRoot||this._root,r=t._clip.tracks,s=r.length,o=t._propertyBindings,a=t._interpolants,l=i.uuid,e=this._bindingsByRootAndName;let h=e[l];void 0===h&&(h={},e[l]=h);for(let e=0;e!==s;++e){const u=r[e],d=u.name;let t=h[d];if(void 0!==t)o[e]=t;else{if(t=o[e],void 0!==t){null===t._cacheIndex&&(++t.referenceCount,this._addInactiveBinding(t,l,d));continue}var c=n&&n._propertyBindings[e].binding.parsedPath;t=new xc(Ac.create(i,d,c),u.ValueTypeName,u.getValueSize()),++t.referenceCount,this._addInactiveBinding(t,l,d),o[e]=t}a[e].resultBuffer=t.buffer}}_activateAction(t){if(!this._isActiveAction(t)){var e,n,i;null===t._cacheIndex&&(e=(t._localRoot||this._root).uuid,n=t._clip.uuid,i=this._actionsByClip[n],this._bindAction(t,i&&i.knownActions[0]),this._addInactiveAction(t,n,e));var r=t._propertyBindings;for(let t=0,e=r.length;t!==e;++t){const s=r[t];0==s.useCount++&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){var n=t._propertyBindings;for(let t=0,e=n.length;t!==e;++t){const i=n[t];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){t=t._cacheIndex;return null!==t&&t<this._nActiveActions}_addInactiveAction(t,e,n){const i=this._actions,r=this._actionsByClip;let s=r[e];if(void 0===s)s={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,r[e]=s;else{const o=s.knownActions;t._byClipCacheIndex=o.length,o.push(t)}t._cacheIndex=i.length,i.push(t),s.actionByRoot[n]=t}_removeInactiveAction(t){const e=this._actions,n=e[e.length-1],i=t._cacheIndex;n._cacheIndex=i,e[i]=n,e.pop(),t._cacheIndex=null;const r=t._clip.uuid,s=this._actionsByClip,o=s[r],a=o.knownActions,l=a[a.length-1],h=t._byClipCacheIndex;l._byClipCacheIndex=h,a[h]=l,a.pop(),t._byClipCacheIndex=null;const c=o.actionByRoot,u=(t._localRoot||this._root).uuid;delete c[u],0===a.length&&delete s[r],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){var n=t._propertyBindings;for(let t=0,e=n.length;t!==e;++t){const i=n[t];0==--i.referenceCount&&this._removeInactiveBinding(i)}}_lendAction(t){const e=this._actions,n=t._cacheIndex,i=this._nActiveActions++,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r}_takeBackAction(t){const e=this._actions,n=t._cacheIndex,i=--this._nActiveActions,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r}_addInactiveBinding(t,e,n){const i=this._bindingsByRootAndName,r=this._bindings;let s=i[e];void 0===s&&(s={},i[e]=s),(s[n]=t)._cacheIndex=r.length,r.push(t)}_removeInactiveBinding(t){const e=this._bindings,n=t.binding,i=n.rootNode.uuid,r=n.path,s=this._bindingsByRootAndName,o=s[i],a=e[e.length-1],l=t._cacheIndex;a._cacheIndex=l,e[l]=a,e.pop(),delete o[r],0===Object.keys(o).length&&delete s[i]}_lendBinding(t){const e=this._bindings,n=t._cacheIndex,i=this._nActiveBindings++,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r}_takeBackBinding(t){const e=this._bindings,n=t._cacheIndex,i=--this._nActiveBindings,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r}_lendControlInterpolant(){const t=this._controlInterpolants,e=this._nActiveControlInterpolants++;let n=t[e];return void 0===n&&(n=new Mh(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),n.__cacheIndex=e,t[e]=n),n}_takeBackControlInterpolant(t){const e=this._controlInterpolants,n=t.__cacheIndex,i=--this._nActiveControlInterpolants,r=e[i];t.__cacheIndex=i,e[i]=t,r.__cacheIndex=n,e[n]=r}clipAction(t,e,n){var i=e||this._root,r=i.uuid;let s="string"==typeof t?zh.findByName(i,t):t;var o=null!==s?s.uuid:t,i=this._actionsByClip[o];let a=null;if(void 0===n&&(n=null!==s?s.blendMode:2500),void 0!==i){t=i.actionByRoot[r];if(void 0!==t&&t.blendMode===n)return t;a=i.knownActions[0],null===s&&(s=a._clip)}if(null===s)return null;n=new Cc(this,s,e,n);return this._bindAction(n,a),this._addInactiveAction(n,o,r),n}existingAction(t,e){var n=e||this._root,e=n.uuid,n="string"==typeof t?zh.findByName(n,t):t,t=n?n.uuid:t,t=this._actionsByClip[t];return void 0!==t&&t.actionByRoot[e]||null}stopAllAction(){const e=this._actions,n=this._nActiveActions;for(let t=n-1;0<=t;--t)e[t].stop();return this}update(e){e*=this.timeScale;var n=this._actions,i=this._nActiveActions,r=this.time+=e,s=Math.sign(e),o=this._accuIndex^=1;for(let t=0;t!==i;++t){const h=n[t];h._update(r,e,s,o)}const a=this._bindings,l=this._nActiveBindings;for(let t=0;t!==l;++t)a[t].apply(o);return this}setTime(t){for(let t=this.time=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){const n=this._actions,e=t.uuid,i=this._actionsByClip,r=i[e];if(void 0!==r){var s=r.knownActions;for(let t=0,e=s.length;t!==e;++t){const o=s[t];this._deactivateAction(o);const a=o._cacheIndex,l=n[n.length-1];o._cacheIndex=null,o._byClipCacheIndex=null,l._cacheIndex=a,n[a]=l,n.pop(),this._removeInactiveBindingsForAction(o)}delete i[e]}}uncacheRoot(t){var e=t.uuid,n=this._actionsByClip;for(const s in n){var i=n[s].actionByRoot[e];void 0!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}var r=this._bindingsByRootAndName[e];if(void 0!==r)for(const o in r){const a=r[o];a.restoreOriginalState(),this._removeInactiveBinding(a)}}uncacheAction(t,e){e=this.existingAction(t,e);null!==e&&(this._deactivateAction(e),this._removeInactiveAction(e))}}Pc.prototype._controlInterpolantsResultBuffer=new Float32Array(1);$o;(class extends $o{constructor(t,e,n=1){super(t,e),this.meshPerAttribute=n}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}clone(t){const e=super.clone(t);return e.meshPerAttribute=this.meshPerAttribute,e}toJSON(t){const e=super.toJSON(t);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}}).prototype.isInstancedInterleavedBuffer=!0;class Lc{constructor(t,e,n=0,i=1/0){this.ray=new _n(t,e),this.near=n,this.far=i,this.camera=null,this.layers=new In,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,e){this.ray.set(t,e)}setFromCamera(t,e){e&&e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e&&e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)}intersectObject(t,e=!1,n=[]){return Ic(t,this,n,e),n.sort(Rc),n}intersectObjects(n,i=!1,r=[]){for(let t=0,e=n.length;t<e;t++)Ic(n[t],this,r,i);return r.sort(Rc),r}}function Rc(t,e){return t.distance-e.distance}function Ic(t,n,i,e){if(t.layers.test(n.layers)&&t.raycast(n,i),!0===e){var r=t.children;for(let t=0,e=r.length;t<e;t++)Ic(r[t],n,i,!0)}}(class extends qn{});(class extends null{});const zc=new We,Nc=new bn,Bc=new bn;Ga;(class extends null{});(class extends null{});Ga;(class extends null{});(class extends null{});(class extends null{});(class extends null{});(class extends null{});(class extends null{});(class extends null{});class Dc extends Ga{constructor(t=1){t=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t];const e=new Ci;e.setAttribute("position",new xi(t,3)),e.setAttribute("color",new xi([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));t=new Ba({vertexColors:!0,toneMapped:!1});super(e,t),this.type="AxesHelper"}setColors(t,e,n){const i=new di;var r=this.geometry.attributes.color.array;return i.set(t),i.toArray(r,0),i.toArray(r,3),i.set(e),i.toArray(r,6),i.toArray(r,9),i.set(n),i.toArray(r,12),i.toArray(r,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}const Fc=new Float32Array(1);new Int32Array(Fc.buffer);cl.create=function(t,e){return console.log("THREE.Curve.create() has been deprecated"),t.prototype=Object.create(cl.prototype),(t.prototype.constructor=t).prototype.getPoint=e,t},Gh.prototype.fromPoints=function(t){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(t)},class extends Ga{constructor(t=10,i=10,r=4473924,s=8947848){r=new di(r),s=new di(s);var o=i/2,a=t/i,l=t/2;const h=[],c=[];for(let t=0,e=0,n=-l;t<=i;t++,n+=a){h.push(-l,0,n,l,0,n),h.push(n,0,-l,n,0,l);const u=t===o?r:s;u.toArray(c,e),e+=3,u.toArray(c,e),e+=3,u.toArray(c,e),e+=3,u.toArray(c,e),e+=3}const e=new Ci;e.setAttribute("position",new xi(h,3)),e.setAttribute("color",new xi(c,3));t=new Ba({vertexColors:!0,toneMapped:!1});super(e,t),this.type="GridHelper"}}.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},class extends Ga{constructor(t){var e=function e(n){const i=[];n&&n.isBone&&i.push(n);for(let t=0;t<n.children.length;t++)i.push.apply(i,e(n.children[t]));return i}(t);const n=new Ci,i=[],r=[];var s=new di(0,0,1),o=new di(0,1,0);for(let t=0;t<e.length;t++){var a=e[t];a.parent&&a.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),r.push(s.r,s.g,s.b),r.push(o.r,o.g,o.b))}n.setAttribute("position",new xi(i,3)),n.setAttribute("color",new xi(r,3));var l=new Ba({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(n,l),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(t){var n=this.bones;const e=this.geometry,i=e.getAttribute("position");Bc.copy(this.root.matrixWorld).invert();for(let t=0,e=0;t<n.length;t++){var r=n[t];r.parent&&r.parent.isBone&&(Nc.multiplyMatrices(Bc,r.matrixWorld),zc.setFromMatrixPosition(Nc),i.setXYZ(e,zc.x,zc.y,zc.z),Nc.multiplyMatrices(Bc,r.parent.matrixWorld),zc.setFromMatrixPosition(Nc),i.setXYZ(e+1,zc.x,zc.y,zc.z),e+=2)}e.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(t)}}.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Fh.prototype.extractUrlBase=function(t){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),uc.extractUrlBase(t)},Fh.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},qe.prototype.center=function(t){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(t)},qe.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},qe.prototype.isIntersectionBox=function(t){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},qe.prototype.isIntersectionSphere=function(t){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},qe.prototype.size=function(t){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(t)},dn.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()},cr.prototype.setFromMatrix=function(t){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(t)},ze.prototype.flattenToArrayOffset=function(t,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},ze.prototype.multiplyVector3=function(t){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},ze.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},ze.prototype.applyToBufferAttribute=function(t){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},ze.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},ze.prototype.getInverse=function(t){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(t).invert()},bn.prototype.extractPosition=function(t){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(t)},bn.prototype.flattenToArrayOffset=function(t,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},bn.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new We).setFromMatrixColumn(this,3)},bn.prototype.setRotationFromQuaternion=function(t){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(t)},bn.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},bn.prototype.multiplyVector3=function(t){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},bn.prototype.multiplyVector4=function(t){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},bn.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},bn.prototype.rotateAxis=function(t){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),t.transformDirection(this)},bn.prototype.crossVector=function(t){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},bn.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},bn.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},bn.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},bn.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},bn.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},bn.prototype.applyToBufferAttribute=function(t){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},bn.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},bn.prototype.makeFrustum=function(t,e,n,i,r,s){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(t,e,i,n,r,s)},bn.prototype.getInverse=function(t){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(t).invert()},ar.prototype.isIntersectionLine=function(t){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(t)},He.prototype.multiplyVector3=function(t){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),t.applyQuaternion(this)},He.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()},_n.prototype.isIntersectionBox=function(t){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},_n.prototype.isIntersectionPlane=function(t){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(t)},_n.prototype.isIntersectionSphere=function(t){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},ii.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},ii.prototype.barycoordFromPoint=function(t,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(t,e)},ii.prototype.midpoint=function(t){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(t)},ii.prototypenormal=function(t){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(t)},ii.prototype.plane=function(t){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(t)},ii.barycoordFromPoint=function(t,e,n,i,r){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),ii.getBarycoord(t,e,n,i,r)},ii.normal=function(t,e,n,i){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),ii.getNormal(t,e,n,i)},jh.prototype.extractAllPoints=function(t){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(t)},jh.prototype.extrude=function(t){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new Zl(this,t)},jh.prototype.makeGeometry=function(t){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new nh(this,t)},Ie.prototype.fromAttribute=function(t,e,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},Ie.prototype.distanceToManhattan=function(t){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},Ie.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},We.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},We.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},We.prototype.getPositionFromMatrix=function(t){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(t)},We.prototype.getScaleFromMatrix=function(t){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(t)},We.prototype.getColumnFromMatrix=function(t,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},We.prototype.applyProjection=function(t){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(t)},We.prototype.fromAttribute=function(t,e,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},We.prototype.distanceToManhattan=function(t){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},We.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Oe.prototype.fromAttribute=function(t,e,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},Oe.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},qn.prototype.getChildByName=function(t){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(t)},qn.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},qn.prototype.translate=function(t,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,t)},qn.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},qn.prototype.applyMatrix=function(t){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)},Object.defineProperties(qn.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(t){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=t}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),qi.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties(qi.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Ma.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},tr.prototype.setLens=function(t,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==e&&(this.filmGauge=e),this.setFocalLength(t)},Object.defineProperties(qh.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(t){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=t}},shadowCameraLeft:{set:function(t){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=t}},shadowCameraRight:{set:function(t){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=t}},shadowCameraTop:{set:function(t){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=t}},shadowCameraBottom:{set:function(t){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=t}},shadowCameraNear:{set:function(t){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=t}},shadowCameraFar:{set:function(t){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=t}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(t){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=t}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(t){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=t}},shadowMapHeight:{set:function(t){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=t}}}),Object.defineProperties(vi.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),35048===this.usage},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(35048)}}}),vi.prototype.setDynamic=function(t){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?35048:35044),this},vi.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},vi.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},Ci.prototype.addIndex=function(t){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(t)},Ci.prototype.addAttribute=function(t,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?"index"===t?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(t,e):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(t,new vi(e,arguments[2])))},Ci.prototype.addDrawCall=function(t,e,n){void 0!==n&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(t,e)},Ci.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},Ci.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},Ci.prototype.removeAttribute=function(t){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(t)},Ci.prototype.applyMatrix=function(t){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)},Object.defineProperties(Ci.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),$o.prototype.setDynamic=function(t){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?35048:35044),this},$o.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},Zl.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},Zl.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},Zl.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},Qo.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},class mv{constructor(t){"string"==typeof t&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),t=arguments[1]),this.value=t}clone(){return new mv(void 0===this.value.clone?this.value:this.value.clone())}}.prototype.onUpdate=function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this},Object.defineProperties(si.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new di}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===t}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(t){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=t}},vertexTangents:{get:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}}),Object.defineProperties(Qi.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(t){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=t}}}),Zo.prototype.clearTarget=function(t,e,n,i){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(t),this.clear(e,n,i)},Zo.prototype.animate=function(t){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(t)},Zo.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},Zo.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},Zo.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},Zo.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},Zo.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},Zo.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},Zo.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},Zo.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},Zo.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},Zo.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},Zo.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},Zo.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},Zo.prototype.enableScissorTest=function(t){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(t)},Zo.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},Zo.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},Zo.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},Zo.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},Zo.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},Zo.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},Zo.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},Zo.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},Zo.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},Zo.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()},Object.defineProperties(Zo.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=t}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=t}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(t){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===t?ve:fe}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(Oo.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(Ve.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=t}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=t}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=t}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=t}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(t){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=t}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(t){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=t}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(t){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=t}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(t){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=t}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(t){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=t}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(t){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=t}}}),er.prototype.updateCubeMap=function(t,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(t,e)},er.prototype.clear=function(t,e,n,i){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(t,e,n,i)},Be.crossOrigin=void 0,Be.loadTexture=function(t,e,n,i){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const r=new Hh;r.setCrossOrigin(this.crossOrigin);const s=r.load(t,n,void 0,i);return e&&(s.mapping=e),s},Be.loadTextureCube=function(t,e,n,i){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const r=new Uh;r.setCrossOrigin(this.crossOrigin);const s=r.load(t,n,void 0,i);return e&&(s.mapping=e),s},Be.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},Be.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"132"}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="132");const kc={type:"change"},Oc={type:"start"},Vc={type:"end"};class Uc extends e{constructor(t,e){super(),void 0===e&&console.warn('THREE.TrackballControls: The second parameter "domElement" is now mandatory.'),e===document&&console.error('THREE.TrackballControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.');const a=this,n={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=t,this.domElement=e,this.domElement.style.touchAction="none",this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=["KeyA","KeyS","KeyD"],this.mouseButtons={LEFT:z.ROTATE,MIDDLE:z.DOLLY,RIGHT:z.PAN},this.target=new We;const i=new We;let r=1,s=n.NONE,o=n.NONE,l=0,h=0,c=0;const u=new We,d=new Ie,p=new Ie,m=new We,f=new Ie,v=new Ie,g=new Ie,y=new Ie,x=[],_={};this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone(),this.zoom0=this.object.zoom,this.handleResize=function(){var t=a.domElement.getBoundingClientRect(),e=a.domElement.ownerDocument.documentElement;a.screen.left=t.left+window.pageXOffset-e.clientLeft,a.screen.top=t.top+window.pageYOffset-e.clientTop,a.screen.width=t.width,a.screen.height=t.height};const b=function(){const n=new Ie;return function(t,e){return n.set((t-a.screen.left)/a.screen.width,(e-a.screen.top)/a.screen.height),n}}(),w=function(){const n=new Ie;return function(t,e){return n.set((t-.5*a.screen.width-a.screen.left)/(.5*a.screen.width),(a.screen.height+2*(a.screen.top-e))/a.screen.width),n}}();function M(t){var e;!1!==a.enabled&&(0===x.length&&(a.domElement.setPointerCapture(t.pointerId),a.domElement.addEventListener("pointermove",S),a.domElement.addEventListener("pointerup",E)),e=t,x.push(e),("touch"===t.pointerType?function(t){{var e;1===(I(t),x.length)?(s=n.TOUCH_ROTATE,p.copy(w(x[0].pageX,x[0].pageY)),d.copy(p)):(s=n.TOUCH_ZOOM_PAN,e=x[0].pageX-x[1].pageX,t=x[0].pageY-x[1].pageY,h=l=Math.sqrt(e*e+t*t),e=(x[0].pageX+x[1].pageX)/2,t=(x[0].pageY+x[1].pageY)/2,g.copy(b(e,t)),y.copy(g))}a.dispatchEvent(Oc)}:function(t){if(s===n.NONE)switch(t.button){case a.mouseButtons.LEFT:s=n.ROTATE;break;case a.mouseButtons.MIDDLE:s=n.ZOOM;break;case a.mouseButtons.RIGHT:s=n.PAN;break;default:s=n.NONE}var e=o!==n.NONE?o:s;e!==n.ROTATE||a.noRotate?e!==n.ZOOM||a.noZoom?e!==n.PAN||a.noPan||(g.copy(b(t.pageX,t.pageY)),y.copy(g)):(f.copy(b(t.pageX,t.pageY)),v.copy(f)):(p.copy(w(t.pageX,t.pageY)),d.copy(p));a.dispatchEvent(Oc)})(t))}function S(t){var e;!1!==a.enabled&&("touch"===t.pointerType?function(t){{var e,n,i;1===(I(t),x.length)?(d.copy(p),p.copy(w(t.pageX,t.pageY))):(i=function(t){t=t.pointerId===x[0].pointerId?x[1]:x[0];return _[t.pointerId]}(t),e=t.pageX-i.x,n=t.pageY-i.y,h=Math.sqrt(e*e+n*n),n=(t.pageX+i.x)/2,i=(t.pageY+i.y)/2,y.copy(b(n,i)))}}(t):(e=t,(t=o!==n.NONE?o:s)!==n.ROTATE||a.noRotate?t!==n.ZOOM||a.noZoom?t!==n.PAN||a.noPan||y.copy(b(e.pageX,e.pageY)):v.copy(b(e.pageX,e.pageY)):(d.copy(p),p.copy(w(e.pageX,e.pageY)))))}function E(t){!1!==a.enabled&&("touch"===t.pointerType?function(t){switch(x.length){case 0:s=n.NONE;break;case 1:s=n.TOUCH_ROTATE,p.copy(w(t.pageX,t.pageY)),d.copy(p);break;case 2:s=n.TOUCH_ZOOM_PAN,p.copy(w(t.pageX-d.pageX,t.pageY-d.pageY)),d.copy(p)}a.dispatchEvent(Vc)}(t):(s=n.NONE,a.dispatchEvent(Vc)),R(t),0===x.length&&(a.domElement.releasePointerCapture(t.pointerId),a.domElement.removeEventListener("pointermove",S),a.domElement.removeEventListener("pointerup",E)))}function T(t){R(t)}function A(t){!1!==a.enabled&&(window.removeEventListener("keydown",A),o!==n.NONE||(t.code!==a.keys[n.ROTATE]||a.noRotate?t.code!==a.keys[n.ZOOM]||a.noZoom?t.code!==a.keys[n.PAN]||a.noPan||(o=n.PAN):o=n.ZOOM:o=n.ROTATE))}function C(){!1!==a.enabled&&(o=n.NONE,window.addEventListener("keydown",A))}function P(t){if(!1!==a.enabled&&!0!==a.noZoom){switch(t.preventDefault(),t.deltaMode){case 2:f.y-=.025*t.deltaY;break;case 1:f.y-=.01*t.deltaY;break;default:f.y-=25e-5*t.deltaY}a.dispatchEvent(Oc),a.dispatchEvent(Vc)}}function L(t){!1!==a.enabled&&t.preventDefault()}function R(e){delete _[e.pointerId];for(let t=0;t<x.length;t++)if(x[t].pointerId==e.pointerId)return void x.splice(t,1)}function I(t){let e=_[t.pointerId];void 0===e&&(e=new Ie,_[t.pointerId]=e),e.set(t.pageX,t.pageY)}this.rotateCamera=function(){const e=new We,n=new He,i=new We,r=new We,s=new We,o=new We;return function(){o.set(p.x-d.x,p.y-d.y,0);var t=o.length();t?(u.copy(a.object.position).sub(a.target),i.copy(u).normalize(),r.copy(a.object.up).normalize(),s.crossVectors(r,i).normalize(),r.setLength(p.y-d.y),s.setLength(p.x-d.x),o.copy(r.add(s)),e.crossVectors(o,u).normalize(),t*=a.rotateSpeed,n.setFromAxisAngle(e,t),u.applyQuaternion(n),a.object.up.applyQuaternion(n),m.copy(e),c=t):!a.staticMoving&&c&&(c*=Math.sqrt(1-a.dynamicDampingFactor),u.copy(a.object.position).sub(a.target),n.setFromAxisAngle(m,c),u.applyQuaternion(n),a.object.up.applyQuaternion(n)),d.copy(p)}}(),this.zoomCamera=function(){let t;s===n.TOUCH_ZOOM_PAN?(t=l/h,l=h,a.object.isPerspectiveCamera?u.multiplyScalar(t):a.object.isOrthographicCamera?(a.object.zoom*=t,a.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")):(t=1+(v.y-f.y)*a.zoomSpeed,1!==t&&0<t&&(a.object.isPerspectiveCamera?u.multiplyScalar(t):a.object.isOrthographicCamera?(a.object.zoom/=t,a.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")),a.staticMoving?f.copy(v):f.y+=(v.y-f.y)*this.dynamicDampingFactor)},this.panCamera=function(){const n=new Ie,i=new We,r=new We;return function(){var t,e;n.copy(y).sub(g),n.lengthSq()&&(a.object.isOrthographicCamera&&(t=(a.object.right-a.object.left)/a.object.zoom/a.domElement.clientWidth,e=(a.object.top-a.object.bottom)/a.object.zoom/a.domElement.clientWidth,n.x*=t,n.y*=e),n.multiplyScalar(u.length()*a.panSpeed),r.copy(u).cross(a.object.up).setLength(n.x),r.add(i.copy(a.object.up).setLength(n.y)),a.object.position.add(r),a.target.add(r),a.staticMoving?g.copy(y):g.add(n.subVectors(y,g).multiplyScalar(a.dynamicDampingFactor)))}}(),this.checkDistances=function(){a.noZoom&&a.noPan||(u.lengthSq()>a.maxDistance*a.maxDistance&&(a.object.position.addVectors(a.target,u.setLength(a.maxDistance)),f.copy(v)),u.lengthSq()<a.minDistance*a.minDistance&&(a.object.position.addVectors(a.target,u.setLength(a.minDistance)),f.copy(v)))},this.update=function(){u.subVectors(a.object.position,a.target),a.noRotate||a.rotateCamera(),a.noZoom||a.zoomCamera(),a.noPan||a.panCamera(),a.object.position.addVectors(a.target,u),a.object.isPerspectiveCamera?(a.checkDistances(),a.object.lookAt(a.target),1e-6<i.distanceToSquared(a.object.position)&&(a.dispatchEvent(kc),i.copy(a.object.position))):a.object.isOrthographicCamera?(a.object.lookAt(a.target),(1e-6<i.distanceToSquared(a.object.position)||r!==a.object.zoom)&&(a.dispatchEvent(kc),i.copy(a.object.position),r=a.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type")},this.reset=function(){s=n.NONE,o=n.NONE,a.target.copy(a.target0),a.object.position.copy(a.position0),a.object.up.copy(a.up0),a.object.zoom=a.zoom0,a.object.updateProjectionMatrix(),u.subVectors(a.object.position,a.target),a.object.lookAt(a.target),a.dispatchEvent(kc),i.copy(a.object.position),r=a.object.zoom},this.dispose=function(){a.domElement.removeEventListener("contextmenu",L),a.domElement.removeEventListener("pointerdown",M),a.domElement.removeEventListener("pointercancel",T),a.domElement.removeEventListener("wheel",P),a.domElement.removeEventListener("pointermove",S),a.domElement.removeEventListener("pointerup",E),window.removeEventListener("keydown",A),window.removeEventListener("keyup",C)},this.domElement.addEventListener("contextmenu",L),this.domElement.addEventListener("pointerdown",M),this.domElement.addEventListener("pointercancel",T),this.domElement.addEventListener("wheel",P,{passive:!1}),window.addEventListener("keydown",A),window.addEventListener("keyup",C),this.handleResize(),this.update()}}class Hc extends Fh{constructor(t){super(t),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new Xc(t)}),this.register(function(t){return new Qc(t)}),this.register(function(t){return new $c(t)}),this.register(function(t){return new Yc(t)}),this.register(function(t){return new Zc(t)}),this.register(function(t){return new Kc(t)}),this.register(function(t){return new Jc(t)}),this.register(function(t){return new jc(t)}),this.register(function(t){return new tu(t)})}load(e,n,t,i){const r=this;let s;s=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:uc.extractUrlBase(e),this.manager.itemStart(e);function o(t){i?i(t):console.error(t),r.manager.itemError(e),r.manager.itemEnd(e)}const a=new Oh(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(t){try{r.parse(t,s,function(t){n(t),r.manager.itemEnd(e)},o)}catch(t){o(t)}},t,o)}setDRACOLoader(t){return this.dracoLoader=t,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(t){return this.ktx2Loader=t,this}setMeshoptDecoder(t){return this.meshoptDecoder=t,this}register(t){return-1===this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.push(t),this}unregister(t){return-1!==this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(t,e,n,i){let r;const s={},o={};if("string"==typeof t)r=t;else if(uc.decodeText(new Uint8Array(t,0,4))===eu){try{s[Gc.KHR_BINARY_GLTF]=new iu(t)}catch(t){return void(i&&i(t))}r=s[Gc.KHR_BINARY_GLTF].content}else r=uc.decodeText(new Uint8Array(t));var a=JSON.parse(r);if(void 0===a.asset||a.asset.version[0]<2)i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{const c=new Tu(a,{path:e||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let t=0;t<this.pluginCallbacks.length;t++){var l=this.pluginCallbacks[t](c);o[l.name]=l,s[l.name]=!0}if(a.extensionsUsed)for(let t=0;t<a.extensionsUsed.length;++t){var h=a.extensionsUsed[t];const u=a.extensionsRequired||[];switch(h){case Gc.KHR_MATERIALS_UNLIT:s[h]=new qc;break;case Gc.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:s[h]=new au;break;case Gc.KHR_DRACO_MESH_COMPRESSION:s[h]=new ru(a,this.dracoLoader);break;case Gc.KHR_TEXTURE_TRANSFORM:s[h]=new su;break;case Gc.KHR_MESH_QUANTIZATION:s[h]=new lu;break;default:0<=u.indexOf(h)&&void 0===o[h]&&console.warn('THREE.GLTFLoader: Unknown extension "'+h+'".')}}c.setExtensions(s),c.setPlugins(o),c.parse(n,i)}}}function Wc(){let n={};return{get:function(t){return n[t]},add:function(t,e){n[t]=e},remove:function(t){delete n[t]},removeAll:function(){n={}}}}const Gc={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class jc{constructor(t){this.parser=t,this.name=Gc.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const n=this.parser;var i=this.parser.json.nodes||[];for(let t=0,e=i.length;t<e;t++){var r=i[t];r.extensions&&r.extensions[this.name]&&void 0!==r.extensions[this.name].light&&n._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(t){const e=this.parser;var n="light:"+t;let i=e.cache.get(n);if(i)return i;var r=e.json;const s=((r.extensions&&r.extensions[this.name]||{}).lights||[])[t];let o;const a=new di(16777215);void 0!==s.color&&a.fromArray(s.color);var l=void 0!==s.range?s.range:0;switch(s.type){case"directional":o=new oc(a),o.target.position.set(0,0,-1),o.add(o.target);break;case"point":o=new rc(a),o.distance=l;break;case"spot":o=new $h(a),o.distance=l,s.spot=s.spot||{},s.spot.innerConeAngle=void 0!==s.spot.innerConeAngle?s.spot.innerConeAngle:0,s.spot.outerConeAngle=void 0!==s.spot.outerConeAngle?s.spot.outerConeAngle:Math.PI/4,o.angle=s.spot.outerConeAngle,o.penumbra=1-s.spot.innerConeAngle/s.spot.outerConeAngle,o.target.position.set(0,0,-1),o.add(o.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+s.type)}return o.position.set(0,0,0),o.decay=2,void 0!==s.intensity&&(o.intensity=s.intensity),o.name=e.createUniqueName(s.name||"light_"+t),i=Promise.resolve(o),e.cache.add(n,i),i}createNodeAttachment(t){const e=this,n=this.parser;t=n.json.nodes[t];const i=(t.extensions&&t.extensions[this.name]||{}).light;return void 0===i?null:this._loadLight(i).then(function(t){return n._getNodeRef(e.cache,i,t)})}}class qc{constructor(){this.name=Gc.KHR_MATERIALS_UNLIT}getMaterialType(){return pi}extendParams(t,e,n){const i=[];t.color=new di(1,1,1),t.opacity=1;var r=e.pbrMetallicRoughness;return r&&(Array.isArray(r.baseColorFactor)&&(e=r.baseColorFactor,t.color.fromArray(e),t.opacity=e[3]),void 0!==r.baseColorTexture&&i.push(n.assignTexture(t,"map",r.baseColorTexture))),Promise.all(i)}}class Xc{constructor(t){this.parser=t,this.name=Gc.KHR_MATERIALS_CLEARCOAT}getMaterialType(t){t=this.parser.json.materials[t];return t.extensions&&t.extensions[this.name]?ph:null}extendMaterialParams(t,e){const n=this.parser;t=n.json.materials[t];if(!t.extensions||!t.extensions[this.name])return Promise.resolve();const i=[];t=t.extensions[this.name];return void 0!==t.clearcoatFactor&&(e.clearcoat=t.clearcoatFactor),void 0!==t.clearcoatTexture&&i.push(n.assignTexture(e,"clearcoatMap",t.clearcoatTexture)),void 0!==t.clearcoatRoughnessFactor&&(e.clearcoatRoughness=t.clearcoatRoughnessFactor),void 0!==t.clearcoatRoughnessTexture&&i.push(n.assignTexture(e,"clearcoatRoughnessMap",t.clearcoatRoughnessTexture)),void 0!==t.clearcoatNormalTexture&&(i.push(n.assignTexture(e,"clearcoatNormalMap",t.clearcoatNormalTexture)),void 0!==t.clearcoatNormalTexture.scale&&(t=t.clearcoatNormalTexture.scale,e.clearcoatNormalScale=new Ie(t,-t))),Promise.all(i)}}class Yc{constructor(t){this.parser=t,this.name=Gc.KHR_MATERIALS_TRANSMISSION}getMaterialType(t){t=this.parser.json.materials[t];return t.extensions&&t.extensions[this.name]?ph:null}extendMaterialParams(t,e){const n=this.parser;t=n.json.materials[t];if(!t.extensions||!t.extensions[this.name])return Promise.resolve();const i=[];t=t.extensions[this.name];return void 0!==t.transmissionFactor&&(e.transmission=t.transmissionFactor),void 0!==t.transmissionTexture&&i.push(n.assignTexture(e,"transmissionMap",t.transmissionTexture)),Promise.all(i)}}class Zc{constructor(t){this.parser=t,this.name=Gc.KHR_MATERIALS_VOLUME}getMaterialType(t){t=this.parser.json.materials[t];return t.extensions&&t.extensions[this.name]?ph:null}extendMaterialParams(t,e){const n=this.parser;t=n.json.materials[t];if(!t.extensions||!t.extensions[this.name])return Promise.resolve();const i=[];t=t.extensions[this.name];e.thickness=void 0!==t.thicknessFactor?t.thicknessFactor:0,void 0!==t.thicknessTexture&&i.push(n.assignTexture(e,"thicknessMap",t.thicknessTexture)),e.attenuationDistance=t.attenuationDistance||0;t=t.attenuationColor||[1,1,1];return e.attenuationTint=new di(t[0],t[1],t[2]),Promise.all(i)}}class Kc{constructor(t){this.parser=t,this.name=Gc.KHR_MATERIALS_IOR}getMaterialType(t){t=this.parser.json.materials[t];return t.extensions&&t.extensions[this.name]?ph:null}extendMaterialParams(t,e){t=this.parser.json.materials[t];if(!t.extensions||!t.extensions[this.name])return Promise.resolve();t=t.extensions[this.name];return e.ior=void 0!==t.ior?t.ior:1.5,Promise.resolve()}}class Jc{constructor(t){this.parser=t,this.name=Gc.KHR_MATERIALS_SPECULAR}getMaterialType(t){t=this.parser.json.materials[t];return t.extensions&&t.extensions[this.name]?ph:null}extendMaterialParams(t,e){const n=this.parser;var i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[];t=i.extensions[this.name];e.specularIntensity=void 0!==t.specularFactor?t.specularFactor:1,void 0!==t.specularTexture&&r.push(n.assignTexture(e,"specularIntensityMap",t.specularTexture));i=t.specularColorFactor||[1,1,1];return e.specularTint=new di(i[0],i[1],i[2]),void 0!==t.specularColorTexture&&r.push(n.assignTexture(e,"specularTintMap",t.specularColorTexture).then(function(t){t.encoding=ve})),Promise.all(r)}}class Qc{constructor(t){this.parser=t,this.name=Gc.KHR_TEXTURE_BASISU}loadTexture(t){const e=this.parser,n=e.json;var i=n.textures[t];if(!i.extensions||!i.extensions[this.name])return null;var r=i.extensions[this.name],i=n.images[r.source],r=e.options.ktx2Loader;if(r)return e.loadTextureImage(t,i,r);if(n.extensionsRequired&&0<=n.extensionsRequired.indexOf(this.name))throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}}class $c{constructor(t){this.parser=t,this.name=Gc.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const n=this.name,i=this.parser,r=i.json;var t=r.textures[e];if(!t.extensions||!t.extensions[n])return null;t=t.extensions[n];const s=r.images[t.source];let o=i.textureLoader;return!s.uri||null!==(t=i.options.manager.getHandler(s.uri))&&(o=t),this.detectSupport().then(function(t){if(t)return i.loadTextureImage(e,s,o);if(r.extensionsRequired&&0<=r.extensionsRequired.indexOf(n))throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(t){const e=new Image;e.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",e.onload=e.onerror=function(){t(1===e.height)}})),this.isSupported}}class tu{constructor(t){this.name=Gc.EXT_MESHOPT_COMPRESSION,this.parser=t}loadBufferView(t){const e=this.parser.json;t=e.bufferViews[t];if(t.extensions&&t.extensions[this.name]){const o=t.extensions[this.name];t=this.parser.getDependency("buffer",o.buffer);const a=this.parser.options.meshoptDecoder;if(a&&a.supported)return Promise.all([t,a.ready]).then(function(t){var e=o.byteOffset||0,n=o.byteLength||0,i=o.count,r=o.byteStride,s=new ArrayBuffer(i*r),n=new Uint8Array(t[0],e,n);return a.decodeGltfBuffer(new Uint8Array(s),i,r,n,o.mode,o.filter),s});if(e.extensionsRequired&&0<=e.extensionsRequired.indexOf(this.name))throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return null}}const eu="glTF",nu={JSON:1313821514,BIN:5130562};class iu{constructor(t){this.name=Gc.KHR_BINARY_GLTF,this.content=null,this.body=null;const e=new DataView(t,0,12);if(this.header={magic:uc.decodeText(new Uint8Array(t.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0)},this.header.magic!==eu)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");var n=this.header.length-12;const i=new DataView(t,12);let r=0;for(;r<n;){var s=i.getUint32(r,!0);r+=4;var o,a=i.getUint32(r,!0);r+=4,a===nu.JSON?(o=new Uint8Array(t,12+r,s),this.content=uc.decodeText(o)):a===nu.BIN&&(a=12+r,this.body=t.slice(a,a+s)),r+=s}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class ru{constructor(t,e){if(!e)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Gc.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=e,this.dracoLoader.preload()}decodePrimitive(t,e){var n=this.json;const i=this.dracoLoader;var r=t.extensions[this.name].bufferView,s=t.extensions[this.name].attributes;const o={},a={},l={};for(const p in s){var h=gu[p]||p.toLowerCase();o[h]=s[p]}for(const m in t.attributes){var c,u,d=gu[m]||m.toLowerCase();void 0!==s[m]&&(c=n.accessors[t.attributes[m]],u=pu[c.componentType],l[d]=u,a[d]=!0===c.normalized)}return e.getDependency("bufferView",r).then(function(t){return new Promise(function(r){i.decodeDracoFile(t,function(t){for(const n in t.attributes){const i=t.attributes[n];var e=a[n];void 0!==e&&(i.normalized=e)}r(t)},o,l)})})}}class su{constructor(){this.name=Gc.KHR_TEXTURE_TRANSFORM}extendTexture(t,e){return void 0!==e.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),void 0===e.offset&&void 0===e.rotation&&void 0===e.scale||(t=t.clone(),void 0!==e.offset&&t.offset.fromArray(e.offset),void 0!==e.rotation&&(t.rotation=e.rotation),void 0!==e.scale&&t.repeat.fromArray(e.scale),t.needsUpdate=!0),t}}class ou extends dh{constructor(t){super(),this.isGLTFSpecularGlossinessMaterial=!0;const n=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),i=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),r=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),s=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),o=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),a={specular:{value:(new di).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=a,this.onBeforeCompile=function(t){for(const e in a)t.uniforms[e]=a[e];t.fragmentShader=t.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",n).replace("#include <metalnessmap_pars_fragment>",i).replace("#include <roughnessmap_fragment>",r).replace("#include <metalnessmap_fragment>",s).replace("#include <lights_physical_fragment>",o)},Object.defineProperties(this,{specular:{get:function(){return a.specular.value},set:function(t){a.specular.value=t}},specularMap:{get:function(){return a.specularMap.value},set:function(t){(a.specularMap.value=t)?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return a.glossiness.value},set:function(t){a.glossiness.value=t}},glossinessMap:{get:function(){return a.glossinessMap.value},set:function(t){(a.glossinessMap.value=t)?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(t)}copy(t){return super.copy(t),this.specularMap=t.specularMap,this.specular.copy(t.specular),this.glossinessMap=t.glossinessMap,this.glossiness=t.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class au{constructor(){this.name=Gc.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"]}getMaterialType(){return ou}extendParams(t,e,n){var i=e.extensions[this.name];t.color=new di(1,1,1),t.opacity=1;const r=[];return Array.isArray(i.diffuseFactor)&&(e=i.diffuseFactor,t.color.fromArray(e),t.opacity=e[3]),void 0!==i.diffuseTexture&&r.push(n.assignTexture(t,"map",i.diffuseTexture)),t.emissive=new di(0,0,0),t.glossiness=void 0!==i.glossinessFactor?i.glossinessFactor:1,t.specular=new di(1,1,1),Array.isArray(i.specularFactor)&&t.specular.fromArray(i.specularFactor),void 0!==i.specularGlossinessTexture&&(i=i.specularGlossinessTexture,r.push(n.assignTexture(t,"glossinessMap",i)),r.push(n.assignTexture(t,"specularMap",i))),Promise.all(r)}createMaterial(t){const e=new ou(t);return e.fog=!0,e.color=t.color,e.map=void 0===t.map?null:t.map,e.lightMap=null,e.lightMapIntensity=1,e.aoMap=void 0===t.aoMap?null:t.aoMap,e.aoMapIntensity=1,e.emissive=t.emissive,e.emissiveIntensity=1,e.emissiveMap=void 0===t.emissiveMap?null:t.emissiveMap,e.bumpMap=void 0===t.bumpMap?null:t.bumpMap,e.bumpScale=1,e.normalMap=void 0===t.normalMap?null:t.normalMap,e.normalMapType=ge,t.normalScale&&(e.normalScale=t.normalScale),e.displacementMap=null,e.displacementScale=1,e.displacementBias=0,e.specularMap=void 0===t.specularMap?null:t.specularMap,e.specular=t.specular,e.glossinessMap=void 0===t.glossinessMap?null:t.glossinessMap,e.glossiness=t.glossiness,e.alphaMap=null,e.envMap=void 0===t.envMap?null:t.envMap,e.envMapIntensity=1,e.refractionRatio=.98,e}}class lu{constructor(){this.name=Gc.KHR_MESH_QUANTIZATION}}class hu extends bh{constructor(t,e,n,i){super(t,e,n,i)}copySampleValue_(t){const e=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=t*i*3+i;for(let t=0;t!==i;t++)e[t]=n[r+t];return e}}hu.prototype.beforeStart_=hu.prototype.copySampleValue_,hu.prototype.afterEnd_=hu.prototype.copySampleValue_,hu.prototype.interpolate_=function(t,e,n,i){const r=this.resultBuffer;var s=this.sampleValues,o=this.valueSize,a=2*o,l=3*o,h=i-e,i=(n-e)/h,n=i*i,e=n*i,c=t*l,u=c-l,d=-2*e+3*n,p=e-n,m=1-d,f=p-n+i;for(let t=0;t!==o;t++){var v=s[u+t+o],g=s[u+t+a]*h,y=s[c+t+o],x=s[c+t]*h;r[t]=m*v+f*g+d*y+p*x}return r};const cu=new He;class uu extends hu{interpolate_(t,e,n,i){i=super.interpolate_(t,e,n,i);return cu.fromArray(i).normalize().toArray(i),i}}const du={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},pu={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},mu={9728:Nt,9729:W,9984:U,9985:t,9986:H,9987:Bt},fu={33071:zt,33648:V,10497:O},vu={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},gu={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},yu={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},xu={CUBICSPLINE:void 0,LINEAR:2301,STEP:2300},_u={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function bu(t,e){return"string"!=typeof t||""===t?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}function wu(t,e,n){for(const i in n.extensions)void 0===t[i]&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[i]=n.extensions[i])}function Mu(t,e){void 0!==e.extras&&("object"==typeof e.extras?Object.assign(t.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function Su(n){let i="";var r=Object.keys(n).sort();for(let t=0,e=r.length;t<e;t++)i+=r[t]+":"+n[r[t]]+";";return i}function Eu(t){switch(t){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}class Tu{constructor(t={},e={}){this.json=t,this.extensions={},this.plugins={},this.options=e,this.cache=new Wc,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.textureCache={},this.nodeNamesUsed={},"undefined"!=typeof createImageBitmap&&!1===/Firefox/.test(navigator.userAgent)?this.textureLoader=new pc(this.options.manager):this.textureLoader=new Hh(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Oh(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(t){this.extensions=t}setPlugins(t){this.plugins=t}parse(n,t){const i=this,r=this.json,s=this.extensions;this.cache.removeAll(),this._invokeAll(function(t){return t._markDefs&&t._markDefs()}),Promise.all(this._invokeAll(function(t){return t.beforeRoot&&t.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(t){const e={scene:t[0][r.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:r.asset,parser:i,userData:{}};wu(s,e,r),Mu(e,r),Promise.all(i._invokeAll(function(t){return t.afterRoot&&t.afterRoot(e)})).then(function(){n(e)})}).catch(t)}_markDefs(){const n=this.json.nodes||[];var i=this.json.skins||[];const r=this.json.meshes||[];for(let t=0,e=i.length;t<e;t++){var s=i[t].joints;for(let t=0,e=s.length;t<e;t++)n[s[t]].isBone=!0}for(let t=0,e=n.length;t<e;t++){var o=n[t];void 0!==o.mesh&&(this._addNodeRef(this.meshCache,o.mesh),void 0!==o.skin&&(r[o.mesh].isSkinnedMesh=!0)),void 0!==o.camera&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(t,e){void 0!==e&&(void 0===t.refs[e]&&(t.refs[e]=t.uses[e]=0),t.refs[e]++)}_getNodeRef(t,e,n){if(t.refs[e]<=1)return n;const i=n.clone();return i.name+="_instance_"+t.uses[e]++,i}_invokeOne(e){const n=Object.values(this.plugins);n.push(this);for(let t=0;t<n.length;t++){var i=e(n[t]);if(i)return i}return null}_invokeAll(e){const n=Object.values(this.plugins);n.unshift(this);const i=[];for(let t=0;t<n.length;t++){var r=e(n[t]);r&&i.push(r)}return i}getDependency(t,e){var n=t+":"+e;let i=this.cache.get(n);if(!i){switch(t){case"scene":i=this.loadScene(e);break;case"node":i=this.loadNode(e);break;case"mesh":i=this._invokeOne(function(t){return t.loadMesh&&t.loadMesh(e)});break;case"accessor":i=this.loadAccessor(e);break;case"bufferView":i=this._invokeOne(function(t){return t.loadBufferView&&t.loadBufferView(e)});break;case"buffer":i=this.loadBuffer(e);break;case"material":i=this._invokeOne(function(t){return t.loadMaterial&&t.loadMaterial(e)});break;case"texture":i=this._invokeOne(function(t){return t.loadTexture&&t.loadTexture(e)});break;case"skin":i=this.loadSkin(e);break;case"animation":i=this.loadAnimation(e);break;case"camera":i=this.loadCamera(e);break;default:throw new Error("Unknown type: "+t)}this.cache.add(n,i)}return i}getDependencies(n){let t=this.cache.get(n);if(!t){const i=this,e=this.json[n+("mesh"===n?"es":"s")]||[];t=Promise.all(e.map(function(t,e){return i.getDependency(n,e)})),this.cache.add(n,t)}return t}loadBuffer(t){const n=this.json.buffers[t],i=this.fileLoader;if(n.type&&"arraybuffer"!==n.type)throw new Error("THREE.GLTFLoader: "+n.type+" buffer type is not supported.");if(void 0===n.uri&&0===t)return Promise.resolve(this.extensions[Gc.KHR_BINARY_GLTF].body);const r=this.options;return new Promise(function(t,e){i.load(bu(n.uri,r.path),t,void 0,function(){e(new Error('THREE.GLTFLoader: Failed to load buffer "'+n.uri+'".'))})})}loadBufferView(t){const i=this.json.bufferViews[t];return this.getDependency("buffer",i.buffer).then(function(t){var e=i.byteLength||0,n=i.byteOffset||0;return t.slice(n,n+e)})}loadAccessor(t){const v=this,g=this.json,y=this.json.accessors[t];if(void 0===y.bufferView&&void 0===y.sparse)return Promise.resolve(null);const e=[];return void 0!==y.bufferView?e.push(this.getDependency("bufferView",y.bufferView)):e.push(null),void 0!==y.sparse&&(e.push(this.getDependency("bufferView",y.sparse.indices.bufferView)),e.push(this.getDependency("bufferView",y.sparse.values.bufferView))),Promise.all(e).then(function(t){var e=t[0],n=vu[y.type];const i=pu[y.componentType];var r=i.BYTES_PER_ELEMENT,s=r*n,o=y.byteOffset||0,a=void 0!==y.bufferView?g.bufferViews[y.bufferView].byteStride:void 0,l=!0===y.normalized;let h,c;if(a&&a!==s){var u=Math.floor(o/a),s="InterleavedBuffer:"+y.bufferView+":"+y.componentType+":"+u+":"+y.count;let t=v.cache.get(s);t||(h=new i(e,u*a,y.count*a/r),t=new $o(h,a/r),v.cache.add(s,t)),c=new ea(t,n,o%a/r,l)}else h=null===e?new i(y.count*n):new i(e,o,y.count*n),c=new vi(h,n,l);if(void 0!==y.sparse){r=vu.SCALAR;const f=pu[y.sparse.indices.componentType];var o=y.sparse.indices.byteOffset||0,l=y.sparse.values.byteOffset||0,d=new f(t[1],o,y.sparse.count*r),p=new i(t[2],l,y.sparse.count*n);null!==e&&(c=new vi(c.array.slice(),c.itemSize,c.normalized));for(let t=0,e=d.length;t<e;t++){var m=d[t];if(c.setX(m,p[t*n]),2<=n&&c.setY(m,p[t*n+1]),3<=n&&c.setZ(m,p[t*n+2]),4<=n&&c.setW(m,p[t*n+3]),5<=n)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return c})}loadTexture(t){var e=this.json;const n=this.options;var i=e.textures[t],e=e.images[i.source];let r=this.textureLoader;return!e.uri||null!==(i=n.manager.getHandler(e.uri))&&(r=i),this.loadTextureImage(t,e,r)}loadTextureImage(n,i,r){const s=this,o=this.json,a=this.options,l=o.textures[n];var t=(i.uri||i.bufferView)+":"+l.sampler;if(this.textureCache[t])return this.textureCache[t];const h=self.URL||self.webkitURL;let c=i.uri||"",u=!1,d=!0;var e=0<c.search(/\.jpe?g($|\?)/i)||0===c.search(/^data\:image\/jpeg/);if("image/jpeg"!==i.mimeType&&!e||(d=!1),void 0!==i.bufferView)c=s.getDependency("bufferView",i.bufferView).then(function(t){var e;"image/png"===i.mimeType&&(e=new DataView(t,25,1).getUint8(0,!1),d=6===e||4===e||3===e),u=!0;t=new Blob([t],{type:i.mimeType});return c=h.createObjectURL(t),c});else if(void 0===i.uri)throw new Error("THREE.GLTFLoader: Image "+n+" is missing URI and bufferView");e=Promise.resolve(c).then(function(i){return new Promise(function(n,t){let e=n;!0===r.isImageBitmapLoader&&(e=function(t){const e=new Fe(t);e.needsUpdate=!0,n(e)}),r.load(bu(i,a.path),e,void 0,t)})}).then(function(t){!0===u&&h.revokeObjectURL(c),t.flipY=!1,l.name&&(t.name=l.name),d||(t.format=Tt);var e=(o.samplers||{})[l.sampler]||{};return t.magFilter=mu[e.magFilter]||W,t.minFilter=mu[e.minFilter]||Bt,t.wrapS=fu[e.wrapS]||O,t.wrapT=fu[e.wrapT]||O,s.associations.set(t,{type:"textures",index:n}),t}).catch(function(){return console.error("THREE.GLTFLoader: Couldn't load texture",c),null});return this.textureCache[t]=e}assignTexture(i,r,s){const o=this;return this.getDependency("texture",s.index).then(function(t){var e,n;return void 0===s.texCoord||0==s.texCoord||"aoMap"===r&&1==s.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+s.texCoord+" for texture "+r+" not yet supported."),!o.extensions[Gc.KHR_TEXTURE_TRANSFORM]||(e=void 0!==s.extensions?s.extensions[Gc.KHR_TEXTURE_TRANSFORM]:void 0)&&(n=o.associations.get(t),t=o.extensions[Gc.KHR_TEXTURE_TRANSFORM].extendTexture(t,e),o.associations.set(t,n)),i[r]=t})}assignFinalMaterial(t){const e=t.geometry;let n=t.material;var i=void 0!==e.attributes.tangent,r=void 0!==e.attributes.color,s=void 0===e.attributes.normal;if(t.isPoints){var o="PointsMaterial:"+n.uuid;let t=this.cache.get(o);t||(t=new qa,si.prototype.copy.call(t,n),t.color.copy(n.color),t.map=n.map,t.sizeAttenuation=!1,this.cache.add(o,t)),n=t}else if(t.isLine){o="LineBasicMaterial:"+n.uuid;let t=this.cache.get(o);t||(t=new Ba,si.prototype.copy.call(t,n),t.color.copy(n.color),this.cache.add(o,t)),n=t}if(i||r||s){let t="ClonedMaterial:"+n.uuid+":";n.isGLTFSpecularGlossinessMaterial&&(t+="specular-glossiness:"),i&&(t+="vertex-tangents:"),r&&(t+="vertex-colors:"),s&&(t+="flat-shading:");let e=this.cache.get(t);e||(e=n.clone(),r&&(e.vertexColors=!0),s&&(e.flatShading=!0),i&&(e.normalScale&&(e.normalScale.y*=-1),e.clearcoatNormalScale&&(e.clearcoatNormalScale.y*=-1)),this.cache.add(t,e),this.associations.set(e,this.associations.get(n))),n=e}n.aoMap&&void 0===e.attributes.uv2&&void 0!==e.attributes.uv&&e.setAttribute("uv2",e.attributes.uv),t.material=n}getMaterialType(){return dh}loadMaterial(e){const n=this;var t=this.json;const i=this.extensions,r=t.materials[e];let s;const o={};t=r.extensions||{};const a=[];if(t[Gc.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const h=i[Gc.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];s=h.getMaterialType(),a.push(h.extendParams(o,r,n))}else if(t[Gc.KHR_MATERIALS_UNLIT]){const c=i[Gc.KHR_MATERIALS_UNLIT];s=c.getMaterialType(),a.push(c.extendParams(o,r,n))}else{var l=r.pbrMetallicRoughness||{};o.color=new di(1,1,1),o.opacity=1,Array.isArray(l.baseColorFactor)&&(t=l.baseColorFactor,o.color.fromArray(t),o.opacity=t[3]),void 0!==l.baseColorTexture&&a.push(n.assignTexture(o,"map",l.baseColorTexture)),o.metalness=void 0!==l.metallicFactor?l.metallicFactor:1,o.roughness=void 0!==l.roughnessFactor?l.roughnessFactor:1,void 0!==l.metallicRoughnessTexture&&(a.push(n.assignTexture(o,"metalnessMap",l.metallicRoughnessTexture)),a.push(n.assignTexture(o,"roughnessMap",l.metallicRoughnessTexture))),s=this._invokeOne(function(t){return t.getMaterialType&&t.getMaterialType(e)}),a.push(Promise.all(this._invokeAll(function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,o)})))}!0===r.doubleSided&&(o.side=Rt);l=r.alphaMode||_u.OPAQUE;return l===_u.BLEND?(o.transparent=!0,o.depthWrite=!1):(o.format=Tt,o.transparent=!1,l===_u.MASK&&(o.alphaTest=void 0!==r.alphaCutoff?r.alphaCutoff:.5)),void 0!==r.normalTexture&&s!==pi&&(a.push(n.assignTexture(o,"normalMap",r.normalTexture)),o.normalScale=new Ie(1,-1),void 0!==r.normalTexture.scale&&o.normalScale.set(r.normalTexture.scale,-r.normalTexture.scale)),void 0!==r.occlusionTexture&&s!==pi&&(a.push(n.assignTexture(o,"aoMap",r.occlusionTexture)),void 0!==r.occlusionTexture.strength&&(o.aoMapIntensity=r.occlusionTexture.strength)),void 0!==r.emissiveFactor&&s!==pi&&(o.emissive=(new di).fromArray(r.emissiveFactor)),void 0!==r.emissiveTexture&&s!==pi&&a.push(n.assignTexture(o,"emissiveMap",r.emissiveTexture)),Promise.all(a).then(function(){let t;return t=s===ou?i[Gc.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(o):new s(o),r.name&&(t.name=r.name),t.map&&(t.map.encoding=ve),t.emissiveMap&&(t.emissiveMap.encoding=ve),Mu(t,r),n.associations.set(t,{type:"materials",index:e}),r.extensions&&wu(i,t,r),t})}createUniqueName(t){var e=Ac.sanitizeNodeName(t||"");let n=e;for(let t=1;this.nodeNamesUsed[n];++t)n=e+"_"+t;return this.nodeNamesUsed[n]=!0,n}loadGeometries(n){const i=this,r=this.extensions,s=this.primitiveCache;const o=[];for(let t=0,e=n.length;t<e;t++){var a=n[t],l=function(t){var e=t.extensions&&t.extensions[Gc.KHR_DRACO_MESH_COMPRESSION];let n;return n=e?"draco:"+e.bufferView+":"+e.indices+":"+Su(e.attributes):t.indices+":"+Su(t.attributes)+":"+t.mode,n}(a),h=s[l];if(h)o.push(h.promise);else{let t;t=a.extensions&&a.extensions[Gc.KHR_DRACO_MESH_COMPRESSION]?function(e){return r[Gc.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,i).then(function(t){return Au(t,e,i)})}(a):Au(new Ci,a,i),s[l]={primitive:a,promise:t},o.push(t)}}return Promise.all(o)}loadMesh(h){const c=this;var t=this.json;const u=this.extensions,d=t.meshes[h],p=d.primitives,n=[];for(let t=0,e=p.length;t<e;t++){var i=void 0===p[t].material?(void 0===(i=this.cache).DefaultMaterial&&(i.DefaultMaterial=new dh({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Pt})),i.DefaultMaterial):this.getDependency("material",p[t].material);n.push(i)}return n.push(c.loadGeometries(p)),Promise.all(n).then(function(t){var n=t.slice(0,t.length-1),i=t[t.length-1];const r=[];for(let e=0,t=i.length;e<t;e++){var s=i[e],o=p[e];let t;var a=n[e];if(o.mode===du.TRIANGLES||o.mode===du.TRIANGLE_STRIP||o.mode===du.TRIANGLE_FAN||void 0===o.mode)t=new(!0===d.isSkinnedMesh?Ma:qi)(s,a),!0!==t.isSkinnedMesh||t.geometry.attributes.skinWeight.normalized||t.normalizeSkinWeights(),o.mode===du.TRIANGLE_STRIP?t.geometry=Cu(t.geometry,1):o.mode===du.TRIANGLE_FAN&&(t.geometry=Cu(t.geometry,2));else if(o.mode===du.LINES)t=new Ga(s,a);else if(o.mode===du.LINE_STRIP)t=new Ua(s,a);else if(o.mode===du.LINE_LOOP)t=new ja(s,a);else{if(o.mode!==du.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+o.mode);t=new Ja(s,a)}0<Object.keys(t.geometry.morphAttributes).length&&function(n,i){if(n.updateMorphTargets(),void 0!==i.weights)for(let t=0,e=i.weights.length;t<e;t++)n.morphTargetInfluences[t]=i.weights[t];if(i.extras&&Array.isArray(i.extras.targetNames)){var r=i.extras.targetNames;if(n.morphTargetInfluences.length===r.length){n.morphTargetDictionary={};for(let t=0,e=r.length;t<e;t++)n.morphTargetDictionary[r[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}(t,d),t.name=c.createUniqueName(d.name||"mesh_"+h),Mu(t,d),o.extensions&&wu(u,t,o),c.assignFinalMaterial(t),r.push(t)}if(1===r.length)return r[0];const l=new Go;for(let t=0,e=r.length;t<e;t++)l.add(r[t]);return l})}loadCamera(t){let e;var n=this.json.cameras[t],t=n[n.type];if(t)return"perspective"===n.type?e=new tr(Re.radToDeg(t.yfov),t.aspectRatio||1,t.znear||1,t.zfar||2e6):"orthographic"===n.type&&(e=new Mr(-t.xmag,t.xmag,t.ymag,-t.ymag,t.znear,t.zfar)),n.name&&(e.name=this.createUniqueName(n.name)),Mu(e,n),Promise.resolve(e);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(t){t=this.json.skins[t];const e={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(e):this.getDependency("accessor",t.inverseBindMatrices).then(function(t){return e.inverseBindMatrices=t,e})}loadAnimation(e){const x=this.json.animations[e],n=[],i=[],r=[],s=[],o=[];for(let t=0,e=x.channels.length;t<e;t++){var a=x.channels[t],l=x.samplers[a.sampler],h=a.target,c=void 0!==h.node?h.node:h.id,u=void 0!==x.parameters?x.parameters[l.input]:l.input,a=void 0!==x.parameters?x.parameters[l.output]:l.output;n.push(this.getDependency("node",c)),i.push(this.getDependency("accessor",u)),r.push(this.getDependency("accessor",a)),s.push(l),o.push(h)}return Promise.all([Promise.all(n),Promise.all(i),Promise.all(r),Promise.all(s),Promise.all(o)]).then(function(t){var n=t[0],i=t[1],r=t[2],s=t[3],o=t[4];const a=[];for(let t=0,e=n.length;t<e;t++){const f=n[t];var l=i[t],h=r[t],c=s[t],u=o[t];if(void 0!==f){f.updateMatrix(),f.matrixAutoUpdate=!0;let n;switch(yu[u.path]){case yu.weights:n=Ch;break;case yu.rotation:n=Lh;break;case yu.position:case yu.scale:default:n=Ih}var d=f.name||f.uuid,p=void 0!==c.interpolation?xu[c.interpolation]:2301;const v=[];yu[u.path]===yu.weights?f.traverse(function(t){!0===t.isMesh&&t.morphTargetInfluences&&v.push(t.name||t.uuid)}):v.push(d);let i=h.array;if(h.normalized){var m=Eu(i.constructor);const g=new Float32Array(i.length);for(let t=0,e=i.length;t<e;t++)g[t]=i[t]*m;i=g}for(let t=0,e=v.length;t<e;t++){const y=new n(v[t]+"."+yu[u.path],l.array,i,p);"CUBICSPLINE"===c.interpolation&&(y.createInterpolant=function(t){const e=this instanceof Lh?uu:hu;return new e(this.times,this.values,this.getValueSize()/3,t)},y.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),a.push(y)}}}t=x.name||"animation_"+e;return new zh(t,void 0,a)})}createNodeMesh(t){var e=this.json;const n=this,i=e.nodes[t];return void 0===i.mesh?null:n.getDependency("mesh",i.mesh).then(function(t){const e=n._getNodeRef(n.meshCache,i.mesh,t);return void 0!==i.weights&&e.traverse(function(n){if(n.isMesh)for(let t=0,e=i.weights.length;t<e;t++)n.morphTargetInfluences[t]=i.weights[t]}),e})}loadNode(r){var t=this.json;const e=this.extensions,s=this,o=t.nodes[r],a=o.name?s.createUniqueName(o.name):"";return function(){const e=[];var t=s._invokeOne(function(t){return t.createNodeMesh&&t.createNodeMesh(r)});return t&&e.push(t),void 0!==o.camera&&e.push(s.getDependency("camera",o.camera).then(function(t){return s._getNodeRef(s.cameraCache,o.camera,t)})),s._invokeAll(function(t){return t.createNodeAttachment&&t.createNodeAttachment(r)}).forEach(function(t){e.push(t)}),Promise.all(e)}().then(function(n){let i;if(i=!0===o.isBone?new Sa:1<n.length?new Go:1===n.length?n[0]:new qn,i!==n[0])for(let t=0,e=n.length;t<e;t++)i.add(n[t]);if(o.name&&(i.userData.name=o.name,i.name=a),Mu(i,o),o.extensions&&wu(e,i,o),void 0!==o.matrix){const t=new bn;t.fromArray(o.matrix),i.applyMatrix4(t)}else void 0!==o.translation&&i.position.fromArray(o.translation),void 0!==o.rotation&&i.quaternion.fromArray(o.rotation),void 0!==o.scale&&i.scale.fromArray(o.scale);return s.associations.set(i,{type:"nodes",index:r}),i})}loadScene(t){var n=this.json,e=this.extensions,t=this.json.scenes[t];const i=new Go;t.name&&(i.name=this.createUniqueName(t.name)),Mu(i,t),t.extensions&&wu(e,i,t);var r=t.nodes||[];const s=[];for(let t=0,e=r.length;t<e;t++)s.push(function o(t,e,a,l){const h=a.nodes[t];return l.getDependency("node",t).then(function(t){if(void 0===h.skin)return t;let a;return l.getDependency("skin",h.skin).then(function(t){a=t;const n=[];for(let t=0,e=a.joints.length;t<e;t++)n.push(l.getDependency("node",a.joints[t]));return Promise.all(n)}).then(function(o){return t.traverse(function(t){if(t.isMesh){const n=[],i=[];for(let t=0,e=o.length;t<e;t++){const r=o[t];if(r){n.push(r);const s=new bn;void 0!==a.inverseBindMatrices&&s.fromArray(a.inverseBindMatrices.array,16*t),i.push(s)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',a.joints[t])}t.bind(new Ca(n,i),t.matrixWorld)}}),t})}).then(function(n){e.add(n);const i=[];if(h.children){const r=h.children;for(let t=0,e=r.length;t<e;t++){const s=r[t];i.push(o(s,n,a,l))}}return Promise.all(i)})}(r[t],i,n,this));return Promise.all(s).then(function(){return i})}}function Au(n,t,i){var e,r=t.attributes;const s=[];for(const a in r){var o=gu[a]||a.toLowerCase();o in n.attributes||s.push(function(t,e){return i.getDependency("accessor",t).then(function(t){n.setAttribute(e,t)})}(r[a],o))}return void 0===t.indices||n.index||(e=i.getDependency("accessor",t.indices).then(function(t){n.setIndex(t)}),s.push(e)),Mu(n,t),function(t,e,n){var i=e.attributes;const r=new qe;if(void 0!==i.POSITION){var s=n.json.accessors[i.POSITION],o=s.min,i=s.max;if(void 0!==o&&void 0!==i){r.set(new We(o[0],o[1],o[2]),new We(i[0],i[1],i[2])),s.normalized&&(s=Eu(pu[s.componentType]),r.min.multiplyScalar(s),r.max.multiplyScalar(s));var a=e.targets;if(void 0!==a){const d=new We,p=new We;for(let t=0,e=a.length;t<e;t++){var l,h,c=a[t];void 0!==c.POSITION&&(l=(h=n.json.accessors[c.POSITION]).min,c=h.max,void 0!==l&&void 0!==c?(p.setX(Math.max(Math.abs(l[0]),Math.abs(c[0]))),p.setY(Math.max(Math.abs(l[1]),Math.abs(c[1]))),p.setZ(Math.max(Math.abs(l[2]),Math.abs(c[2]))),h.normalized&&(h=Eu(pu[h.componentType]),p.multiplyScalar(h)),d.max(p)):console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION."))}r.expandByVector(d)}t.boundingBox=r;const u=new dn;r.getCenter(u.center),u.radius=r.min.distanceTo(r.max)/2,t.boundingSphere=u}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}(n,t,i),Promise.all(s).then(function(){return void 0!==t.targets?function(n,i,r){let s=!1,o=!1;for(let t=0,e=i.length;t<e;t++){var a=i[t];if(void 0!==a.POSITION&&(s=!0),void 0!==a.NORMAL&&(o=!0),s&&o)break}if(!s&&!o)return Promise.resolve(n);const l=[],h=[];for(let t=0,e=i.length;t<e;t++){var c,u=i[t];s&&(c=void 0!==u.POSITION?r.getDependency("accessor",u.POSITION):n.attributes.position,l.push(c)),o&&(u=void 0!==u.NORMAL?r.getDependency("accessor",u.NORMAL):n.attributes.normal,h.push(u))}return Promise.all([Promise.all(l),Promise.all(h)]).then(function(t){var e=t[0],t=t[1];return s&&(n.morphAttributes.position=e),o&&(n.morphAttributes.normal=t),n.morphTargetsRelative=!0,n})}(n,t.targets,i):n})}function Cu(t,e){let n=t.getIndex();if(null===n){const a=[];var i=t.getAttribute("position");if(void 0===i)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),t;for(let t=0;t<i.count;t++)a.push(t);t.setIndex(a),n=t.getIndex()}var r=n.count-2;const s=[];if(2===e)for(let t=1;t<=r;t++)s.push(n.getX(0)),s.push(n.getX(t)),s.push(n.getX(t+1));else for(let t=0;t<r;t++)t%2==0?(s.push(n.getX(t)),s.push(n.getX(t+1)),s.push(n.getX(t+2))):(s.push(n.getX(t+2)),s.push(n.getX(t+1)),s.push(n.getX(t)));s.length/3!=r&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const o=t.clone();return o.setIndex(s),o}const Pu=new WeakMap;class Lu extends Fh{constructor(t){super(t),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(t){return this.decoderPath=t,this}setDecoderConfig(t){return this.decoderConfig=t,this}setWorkerLimit(t){return this.workerLimit=t,this}load(t,n,e,i){const r=new Oh(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(t,t=>{var e={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(t,e).then(n).catch(i)},e,i)}decodeDracoFile(t,e,n,i){n={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:i||this.defaultAttributeTypes,useUniqueIDs:!!n};this.decodeGeometry(t,n).then(e)}decodeGeometry(n,i){for(const l in i.attributeTypes){var t=i.attributeTypes[l];void 0!==t.BYTES_PER_ELEMENT&&(i.attributeTypes[l]=t.name)}var e=JSON.stringify(i);if(Pu.has(n)){var r=Pu.get(n);if(r.key===e)return r.promise;if(0===n.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let s;const o=this.workerNextTaskID++;r=n.byteLength;const a=this._getWorker(o,r).then(t=>(s=t,new Promise((t,e)=>{s._callbacks[o]={resolve:t,reject:e},s.postMessage({type:"decode",id:o,taskConfig:i,buffer:n},[n])}))).then(t=>this._createGeometry(t.geometry));return a.catch(()=>!0).then(()=>{s&&o&&this._releaseTask(s,o)}),Pu.set(n,{key:e,promise:a}),a}_createGeometry(e){const n=new Ci;e.index&&n.setIndex(new vi(e.index.array,1));for(let t=0;t<e.attributes.length;t++){var i=e.attributes[t],r=i.name,s=i.array,i=i.itemSize;n.setAttribute(r,new vi(s,i))}return n}_loadLibrary(n,t){const i=new Oh(this.manager);return i.setPath(this.decoderPath),i.setResponseType(t),i.setWithCredentials(this.withCredentials),new Promise((t,e)=>{i.load(n,t,void 0,e)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const i="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,t=[];return i?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(t=>{const e=t[0];i||(this.decoderConfig.wasmBinary=t[1]);const n=function(){let n,e;function l(n,i,t,r){var s=r.attributeIDs,o=r.attributeTypes;let a,e;var l=i.GetEncodedGeometryType(t);if(l===n.TRIANGULAR_MESH)a=new n.Mesh,e=i.DecodeBufferToMesh(t,a);else{if(l!==n.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");a=new n.PointCloud,e=i.DecodeBufferToPointCloud(t,a)}if(!e.ok()||0===a.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+e.error_msg());const h={index:null,attributes:[]};for(const u in s){var c=self[o[u]];let t,e;if(r.useUniqueIDs)e=s[u],t=i.GetAttributeByUniqueId(a,e);else{if(e=i.GetAttributeId(a,n[s[u]]),-1===e)continue;t=i.GetAttribute(a,e)}h.attributes.push(function(t,e,n,i,r,s){var o=s.num_components(),a=n.num_points(),l=a*o,h=l*r.BYTES_PER_ELEMENT,c=function(t,e){switch(e){case Float32Array:return t.DT_FLOAT32;case Int8Array:return t.DT_INT8;case Int16Array:return t.DT_INT16;case Int32Array:return t.DT_INT32;case Uint8Array:return t.DT_UINT8;case Uint16Array:return t.DT_UINT16;case Uint32Array:return t.DT_UINT32}}(t,r),a=t._malloc(h);e.GetAttributeDataArrayForAllPoints(n,s,c,h,a);l=new r(t.HEAPF32.buffer,a,l).slice();return t._free(a),{name:i,array:l,itemSize:o}}(n,i,a,u,c,t))}return l===n.TRIANGULAR_MESH&&(h.index=function(t,e,n){var i=n.num_faces(),r=3*i,s=4*r,i=t._malloc(s);e.GetTrianglesUInt32Array(n,s,i);r=new Uint32Array(t.HEAPF32.buffer,i,r).slice();return t._free(i),{array:r,itemSize:1}}(n,i,a)),n.destroy(a),h}onmessage=function(t){const s=t.data;switch(s.type){case"init":n=s.decoderConfig,e=new Promise(function(e){n.onModuleLoaded=function(t){e({draco:t})},DracoDecoderModule(n)});break;case"decode":const o=s.buffer,a=s.taskConfig;e.then(t=>{const e=t.draco;t=new e.Decoder;const n=new e.DecoderBuffer;n.Init(new Int8Array(o),o.byteLength);try{const i=l(e,t,n,a),r=i.attributes.map(t=>t.array.buffer);i.index&&r.push(i.index.array.buffer),self.postMessage({type:"decode",id:s.id,geometry:i},r)}catch(t){console.error(t),self.postMessage({type:"error",id:s.id,error:t.message})}finally{e.destroy(n),e.destroy(t)}})}}}.toString();t=["/* draco decoder */",e,"","/* worker */",n.substring(n.indexOf("{")+1,n.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([t]))}),this.decoderPending}_getWorker(t,e){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const n=new Worker(this.workerSourceURL);n._callbacks={},n._taskCosts={},n._taskLoad=0,n.postMessage({type:"init",decoderConfig:this.decoderConfig}),n.onmessage=function(t){var e=t.data;switch(e.type){case"decode":n._callbacks[e.id].resolve(e);break;case"error":n._callbacks[e.id].reject(e);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+e.type+'"')}},this.workerPool.push(n)}else this.workerPool.sort(function(t,e){return t._taskLoad>e._taskLoad?-1:1});const n=this.workerPool[this.workerPool.length-1];return n._taskCosts[t]=e,n._taskLoad+=e,n})}_releaseTask(t,e){t._taskLoad-=t._taskCosts[e],delete t._callbacks[e],delete t._taskCosts[e]}debug(){console.log("Task load: ",this.workerPool.map(t=>t._taskLoad))}dispose(){for(let t=0;t<this.workerPool.length;++t)this.workerPool[t].terminate();return this.workerPool.length=0,this}}var Ru=fv(466),Iu=fv(498);function zu(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Nu(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}
/*!
 * GSAP 3.7.1
 * https://greensock.com
 *
 * @license Copyright 2008-2021, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for
 * Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/function Bu(t){return!1!==t}function Du(){return"undefined"!=typeof window}function Fu(t){return ap(t)||op(t)}function ku(t){return(bp=Xu(t,_p))&&Um}function Ou(t,e){return!e&&console.warn(t)}function Vu(t,e){return t&&(_p[t]=e)&&bp&&(bp[t]=e)||_p}function Uu(){return 0}function Hu(t,e){return(t=t.split(",")).forEach(e)||t}function Wu(t,e,n,i){Sp.length&&Bp(),t.render(e,n,i),Sp.length&&Bp()}function Gu(t){return t}function ju(t,e){for(var n in e)n in t||(t[n]=e[n]);return t}function qu(t,e){for(var n in e)n in t||"duration"===n||"ease"===n||(t[n]=e[n])}function Xu(t,e){for(var n in e)t[n]=e[n];return t}function Yu(t,e){for(var n in e)"__proto__"!==n&&"constructor"!==n&&"prototype"!==n&&(t[n]=cp(e[n])?Yu(t[n]||(t[n]={}),e[n]):e[n]);return t}function Zu(t,e){var n,i={};for(n in t)n in e||(i[n]=t[n]);return i}function Ku(t){var e=t.parent||Cd,n=t.keyframes?qu:ju;if(Bu(t.inherit))for(;e;)n(t,e.vars.defaults),e=e.parent||e._dp;return t}function Ju(t,e){!t.parent||e&&!t.parent.autoRemoveChildren||t.parent.remove(t),t._act=0}function Qu(t){return!t||t._ts&&Qu(t.parent)}function $u(t){return t._repeat?td(t._tTime,t=t.duration()+t._rDelay)*t:0}function td(t,e){return e=Math.floor(t/=e),t&&e===t?e-1:e}function ed(t,e){return(t-e._start)*e._ts+(0<=e._ts?0:e._dirty?e.totalDuration():e._tDur)}function nd(t,e){var n;if((e._time||e._initted&&!e._dur)&&(n=ed(t.rawTime(),e),(!e._dur||dd(0,e.totalDuration(),n)-e._tTime>$d)&&e.render(n,!0)),kp(t,e)._dp&&t._initted&&t._time>=t._dur&&t._ts){if(t._dur<t.duration())for(n=t;n._dp;)0<=n.rawTime()&&n.totalTime(n._tTime),n=n._dp;t._zTime=-$d}}function id(t,e,n,i){return e.parent&&Ju(e),e._start=Np((lp(n)?n:n||t!==Cd?cd(t,n,e):t._time)+e._delay),e._end=Np(e._start+(e.totalDuration()/Math.abs(e.timeScale())||0)),function(t,e,n,i,r){void 0===n&&(n="_first");var s,o=t[i=void 0===i?"_last":i];if(r)for(s=e[r];o&&o[r]>s;)o=o._prev;o?(e._next=o._next,o._next=e):(e._next=t[n],t[n]=e),e._next?e._next._prev=e:t[i]=e,e._prev=o,e.parent=e._dp=t}(t,e,"_first","_last",t._sort?"_start":0),ad(e)||(t._recent=e),i||nd(t,e),t}function rd(t,e){return(_p.ScrollTrigger||wp("scrollTrigger",e))&&_p.ScrollTrigger.create(e,t)}function sd(t,e,n,i){return xm(t,e),t._initted?!n&&t._pt&&(t._dur&&!1!==t.vars.lazy||!t._dur&&t.vars.lazy)&&zd!==em.frame?(Sp.push(t),t._lazy=[e,i]):void 0:1}function od(t){return(t=t.parent)&&t._ts&&t._initted&&!t._lock&&(t.rawTime()<0||od(t))}function ad(t){return"isFromStart"===(t=t.data)||"isStart"===t}function ld(t,e,n,i){var r=t._repeat,s=Np(e)||0;return(e=t._tTime/t._tDur)&&!i&&(t._time*=s/t._dur),t._dur=s,t._tDur=r?r<0?1e10:Np(s*(r+1)+t._rDelay*r):s,e&&!i?Vp(t,t._tTime=t._tDur*e):t.parent&&Op(t),n||kp(t.parent,t),t}function hd(t){return t instanceof mm?kp(t):ld(t,t._dur)}function cd(t,e,n){var i,r,s,o=t.labels,a=t._recent||Up,l=t.duration()>=Qd?a.endTime(!1):t._dur;return op(e)&&(isNaN(e)||e in o)?(r=e.charAt(0),s="%"===e.substr(-1),i=e.indexOf("="),"<"===r||">"===r?(0<=i&&(e=e.replace(/=/,"")),("<"===r?a._start:a.endTime(0<=a._repeat))+(parseFloat(e.substr(1))||0)*(s?(i<0?a:n).totalDuration()/100:1)):i<0?(e in o||(o[e]=l),o[e]):(r=parseFloat(e.charAt(i-1)+e.substr(i+1)),s&&n&&(r=r/100*(dp(n)?n[0]:n).totalDuration()),1<i?cd(t,e.substr(0,i-1),n)+r:l+r)):null==e?l:+e}function ud(t,e,n){var i,r,s=lp(e[1]),o=(s?2:1)+(t<2?0:1),a=e[o];if(s&&(a.duration=e[1]),a.parent=n,t){for(i=a,r=n;r&&!("immediateRender"in i);)i=r.vars.defaults||{},r=Bu(r.vars.inherit)&&r.parent;a.immediateRender=Bu(i.immediateRender),t<2?a.runBackwards=1:a.startAt=e[o-1]}return new Mm(e[0],a,e[1+o])}function dd(t,e,n){return n<t?t:e<n?e:n}function pd(t){if(ap(t))return t;var p=cp(t)?t:{each:t},m=hm(p.ease),f=p.from||0,v=parseFloat(p.base)||0,g={},t=0<f&&f<1,y=isNaN(f)||t,x=p.axis,_=f,b=f;return op(f)?_=b={center:.5,edges:.5,end:1}[f]||0:!t&&y&&(_=f[0],b=f[1]),function(t,e,n){var i,r,s,o,a,l,h,c,u=(n||p).length,d=g[u];if(!d){if(!(c="auto"===p.grid?0:(p.grid||[1,Qd])[1])){for(l=-Qd;l<(l=n[c++].getBoundingClientRect().left)&&c<u;);c--}for(d=g[u]=[],i=y?Math.min(c,u)*_-.5:f%c,r=y?u*b/c-.5:f/c|0,h=Qd,a=l=0;a<u;a++)s=a%c-i,o=r-(a/c|0),d[a]=o=x?Math.abs("y"===x?o:s):ip(s*s+o*o),l<o&&(l=o),o<h&&(h=o);"random"===f&&Xp(d),d.max=l-h,d.min=h,d.v=u=(parseFloat(p.amount)||parseFloat(p.each)*(u<c?u-1:x?"y"===x?u/c:c:Math.max(c,u/c))||0)*("edges"===f?-1:1),d.b=u<0?v-u:v,d.u=Wp(p.amount||p.each)||0,m=m&&u<0?lm(m):m}return u=(d[t]-d.min)/d.max||0,Np(d.b+(m?m(u):u)*d.v)+d.u}}function md(n){var i=n<1?Math.pow(10,(n+"").length-2):1;return function(t){var e=Math.round(parseFloat(t)/n)*n*i;return(e-e%1)/i+(lp(t)?0:Wp(t))}}function fd(t,e,n,i){return Hp(dp(t)?!e:!0===n?!!(n=0):!i,function(){return dp(t)?t[~~(Math.random()*t.length)]:(n=n||1e-5)&&(i=n<1?Math.pow(10,(n+"").length-2):1)&&Math.floor(Math.round((t-n/2+Math.random()*(e-t+.99*n))/n)*n*i)/i})}function vd(e,n,t){return Hp(t,function(t){return e[~~n(t)]})}function gd(e,t,n,i,r){var s=t-e,o=i-n;return Hp(r,function(t){return n+((t-e)/s*o||0)})}function yd(t,e,n){var i,r,s,o=t.labels,a=Qd;for(i in o)(r=o[i]-e)<0==!!n&&r&&a>(r=Math.abs(r))&&(s=i,a=r);return s}function xd(t,e,n){var i=t.vars,r=i[e];return r&&(e=i[e+"Params"],t=i.callbackScope||t,n&&Sp.length&&Bp(),e?r.apply(t,e):r.call(t))}function _d(t){return Ju(t),t.scrollTrigger&&t.scrollTrigger.kill(!1),t.progress()<1&&xd(t,"onInterrupt"),t}function bd(t,e,n){return(6*(t=t<0?t+1:1<t?t-1:t)<1?e+(n-e)*t*6:t<.5?n:3*t<2?e+(n-e)*(2/3-t)*6:e)*Zp+.5|0}function wd(t,e,n){var i,r,s,o,a="",l=(t+a).match($p),h=e?"hsla(":"rgba(",c=0;if(!l)return t;if(l=l.map(function(t){return(t=Jp(t,e,1))&&h+(e?t[0]+","+t[1]+"%,"+t[2]+"%,"+t[3]:t.join(","))+")"}),n&&(s=Qp(t),(i=n.c).join(a)!==s.c.join(a)))for(o=(r=t.replace($p,"1").split(fp)).length-1;c<o;c++)a+=r[c]+(~i.indexOf(c)?l.shift()||h+"0,0,0,0)":(s.length?s:l.length?l:n).shift());if(!r)for(o=(r=t.split($p)).length-1;c<o;c++)a+=r[c]+l[c];return a+r[o]}function Md(t){var e=t.join(" ");if($p.lastIndex=0,$p.test(e))return e=tm.test(e),t[1]=wd(t[1],e),t[0]=wd(t[0],e,Qp(t[1])),!0}function Sd(t,e){for(var n,i=t._first;i;)i instanceof mm?Sd(i,e):!i.vars.yoyoEase||i._yoyo&&i._repeat||i._yoyo===e||(i.timeline?Sd(i.timeline,e):(n=i._ease,i._ease=i._yEase,i._yEase=n,i._yoyo=e)),i=i._next}function Ed(t,e,n,i){void 0===n&&(n=function(t){return 1-e(1-t)}),void 0===i&&(i=function(t){return t<.5?e(2*t)/2:1-e(2*(1-t))/2});var r,s={easeIn:e,easeOut:n,easeInOut:i};return Hu(t,function(t){for(var e in im[t]=_p[t]=s,im[r=t.toLowerCase()]=n,s)im[r+("easeIn"===e?".in":"easeOut"===e?".out":".inOut")]=im[t+"."+e]=s[e]}),1}function Td(e){return function(t){return t<.5?(1-e(1-2*t))/2:.5+e(2*(t-.5))/2}}var Ad,Cd,Pd,Ld,Rd,Id,zd,Nd,Bd,Dd,Fd,kd,Od,Vd,Ud,Hd,Wd,Gd,jd,qd,Xd,Yd,Zd,Kd={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},Jd={duration:.5,overwrite:!1,delay:0},Qd=1e8,$d=1/Qd,tp=2*Math.PI,ep=tp/4,np=0,ip=Math.sqrt,rp=Math.cos,sp=Math.sin,op=function(t){return"string"==typeof t},ap=function(t){return"function"==typeof t},lp=function(t){return"number"==typeof t},hp=function(t){return void 0===t},cp=function(t){return"object"==typeof t},up="function"==typeof ArrayBuffer&&ArrayBuffer.isView||function(){},dp=Array.isArray,pp=/(?:-?\.?\d|\.)+/gi,mp=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,fp=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,vp=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,gp=/[+-]=-?[.\d]+/,yp=/[^,'"\[\]\s]+/gi,xp=/[\d.+\-=]+(?:e[-+]\d*)*/i,_p={},bp={},wp=function(t,e){return console.warn("Invalid property",t,"set to",e,"Missing plugin? gsap.registerPlugin()")},Mp={},Sp=[],Ep={},Tp={},Ap={},Cp=30,Pp=[],Lp="",Rp=function(t){var e,n,i=t[0];if(cp(i)||ap(i)||(t=[t]),!(e=(i._gsap||{}).harness)){for(n=Pp.length;n--&&!Pp[n].targetTest(i););e=Pp[n]}for(n=t.length;n--;)t[n]&&(t[n]._gsap||(t[n]._gsap=new dm(t[n],e)))||t.splice(n,1);return t},Ip=function(t){return t._gsap||Rp(qp(t))[0]._gsap},zp=function(t,e,n){return(n=t[e])&&ap(n)?t[e]():hp(n)&&t.getAttribute&&t.getAttribute(e)||n},Np=function(t){return Math.round(1e5*t)/1e5||0},Bp=function(){var t,e,n=Sp.length,i=Sp.slice(0);for(Ep={},t=Sp.length=0;t<n;t++)(e=i[t])&&e._lazy&&(e.render(e._lazy[0],e._lazy[1],!0)._lazy=0)},Dp=function(t){var e=parseFloat(t);return(e||0===e)&&(t+"").match(yp).length<2?e:op(t)?t.trim():t},Fp=function(t,e,n,i){void 0===n&&(n="_first"),void 0===i&&(i="_last");var r=e._prev,s=e._next;r?r._next=s:t[n]===e&&(t[n]=s),s?s._prev=r:t[i]===e&&(t[i]=r),e._next=e._prev=e.parent=null},kp=function(t,e){if(t&&(!e||e._end>t._dur||e._start<0))for(var n=t;n;)n._dirty=1,n=n.parent;return t},Op=function(t){return t._end=Np(t._start+(t._tDur/Math.abs(t._ts||t._rts||$d)||0))},Vp=function(t,e){var n=t._dp;return n&&n.smoothChildTiming&&t._ts&&(t._start=Np(n._time-(0<t._ts?e/t._ts:((t._dirty?t.totalDuration():t._tDur)-e)/-t._ts)),Op(t),n._dirty||kp(n,t)),t},Up={_start:0,endTime:Uu,totalDuration:Uu},Hp=function(t,e){return t||0===t?e(t):e},Wp=function(t){if("string"!=typeof t)return"";var e=xp.exec(t);return e?t.substr(e.index+e[0].length):""},Gp=[].slice,jp=function(t,e){return t&&cp(t)&&"length"in t&&(!e&&!t.length||t.length-1 in t&&cp(t[0]))&&!t.nodeType&&t!==Pd},qp=function(t,e,n){return!op(t)||n||!Ld&&nm()?dp(t)?(i=n,void 0===r&&(r=[]),t.forEach(function(t){return op(t)&&!i||jp(t,1)?r.push.apply(r,qp(t)):r.push(t)})||r):jp(t)?Gp.call(t,0):t?[t]:[]:Gp.call((e||Rd).querySelectorAll(t),0);var i,r},Xp=function(t){return t.sort(function(){return.5-Math.random()})},Mc=function(l,t){var h,c,e=dp(l);return!e&&cp(l)&&(h=e=l.radius||Qd,l.values?(l=qp(l.values),(c=!lp(l[0]))&&(h*=h)):l=md(l.increment)),Hp(t,e?ap(l)?function(t){return c=l(t),Math.abs(c-t)<=h?c:t}:function(t){for(var e,n,i=parseFloat(c?t.x:t),r=parseFloat(c?t.y:0),s=Qd,o=0,a=l.length;a--;)(e=c?(e=l[a].x-i)*e+(n=l[a].y-r)*n:Math.abs(l[a]-i))<s&&(s=e,o=a);return o=!h||s<=h?l[o]:t,c||o===t||lp(t)?o:o+Wp(t)}:md(l))},wc=function t(e,n,i){var r=n-e;return dp(e)?vd(e,t(0,e.length),n):Hp(i,function(t){return(r+(t-e)%r)%r+e})},Sc=function t(e,n,i){var r=n-e,s=2*r;return dp(e)?vd(e,t(0,e.length-1),n):Hp(i,function(t){return e+(r<(t=(s+(t-e)%s)%s||0)?s-t:t)})},Yp=function(t){for(var e,n,i,r,s=0,o="";~(e=t.indexOf("random(",s));)i=t.indexOf(")",e),r="["===t.charAt(e+7),n=t.substr(e+7,i-e-7).match(r?yp:pp),o+=t.substr(s,e-s)+fd(r?n:+n[0],r?0:+n[1],+n[2]||1e-5),s=i+1;return o+t.substr(s,t.length-s)},Br=function t(e,n,i,r){var s=isNaN(e+n)?0:function(t){return(1-t)*e+t*n};if(!s){var o,a,l,h,c,u=op(e),d={};if(!0===i&&(r=1)&&(i=null),u)e={p:e},n={p:n};else if(dp(e)&&!dp(n)){for(l=[],h=e.length,c=h-2,a=1;a<h;a++)l.push(t(e[a-1],e[a]));h--,s=function(t){t*=h;var e=Math.min(c,~~t);return l[e](t-e)},i=n}else r||(e=Xu(dp(e)?[]:{},e));if(!l){for(o in n)fm.call(d,e,o,"get",n[o]);s=function(t){return Em(t,d),u?e.p:e}}}return Hp(i,s)},Zp=255,Kp={aqua:[0,Zp,Zp],lime:[0,Zp,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,Zp],navy:[0,0,128],white:[Zp,Zp,Zp],olive:[128,128,0],yellow:[Zp,Zp,0],orange:[Zp,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[Zp,0,0],pink:[Zp,192,203],cyan:[0,Zp,Zp],transparent:[Zp,Zp,Zp,0]},Jp=function(t,e,n){var i,r,s,o,a,l,h,c=t?lp(t)?[t>>16,t>>8&Zp,t&Zp]:0:Kp.black;if(!c){if(","===t.substr(-1)&&(t=t.substr(0,t.length-1)),Kp[t])c=Kp[t];else if("#"===t.charAt(0)){if(9===(t=t.length<6?"#"+(i=t.charAt(1))+i+(r=t.charAt(2))+r+(s=t.charAt(3))+s+(5===t.length?t.charAt(4)+t.charAt(4):""):t).length)return[(c=parseInt(t.substr(1,6),16))>>16,c>>8&Zp,c&Zp,parseInt(t.substr(7),16)/255];c=[(t=parseInt(t.substr(1),16))>>16,t>>8&Zp,t&Zp]}else if("hsl"===t.substr(0,3))if(c=h=t.match(pp),e){if(~t.indexOf("="))return c=t.match(mp),n&&c.length<4&&(c[3]=1),c}else o=+c[0]%360/360,a=+c[1]/100,i=2*(l=+c[2]/100)-(r=l<=.5?l*(a+1):l+a-l*a),3<c.length&&(c[3]*=1),c[0]=bd(o+1/3,i,r),c[1]=bd(o,i,r),c[2]=bd(o-1/3,i,r);else c=t.match(pp)||Kp.transparent;c=c.map(Number)}return e&&!h&&(i=c[0]/Zp,r=c[1]/Zp,s=c[2]/Zp,l=((t=Math.max(i,r,s))+(e=Math.min(i,r,s)))/2,t===e?o=a=0:(h=t-e,a=.5<l?h/(2-t-e):h/(t+e),o=t===i?(r-s)/h+(r<s?6:0):t===r?(s-i)/h+2:(i-r)/h+4,o*=60),c[0]=~~(o+.5),c[1]=~~(100*a+.5),c[2]=~~(100*l+.5)),n&&c.length<4&&(c[3]=1),c},Qp=function(t){var e=[],n=[],i=-1;return t.split($p).forEach(function(t){t=t.match(fp)||[];e.push.apply(e,t),n.push(i+=t.length+1)}),e.c=n,e},$p=function(){var t,e="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b";for(t in Kp)e+="|"+t+"\\b";return new RegExp(e+")","gi")}(),tm=/hsl[a]?\(/,em=(Vd=Date.now,Ud=500,Hd=33,Wd=Vd(),Gd=Wd,qd=jd=1e3/240,Yd={time:0,frame:0,tick:function(){cm(!0)},deltaRatio:function(t){return kd/(1e3/(t||60))},wake:function(){Id&&(!Ld&&Du()&&(Pd=Ld=window,Rd=Pd.document||{},_p.gsap=Um,(Pd.gsapVersions||(Pd.gsapVersions=[])).push(Um.version),ku(bp||Pd.GreenSockGlobals||!Pd.gsap&&Pd||{}),Fd=Pd.requestAnimationFrame),Bd&&Yd.sleep(),Dd=Fd||function(t){return setTimeout(t,qd-1e3*Yd.time+1|0)},Nd=1,cm(2))},sleep:function(){(Fd?Pd.cancelAnimationFrame:clearTimeout)(Bd),Nd=0,Dd=Uu},lagSmoothing:function(t,e){Ud=t||1/$d,Hd=Math.min(e,Ud,0)},fps:function(t){jd=1e3/(t||240),qd=1e3*Yd.time+jd},add:function(t){Xd.indexOf(t)<0&&Xd.push(t),nm()},remove:function(t){~(t=Xd.indexOf(t))&&Xd.splice(t,1)&&t<=Od&&Od--},_listeners:Xd=[]}),nm=function(){return!Nd&&em.wake()},im={},rm=/^[\d.\-M][\d.\-,\s]/,sm=/["']/g,om=function(t){for(var e,n,i,r={},s=t.substr(1,t.length-3).split(":"),o=s[0],a=1,l=s.length;a<l;a++)n=s[a],e=a!==l-1?n.lastIndexOf(","):n.length,i=n.substr(0,e),r[o]=isNaN(i)?i.replace(sm,"").trim():+i,o=n.substr(e+1).trim();return r},am=function(t){var e=t.indexOf("(")+1,n=t.indexOf(")"),i=t.indexOf("(",e);return t.substring(e,~i&&i<n?t.indexOf(")",n+1):n)},lm=function(e){return function(t){return 1-e(1-t)}},hm=function(t,e){return t&&(ap(t)?t:im[t]||(i=((n=t)+"").split("("),(t=im[i[0]])&&1<i.length&&t.config?t.config.apply(null,~n.indexOf("{")?[om(i[1])]:am(n).split(",").map(Dp)):im._CE&&rm.test(n)?im._CE("",n):t))||e;var n,i},Dr=function n(i,t,e){function r(t){return 1===t?1:s*Math.pow(2,-10*t)*sp((t-o)*a)+1}var s=1<=t?t:1,o=(a=(e||(i?.3:.45))/(t<1?t:1))/tp*(Math.asin(1/s)||0),t="out"===i?r:"in"===i?function(t){return 1-r(1-t)}:Td(r),a=tp/a;return t.config=function(t,e){return n(i,t,e)},t},_c=function e(n,i){void 0===i&&(i=1.70158);function r(t){return t?--t*t*((i+1)*t+i)+1:0}var t="out"===n?r:"in"===n?function(t){return 1-r(1-t)}:Td(r);return t.config=function(t){return e(n,t)},t};function cm(t){var e,n,i,r=Vd()-Gd,s=!0===t;if(Ud<r&&(Wd+=r-Hd),(0<(r=(n=(Gd+=r)-Wd)-qd)||s)&&(i=++Yd.frame,kd=n-1e3*Yd.time,Yd.time=n/=1e3,qd+=r+(jd<=r?4:jd-r),e=1),s||(Bd=Dd(cm)),e)for(Od=0;Od<Xd.length;Od++)Xd[Od](n,kd,i,t)}function um(t){return t<1/2.75?Zd*t*t:t<1/2.75*2?Zd*Math.pow(t-1.5/2.75,2)+.75:t<1/2.75*2.5?Zd*(t-=2.25/2.75)*t+.9375:Zd*Math.pow(t-2.625/2.75,2)+.984375}Hu("Linear,Quad,Cubic,Quart,Quint,Strong",function(t,e){var n=e<5?e+1:e;Ed(t+",Power"+(n-1),e?function(t){return Math.pow(t,n)}:function(t){return t},function(t){return 1-Math.pow(1-t,n)},function(t){return t<.5?Math.pow(2*t,n)/2:1-Math.pow(2*(1-t),n)/2})}),im.Linear.easeNone=im.none=im.Linear.easeIn,Ed("Elastic",Dr("in"),Dr("out"),Dr()),Zd=7.5625,Ed("Bounce",function(t){return 1-um(1-t)},um),Ed("Expo",function(t){return t?Math.pow(2,10*(t-1)):0}),Ed("Circ",function(t){return-(ip(1-t*t)-1)}),Ed("Sine",function(t){return 1===t?1:1-rp(t*ep)}),Ed("Back",_c("in"),_c("out"),_c()),im.SteppedEase=im.steps=_p.SteppedEase={config:function(t,e){var n=1/(t=void 0===t?1:t),i=t+(e?0:1),r=e?1:0,s=1-$d;return function(t){return((i*dd(0,s,t)|0)+r)*n}}},Jd.ease=im["quad.out"],Hu("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(t){return Lp+=t+","+t+"Params,"});var dm=function(t,e){this.id=np++,(t._gsap=this).target=t,this.harness=e,this.get=e?e.get:zp,this.set=e?e.getSetter:Nm},pm=function(){function t(t){this.vars=t,this._delay=+t.delay||0,(this._repeat=t.repeat===1/0?-2:t.repeat||0)&&(this._rDelay=t.repeatDelay||0,this._yoyo=!!t.yoyo||!!t.yoyoEase),this._ts=1,ld(this,+t.duration,1,1),this.data=t.data,Nd||em.wake()}var e=t.prototype;return e.delay=function(t){return t||0===t?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+t-this._delay),this._delay=t,this):this._delay},e.duration=function(t){return arguments.length?this.totalDuration(0<this._repeat?t+(t+this._rDelay)*this._repeat:t):this.totalDuration()&&this._dur},e.totalDuration=function(t){return arguments.length?(this._dirty=0,ld(this,this._repeat<0?t:(t-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},e.totalTime=function(t,e){if(nm(),!arguments.length)return this._tTime;var n=this._dp;if(n&&n.smoothChildTiming&&this._ts){for(Vp(this,t),!n._dp||n.parent||nd(n,this);n.parent;)n.parent._time!==n._start+(0<=n._ts?n._tTime/n._ts:(n.totalDuration()-n._tTime)/-n._ts)&&n.totalTime(n._tTime,!0),n=n.parent;!this.parent&&this._dp.autoRemoveChildren&&(0<this._ts&&t<this._tDur||this._ts<0&&0<t||!this._tDur&&!t)&&id(this._dp,this,this._start-this._delay)}return(this._tTime!==t||!this._dur&&!e||this._initted&&Math.abs(this._zTime)===$d||!t&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=t),Wu(this,t,e)),this},e.time=function(t,e){return arguments.length?this.totalTime(Math.min(this.totalDuration(),t+$u(this))%(this._dur+this._rDelay)||(t?this._dur:0),e):this._time},e.totalProgress=function(t,e){return arguments.length?this.totalTime(this.totalDuration()*t,e):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.ratio},e.progress=function(t,e){return arguments.length?this.totalTime(this.duration()*(!this._yoyo||1&this.iteration()?t:1-t)+$u(this),e):this.duration()?Math.min(1,this._time/this._dur):this.ratio},e.iteration=function(t,e){var n=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(t-1)*n,e):this._repeat?td(this._tTime,n)+1:1},e.timeScale=function(t){if(!arguments.length)return this._rts===-$d?0:this._rts;if(this._rts===t)return this;var e=this.parent&&this._ts?ed(this.parent._time,this):this._tTime;return this._rts=+t||0,this._ts=this._ps||t===-$d?0:this._rts,function(t){for(var e=t.parent;e&&e.parent;)e._dirty=1,e.totalDuration(),e=e.parent;return t}(this.totalTime(dd(-this._delay,this._tDur,e),!0))},e.paused=function(t){return arguments.length?(this._ps!==t&&((this._ps=t)?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(nm(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,1===this.progress()&&Math.abs(this._zTime)!==$d&&(this._tTime-=$d)))),this):this._ps},e.startTime=function(t){if(arguments.length){this._start=t;var e=this.parent||this._dp;return!e||!e._sort&&this.parent||id(e,this,t-this._delay),this}return this._start},e.endTime=function(t){return this._start+(Bu(t)?this.totalDuration():this.duration())/Math.abs(this._ts)},e.rawTime=function(t){var e=this.parent||this._dp;return e?t&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?ed(e.rawTime(t),this):this._tTime:this._tTime},e.globalTime=function(t){for(var e=this,n=arguments.length?t:e.rawTime();e;)n=e._start+n/(e._ts||1),e=e._dp;return n},e.repeat=function(t){return arguments.length?(this._repeat=t===1/0?-2:t,hd(this)):-2===this._repeat?1/0:this._repeat},e.repeatDelay=function(t){if(arguments.length){var e=this._time;return this._rDelay=t,hd(this),e?this.time(e):this}return this._rDelay},e.yoyo=function(t){return arguments.length?(this._yoyo=t,this):this._yoyo},e.seek=function(t,e){return this.totalTime(cd(this,t),Bu(e))},e.restart=function(t,e){return this.play().totalTime(t?-this._delay:0,Bu(e))},e.play=function(t,e){return null!=t&&this.seek(t,e),this.reversed(!1).paused(!1)},e.reverse=function(t,e){return null!=t&&this.seek(t||this.totalDuration(),e),this.reversed(!0).paused(!1)},e.pause=function(t,e){return null!=t&&this.seek(t,e),this.paused(!0)},e.resume=function(){return this.paused(!1)},e.reversed=function(t){return arguments.length?(!!t!==this.reversed()&&this.timeScale(-this._rts||(t?-$d:0)),this):this._rts<0},e.invalidate=function(){return this._initted=this._act=0,this._zTime=-$d,this},e.isActive=function(){var t,e=this.parent||this._dp,n=this._start;return!(e&&!(this._ts&&this._initted&&e.isActive()&&(t=e.rawTime(!0))>=n&&t<this.endTime(!0)-$d))},e.eventCallback=function(t,e,n){var i=this.vars;return 1<arguments.length?(e?(i[t]=e,n&&(i[t+"Params"]=n),"onUpdate"===t&&(this._onUpdate=e)):delete i[t],this):i[t]},e.then=function(i){var r=this;return new Promise(function(e){function t(){var t=r.then;r.then=null,ap(n)&&(n=n(r))&&(n.then||n===r)&&(r.then=t),e(n),r.then=t}var n=ap(i)?i:Gu;r._initted&&1===r.totalProgress()&&0<=r._ts||!r._tTime&&r._ts<0?t():r._prom=t})},e.kill=function(){_d(this)},t}();ju(pm.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-$d,_prom:0,_ps:!1,_rts:1});var mm=function(i){function t(t,e){var n;return(n=i.call(this,t=void 0===t?{}:t)||this).labels={},n.smoothChildTiming=!!t.smoothChildTiming,n.autoRemoveChildren=!!t.autoRemoveChildren,n._sort=Bu(t.sortChildren),Cd&&id(t.parent||Cd,zu(n),e),t.reversed&&n.reverse(),t.paused&&n.paused(!0),t.scrollTrigger&&rd(zu(n),t.scrollTrigger),n}Nu(t,i);var e=t.prototype;return e.to=function(t,e,n){return ud(0,arguments,this),this},e.from=function(t,e,n){return ud(1,arguments,this),this},e.fromTo=function(t,e,n,i){return ud(2,arguments,this),this},e.set=function(t,e,n){return e.duration=0,e.parent=this,Ku(e).repeatDelay||(e.repeat=0),e.immediateRender=!!e.immediateRender,new Mm(t,e,cd(this,n),1),this},e.call=function(t,e,n){return id(this,Mm.delayedCall(0,t,e),n)},e.staggerTo=function(t,e,n,i,r,s,o){return n.duration=e,n.stagger=n.stagger||i,n.onComplete=s,n.onCompleteParams=o,n.parent=this,new Mm(t,n,cd(this,r)),this},e.staggerFrom=function(t,e,n,i,r,s,o){return n.runBackwards=1,Ku(n).immediateRender=Bu(n.immediateRender),this.staggerTo(t,e,n,i,r,s,o)},e.staggerFromTo=function(t,e,n,i,r,s,o,a){return i.startAt=n,Ku(i).immediateRender=Bu(i.immediateRender),this.staggerTo(t,e,i,r,s,o,a)},e.render=function(t,e,n){var i,r,s,o,a,l,h,c,u,d,p=this._time,m=this._dirty?this.totalDuration():this._tDur,f=this._dur,v=this!==Cd&&m-$d<t&&0<=t?m:t<$d?0:t,g=this._zTime<0!=t<0&&(this._initted||!f);if(v!==this._tTime||n||g){if(p!==this._time&&f&&(v+=this._time-p,t+=this._time-p),i=v,c=this._start,a=!(h=this._ts),g&&(f||(p=this._zTime),!t&&e||(this._zTime=t)),this._repeat){if(y=this._yoyo,o=f+this._rDelay,this._repeat<-1&&t<0)return this.totalTime(100*o+t,e,n);if(i=Np(v%o),v===m?(s=this._repeat,i=f):((s=~~(v/o))&&s===v/o&&(i=f,s--),f<i&&(i=f)),u=td(this._tTime,o),y&&1&s&&(i=f-i,d=1),s!==(u=!p&&this._tTime&&u!==s?s:u)&&!this._lock){var g=y&&1&u,y=g===(y&&1&s),p=(g=s<u?!g:g)?0:f;if(this._lock=1,this.render(p||(d?0:Np(s*o)),e,!f)._lock=0,this._tTime=v,!e&&this.parent&&xd(this,"onRepeat"),this.vars.repeatRefresh&&!d&&(this.invalidate()._lock=1),p&&p!==this._time||a!=!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(f=this._dur,m=this._tDur,y&&(this._lock=2,this.render(p=g?f:-1e-4,!0),this.vars.repeatRefresh&&!d&&this.invalidate()),this._lock=0,!this._ts&&!a)return this;Sd(this,d)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(l=function(t,e,n){var i;if(e<n)for(i=t._first;i&&i._start<=n;){if(!i._dur&&"isPause"===i.data&&i._start>e)return i;i=i._next}else for(i=t._last;i&&i._start>=n;){if(!i._dur&&"isPause"===i.data&&i._start<e)return i;i=i._prev}}(this,Np(p),Np(i)))&&(v-=i-(i=l._start)),this._tTime=v,this._time=i,this._act=!h,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=t,p=0),!p&&i&&!e&&(xd(this,"onStart"),this._tTime!==v))return this;if(p<=i&&0<=t)for(x=this._first;x;){if(r=x._next,(x._act||i>=x._start)&&x._ts&&l!==x){if(x.parent!==this)return this.render(t,e,n);if(x.render(0<x._ts?(i-x._start)*x._ts:(x._dirty?x.totalDuration():x._tDur)+(i-x._start)*x._ts,e,n),i!==this._time||!this._ts&&!a){l=0,r&&(v+=this._zTime=-$d);break}}x=r}else for(var x=this._last,_=t<0?t:i;x;){if(r=x._prev,(x._act||_<=x._end)&&x._ts&&l!==x){if(x.parent!==this)return this.render(t,e,n);if(x.render(0<x._ts?(_-x._start)*x._ts:(x._dirty?x.totalDuration():x._tDur)+(_-x._start)*x._ts,e,n),i!==this._time||!this._ts&&!a){l=0,r&&(v+=this._zTime=_?-$d:$d);break}}x=r}if(l&&!e&&(this.pause(),l.render(p<=i?0:-$d)._zTime=p<=i?1:-1,this._ts))return this._start=c,Op(this),this.render(t,e,n);this._onUpdate&&!e&&xd(this,"onUpdate",!0),(v===m&&m>=this.totalDuration()||!v&&p)&&(c!==this._start&&Math.abs(h)===Math.abs(this._ts)||this._lock||(!t&&f||!(v===m&&0<this._ts||!v&&this._ts<0)||Ju(this,1),e||t<0&&!p||!v&&!p&&m||(xd(this,v===m&&0<=t?"onComplete":"onReverseComplete",!0),!this._prom||v<m&&0<this.timeScale()||this._prom())))}return this},e.add=function(t,e){var n=this;if(lp(e)||(e=cd(this,e,t)),!(t instanceof pm)){if(dp(t))return t.forEach(function(t){return n.add(t,e)}),this;if(op(t))return this.addLabel(t,e);if(!ap(t))return this;t=Mm.delayedCall(0,t)}return this!==t?id(this,t,e):this},e.getChildren=function(t,e,n,i){void 0===t&&(t=!0),void 0===e&&(e=!0),void 0===n&&(n=!0),void 0===i&&(i=-Qd);for(var r=[],s=this._first;s;)s._start>=i&&(s instanceof Mm?e&&r.push(s):(n&&r.push(s),t&&r.push.apply(r,s.getChildren(!0,e,n)))),s=s._next;return r},e.getById=function(t){for(var e=this.getChildren(1,1,1),n=e.length;n--;)if(e[n].vars.id===t)return e[n]},e.remove=function(t){return op(t)?this.removeLabel(t):ap(t)?this.killTweensOf(t):(Fp(this,t),t===this._recent&&(this._recent=this._last),kp(this))},e.totalTime=function(t,e){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=Np(em.time-(0<this._ts?t/this._ts:(this.totalDuration()-t)/-this._ts))),i.prototype.totalTime.call(this,t,e),this._forcing=0,this):this._tTime},e.addLabel=function(t,e){return this.labels[t]=cd(this,e),this},e.removeLabel=function(t){return delete this.labels[t],this},e.addPause=function(t,e,n){n=Mm.delayedCall(0,e||Uu,n);return n.data="isPause",this._hasPause=1,id(this,n,cd(this,t))},e.removePause=function(t){var e=this._first;for(t=cd(this,t);e;)e._start===t&&"isPause"===e.data&&Ju(e),e=e._next},e.killTweensOf=function(t,e,n){for(var i=this.getTweensOf(t,n),r=i.length;r--;)gm!==i[r]&&i[r].kill(t,e);return this},e.getTweensOf=function(t,e){for(var n,i=[],r=qp(t),s=this._first,o=lp(e);s;)s instanceof Mm?function(t,e){for(var n=e.length,i=0;t.indexOf(e[i])<0&&++i<n;);return i<n}(s._targets,r)&&(o?(!gm||s._initted&&s._ts)&&s.globalTime(0)<=e&&s.globalTime(s.totalDuration())>e:!e||s.isActive())&&i.push(s):(n=s.getTweensOf(r,e)).length&&i.push.apply(i,n),s=s._next;return i},e.tweenTo=function(t,e){e=e||{};var n,i=this,r=cd(i,t),t=e,s=t.startAt,o=t.onStart,a=t.onStartParams,t=t.immediateRender,l=Mm.to(i,ju({ease:e.ease||"none",lazy:!1,immediateRender:!1,time:r,overwrite:"auto",duration:e.duration||Math.abs((r-(s&&"time"in s?s.time:i._time))/i.timeScale())||$d,onStart:function(){var t;i.pause(),n||(t=e.duration||Math.abs((r-(s&&"time"in s?s.time:i._time))/i.timeScale()),l._dur!==t&&ld(l,t,0,1).render(l._time,!0,!0),n=1),o&&o.apply(l,a||[])}},e));return t?l.render(0):l},e.tweenFromTo=function(t,e,n){return this.tweenTo(e,ju({startAt:{time:cd(this,t)}},n))},e.recent=function(){return this._recent},e.nextLabel=function(t){return void 0===t&&(t=this._time),yd(this,cd(this,t))},e.previousLabel=function(t){return void 0===t&&(t=this._time),yd(this,cd(this,t),1)},e.currentLabel=function(t){return arguments.length?this.seek(t,!0):this.previousLabel(this._time+$d)},e.shiftChildren=function(t,e,n){void 0===n&&(n=0);for(var i,r=this._first,s=this.labels;r;)r._start>=n&&(r._start+=t,r._end+=t),r=r._next;if(e)for(i in s)s[i]>=n&&(s[i]+=t);return kp(this)},e.invalidate=function(){var t=this._first;for(this._lock=0;t;)t.invalidate(),t=t._next;return i.prototype.invalidate.call(this)},e.clear=function(t){void 0===t&&(t=!0);for(var e,n=this._first;n;)e=n._next,this.remove(n),n=e;return this._dp&&(this._time=this._tTime=this._pTime=0),t&&(this.labels={}),kp(this)},e.totalDuration=function(t){var e,n,i,r=0,s=this,o=s._last,a=Qd;if(arguments.length)return s.timeScale((s._repeat<0?s.duration():s.totalDuration())/(s.reversed()?-t:t));if(s._dirty){for(i=s.parent;o;)e=o._prev,o._dirty&&o.totalDuration(),a<(n=o._start)&&s._sort&&o._ts&&!s._lock?(s._lock=1,id(s,o,n-o._delay,1)._lock=0):a=n,n<0&&o._ts&&(r-=n,(!i&&!s._dp||i&&i.smoothChildTiming)&&(s._start+=n/s._ts,s._time-=n,s._tTime-=n),s.shiftChildren(-n,!1,-1/0),a=0),o._end>r&&o._ts&&(r=o._end),o=e;ld(s,s===Cd&&s._time>r?s._time:r,1,1),s._dirty=0}return s._tDur},t.updateRoot=function(t){if(Cd._ts&&(Wu(Cd,ed(t,Cd)),zd=em.frame),em.frame>=Cp){Cp+=Kd.autoSleep||120;var e=Cd._first;if((!e||!e._ts)&&Kd.autoSleep&&em._listeners.length<2){for(;e&&!e._ts;)e=e._next;e||em.sleep()}}},t}(pm);ju(mm.prototype,{_lock:0,_hasPause:0,_forcing:0});function fm(t,e,n,i,r,s,o,a,l){ap(i)&&(i=i(r||0,t,s));var h,r=t[e],s="get"!==n?n:ap(r)?l?t[e.indexOf("set")||!ap(t["get"+e.substr(3)])?e:"get"+e.substr(3)](l):t[e]():r,n=ap(r)?l?Im:Rm:Lm;if(op(i)&&"="===(i=~i.indexOf("random(")?Yp(i):i).charAt(1)&&(!(h=parseFloat(s)+parseFloat(i.substr(2))*("-"===i.charAt(0)?-1:1)+(Wp(s)||0))&&0!==h||(i=h)),s!==i)return isNaN(s*i)||""===i?(r||e in t||wp(e,i),ym.call(this,t,e,s,i,n,a||Kd.stringFilter,l)):(h=new Fm(this._pt,t,e,+s||0,i-(s||0),"boolean"==typeof r?Dm:Bm,0,n),l&&(h.fp=l),o&&h.modifier(o,this,t),this._pt=h)}function vm(t,e,n,i,r,s){var o,a,l,h;if(Tp[t]&&!1!==(o=new Tp[t]).init(r,o.rawVars?e[t]:function(t,e,n,i,r){if(ap(t)&&(t=_m(t,r,e,n,i)),!cp(t)||t.style&&t.nodeType||dp(t)||up(t))return op(t)?_m(t,r,e,n,i):t;var s,o={};for(s in t)o[s]=_m(t[s],r,e,n,i);return o}(e[t],i,r,s,n),n,i,s)&&(n._pt=a=new Fm(n._pt,r,t,0,1,o.render,o,0,o.priority),n!==Om))for(l=n._ptLookup[n._targets.indexOf(r)],h=o._props.length;h--;)l[o._props[h]]=a;return o}var gm,ym=function(t,e,n,i,r,s,o){var a,l,h,c,u,d=new Fm(this._pt,t,e,0,1,Sm,null,r),p=0,m=0;for(d.b=n,d.e=i,n+="",(r=~(i+="").indexOf("random("))&&(i=Yp(i)),s&&(s(s=[n,i],t,e),n=s[0],i=s[1]),a=n.match(vp)||[];u=vp.exec(i);)h=u[0],c=i.substring(p,u.index),l?l=(l+1)%5:"rgba("===c.substr(-5)&&(l=1),h!==a[m++]&&(u=parseFloat(a[m-1])||0,d._pt={_next:d._pt,p:c||1===m?c:",",s:u,c:"="===h.charAt(1)?parseFloat(h.substr(2))*("-"===h.charAt(0)?-1:1):parseFloat(h)-u,m:l&&l<4?Math.round:0},p=vp.lastIndex);return d.c=p<i.length?i.substring(p,i.length):"",d.fp=o,(gp.test(i)||r)&&(d.e=0),this._pt=d},xm=function t(e,n){var i,r,s,o,a,l,h,c,u,d,p,m,f,v=e.vars,g=v.ease,y=v.startAt,x=v.immediateRender,_=v.lazy,b=v.onUpdate,w=v.onUpdateParams,M=v.callbackScope,S=v.runBackwards,E=v.yoyoEase,T=v.keyframes,A=v.autoRevert,C=e._dur,P=e._startAt,L=e._targets,R=e.parent,I=R&&"nested"===R.data?R.parent._targets:L,z="auto"===e._overwrite&&!Ad,N=e.timeline;if(e._ease=hm(g=!(!N||T&&g)?"none":g,Jd.ease),e._yEase=E?lm(hm(!0===E?g:E,Jd.ease)):0,E&&e._yoyo&&!e._repeat&&(E=e._yEase,e._yEase=e._ease,e._ease=E),e._from=!N&&!!v.runBackwards,!N){if(m=(c=L[0]?Ip(L[0]).harness:0)&&v[c.prop],i=Zu(v,Mp),P&&P.render(-1,!0).kill(),y)if(Ju(e._startAt=Mm.set(L,ju({data:"isStart",overwrite:!1,parent:R,immediateRender:!0,lazy:Bu(_),startAt:null,delay:0,onUpdate:b,onUpdateParams:w,callbackScope:M,stagger:0},y))),n<0&&!x&&!A&&e._startAt.render(-1,!0),x){if(0<n&&!A&&(e._startAt=0),C&&n<=0)return void(n&&(e._zTime=n))}else!1===A&&(e._startAt=0);else if(S&&C)if(P)A||(e._startAt=0);else if(s=ju({overwrite:!1,data:"isFromStart",lazy:(x=n?!1:x)&&Bu(_),immediateRender:x,stagger:0,parent:R},i),m&&(s[c.prop]=m),Ju(e._startAt=Mm.set(L,s)),n<0&&e._startAt.render(-1,!0),x){if(!n)return}else t(e._startAt,$d);for(e._pt=0,_=C&&Bu(_)||_&&!C,r=0;r<L.length;r++){if(h=(a=L[r])._gsap||Rp(L)[r]._gsap,e._ptLookup[r]=d={},Ep[h.id]&&Sp.length&&Bp(),p=I===L?r:I.indexOf(a),c&&!1!==(u=new c).init(a,m||i,e,p,I)&&(e._pt=o=new Fm(e._pt,a,u.name,0,1,u.render,u,0,u.priority),u._props.forEach(function(t){d[t]=o}),u.priority&&(l=1)),!c||m)for(s in i)Tp[s]&&(u=vm(s,i,e,p,a,I))?u.priority&&(l=1):d[s]=o=fm.call(e,a,s,"get",i[s],p,I,0,v.stringFilter);e._op&&e._op[r]&&e.kill(a,e._op[r]),z&&e._pt&&(gm=e,Cd.killTweensOf(a,d,e.globalTime(0)),f=!e.parent,gm=0),e._pt&&_&&(Ep[h.id]=1)}l&&Pm(e),e._onInit&&e._onInit(e)}e._onUpdate=b,e._initted=(!e._op||e._pt)&&!f},_m=function(t,e,n,i,r){return ap(t)?t.call(e,n,i,r):op(t)&&~t.indexOf("random(")?Yp(t):t},bm=Lp+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase",wm=(bm+",id,stagger,delay,duration,paused,scrollTrigger").split(","),Mm=function(M){function r(t,e,n,i){"number"==typeof e&&(n.duration=e,e=n,n=null);var r,s,o,a,l,h,c,u,d,p=(r=M.call(this,i?e:Ku(e))||this).vars,m=p.duration,f=p.delay,v=p.immediateRender,g=p.stagger,y=p.overwrite,x=p.keyframes,_=p.defaults,i=p.scrollTrigger,b=p.yoyoEase,p=e.parent||Cd,w=(dp(t)||up(t)?lp(t[0]):"length"in e)?[t]:qp(t);if(r._targets=w.length?Rp(w):Ou("GSAP target "+t+" not found. https://greensock.com",!Kd.nullTargetWarn)||[],r._ptLookup=[],r._overwrite=y,x||g||Fu(m)||Fu(f)){if(e=r.vars,(s=r.timeline=new mm({data:"nested",defaults:_||{}})).kill(),s.parent=s._dp=zu(r),s._start=0,x)ju(s.vars.defaults,{ease:"none"}),g?w.forEach(function(n,i){return x.forEach(function(t,e){return s.to(n,t,e?">":i*g)})}):x.forEach(function(t){return s.to(w,t,">")});else{if(l=w.length,u=g?pd(g):Uu,cp(g))for(h in g)~bm.indexOf(h)&&((d=d||{})[h]=g[h]);for(o=0;o<l;o++){for(h in a={},e)wm.indexOf(h)<0&&(a[h]=e[h]);a.stagger=0,b&&(a.yoyoEase=b),d&&Xu(a,d),c=w[o],a.duration=+_m(m,zu(r),o,c,w),a.delay=(+_m(f,zu(r),o,c,w)||0)-r._delay,!g&&1===l&&a.delay&&(r._delay=f=a.delay,r._start+=f,a.delay=0),s.to(c,a,u(o,c,w))}s.duration()?m=f=0:r.timeline=0}m||r.duration(m=s.duration())}else r.timeline=0;return!0!==y||Ad||(gm=zu(r),Cd.killTweensOf(w),gm=0),id(p,zu(r),n),e.reversed&&r.reverse(),e.paused&&r.paused(!0),(v||!m&&!x&&r._start===Np(p._time)&&Bu(v)&&Qu(zu(r))&&"nested"!==p.data)&&(r._tTime=-$d,r.render(Math.max(0,-f))),i&&rd(zu(r),i),r}Nu(r,M);var t=r.prototype;return t.render=function(t,e,n){var i,r,s,o,a,l,h,c,u,d=this._time,p=this._tDur,m=this._dur,f=p-$d<t&&0<=t?p:t<$d?0:t;if(m){if(f!==this._tTime||!t||n||!this._initted&&this._tTime||this._startAt&&this._zTime<0!=t<0){if(i=f,c=this.timeline,this._repeat){if(o=m+this._rDelay,this._repeat<-1&&t<0)return this.totalTime(100*o+t,e,n);if(i=Np(f%o),f===p?(s=this._repeat,i=m):((s=~~(f/o))&&s===f/o&&(i=m,s--),m<i&&(i=m)),(l=this._yoyo&&1&s)&&(u=this._yEase,i=m-i),a=td(this._tTime,o),i===d&&!n&&this._initted)return this;s!==a&&(c&&this._yEase&&Sd(c,l),!this.vars.repeatRefresh||l||this._lock||(this._lock=n=1,this.render(Np(o*s),!0).invalidate()._lock=0))}if(!this._initted){if(sd(this,t<0?t:i,n,e))return this._tTime=0,this;if(m!==this._dur)return this.render(t,e,n)}if(this._tTime=f,this._time=i,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=h=(u||this._ease)(i/m),this._from&&(this.ratio=h=1-h),i&&!d&&!e&&(xd(this,"onStart"),this._tTime!==f))return this;for(r=this._pt;r;)r.r(h,r.d),r=r._next;c&&c.render(t<0?t:!i&&l?-$d:c._dur*h,e,n)||this._startAt&&(this._zTime=t),this._onUpdate&&!e&&(t<0&&this._startAt&&this._startAt.render(t,!0,n),xd(this,"onUpdate")),this._repeat&&s!==a&&this.vars.onRepeat&&!e&&this.parent&&xd(this,"onRepeat"),f!==this._tDur&&f||this._tTime!==f||(t<0&&this._startAt&&!this._onUpdate&&this._startAt.render(t,!0,!0),!t&&m||!(f===this._tDur&&0<this._ts||!f&&this._ts<0)||Ju(this,1),e||t<0&&!d||!f&&!d||(xd(this,f===p?"onComplete":"onReverseComplete",!0),!this._prom||f<p&&0<this.timeScale()||this._prom()))}}else!function(t,e,n,i){var r,s,o,a=t.ratio,l=e<0||!e&&(!t._start&&od(t)&&(t._initted||!ad(t))||(t._ts<0||t._dp._ts<0)&&!ad(t))?0:1,h=t._rDelay,c=0;if(h&&t._repeat&&(c=dd(0,t._tDur,e),s=td(c,h),o=td(t._tTime,h),t._yoyo&&1&s&&(l=1-l),s!==o&&(a=1-l,t.vars.repeatRefresh&&t._initted&&t.invalidate())),l!==a||i||t._zTime===$d||!e&&t._zTime){if(t._initted||!sd(t,e,i,n)){for(o=t._zTime,t._zTime=e||(n?$d:0),n=n||e&&!o,t.ratio=l,t._from&&(l=1-l),t._time=0,t._tTime=c,r=t._pt;r;)r.r(l,r.d),r=r._next;t._startAt&&e<0&&t._startAt.render(e,!0,!0),t._onUpdate&&!n&&xd(t,"onUpdate"),c&&t._repeat&&!n&&t.parent&&xd(t,"onRepeat"),(e>=t._tDur||e<0)&&t.ratio===l&&(l&&Ju(t,1),n||(xd(t,l?"onComplete":"onReverseComplete",!0),t._prom&&t._prom()))}}else t._zTime||(t._zTime=e)}(this,t,e,n);return this},t.targets=function(){return this._targets},t.invalidate=function(){return this._pt=this._op=this._startAt=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(),M.prototype.invalidate.call(this)},t.kill=function(t,e){if(void 0===e&&(e="all"),!(t||e&&"all"!==e))return this._lazy=this._pt=0,this.parent?_d(this):this;if(this.timeline){var n=this.timeline.totalDuration();return this.timeline.killTweensOf(t,e,gm&&!0!==gm.vars.overwrite)._first||_d(this),this.parent&&n!==this.timeline.totalDuration()&&ld(this,this._dur*this.timeline._tDur/n,0,1),this}var i,r,s,o,a,l,h,c=this._targets,u=t?qp(t):c,d=this._ptLookup,t=this._pt;if((!e||"all"===e)&&function(t,e){for(var n=t.length,i=n===e.length;i&&n--&&t[n]===e[n];);return n<0}(c,u))return"all"===e&&(this._pt=0),_d(this);for(i=this._op=this._op||[],"all"!==e&&(op(e)&&(a={},Hu(e,function(t){return a[t]=1}),e=a),e=function(t,e){var n,i,r,s,t=t[0]?Ip(t[0]).harness:0,o=t&&t.aliases;if(!o)return e;for(i in n=Xu({},e),o)if(i in n)for(r=(s=o[i].split(",")).length;r--;)n[s[r]]=n[i];return n}(c,e)),h=c.length;h--;)if(~u.indexOf(c[h]))for(a in r=d[h],"all"===e?(i[h]=e,o=r,s={}):(s=i[h]=i[h]||{},o=e),o)(l=r&&r[a])&&("kill"in l.d&&!0!==l.d.kill(a)||Fp(this,l,"_pt"),delete r[a]),"all"!==s&&(s[a]=1);return this._initted&&!this._pt&&t&&_d(this),this},r.to=function(t,e){return new r(t,e,arguments[2])},r.from=function(t,e){return ud(1,arguments)},r.delayedCall=function(t,e,n,i){return new r(e,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:t,onComplete:e,onReverseComplete:e,onCompleteParams:n,onReverseCompleteParams:n,callbackScope:i})},r.fromTo=function(t,e,n){return ud(2,arguments)},r.set=function(t,e){return e.duration=0,e.repeatDelay||(e.repeat=0),new r(t,e)},r.killTweensOf=function(t,e,n){return Cd.killTweensOf(t,e,n)},r}(pm);ju(Mm.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0}),Hu("staggerTo,staggerFrom,staggerFromTo",function(n){Mm[n]=function(){var t=new mm,e=Gp.call(arguments,0);return e.splice("staggerFromTo"===n?5:4,0,0),t[n].apply(t,e)}});function Sm(t,e){var n=e._pt,i="";if(!t&&e.b)i=e.b;else if(1===t&&e.e)i=e.e;else{for(;n;)i=n.p+(n.m?n.m(n.s+n.c*t):Math.round(1e4*(n.s+n.c*t))/1e4)+i,n=n._next;i+=e.c}e.set(e.t,e.p,i,e)}function Em(t,e){for(var n=e._pt;n;)n.r(t,n.d),n=n._next}function Tm(t,e,n,i){for(var r,s=this._pt;s;)r=s._next,s.p===i&&s.modifier(t,e,n),s=r}function Am(t){for(var e,n,i=this._pt;i;)n=i._next,i.p===t&&!i.op||i.op===t?Fp(this,i,"_pt"):i.dep||(e=1),i=n;return!e}function Cm(t,e,n,i){i.mSet(t,e,i.m.call(i.tween,n,i.mt),i)}function Pm(t){for(var e,n,i,r,s=t._pt;s;){for(e=s._next,n=i;n&&n.pr>s.pr;)n=n._next;(s._prev=n?n._prev:r)?s._prev._next=s:i=s,(s._next=n)?n._prev=s:r=s,s=e}t._pt=i}var Lm=function(t,e,n){return t[e]=n},Rm=function(t,e,n){return t[e](n)},Im=function(t,e,n,i){return t[e](i.fp,n)},zm=function(t,e,n){return t.setAttribute(e,n)},Nm=function(t,e){return ap(t[e])?Rm:hp(t[e])&&t.setAttribute?zm:Lm},Bm=function(t,e){return e.set(e.t,e.p,Math.round(1e6*(e.s+e.c*t))/1e6,e)},Dm=function(t,e){return e.set(e.t,e.p,!!(e.s+e.c*t),e)},Fm=function(){function t(t,e,n,i,r,s,o,a,l){this.t=e,this.s=i,this.c=r,this.p=n,this.r=s||Bm,this.d=o||this,this.set=a||Lm,this.pr=l||0,(this._next=t)&&(t._prev=this)}return t.prototype.modifier=function(t,e,n){this.mSet=this.mSet||this.set,this.set=Cm,this.m=t,this.mt=n,this.tween=e},t}();Hu(Lp+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(t){return Mp[t]=1}),_p.TweenMax=_p.TweenLite=Mm,_p.TimelineLite=_p.TimelineMax=mm,Cd=new mm({sortChildren:!1,defaults:Jd,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0}),Kd.stringFilter=Md;var km={registerPlugin:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];e.forEach(function(t){var e=(t=!t.name&&t.default||t).name,n=ap(t),i=e&&!n&&t.init?function(){this._props=[]}:t,r={init:Uu,render:Em,add:fm,kill:Am,modifier:Tm,rawVars:0},n={targetTest:0,get:0,getSetter:Nm,aliases:{},register:0};if(nm(),t!==i){if(Tp[e])return;ju(i,ju(Zu(t,r),n)),Xu(i.prototype,Xu(r,Zu(t,n))),Tp[i.prop=e]=i,t.targetTest&&(Pp.push(i),Mp[e]=1),e=("css"===e?"CSS":e.charAt(0).toUpperCase()+e.substr(1))+"Plugin"}Vu(e,i),t.register&&t.register(Um,i,Fm)})},timeline:function(t){return new mm(t)},getTweensOf:function(t,e){return Cd.getTweensOf(t,e)},getProperty:function(i,t,e,n){op(i)&&(i=qp(i)[0]);var r=Ip(i||{}).get,s=e?Gu:Dp;return"native"===e&&(e=""),i&&(t?s((Tp[t]&&Tp[t].get||r)(i,t,e,n)):function(t,e,n){return s((Tp[t]&&Tp[t].get||r)(i,t,e,n))})},quickSetter:function(n,e,i){if(1<(n=qp(n)).length){var r=n.map(function(t){return Um.quickSetter(t,e,i)}),s=r.length;return function(t){for(var e=s;e--;)r[e](t)}}n=n[0]||{};var o=Tp[e],a=Ip(n),l=a.harness&&(a.harness.aliases||{})[e]||e,h=o?function(t){var e=new o;Om._pt=0,e.init(n,i?t+i:t,Om,0,[n]),e.render(1,e),Om._pt&&Em(1,Om)}:a.set(n,l);return o?h:function(t){return h(n,l,i?t+i:t,a,1)}},isTweening:function(t){return 0<Cd.getTweensOf(t,!0).length},defaults:function(t){return t&&t.ease&&(t.ease=hm(t.ease,Jd.ease)),Yu(Jd,t||{})},config:function(t){return Yu(Kd,t||{})},registerEffect:function(t){var i=t.name,r=t.effect,e=t.plugins,s=t.defaults,t=t.extendTimeline;(e||"").split(",").forEach(function(t){return t&&!Tp[t]&&!_p[t]&&Ou(i+" effect requires "+t+" plugin.")}),Ap[i]=function(t,e,n){return r(qp(t),ju(e||{},s),n)},t&&(mm.prototype[i]=function(t,e,n){return this.add(Ap[i](t,cp(e)?e:(n=e)&&{},this),n)})},registerEase:function(t,e){im[t]=hm(e)},parseEase:function(t,e){return arguments.length?hm(t,e):im},getById:function(t){return Cd.getById(t)},exportRoot:function(t,e){var n,i,r=new mm(t=void 0===t?{}:t);for(r.smoothChildTiming=Bu(t.smoothChildTiming),Cd.remove(r),r._dp=0,r._time=r._tTime=Cd._time,n=Cd._first;n;)i=n._next,!e&&!n._dur&&n instanceof Mm&&n.vars.onComplete===n._targets[0]||id(r,n,n._start-n._delay),n=i;return id(Cd,r,0),r},utils:{wrap:wc,wrapYoyo:Sc,distribute:pd,random:fd,snap:Mc,normalize:function(t,e,n){return gd(t,e,0,1,n)},getUnit:Wp,clamp:function(e,n,t){return Hp(t,function(t){return dd(e,n,t)})},splitColor:Jp,toArray:qp,selector:function(n){return n=qp(n)[0]||Ou("Invalid scope")||{},function(t){var e=n.current||n.nativeElement||n;return qp(t,e.querySelectorAll?e:e===n?Ou("Invalid scope")||Rd.createElement("div"):n)}},mapRange:gd,pipe:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(t){return e.reduce(function(t,e){return e(t)},t)}},unitize:function(e,n){return function(t){return e(parseFloat(t))+(n||Wp(t))}},interpolate:Br,shuffle:Xp},install:ku,effects:Ap,ticker:em,updateRoot:mm.updateRoot,plugins:Tp,globalTimeline:Cd,core:{PropTween:Fm,globals:Vu,Tween:Mm,Timeline:mm,Animation:pm,getCache:Ip,_removeLinkedListItem:Fp,suppressOverwrites:function(t){return Ad=t}}};Hu("to,from,fromTo,delayedCall,set,killTweensOf",function(t){return km[t]=Mm[t]}),em.add(mm.updateRoot);var Om=km.to({},{duration:0}),Vm=function(t,e){for(var n=t._pt;n&&n.p!==e&&n.op!==e&&n.fp!==e;)n=n._next;return n},Sc=function(t,r){return{name:t,rawVars:1,init:function(t,i,e){e._onInit=function(t){var e,n;if(op(i)&&(e={},Hu(i,function(t){return e[t]=1}),i=e),r){for(n in e={},i)e[n]=r(i[n]);i=e}!function(t,e){var n,i,r,s=t._targets;for(n in e)for(i=s.length;i--;)(r=(r=t._ptLookup[i][n])&&r.d)&&(r=r._pt?Vm(r,n):r)&&r.modifier&&r.modifier(e[n],t,s[i],n)}(t,i)}}}},Um=km.registerPlugin({name:"attr",init:function(t,e,n,i,r){var s,o;for(s in e)(o=this.add(t,"setAttribute",(t.getAttribute(s)||0)+"",e[s],i,r,0,0,s))&&(o.op=s),this._props.push(s)}},{name:"endArray",init:function(t,e){for(var n=e.length;n--;)this.add(t,n,t[n]||0,e[n])}},Sc("roundProps",md),Sc("modifiers"),Sc("snap",Mc))||km;Mm.version=mm.version=Um.version="3.7.1",Id=1,Du()&&nm();im.Power0,im.Power1,im.Power2,im.Power3,im.Power4,im.Linear,im.Quad,im.Cubic,im.Quart,im.Quint,im.Strong,im.Elastic,im.Back,im.SteppedEase,im.Bounce,im.Sine,im.Expo,im.Circ;function Hm(t,e){return e.set(e.t,e.p,Math.round(1e4*(e.s+e.c*t))/1e4+e.u,e)}function Wm(t,e){return e.set(e.t,e.p,1===t?e.e:Math.round(1e4*(e.s+e.c*t))/1e4+e.u,e)}function Gm(t,e){return e.set(e.t,e.p,t?Math.round(1e4*(e.s+e.c*t))/1e4+e.u:e.b,e)}function jm(t,e){t=e.s+e.c*t,e.set(e.t,e.p,~~(t+(t<0?-.5:.5))+e.u,e)}function qm(t,e){return e.set(e.t,e.p,t?e.e:e.b,e)}function Xm(t,e){return e.set(e.t,e.p,1!==t?e.b:e.e,e)}function Ym(t,e,n){return t.style[e]=n}function Zm(t,e,n){return t.style.setProperty(e,n)}function Km(t,e,n){return t._gsap[e]=n}function Jm(t,e,n){return t._gsap.scaleX=t._gsap.scaleY=n}function Qm(t,e,n,i,r){(t=t._gsap).scaleX=t.scaleY=n,t.renderTransform(r,t)}function $m(t,e,n,i,r){(t=t._gsap)[e]=n,t.renderTransform(r,t)}function tf(){yf()&&window.document&&(uf=window,df=uf.document,pf=df.documentElement,ff=Pf("div")||{style:{}},Pf("div"),Af=If(Af),Cf=Af+"Origin",ff.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",gf=!!If("perspective"),mf=1)}function ef(t){var e,n=Pf("svg",this.ownerSVGElement&&this.ownerSVGElement.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),i=this.parentNode,r=this.nextSibling,s=this.style.cssText;if(pf.appendChild(n),n.appendChild(this),this.style.display="block",t)try{e=this.getBBox(),this._gsapBBox=this.getBBox,this.getBBox=ef}catch(t){}else this._gsapBBox&&(e=this._gsapBBox());return i&&(r?i.insertBefore(this,r):i.appendChild(this)),pf.removeChild(n),this.style.cssText=s,e}function nf(t,e){for(var n=e.length;n--;)if(t.hasAttribute(e[n]))return t.getAttribute(e[n])}function rf(t,e,n,i){var r;return mf||tf(),e in Tf&&"transform"!==e&&~(e=Tf[e]).indexOf(",")&&(e=e.split(",")[0]),xf[e]&&"transform"!==e?(r=jf(t,i),r="transformOrigin"!==e?r[e]:r.svg?r.origin:qf(Lf(t,Cf))+" "+r.zOrigin+"px"):(r=t.style[e])&&"auto"!==r&&!i&&!~(r+"").indexOf("calc(")||(r=Vf[e]&&Vf[e](t,e,n)||Lf(t,e)||zp(t,e)||("opacity"===e?1:0)),n&&!~(r+"").trim().indexOf(" ")?kf(t,e,r,n)+n:r}function sf(t,e,n,i){var r;n&&"none"!==n||((s=(r=If(e,t,1))&&Lf(t,r,1))&&s!==n?(e=r,n=s):"borderColor"===e&&(n=Lf(t,"borderTopColor")));var s,o,a,l,h,c,u,d,p,m,f=new Fm(this._pt,t.style,e,0,1,Sm),v=0,g=0;if(f.b=n,f.e=i,n+="","auto"===(i+="")&&(t.style[e]=i,i=Lf(t,e)||i,t.style[e]=n),Md(s=[n,i]),i=s[1],o=(n=s[0]).match(fp)||[],(i.match(fp)||[]).length){for(;c=fp.exec(i);)d=c[0],u=i.substring(v,c.index),l?l=(l+1)%5:"rgba("!==u.substr(-5)&&"hsla("!==u.substr(-5)||(l=1),d!==(h=o[g++]||"")&&(a=parseFloat(h)||0,p=h.substr((a+"").length),(m="="===d.charAt(1)?+(d.charAt(0)+"1"):0)&&(d=d.substr(2)),c=parseFloat(d),d=d.substr((c+"").length),v=fp.lastIndex-d.length,d||(d=d||Kd.units[e]||p,v===i.length&&(i+=d,f.e+=d)),p!==d&&(a=kf(t,e,h,d)||0),f._pt={_next:f._pt,p:u||1===g?u:",",s:a,c:m?m*c:c-a,m:l&&l<4||"zIndex"===e?Math.round:0});f.c=v<i.length?i.substring(v,i.length):""}else f.r="display"===e&&"none"===i?Xm:qm;return gp.test(i)&&(f.e=0),this._pt=f}function of(t,e){if(e.tween&&e.tween._time===e.tween._dur){var n,i,r,s=e.t,o=s.style,a=e.u,e=s._gsap;if("all"===a||!0===a)o.cssText="",i=1;else for(r=(a=a.split(",")).length;-1<--r;)n=a[r],xf[n]&&(i=1,n="transformOrigin"===n?Cf:Af),Bf(s,n);i&&(Bf(s,Af),e&&(e.svg&&s.removeAttribute("transform"),jf(s,1),e.uncache=1))}}function af(t){return"matrix(1, 0, 0, 1, 0, 0)"===t||"none"===t||!t}function lf(t,e,n,i,r,s){var o,a,l=t._gsap,h=r||Gf(t,!0),c=l.xOrigin||0,u=l.yOrigin||0,d=l.xOffset||0,p=l.yOffset||0,m=h[0],f=h[1],v=h[2],g=h[3],y=h[4],x=h[5],_=e.split(" "),b=parseFloat(_[0])||0,r=parseFloat(_[1])||0;n?h!==Uf&&(o=m*g-f*v)&&(a=b*(-f/o)+r*(m/o)-(m*x-f*y)/o,b=b*(g/o)+r*(-v/o)+(v*x-g*y)/o,r=a):(b=(a=zf(t)).x+(~_[0].indexOf("%")?b/100*a.width:b),r=a.y+(~(_[1]||_[0]).indexOf("%")?r/100*a.height:r)),i||!1!==i&&l.smooth?(l.xOffset=d+((y=b-c)*m+(x=r-u)*v)-y,l.yOffset=p+(y*f+x*g)-x):l.xOffset=l.yOffset=0,l.xOrigin=b,l.yOrigin=r,l.smooth=!!i,l.origin=e,l.originIsAbsolute=!!n,t.style[Cf]="0px 0px",s&&(Df(s,l,"xOrigin",c,b),Df(s,l,"yOrigin",u,r),Df(s,l,"xOffset",d,l.xOffset),Df(s,l,"yOffset",p,l.yOffset)),t.setAttribute("data-svg-origin",b+" "+r)}function hf(t,e,n){var i=Wp(e);return Np(parseFloat(e)+parseFloat(kf(t,"x",n+"px",i)))+i}function cf(t,e){for(var n in e)t[n]=e[n];return t}var uf,df,pf,mf,ff,vf,gf,yf=function(){return"undefined"!=typeof window},xf={},_f=180/Math.PI,bf=Math.PI/180,wf=Math.atan2,Mf=/([A-Z])/g,Sf=/(?:left|right|width|margin|padding|x)/i,Ef=/[\s,\(]\S/,Tf={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},Af="transform",Cf=Af+"Origin",Pf=function(t,e){e=df.createElementNS?df.createElementNS((e||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),t):df.createElement(t);return e.style?e:df.createElement(t)},Lf=function t(e,n,i){var r=getComputedStyle(e);return r[n]||r.getPropertyValue(n.replace(Mf,"-$1").toLowerCase())||r.getPropertyValue(n)||!i&&t(e,If(n)||n,1)||""},Rf="O,Moz,ms,Ms,Webkit".split(","),If=function(t,e,n){var i=(e||ff).style,r=5;if(t in i&&!n)return t;for(t=t.charAt(0).toUpperCase()+t.substr(1);r--&&!(Rf[r]+t in i););return r<0?null:(3===r?"ms":0<=r?Rf[r]:"")+t},zf=function(e){var n;try{n=e.getBBox()}catch(t){n=ef.call(e,!0)}return!(n=!(n&&(n.width||n.height)||e.getBBox===ef)?ef.call(e,!0):n)||n.width||n.x||n.y?n:{x:+nf(e,["x","cx","x1"])||0,y:+nf(e,["y","cy","y1"])||0,width:0,height:0}},Nf=function(t){return!(!t.getCTM||t.parentNode&&!t.ownerSVGElement||!zf(t))},Bf=function(t,e){e&&(t=t.style,e in xf&&e!==Cf&&(e=Af),t.removeProperty?("ms"!==e.substr(0,2)&&"webkit"!==e.substr(0,6)||(e="-"+e),t.removeProperty(e.replace(Mf,"-$1").toLowerCase())):t.removeAttribute(e))},Df=function(t,e,n,i,r,s){s=new Fm(t._pt,e,n,0,1,s?Xm:qm);return(t._pt=s).b=i,s.e=r,t._props.push(n),s},Ff={deg:1,rad:1,turn:1},kf=function t(e,n,i,r){var s,o=parseFloat(i)||0,a=(i+"").trim().substr((o+"").length)||"px",l=ff.style,h=Sf.test(n),c="svg"===e.tagName.toLowerCase(),u=(c?"client":"offset")+(h?"Width":"Height"),d="px"===r,p="%"===r;return r===a||!o||Ff[r]||Ff[a]?o:("px"===a||d||(o=t(e,n,i,"px")),i=e.getCTM&&Nf(e),!p&&"%"!==a||!xf[n]&&!~n.indexOf("adius")?(l[h?"width":"height"]=100+(d?a:r),r=~n.indexOf("adius")||"em"===r&&e.appendChild&&!c?e:e.parentNode,(c=(r=!(r=i?(e.ownerSVGElement||{}).parentNode:r)||r===df||!r.appendChild?df.body:r)._gsap)&&p&&c.width&&h&&c.time===em.time?Np(o/c.width*100):(!p&&"%"!==a||(l.position=Lf(e,"position")),r===e&&(l.position="static"),r.appendChild(ff),s=ff[u],r.removeChild(ff),l.position="absolute",h&&p&&((c=Ip(r)).time=em.time,c.width=r[u]),Np(d?s*o/100:s&&o?100/s*o:0))):(s=i?e.getBBox()[h?"width":"height"]:e[u],Np(p?o/s*100:o/100*s)))},Of={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},Vf={clearProps:function(t,e,n,i,r){if("isFromStart"!==r.data){e=t._pt=new Fm(t._pt,e,n,0,0,of);return e.u=i,e.pr=-10,e.tween=r,t._props.push(n),1}}},Uf=[1,0,0,1,0,0],Hf={},Wf=function(t){t=Lf(t,Af);return af(t)?Uf:t.substr(7).match(mp).map(Np)},Gf=function(t,e){var n,i,r,s=t._gsap||Ip(t),o=t.style,a=Wf(t);return s.svg&&t.getAttribute("transform")?"1,0,0,1,0,0"===(a=[(i=t.transform.baseVal.consolidate().matrix).a,i.b,i.c,i.d,i.e,i.f]).join(",")?Uf:a:(a!==Uf||t.offsetParent||t===pf||s.svg||(i=o.display,o.display="block",(s=t.parentNode)&&t.offsetParent||(r=1,n=t.nextSibling,pf.appendChild(t)),a=Wf(t),i?o.display=i:Bf(t,"display"),r&&(n?s.insertBefore(t,n):s?s.appendChild(t):pf.removeChild(t))),e&&6<a.length?[a[0],a[1],a[4],a[5],a[12],a[13]]:a)},jf=function(t,e){var n=t._gsap||new dm(t);if("x"in n&&!e&&!n.uncache)return n;var i,r,s,o,a,l,h,c,u,d,p,m,f,v,g,y,x,_,b,w,M,S,E,T,A,C=t.style,P=n.scaleX<0,L=Lf(t,Cf)||"0",R=i=r=o=a=l=h=c=0,I=s=1;return n.svg=!(!t.getCTM||!Nf(t)),u=Gf(t,n.svg),n.svg&&(_=(!n.uncache||"0px 0px"===L)&&!e&&t.getAttribute("data-svg-origin"),lf(t,_||L,!!_||n.originIsAbsolute,!1!==n.smooth,u)),S=n.xOrigin||0,T=n.yOrigin||0,u!==Uf&&(m=u[0],f=u[1],v=u[2],g=u[3],R=y=u[4],i=x=u[5],6===u.length?(I=Math.sqrt(m*m+f*f),s=Math.sqrt(g*g+v*v),o=m||f?wf(f,m)*_f:0,(h=v||g?wf(v,g)*_f+o:0)&&(s*=Math.abs(Math.cos(h*bf))),n.svg&&(R-=S-(S*m+T*v),i-=T-(S*f+T*g))):(A=u[6],E=u[7],M=u[8],e=u[9],S=u[10],T=u[11],R=u[12],i=u[13],r=u[14],a=(u=wf(A,S))*_f,u&&(_=y*(d=Math.cos(-u))+M*(p=Math.sin(-u)),b=x*d+e*p,w=A*d+S*p,M=y*-p+M*d,e=x*-p+e*d,S=A*-p+S*d,T=E*-p+T*d,y=_,x=b,A=w),l=(u=wf(-v,S))*_f,u&&(d=Math.cos(-u),T=g*(p=Math.sin(-u))+T*d,m=_=m*d-M*p,f=b=f*d-e*p,v=w=v*d-S*p),o=(u=wf(f,m))*_f,u&&(_=m*(d=Math.cos(u))+f*(p=Math.sin(u)),b=y*d+x*p,f=f*d-m*p,x=x*d-y*p,m=_,y=b),a&&359.9<Math.abs(a)+Math.abs(o)&&(a=o=0,l=180-l),I=Np(Math.sqrt(m*m+f*f+v*v)),s=Np(Math.sqrt(x*x+A*A)),u=wf(y,x),h=2e-4<Math.abs(u)?u*_f:0,c=T?1/(T<0?-T:T):0),n.svg&&(_=t.getAttribute("transform"),n.forceCSS=t.setAttribute("transform","")||!af(Lf(t,Af)),_&&t.setAttribute("transform",_))),90<Math.abs(h)&&Math.abs(h)<270&&(P?(I*=-1,h+=o<=0?180:-180,o+=o<=0?180:-180):(s*=-1,h+=h<=0?180:-180)),n.x=R-((n.xPercent=R&&(n.xPercent||(Math.round(t.offsetWidth/2)===Math.round(-R)?-50:0)))?t.offsetWidth*n.xPercent/100:0)+"px",n.y=i-((n.yPercent=i&&(n.yPercent||(Math.round(t.offsetHeight/2)===Math.round(-i)?-50:0)))?t.offsetHeight*n.yPercent/100:0)+"px",n.z=r+"px",n.scaleX=Np(I),n.scaleY=Np(s),n.rotation=Np(o)+"deg",n.rotationX=Np(a)+"deg",n.rotationY=Np(l)+"deg",n.skewX=h+"deg",n.skewY="0deg",n.transformPerspective=c+"px",(n.zOrigin=parseFloat(L.split(" ")[2])||0)&&(C[Cf]=qf(L)),n.xOffset=n.yOffset=0,n.force3D=Kd.force3D,n.renderTransform=n.svg?Kf:gf?Zf:Xf,n.uncache=0,n},qf=function(t){return(t=t.split(" "))[0]+" "+t[1]},Xf=function(t,e){e.z="0px",e.rotationY=e.rotationX="0deg",e.force3D=0,Zf(t,e)},Yf="0deg",Zf=function(t,e){var n=e||this,i=n.xPercent,r=n.yPercent,s=n.x,o=n.y,a=n.z,l=n.rotation,h=n.rotationY,c=n.rotationX,u=n.skewX,d=n.skewY,p=n.scaleX,m=n.scaleY,f=n.transformPerspective,v=n.force3D,g=n.target,y=n.zOrigin,x="",_="auto"===v&&t&&1!==t||!0===v;!y||c===Yf&&h===Yf||(e=parseFloat(h)*bf,n=Math.sin(e),t=Math.cos(e),e=parseFloat(c)*bf,v=Math.cos(e),s=hf(g,s,n*v*-y),o=hf(g,o,-Math.sin(e)*-y),a=hf(g,a,t*v*-y+y)),"0px"!==f&&(x+="perspective("+f+") "),(i||r)&&(x+="translate("+i+"%, "+r+"%) "),!_&&"0px"===s&&"0px"===o&&"0px"===a||(x+="0px"!==a||_?"translate3d("+s+", "+o+", "+a+") ":"translate("+s+", "+o+") "),l!==Yf&&(x+="rotate("+l+") "),h!==Yf&&(x+="rotateY("+h+") "),c!==Yf&&(x+="rotateX("+c+") "),u===Yf&&d===Yf||(x+="skew("+u+", "+d+") "),1===p&&1===m||(x+="scale("+p+", "+m+") "),g.style[Af]=x||"translate(0, 0)"},Kf=function(t,e){var n,i,r,s,o,a=e||this,l=a.xPercent,h=a.yPercent,c=a.x,u=a.y,d=a.rotation,p=a.skewX,m=a.skewY,f=a.scaleX,v=a.scaleY,g=a.target,y=a.xOrigin,x=a.yOrigin,_=a.xOffset,b=a.yOffset,w=a.forceCSS,e=parseFloat(c),a=parseFloat(u),d=parseFloat(d),p=parseFloat(p);(m=parseFloat(m))&&(p+=m=parseFloat(m),d+=m),d||p?(d*=bf,p*=bf,n=Math.cos(d)*f,i=Math.sin(d)*f,r=Math.sin(d-p)*-v,s=Math.cos(d-p)*v,p&&(m*=bf,o=Math.tan(p-m),r*=o=Math.sqrt(1+o*o),s*=o,m&&(o=Math.tan(m),n*=o=Math.sqrt(1+o*o),i*=o)),n=Np(n),i=Np(i),r=Np(r),s=Np(s)):(n=f,s=v,i=r=0),(e&&!~(c+"").indexOf("px")||a&&!~(u+"").indexOf("px"))&&(e=kf(g,"x",c,"px"),a=kf(g,"y",u,"px")),(y||x||_||b)&&(e=Np(e+y-(y*n+x*r)+_),a=Np(a+x-(y*i+x*s)+b)),(l||h)&&(o=g.getBBox(),e=Np(e+l/100*o.width),a=Np(a+h/100*o.height)),g.setAttribute("transform",o="matrix("+n+","+i+","+r+","+s+","+e+","+a+")"),w&&(g.style[Af]=o)};Hu("padding,margin,Width,Radius",function(e,n){var t="Top",i="Right",r="Bottom",s="Left",a=(n<3?[t,i,r,s]:[t+s,t+i,r+i,r+s]).map(function(t){return n<2?e+t:"border"+t+e});Vf[1<n?"border"+e:e]=function(e,t,n,i,r){var s,o;if(arguments.length<4)return s=a.map(function(t){return rf(e,t,n)}),5===(o=s.join(" ")).split(s[0]).length?s[0]:o;s=(i+"").split(" "),o={},a.forEach(function(t,e){return o[t]=s[e]=s[e]||s[(e-1)/2|0]}),e.init(t,o,r)}});var Jf,Br={name:"css",register:tf,targetTest:function(t){return t.style&&t.nodeType},init:function(t,e,n,i,r){var s,o,a,l,h,c,u,d,p,m,f,v,g,y,x,_,b,w,M,S,E,T=this._props,A=t.style,C=n.vars.startAt;for(h in mf||tf(),e)if("autoRound"!==h&&(o=e[h],!Tp[h]||!vm(h,e,n,i,t,r)))if(_=Vf[h],"string"===(b="function"===(b=typeof o)?typeof(o=o.call(n,i,t,r)):b)&&~o.indexOf("random(")&&(o=Yp(o)),_)_(this,t,h,o,n)&&(g=1);else if("--"===h.substr(0,2))s=(getComputedStyle(t).getPropertyValue(h)+"").trim(),o+="",$p.lastIndex=0,$p.test(s)||(c=Wp(s),u=Wp(o)),u?c!==u&&(s=kf(t,h,s,u)+u):c&&(o+=c),this.add(A,"setProperty",s,o,i,r,0,0,h),T.push(h);else if("undefined"!==b){if(C&&h in C?(s="function"==typeof C[h]?C[h].call(n,i,t,r):C[h],h in Kd.units&&!Wp(s)&&(s+=Kd.units[h]),"="===(s+"").charAt(1)&&(s=rf(t,h))):s=rf(t,h),l=parseFloat(s),(d="string"===b&&"="===o.charAt(1)?+(o.charAt(0)+"1"):0)&&(o=o.substr(2)),a=parseFloat(o),h in Tf&&("autoAlpha"===h&&(1===l&&"hidden"===rf(t,"visibility")&&a&&(l=0),Df(this,A,"visibility",l?"inherit":"hidden",a?"inherit":"hidden",!a)),"scale"!==h&&"transform"!==h&&~(h=Tf[h]).indexOf(",")&&(h=h.split(",")[0])),p=h in xf)if(m||((f=t._gsap).renderTransform&&!e.parseTransform||jf(t,e.parseTransform),v=!1!==e.smoothOrigin&&f.smooth,(m=this._pt=new Fm(this._pt,A,Af,0,1,f.renderTransform,f,0,-1)).dep=1),"scale"===h)this._pt=new Fm(this._pt,f,"scaleY",f.scaleY,(d?d*a:a-f.scaleY)||0),T.push("scaleY",h),h+="X";else{if("transformOrigin"===h){E=S=M=void 0,M=(w=o).split(" "),S=M[0],E=M[1]||"50%","top"!==S&&"bottom"!==S&&"left"!==E&&"right"!==E||(w=S,S=E,E=w),M[0]=Of[S]||S,M[1]=Of[E]||E,o=M.join(" "),f.svg?lf(t,o,0,v,0,this):((u=parseFloat(o.split(" ")[2])||0)!==f.zOrigin&&Df(this,f,"zOrigin",f.zOrigin,u),Df(this,A,h,qf(s),qf(o)));continue}if("svgOrigin"===h){lf(t,o,1,v,0,this);continue}if(h in Hf){y=this,x=f,_=h,b=l,w=d,E=S=void 0,S=op(M=o),E=parseFloat(M)*(S&&~M.indexOf("rad")?_f:1),E=b+(w=w?E*w:E-b)+"deg",S&&("short"===(M=M.split("_")[1])&&(w%=360)!==w%180&&(w+=w<0?360:-360),"cw"===M&&w<0?w=(w+36e9)%360-360*~~(w/360):"ccw"===M&&0<w&&(w=(w-36e9)%360-360*~~(w/360))),y._pt=w=new Fm(y._pt,x,_,b,w,Wm),w.e=E,w.u="deg",y._props.push(_);continue}if("smoothOrigin"===h){Df(this,f,"smooth",f.smooth,o);continue}if("force3D"===h){f[h]=o;continue}if("transform"===h){!function(t,e,n){var i,r,s,o,a,l,h=cf({},n._gsap),c=n.style;for(r in h.svg?(s=n.getAttribute("transform"),n.setAttribute("transform",""),c[Af]=e,i=jf(n,1),Bf(n,Af),n.setAttribute("transform",s)):(s=getComputedStyle(n)[Af],c[Af]=e,i=jf(n,1),c[Af]=s),xf)(s=h[r])!==(a=i[r])&&"perspective,force3D,transformOrigin,svgOrigin".indexOf(r)<0&&(o=Wp(s)!==(l=Wp(a))?kf(n,r,s,l):parseFloat(s),a=parseFloat(a),t._pt=new Fm(t._pt,i,r,o,a-o,Hm),t._pt.u=l||0,t._props.push(r));cf(i,h)}(this,o,t);continue}}else h in A||(h=If(h)||h);if(p||(a||0===a)&&(l||0===l)&&!Ef.test(o)&&h in A)a=a||0,(c=(s+"").substr((l+"").length))!==(u=Wp(o)||(h in Kd.units?Kd.units[h]:c))&&(l=kf(t,h,s,u)),this._pt=new Fm(this._pt,p?f:A,h,l,d?d*a:a-l,p||"px"!==u&&"zIndex"!==h||!1===e.autoRound?Hm:jm),this._pt.u=u||0,c!==u&&(this._pt.b=s,this._pt.r=Gm);else if(h in A)sf.call(this,t,h,s,o);else{if(!(h in t)){wp(h,o);continue}this.add(t,h,s||t[h],o,i,r)}T.push(h)}g&&Pm(this)},get:rf,aliases:Tf,getSetter:function(t,e,n){var i=Tf[e];return(e=i&&i.indexOf(",")<0?i:e)in xf&&e!==Cf&&(t._gsap.x||rf(t,"x"))?n&&vf===n?"scale"===e?Jm:Km:(vf=n||{})&&("scale"===e?Qm:$m):t.style&&!hp(t.style[e])?Ym:~e.indexOf("-")?Zm:Nm(t,e)},core:{_removeProperty:Bf,_getMatrix:Gf}};Um.utils.checkPrefix=If,Jf=Hu((Sc="x,y,z,scale,scaleX,scaleY,xPercent,yPercent")+","+(Mc="rotation,rotationX,rotationY,skewX,skewY")+",transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective",function(t){xf[t]=1}),Hu(Mc,function(t){Kd.units[t]="deg",Hf[t]=1}),Tf[Jf[13]]=Sc+","+Mc,Hu("0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY",function(t){t=t.split(":");Tf[t[1]]=Jf[t[0]]}),Hu("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(t){Kd.units[t]="px"}),Um.registerPlugin(Br);var Qf=Um.registerPlugin(Br)||Um,Mc=(Qf.core.Tween,class{constructor(t){this.options=t,this.title="Choose an experience"}debug(){}updateCameraPosition(t){return Qf.to(this.options.camera.position,{x:t.x,y:t.y,z:t.z,duration:0,onComplete:()=>(this.options.debug.refresh(),this.options.camera.lookAt(new We(0,0,0)))})}_onScroll(t){return this.onScroll(t)}_onResize(t){return this.onResize(t)}_onMouseMove(t){return this.onMouseMove(t)}_onUpdate(t){return this.onUpdate(t)}load(){return this.unload(),this.init(),document.querySelector(".home__scene__title").innerHTML=this.title}unload(){return this.options.scene.remove(this.mesh),this.options.renderer.setClearColor("#000000"),document.querySelector(".home__scene__title").innerHTML="Choose an experience"}onScroll(t){}onResize(t){}onMouseMove(t){}onUpdate(t){}});const $f=class extends Mc{constructor(t){super(),this.options=t,this.axesHelper=new Dc(1e3),this.axesHelper.visible=!1,this.options.scene.add(this.axesHelper),this.options.debug&&this.debug()}debug(){return this.debugFolder=this.options.debug.addFolder({title:"Axes helpers",expanded:!1}),this.debugFolder.addButton({title:"Toggle"}).on("click",t=>this.axesHelper.visible=!this.axesHelper.visible),this.options.debug.addSeparator()}},tv=class extends Mc{constructor(t){super(),this.options=t,this.title="1. Font",this.config={matcap:1},this.options.debug&&this.debug()}init(){var e;return this.updateCameraPosition({x:0,y:0,z:15}),e=this.options.loaders.texture.load("./scripts/tools/Scene/textures/matcaps/1.png"),this.options.loaders.font.load("./scripts/tools/Scene/fonts/helvetiker_regular.typeface.json",t=>(this.geometry=new sh("Hungry Minds RPZ",{font:t,size:1.5,height:.8,curveSegments:10,bevelEnabled:!0,bevelThickness:.03,bevelSize:.02,bevelOffset:0,bevelSegments:8}),this.geometry.center(),this.material=new yh({matcap:e}),this.mesh=new qi(this.geometry,this.material),this.options.scene.add(this.mesh)))}debug(){return this.debugFolder=this.options.debug.addFolder({title:this.title,expanded:!1}),this.debugFolder.addButton({title:"Load"}).on("click",t=>this.load()),this.debugFolder.addButton({title:"Unload"}).on("click",t=>this.unload()),this.debugFolder.addSeparator(),this.debugFolder.addInput(this.config,"matcap",{options:{gold:1,blue:2,glass:3,red_orange:4,red:5,skin:6,green:7,red_blue:8}}).on("change",t=>{if(this.material)return this.material.matcap=this.options.loaders.texture.load("./scripts/tools/Scene/textures/matcaps/"+t.value+".png")})}},ev=class extends Mc{constructor(t){super(),this.options=t,this.title="2. Shadows",this.config={ambientLight:{intensity:.5},directionalLight:{intensity:.5,pos:{x:2,y:2,z:-1}},material:{metalness:0,roughness:.7}},this.options.debug&&this.debug()}init(){var t,e;return this.mesh=new Go,this.updateCameraPosition({x:1.5,y:2,z:6}),t=this.options.loaders.texture.load("./scripts/tools/Scene/textures/shadows/simpleShadow.jpg"),this.main=new ac(16777215,this.config.ambientLight.intensity),this.mesh.add(this.main),this.point=new oc(16777215,this.config.directionalLight.intensity),this.point.position.set(this.config.directionalLight.pos.x,this.config.directionalLight.pos.y,this.config.directionalLight.pos.z),this.mesh.add(this.point),this.material=new dh,this.material.metalness=this.config.material.metalness,this.material.roughness=this.config.material.roughness,e=new ih(1,32,32),this.object=new qi(e,this.material),this.mesh.add(this.object),e=new pr(8,8),this.plane=new qi(e,this.material),this.plane.position.y=-1,this.plane.rotation.x=.5*-Math.PI,this.plane.material.side=Rt,this.mesh.add(this.plane),this.objectShadow=new qi(new pr(3,3),new pi({color:0,transparent:!0,alphaMap:t})),this.objectShadow.position.y=this.plane.position.y+.01,this.objectShadow.rotation.x=.5*-Math.PI,this.mesh.add(this.objectShadow),this.options.scene.add(this.mesh)}debug(){var t;return this.debugFolder=this.options.debug.addFolder({title:this.title,expanded:!1}),this.debugFolder.addButton({title:"Load"}).on("click",t=>this.load()),this.debugFolder.addButton({title:"Unload"}).on("click",t=>this.unload()),this.debugFolder.addSeparator(),this.debugFolder.addFolder({title:"Ambient light",expanded:!1}).addInput(this.config.ambientLight,"intensity",{min:0,max:1,step:.01}).on("change",t=>{if(this.main)return this.main.intensity=this.config.ambientLight.intensity}),(t=this.debugFolder.addFolder({title:"Light",expanded:!1})).addInput(this.config.directionalLight,"intensity",{min:0,max:1,step:.01}).on("change",t=>{if(this.point)return this.point.intensity=this.config.directionalLight.intensity}),t.addInput(this.config.directionalLight.pos,"x",{min:-5,max:15,step:.01}).on("change",t=>{if(this.point)return this.point.position.x=this.config.directionalLight.pos.x}),t.addInput(this.config.directionalLight.pos,"y",{min:-5,max:15,step:.01}).on("change",t=>{if(this.point)return this.point.position.y=this.config.directionalLight.pos.y}),t.addInput(this.config.directionalLight.pos,"z",{min:-5,max:15,step:.01}).on("change",t=>{if(this.point)return this.point.position.z=this.config.directionalLight.pos.z}),(t=this.debugFolder.addFolder({title:"Material",expanded:!1})).addInput(this.config.material,"metalness",{min:0,max:1,step:.01}).on("change",t=>{if(this.material)return this.material.metalness=this.config.material.metalness}),t.addInput(this.config.material,"roughness",{min:0,max:1,step:.01}).on("change",t=>{if(this.material)return this.material.roughness=this.config.material.roughness})}onUpdate(t){if(this.object)return this.object.position.x=Math.cos(2*t),this.object.position.z=Math.sin(2*t),this.object.position.y=Math.abs(Math.sin(3.5*t)),this.objectShadow.position.x=this.object.position.x,this.objectShadow.position.z=this.object.position.z,this.objectShadow.material.opacity=.8*(1-this.object.position.y)}},nv=class extends Mc{constructor(t){super(),this.options=t,this.title="3. Particles",this.options.debug&&this.debug()}init(){var t,e,n,i,r;for(this.updateCameraPosition({x:0,y:2,z:5}),this.geometry=new Ci,this.count=5e3,i=new Float32Array(3*this.count),t=new Float32Array(3*this.count),e=n=0,r=3*this.count;0<=r?n<r:r<n;e=0<=r?++n:--n)i[e]=20*(Math.random()-.5),t[e]=Math.random();return this.geometry.addAttribute("position",new vi(i,3)),this.geometry.addAttribute("color",new vi(t,3)),this.material=new qa({size:.2,sizeAttenuation:!0,map:this.options.loaders.texture.load("./scripts/tools/Scene/textures/particles/2.png"),depthWrite:!1,vertexColors:!0,blending:K}),this.material.color.setHSL(1,.4,.7),this.mesh=new Ja(this.geometry,this.material),this.options.scene.add(this.mesh)}debug(){return this.debugFolder=this.options.debug.addFolder({title:this.title,expanded:!1}),this.debugFolder.addButton({title:"Load"}).on("click",t=>this.load()),this.debugFolder.addButton({title:"Unload"}).on("click",t=>this.unload()),this.debugFolder.addSeparator()}onUpdate(t){var e,n,i,r,s;if(this.geometry){for(e=i=0,r=this.count;0<=r?i<r:r<i;e=0<=r?++i:--i)s=this.geometry.attributes.position.array[0+(n=3*e)],this.geometry.attributes.position.array[1+n]=Math.sin(t+s);return this.geometry.attributes.position.needsUpdate=!0}}},iv=class extends Mc{constructor(t){super(),this.options=t,this.title="4. Galaxy ",this.config={count:358800,radius:11.09,branches:10,randomness:.848,randomnessPower:2.859,insideColor:"#ff6030",outsideColor:"#1b3984"},this.options.debug&&this.debug()}init(){return this.updateCameraPosition({x:5,y:5,z:5}),this.geometry=null,this.material=null,this.points=null,this.generate()}debug(){return this.debugFolder=this.options.debug.addFolder({title:this.title,expanded:!1}),this.debugFolder.addButton({title:"Load"}).on("click",t=>this.load()),this.debugFolder.addButton({title:"Unload"}).on("click",t=>this.unload()),this.debugFolder.addSeparator(),this.debugFolder.addInput(this.config,"count",{min:100,max:1e6,step:100}).on("change",t=>{if(t.last)return this.generate()}),this.debugFolder.addInput(this.config,"radius",{min:.01,max:20,step:.01}).on("change",t=>{if(t.last)return this.generate()}),this.debugFolder.addInput(this.config,"branches",{min:2,max:20,step:1}).on("change",t=>{if(t.last)return this.generate()}),this.debugFolder.addInput(this.config,"randomness",{min:0,max:2,step:.001}).on("change",t=>{if(t.last)return this.generate()}),this.debugFolder.addInput(this.config,"randomnessPower",{min:1,max:20,step:.001}).on("change",t=>{if(t.last)return this.generate()}),this.debugFolder.addInput(this.config,"insideColor").on("change",t=>{if(t.last)return this.generate()}),this.debugFolder.addInput(this.config,"outsideColor").on("change",t=>{if(t.last)return this.generate()})}destroy(){return this.geometry&&this.geometry.dispose(),this.material&&this.material.dispose(),this.options.scene.remove(this.points)}generate(){var t,e,n,i,r,s,o,a,l,h,c,u;for(null!==this.points&&this.destroy(),this.geometry=new Ci,a=new Float32Array(3*this.config.count),n=new Float32Array(3*this.config.count),u=new Float32Array(+this.config.count),h=new Float32Array(3*this.config.count),t=new di(this.config.insideColor),e=new di(this.config.outsideColor),i=s=0,c=this.config.count;0<=c?s<c:c<s;i=0<=c?++s:--s)r=3*i,l=Math.random()*this.config.radius,o=i%this.config.branches/this.config.branches*Math.PI*2,a[r]=Math.cos(o)*l,a[1+r]=0,a[2+r]=Math.sin(o)*l,h[r]=Math.pow(Math.random(),this.config.randomnessPower)*(Math.random()<.5?1:-1),h[1+r]=Math.pow(Math.random(),this.config.randomnessPower)*(Math.random()<.5?1:-1),h[2+r]=Math.pow(Math.random(),this.config.randomnessPower)*(Math.random()<.5?1:-1),(o=t.clone()).lerp(e,l/this.config.radius),n[r]=o.r,n[1+r]=o.g,n[2+r]=o.b,u[i]=Math.random();return this.geometry.addAttribute("position",new vi(a,3)),this.geometry.addAttribute("color",new vi(n,3)),this.geometry.addAttribute("aScale",new vi(u,1)),this.geometry.addAttribute("aRandomness",new vi(h,3)),this.material=new Qi({uniforms:{uTime:{value:0},uSize:{value:30*this.options.renderer.getPixelRatio()}},vertexShader:"#define GLSLIFY 1\nattribute float aScale;\nattribute vec3  aRandomness;\n\nuniform float uTime;\nuniform float uSize;\n\nvarying vec3 vColor;\n\nvoid main() {\n\n    vec4 modelPosition = modelMatrix * vec4(position, 1.0);\n\n    // Spin\n    float angle = atan(modelPosition.x, modelPosition.z);\n    float distanceToCenter = length(modelPosition.xz);\n    float angleOffset = (1.0 / distanceToCenter) * uTime * 0.2;\n    angle += angleOffset;\n\n    modelPosition.x = cos(angle) * distanceToCenter;\n    modelPosition.z = sin(angle) * distanceToCenter;\n\n    modelPosition.xyz += aRandomness;\n\n    vec4 viewPosition = viewMatrix * modelPosition;\n    vec4 projectedPosition = projectionMatrix * viewPosition;\n    \n    gl_Position = projectedPosition;\n\n    gl_PointSize = uSize * aScale;\n    gl_PointSize *= (1.0 / - viewPosition.z);\n\n    vColor = color;\n}",fragmentShader:"#define GLSLIFY 1\nvarying vec3 vColor;\n\nvoid main() {\n\n    // Disc pattern\n    // float strength = distance(gl_PointCoord, vec2(0.5));\n    // strength = 1.0 - step(0.5, strength);\n\n    // Diffuse point\n    // float strength = 1.0 - (distance(gl_PointCoord, vec2(0.5)) * 2.0);\n\n    // Light point\n    float strength = 1.0 - distance(gl_PointCoord, vec2(0.5));\n    strength = pow(strength, 10.0);\n\n    gl_FragColor = vec4(vColor, strength);\n}\n",vertexColors:!0,depthWrite:!1,blending:K}),this.points=new Ja(this.geometry,this.material),this.options.scene.add(this.points)}unload(){return this.destroy()}onUpdate(t){if(this.material)return this.material.uniforms.uTime.value=t}},rv=class extends Mc{constructor(t){super(),this.options=t,this.title="5. Raycaster",this.options.debug&&this.debug()}init(){return this.updateCameraPosition({x:0,y:4,z:0}),this.mesh=new Go,this.object1=new qi(new ih(.5,32,32),new pi({color:"#ff0000"})),this.object1.position.x=-2,this.mesh.add(this.object1),this.object2=new qi(new ih(.5,32,32),new pi({color:"#ff0000"})),this.mesh.add(this.object2),this.object3=new qi(new ih(.5,32,32),new pi({color:"#ff0000"})),this.object3.position.x=2,this.mesh.add(this.object3),this.raycaster=new Lc,this.mouse=new Ie,this.options.scene.add(this.mesh)}debug(){return this.debugFolder=this.options.debug.addFolder({title:this.title,expanded:!1}),this.debugFolder.addButton({title:"Load"}).on("click",t=>this.load()),this.debugFolder.addButton({title:"Unload"}).on("click",t=>this.unload()),this.debugFolder.addSeparator()}onUpdate(t){var e,n,i,r,s,o,a,l;if(this.raycaster){for(this.object1.position.z=Math.sin(1.43*t),this.object2.position.z=Math.sin(1.3*t),this.object3.position.z=Math.sin(1.32*t),this.raycaster.setFromCamera(this.mouse,this.options.camera),a=[this.object1,this.object2,this.object3],n=this.raycaster.intersectObjects(a),e=0,r=a.length;e<r;e++)(o=a[e]).material.color.set("#ff0000");for(l=[],i=0,s=n.length;i<s;i++)o=n[i],l.push(o.object.material.color.set("#0000ff"));return l}}onMouseMove(t){if(this.mouse)return this.mouse.x=t.clientX/window.innerWidth*2-1,this.mouse.y=2*-(t.clientY/window.innerHeight)+1}};var Br=fv(125),sv=fv.n(Br);const ov=class extends Mc{constructor(t){super(),this.options=t,this.title="6. Physics",this.oldElapsedTime=0,this.objectsToUpdate=[],this.sounds={hit:new Audio("./scripts/tools/Scene/sounds/hit.mp3")},this.options.debug&&this.debug()}init(){return this.updateCameraPosition({x:0,y:3,z:6}),this.mesh=new Go,this.setupWorld(),this.setupMeshes(),this.createFloor(),this.createLights(),this.options.scene.add(this.mesh)}debug(){return this.debugFolder=this.options.debug.addFolder({title:this.title,expanded:!1}),this.debugFolder.addButton({title:"Load"}).on("click",t=>this.load()),this.debugFolder.addButton({title:"Unload"}).on("click",t=>this.unload()),this.debugFolder.addSeparator(),this.debugFolder.addButton({title:"Create sphere"}).on("click",()=>this.createSphere(.5*Math.random(),{x:3*(Math.random()-.5),y:3,z:3*(Math.random()-.5)})),this.debugFolder.addButton({title:"Create box"}).on("click",()=>this.createBox(Math.random(),Math.random(),Math.random(),{x:3*(Math.random()-.5),y:3,z:3*(Math.random()-.5)})),this.debugFolder.addButton({title:"Reset playground"}).on("click",()=>this.reset())}playHitSound(t){if(1.5<t.contact.getImpactVelocityAlongNormal())return this.sounds.hit.volume=Math.random(),this.sounds.hit.currentTime=0,this.sounds.hit.play()}reset(){for(var t,e=this.objectsToUpdate,n=[],i=0,r=e.length;i<r;i++)(t=e[i]).body.removeEventListener("collide",t=>this.playHitSound(t)),this.world.removeBody(t.body),n.push(this.mesh.remove(t.mesh));return n}setupWorld(){return this.world=new(sv().World),this.world.gravity.set(0,-9.82,0),this.world.broadphase=new(sv().SAPBroadphase)(this.world),this.world.allowSleep=!0,this.defaultMaterial=new(sv().Material)("default"),this.world.addContactMaterial(new(sv().ContactMaterial)(this.defaultMaterial,this.defaultMaterial,{friction:.1,restitution:.9}))}setupMeshes(){return this.sphereGeometry=new ih(1,20,20),this.sphereMaterial=new dh({metalness:.3,roughness:.4}),this.boxGeometry=new Yi(1,1,1),this.boxMaterial=new dh({metalness:.3,roughness:.4})}createSphere(t,e){var n=new qi(this.sphereGeometry,this.sphereMaterial);return n.scale.set(t,t,t),n.castShadow=!0,n.position.copy(e),this.mesh.add(n),t=new(sv().Sphere)(t),(t=new(sv().Body)({mass:1,position:new(sv().Vec3)(0,3,0),shape:t,material:this.defaultMaterial})).position.copy(e),t.addEventListener("collide",t=>this.playHitSound(t)),this.world.addBody(t),this.objectsToUpdate.push({mesh:n,body:t})}createBox(t,e,n,i){var r=new qi(this.boxGeometry,this.boxMaterial);return r.scale.set(t,e,n),r.castShadow=!0,r.position.copy(i),this.mesh.add(r),n=new(sv().Box)(new(sv().Vec3)(.5*t,.5*e,.5*n)),(n=new(sv().Body)({mass:1,position:new(sv().Vec3)(0,3,0),shape:n,material:this.defaultMaterial})).position.copy(i),n.addEventListener("collide",t=>this.playHitSound(t)),this.world.addBody(n),this.objectsToUpdate.push({mesh:r,body:n})}createFloor(){var t=new(sv().Plane);return this.floorBody=new(sv().Body)({mass:0,shape:t,material:this.defaultMaterial}),this.floorBody.quaternion.setFromAxisAngle(new(sv().Vec3)(-1,0,0),.5*Math.PI),this.world.addBody(this.floorBody),this.floor=new qi(new pr(20,20),new dh({color:"#777777",metalness:.3,roughness:.4})),this.floor.receiveShadow=!0,this.floor.rotation.x=.5*-Math.PI,this.mesh.add(this.floor)}createLights(){var t=new ac(16777215,.7);return this.mesh.add(t),(t=new oc(16777215,.2)).castShadow=!0,t.shadow.mapSize.set(1024,1024),t.shadow.camera.far=15,t.shadow.camera.left=-7,t.shadow.camera.top=7,t.shadow.camera.right=7,t.shadow.camera.bottom=-7,t.position.set(5,5,5),this.mesh.add(t)}unload(){return this.reset(),this.options.scene.remove(this.mesh)}onUpdate(t){var e,n,i,r,s,o=t-this.oldElapsedTime;if(this.oldElapsedTime=t,this.world&&this.world.step(1/60,o,3),this.objectsToUpdate){for(s=[],e=0,n=(r=this.objectsToUpdate).length;e<n;e++)(i=r[e]).mesh.position.copy(i.body.position),s.push(i.mesh.quaternion.copy(i.body.quaternion));return s}}},av=class extends Mc{constructor(t){super(),this.options=t,this.title="7. Animated 3D model",this.options.debug&&this.debug()}init(){var t;return this.updateCameraPosition({x:4,y:2,z:4}),this.mesh=new Go,this.previousTime=0,(t=new qi(new pr(10,10),new dh({color:"#444444",metalness:0,roughness:.5,side:Rt}))).receiveShadow=!0,t.rotation.x=.5*-Math.PI,this.mesh.add(t),this.createLights(),this.mixer=null,this.options.loaders.gltf.load("./scripts/tools/Scene/models/Fox/glTF/Fox.gltf",t=>(this.animations=t.animations,this.mixer=new Pc(t.scene),t.scene.scale.set(.025,.025,.025),this.mesh.add(t.scene))),this.options.scene.add(this.mesh)}debug(){return this.debugFolder=this.options.debug.addFolder({title:this.title,expanded:!1}),this.debugFolder.addButton({title:"Load"}).on("click",t=>this.load()),this.debugFolder.addButton({title:"Unload"}).on("click",t=>this.unload()),this.debugFolder.addSeparator(),this.debugFolder.addButton({title:"Idle"}).on("click",t=>(this.action&&this.action.stop(),this.action=this.mixer.clipAction(this.animations[0]),this.action.setDuration(3),this.action.play())),this.debugFolder.addButton({title:"Walk"}).on("click",t=>(this.action&&this.action.stop(),this.action=this.mixer.clipAction(this.animations[1]),this.action.setDuration(1),this.action.play())),this.debugFolder.addButton({title:"Run"}).on("click",t=>(this.action&&this.action.stop(),this.action=this.mixer.clipAction(this.animations[2]),this.action.setDuration(.9),this.action.play())),this.debugFolder.addButton({title:"Stop"}).on("click",t=>{if(this.action)return this.action.stop()})}createLights(){var t=new ac(16777215,.8);return this.mesh.add(t),(t=new oc(16777215,.6)).castShadow=!0,t.shadow.mapSize.set(1024,1024),t.shadow.camera.far=15,t.shadow.camera.left=-7,t.shadow.camera.top=7,t.shadow.camera.right=7,t.shadow.camera.bottom=-7,t.position.set(5,5,5),this.mesh.add(t)}onUpdate(t){var e=t-this.previousTime;if(this.previousTime=t,this.mixer)return this.mixer.update(e)}},lv=class extends Mc{constructor(t){super(),this.options=t,this.title="7. Shaders",this.config={frequencyX:10,frequencyY:5},this.options.debug&&this.debug()}init(){return this.updateCameraPosition({x:0,y:0,z:2}),this.geometry=new pr(1,1,32,32),this.material=new Qi({uniforms:{uFrequency:{value:new Ie(this.config.frequencyX,this.config.frequencyY)},uTime:{value:0},uColor:{value:new di("#888888")},uTexture:{value:this.options.loaders.texture.load("./scripts/tools/Scene/textures/flag-french.jpg")}},vertexShader:"#define GLSLIFY 1\nattribute float aRandom;\n\nuniform float uTime;\nuniform vec2 uFrequency;\n\nvarying vec2 vUv;\nvarying float vRandom;\nvarying float vElevation;\n\nvoid main() {\n\n    vec3 pos = position;\n\n    float elevation = sin(pos.x * uFrequency.x - uTime) * 0.1;\n    elevation += sin(pos.y * uFrequency.y - uTime) * 0.1;\n\n    pos.z += elevation;\n\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);\n\n    vUv = uv;\n    vRandom = aRandom;\n    vElevation = elevation;\n}",fragmentShader:"precision mediump float;\n#define GLSLIFY 1\n\nuniform vec3 uColor;\nuniform sampler2D uTexture;\n\nvarying vec2 vUv;\nvarying float vRandom;\nvarying float vElevation;\n\nvoid main() {\n\n    vec4 color = texture2D(uTexture, vUv);\n    color.rgb *= vElevation * 2.0 + 0.9;\n\n    gl_FragColor = vec4(color);\n}\n",wireframe:!1,side:Rt}),this.mesh=new qi(this.geometry,this.material),this.mesh.scale.y=2/3,this.options.scene.add(this.mesh)}debug(){return this.debugFolder=this.options.debug.addFolder({title:this.title,expanded:!1}),this.debugFolder.addButton({title:"Load"}).on("click",t=>this.load()),this.debugFolder.addButton({title:"Unload"}).on("click",t=>this.unload()),this.debugFolder.addSeparator(),this.debugFolder.addInput(this.config,"frequencyX",{min:0,max:20,step:.01}).on("change",t=>this.mesh.material.uniforms.uFrequency.value.x=this.config.frequencyX),this.debugFolder.addInput(this.config,"frequencyY",{min:0,max:20,step:.01}).on("change",t=>this.mesh.material.uniforms.uFrequency.value.y=this.config.frequencyY)}onUpdate(t){if(this.mesh)return this.mesh.material.uniforms.uTime.value+=.01}},hv=class extends Mc{constructor(t){super(),this.options=t,this.title="8. Shaders Patterns",this.config={pattern:.2},this.options.debug&&this.debug()}init(){return this.updateCameraPosition({x:0,y:0,z:2}),this.geometry=new pr(1,1,32,32),this.material=new Qi({uniforms:{uTime:{value:0},uPattern:{value:this.config.pattern}},vertexShader:"#define GLSLIFY 1\nuniform float uTime;\n\nvarying vec2 vUv;\n\nvoid main() {\n\n    vec3 pos = position;\n\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);\n\n    vUv = uv;\n}",fragmentShader:'#define GLSLIFY 1\n//\n// GLSL textureless classic 2D noise "cnoise",\n// with an RSL-style periodic variant "pnoise".\n// Author:  Stefan Gustavson (stefan.gustavson@liu.se)\n// Version: 2011-08-22\n//\n// Many thanks to Ian McEwan of Ashima Arts for the\n// ideas for permutation and gradient selection.\n//\n// Copyright (c) 2011 Stefan Gustavson. All rights reserved.\n// Distributed under the MIT license. See LICENSE file.\n// https://github.com/ashima/webgl-noise\n//\n\nvec4 mod289(vec4 x)\n{\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec4 permute(vec4 x)\n{\n  return mod289(((x*34.0)+1.0)*x);\n}\n\nvec4 taylorInvSqrt(vec4 r)\n{\n  return 1.79284291400159 - 0.85373472095314 * r;\n}\n\nvec2 fade(vec2 t) {\n  return t*t*t*(t*(t*6.0-15.0)+10.0);\n}\n\n// Classic Perlin noise\nfloat cnoise(vec2 P)\n{\n  vec4 Pi = floor(P.xyxy) + vec4(0.0, 0.0, 1.0, 1.0);\n  vec4 Pf = fract(P.xyxy) - vec4(0.0, 0.0, 1.0, 1.0);\n  Pi = mod289(Pi); // To avoid truncation effects in permutation\n  vec4 ix = Pi.xzxz;\n  vec4 iy = Pi.yyww;\n  vec4 fx = Pf.xzxz;\n  vec4 fy = Pf.yyww;\n\n  vec4 i = permute(permute(ix) + iy);\n\n  vec4 gx = fract(i * (1.0 / 41.0)) * 2.0 - 1.0 ;\n  vec4 gy = abs(gx) - 0.5 ;\n  vec4 tx = floor(gx + 0.5);\n  gx = gx - tx;\n\n  vec2 g00 = vec2(gx.x,gy.x);\n  vec2 g10 = vec2(gx.y,gy.y);\n  vec2 g01 = vec2(gx.z,gy.z);\n  vec2 g11 = vec2(gx.w,gy.w);\n\n  vec4 norm = taylorInvSqrt(vec4(dot(g00, g00), dot(g01, g01), dot(g10, g10), dot(g11, g11)));\n  g00 *= norm.x;\n  g01 *= norm.y;\n  g10 *= norm.z;\n  g11 *= norm.w;\n\n  float n00 = dot(g00, vec2(fx.x, fy.x));\n  float n10 = dot(g10, vec2(fx.y, fy.y));\n  float n01 = dot(g01, vec2(fx.z, fy.z));\n  float n11 = dot(g11, vec2(fx.w, fy.w));\n\n  vec2 fade_xy = fade(Pf.xy);\n  vec2 n_x = mix(vec2(n00, n01), vec2(n10, n11), fade_xy.x);\n  float n_xy = mix(n_x.x, n_x.y, fade_xy.y);\n  return 2.3 * n_xy;\n}\n\nuniform float uTime;\nuniform float uPattern;\n\nvarying vec2 vUv;\n\nfloat random(vec2 st) {\n    return fract(sin(dot(st.xy, vec2(12.9898, 78.233))) * 43758.5453123);\n}\n\nfloat getStar(float size, vec2 offset) {\n    return size / distance(vUv, vec2(0.5) + offset) * max(0.5, sin(uTime * size * 100.0));\n}\n\nvoid main() {\n\n    float strength = .05;\n    vec3  color = vec3(0.0);\n\n    // Checkboard pattern\n    if (uPattern == 0.0) {\n        vec2 gridUv = vec2(\n            floor(vUv.x * 10.0) / 10.0,\n            floor(vUv.y * 10.0) / 10.0\n        );\n        color = vec3(random(gridUv));\n    }\n    \n    // Stars\n    if (uPattern == 0.1) {\n        \n        float point01 = getStar(0.008, vec2(0.01, 0.05));\n        color += point01;\n\n        float point02 = getStar(0.002, vec2(-0.08, 0.0));\n        color += point02;\n\n        float point03 = getStar(0.005, vec2(0.30, 0.25));\n        color += point03;\n\n        float point04 = getStar(0.003, vec2(-0.44, 0.32));\n        color += point04;    \n        \n        float point05 = getStar(0.002, vec2(0.20, -0.12));\n        color += point05;    \n        \n        float point06 = getStar(0.004, vec2(-0.41, -0.22));\n        color += point06;\n\n        float point07 = getStar(0.004, vec2(-0.11, -0.39));\n        color += point07;\n    }\n\n    // Noise color\n    if (uPattern == 0.2) {\n        strength = step(0.9, sin(cnoise(vUv * 4.0) * 20.0));\n        strength = clamp(strength, 0.0, 1.0);\n\n        color = vec3(vUv, 1.0) * strength;\n    }\n    \n\n    gl_FragColor = vec4(color, 1.0);\n}\n',wireframe:!1,side:Rt}),this.mesh=new qi(this.geometry,this.material),this.options.scene.add(this.mesh)}debug(){return this.debugFolder=this.options.debug.addFolder({title:this.title,expanded:!1}),this.debugFolder.addButton({title:"Load"}).on("click",t=>this.load()),this.debugFolder.addButton({title:"Unload"}).on("click",t=>this.unload()),this.debugFolder.addSeparator(),this.debugFolder.addInput(this.config,"pattern",{options:{checkboard:0,stars:.1,noise:.2}}).on("change",t=>this.material.uniforms.uPattern.value=this.config.pattern)}onUpdate(t){if(this.mesh)return this.mesh.material.uniforms.uTime.value+=.01}},cv=class extends Mc{constructor(t){super(),this.options=t,this.title="9. Raging sea",this.config={default:{smallWaves:{speed:.978,elevation:.087,frequency:7.5,iterations:4},bigWaves:{speed:1.304,elevation:.098,frequency:{x:2.609,y:3.587},color:{offset:.076,multiplier:2.5,surface:"#84f8b1",depth:"#04216c"}}},blue:{smallWaves:{speed:.978,elevation:.087,frequency:7.5,iterations:4},bigWaves:{speed:1.304,elevation:.098,frequency:{x:2.609,y:3.587},color:{offset:.076,multiplier:2.5,surface:"#84f8b1",depth:"#04216c"}}},lava:{smallWaves:{speed:.435,elevation:.261,frequency:1.63,iterations:2},bigWaves:{speed:.163,elevation:.163,frequency:{x:2.609,y:3.587},color:{offset:.174,multiplier:2.935,surface:"#e8ce37",depth:"#a53511"}}},greenSlug:{smallWaves:{speed:1.467,elevation:.065,frequency:8.804,iterations:1},bigWaves:{speed:1.304,elevation:.043,frequency:{x:7.717,y:4.457},color:{offset:.12,multiplier:3.696,surface:"#0fe864",depth:"#425c5c"}}},movingSand:{smallWaves:{speed:.543,elevation:.054,frequency:5.978,iterations:2},bigWaves:{speed:1.359,elevation:.022,frequency:{x:3.37,y:5.217},color:{offset:0,multiplier:8.587,surface:"#f4ff3c",depth:"#b87713"}}}},this.options.debug&&this.debug()}init(){return this.updateCameraPosition({x:1.6,y:1.3,z:1.6}),this.geometry=new pr(2,2,128,128),this.material=new Qi({uniforms:{uTime:{value:0},uSmallWavesSpeed:{value:this.config.default.smallWaves.speed},uSmallWavesElevation:{value:this.config.default.smallWaves.elevation},uSmallWavesFrequency:{value:this.config.default.smallWaves.frequency},uSmallWavesIterations:{value:this.config.default.smallWaves.iterations},uBigWavesElevation:{value:this.config.default.bigWaves.elevation},uBigWavesFrequency:{value:new Ie(this.config.default.bigWaves.frequency.x,this.config.default.bigWaves.frequency.y)},uBigWavesSpeed:{value:this.config.default.bigWaves.speed},uBigWavesColorOffset:{value:this.config.default.bigWaves.color.offset},uBigWavesColorMultiplier:{value:this.config.default.bigWaves.color.multiplier},uBigWavesColorSurface:{value:new di(this.config.default.bigWaves.color.surface)},uBigWavesColorDepth:{value:new di(this.config.default.bigWaves.color.depth)}},vertexShader:'#define GLSLIFY 1\n//\n// GLSL textureless classic 3D noise "cnoise",\n// with an RSL-style periodic variant "pnoise".\n// Author:  Stefan Gustavson (stefan.gustavson@liu.se)\n// Version: 2011-10-11\n//\n// Many thanks to Ian McEwan of Ashima Arts for the\n// ideas for permutation and gradient selection.\n//\n// Copyright (c) 2011 Stefan Gustavson. All rights reserved.\n// Distributed under the MIT license. See LICENSE file.\n// https://github.com/ashima/webgl-noise\n//\n\nvec3 mod289(vec3 x)\n{\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec4 mod289(vec4 x)\n{\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec4 permute(vec4 x)\n{\n  return mod289(((x*34.0)+1.0)*x);\n}\n\nvec4 taylorInvSqrt(vec4 r)\n{\n  return 1.79284291400159 - 0.85373472095314 * r;\n}\n\nvec3 fade(vec3 t) {\n  return t*t*t*(t*(t*6.0-15.0)+10.0);\n}\n\n// Classic Perlin noise\nfloat cnoise(vec3 P)\n{\n  vec3 Pi0 = floor(P); // Integer part for indexing\n  vec3 Pi1 = Pi0 + vec3(1.0); // Integer part + 1\n  Pi0 = mod289(Pi0);\n  Pi1 = mod289(Pi1);\n  vec3 Pf0 = fract(P); // Fractional part for interpolation\n  vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0\n  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n  vec4 iy = vec4(Pi0.yy, Pi1.yy);\n  vec4 iz0 = Pi0.zzzz;\n  vec4 iz1 = Pi1.zzzz;\n\n  vec4 ixy = permute(permute(ix) + iy);\n  vec4 ixy0 = permute(ixy + iz0);\n  vec4 ixy1 = permute(ixy + iz1);\n\n  vec4 gx0 = ixy0 * (1.0 / 7.0);\n  vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;\n  gx0 = fract(gx0);\n  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);\n  vec4 sz0 = step(gz0, vec4(0.0));\n  gx0 -= sz0 * (step(0.0, gx0) - 0.5);\n  gy0 -= sz0 * (step(0.0, gy0) - 0.5);\n\n  vec4 gx1 = ixy1 * (1.0 / 7.0);\n  vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;\n  gx1 = fract(gx1);\n  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);\n  vec4 sz1 = step(gz1, vec4(0.0));\n  gx1 -= sz1 * (step(0.0, gx1) - 0.5);\n  gy1 -= sz1 * (step(0.0, gy1) - 0.5);\n\n  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);\n  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);\n  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);\n  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);\n  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);\n  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);\n  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);\n  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);\n\n  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));\n  g000 *= norm0.x;\n  g010 *= norm0.y;\n  g100 *= norm0.z;\n  g110 *= norm0.w;\n  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));\n  g001 *= norm1.x;\n  g011 *= norm1.y;\n  g101 *= norm1.z;\n  g111 *= norm1.w;\n\n  float n000 = dot(g000, Pf0);\n  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));\n  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));\n  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));\n  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));\n  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));\n  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));\n  float n111 = dot(g111, Pf1);\n\n  vec3 fade_xyz = fade(Pf0);\n  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);\n  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);\n  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x);\n  return 2.2 * n_xyz;\n}\n\nuniform float uTime;\n\nuniform float uSmallWavesSpeed;\nuniform float uSmallWavesElevation;\nuniform float uSmallWavesFrequency;\nuniform float uSmallWavesIterations;\n\nuniform float uBigWavesSpeed;\nuniform float uBigWavesElevation;\nuniform vec2  uBigWavesFrequency;\n\nvarying float vElevation;\nvarying vec2 vUv;\n\nvoid main() {\n\n    vec4 modelPosition = modelMatrix * vec4(position, 1.0);\n\n    // Elevation\n    float elevation = sin(modelPosition.x * uBigWavesFrequency.x + uTime * uBigWavesSpeed) *\n                      sin(modelPosition.z * uBigWavesFrequency.y + uTime * uBigWavesSpeed) *\n                      uBigWavesElevation;\n\n    // Add the small waves\n    for (float i = 1.0; i <= uSmallWavesIterations; i++) {\n        elevation -= abs(\n            cnoise(\n                vec3(\n                    modelPosition.xz * uSmallWavesFrequency * i,\n                    uTime * uSmallWavesSpeed\n                )\n            ) * uSmallWavesElevation / i\n        );\n    }\n\n    modelPosition.y += elevation;\n\n    vec4 viewPosition = viewMatrix * modelPosition;\n    vec4 projectedPosition = projectionMatrix * viewPosition;\n    gl_Position = projectedPosition;\n\n    vUv = uv;\n    vElevation = elevation;\n}',fragmentShader:"#define GLSLIFY 1\nuniform float uBigWavesColorOffset;\nuniform float uBigWavesColorMultiplier;\nuniform vec3  uBigWavesColorSurface;\nuniform vec3  uBigWavesColorDepth;\n\nvarying float vElevation;\nvarying vec2  vUv;\n\nvoid main() {\n\n    float mixStrengh = (vElevation + uBigWavesColorOffset) * uBigWavesColorMultiplier;\n    vec3 color = mix(uBigWavesColorDepth, uBigWavesColorSurface, mixStrengh);\n\n    gl_FragColor = vec4(color, 1.0);\n}\n",wireframe:!1,side:Rt}),this.mesh=new qi(this.geometry,this.material),this.mesh.rotation.x=.5*-Math.PI,this.options.scene.add(this.mesh)}debug(){var t;return this.debugFolder=this.options.debug.addFolder({title:this.title,expanded:!1}),this.debugFolder.addButton({title:"Load"}).on("click",t=>this.load()),this.debugFolder.addButton({title:"Unload"}).on("click",t=>this.unload()),this.debugFolder.addSeparator(),(t=this.debugFolder.addFolder({title:"Small waves",expanded:!1})).addInput(this.config.default.smallWaves,"speed",{min:0,max:5,step:.001,label:"speed"}).on("change",t=>{if(this.material)return this.material.uniforms.uSmallWavesSpeed.value=this.config.default.smallWaves.speed}),t.addInput(this.config.default.smallWaves,"elevation",{min:0,max:1,step:.001,label:"elevation"}).on("change",t=>{if(this.material)return this.material.uniforms.uSmallWavesElevation.value=this.config.default.smallWaves.elevation}),t.addInput(this.config.default.smallWaves,"frequency",{min:0,max:10,step:.001,label:"frequency"}).on("change",t=>{if(this.material)return this.material.uniforms.uSmallWavesFrequency.value=this.config.default.smallWaves.frequency}),t.addInput(this.config.default.smallWaves,"iterations",{min:1,max:5,step:1,label:"iterations"}).on("change",t=>{if(this.material)return this.material.uniforms.uSmallWavesIterations.value=this.config.default.smallWaves.iterations}),(t=this.debugFolder.addFolder({title:"Big waves",expanded:!1})).addInput(this.config.default.bigWaves,"speed",{min:0,max:5,step:.001,label:"speed"}).on("change",t=>{if(this.material)return this.material.uniforms.uBigWavesSpeed.value=this.config.default.bigWaves.speed}),t.addInput(this.config.default.bigWaves,"elevation",{min:0,max:1,step:.001,label:"elevation"}).on("change",t=>{if(this.material)return this.material.uniforms.uBigWavesElevation.value=this.config.default.bigWaves.elevation}),t.addInput(this.config.default.bigWaves.frequency,"x",{min:0,max:10,step:.001,label:"frequencyX"}).on("change",t=>{if(this.material)return this.material.uniforms.uBigWavesFrequency.value.x=this.config.default.bigWaves.frequency.x}),t.addInput(this.config.default.bigWaves.frequency,"y",{min:0,max:10,step:.001,label:"frequencyY"}).on("change",t=>{if(this.material)return this.material.uniforms.uBigWavesFrequency.value.y=this.config.default.bigWaves.frequency.y}),t.addInput(this.config.default.bigWaves.color,"offset",{min:0,max:1,step:.001,label:"colorOffset"}).on("change",t=>{if(this.material)return this.material.uniforms.uBigWavesColorOffset.value=this.config.default.bigWaves.color.offset}),t.addInput(this.config.default.bigWaves.color,"multiplier",{min:0,max:10,step:.001,label:"colorMultiplier"}).on("change",t=>{if(this.material)return this.material.uniforms.uBigWavesColorMultiplier.value=this.config.default.bigWaves.color.multiplier}),t.addInput(this.config.default.bigWaves.color,"surface",{label:"colorSurface"}).on("change",t=>{if(this.material)return this.material.uniforms.uBigWavesColorSurface.value=new di(this.config.default.bigWaves.color.surface)}),t.addInput(this.config.default.bigWaves.color,"depth",{label:"colorDepth"}).on("change",t=>{if(this.material)return this.material.uniforms.uBigWavesColorDepth.value=new di(this.config.default.bigWaves.color.depth)}),(t=this.debugFolder.addFolder({title:"Examples",expanded:!1})).addButton({title:"Default"}).on("click",()=>{if(this.material)return this.changeParams(this.config.blue)}),t.addButton({title:"Lava"}).on("click",()=>{if(this.material)return this.changeParams(this.config.lava)}),t.addButton({title:"Green slug"}).on("click",()=>{if(this.material)return this.changeParams(this.config.greenSlug)}),t.addButton({title:"Moving sand"}).on("click",()=>{if(this.material)return this.changeParams(this.config.movingSand)})}changeParams(t){return this.material.uniforms.uSmallWavesSpeed.value=t.smallWaves.speed,this.material.uniforms.uSmallWavesElevation.value=t.smallWaves.elevation,this.material.uniforms.uSmallWavesFrequency.value=t.smallWaves.frequency,this.material.uniforms.uSmallWavesIterations.value=t.smallWaves.iterations,this.material.uniforms.uBigWavesSpeed.value=t.bigWaves.speed,this.material.uniforms.uBigWavesElevation.value=t.bigWaves.elevation,this.material.uniforms.uBigWavesFrequency.value.x=t.bigWaves.frequency.x,this.material.uniforms.uBigWavesFrequency.value.y=t.bigWaves.frequency.y,this.material.uniforms.uBigWavesColorOffset.value=t.bigWaves.color.offset,this.material.uniforms.uBigWavesColorMultiplier.value=t.bigWaves.color.multiplier,this.material.uniforms.uBigWavesColorSurface.value=new di(t.bigWaves.color.surface),this.material.uniforms.uBigWavesColorDepth.value=new di(t.bigWaves.color.depth),this.config.default.smallWaves.speed=t.smallWaves.speed,this.config.default.smallWaves.elevation=t.smallWaves.elevation,this.config.default.smallWaves.frequency=t.smallWaves.frequency,this.config.default.smallWaves.iterations=t.smallWaves.iterations,this.config.default.bigWaves.speed=t.bigWaves.speed,this.config.default.bigWaves.elevation=t.bigWaves.elevation,this.config.default.bigWaves.frequency.x=t.bigWaves.frequency.x,this.config.default.bigWaves.frequency.y=t.bigWaves.frequency.y,this.config.default.bigWaves.color.offset=t.bigWaves.color.offset,this.config.default.bigWaves.color.multiplier=t.bigWaves.color.multiplier,this.config.default.bigWaves.color.surface=t.bigWaves.color.surface,this.config.default.bigWaves.color.depth=t.bigWaves.color.depth,this.options.debug.refresh()}onUpdate(t){if(this.mesh)return this.mesh.material.uniforms.uTime.value=t}},uv=class extends Mc{constructor(t){super(),this.options=t,this.title="10. Modified Materials",this.config={time:{value:0},deformation:{value:.26},speed:{value:1}},this.options.debug&&this.debug()}init(){var t,e;return this.updateCameraPosition({x:10,y:5,z:10}),this.mesh=new Go,this.createLights(),(t=this.options.loaders.texture.load("./scripts/tools/Scene/models/LeePerrySmith/color.jpg")).encoding=ve,e=this.options.loaders.texture.load("./scripts/tools/Scene/models/LeePerrySmith/normal.jpg"),this.material=new dh({map:t,normalMap:e}),this.material.onBeforeCompile=t=>(t.uniforms.uTime=this.config.time,t.uniforms.uDeformation=this.config.deformation,t.uniforms.uSpeed=this.config.speed,t.vertexShader=t.vertexShader.replace("#include <common>",`#include <common>

uniform float uTime;
uniform float uDeformation;
uniform float uSpeed;

mat2 get2dRotateMatrix (float _angle) {
    return mat2(
        cos(_angle),
        - sin(_angle),
        sin(_angle),
        cos(_angle)
    );
}`),t.vertexShader=t.vertexShader.replace("#include <beginnormal_vertex>",`#include <beginnormal_vertex>

float angle = (sin(position.y + uTime * uSpeed)) * uDeformation;
mat2 rotateMatrix = get2dRotateMatrix(angle);

objectNormal.xz = objectNormal.xz * rotateMatrix;`),t.vertexShader=t.vertexShader.replace("#include <begin_vertex>",`#include <begin_vertex>

transformed.xz = transformed.xz * rotateMatrix;`)),this.depthMaterial=new Bo({depthPacking:n}),this.depthMaterial.onBeforeCompile=t=>(t.uniforms.uTime=this.config.uTime,t.vertexShader=t.vertexShader.replace("#include <common>",`#include <common>

uniform float uTime;
uniform float uDeformation;
uniform float uSpeed;

mat2 get2dRotateMatrix (float _angle) {
    return mat2(
        cos(_angle),
        - sin(_angle),
        sin(_angle),
        cos(_angle)
    );
}`),t.vertexShader=t.vertexShader.replace("#include <begin_vertex>",`#include <begin_vertex>

float angle = (sin(position.y + uTime * uSpeed)) * uDeformation;
mat2 rotateMatrix = get2dRotateMatrix(angle);

transformed.xz = transformed.xz * rotateMatrix;`)),this.options.loaders.gltf.load("./scripts/tools/Scene/models/LeePerrySmith/LeePerrySmith.glb",t=>{t=t.scene.children[0];return t.position.set(0,1,0),t.rotation.y=.15*Math.PI,t.material=this.material,t.customDepthMaterial=this.depthMaterial,this.mesh.add(t),this.updateAllMaterials()}),this.options.scene.add(this.mesh)}createLights(t=0){var e=new oc("#ffffff",3);return e.castShadow=!0,e.shadow.mapSize.set(1024,1024),e.shadow.camera.far=15,e.shadow.normalBias=.05,e.position.set(0,10,10),this.mesh.add(e)}updateAllMaterials(){return this.mesh.traverse(t=>{if(t instanceof qi&&t.material instanceof dh)return t.material.envMapIntensity=this.config.envMapIntensity,t.material.needsUpdate=!0,t.castShadow=!0,t.receiveShadow=!0})}debug(){return this.debugFolder=this.options.debug.addFolder({title:this.title,expanded:!1}),this.debugFolder.addButton({title:"Load"}).on("click",t=>this.load()),this.debugFolder.addButton({title:"Unload"}).on("click",t=>this.unload()),this.debugFolder.addSeparator(),this.debugFolder.addInput(this.config.deformation,"value",{min:-1,max:1,step:.01,label:"deformation"}),this.debugFolder.addInput(this.config.speed,"value",{min:.1,max:5,step:.1,label:"speed"})}onUpdate(t){if(this.material)return this.config.time.value=t}},dv=class extends Mc{constructor(t){super(),this.options=t,this.title="11. Portal Model",this.config={bgColor:"#161616",firefliesSize:12,portalColorA:"#161616",portalColorB:"#c8e4ef"},this.options.debug&&this.debug()}init(){var e,t,n,i,r,s,o;for(this.updateCameraPosition({x:2.5,y:2,z:3}),this.options.renderer.setClearColor(this.config.bgColor),this.mesh=new Go,(t=this.options.loaders.texture.load("./scripts/tools/Scene/models/Portal/baked.jpg")).flipY=!1,t.encoding=ve,this.options.renderer.outputEncoding=ve,e=new pi({map:t}),o=new pi({color:16777189}),this.portalLightMaterial=new Qi({uniforms:{uTime:{value:0},uColorA:{value:new di(this.config.portalColorA)},uColorB:{value:new di(this.config.portalColorB)}},vertexShader:"#define GLSLIFY 1\nvarying vec2 vUv;\n\nvoid main() {\n\n    vec4 modelPosition = modelMatrix * vec4(position, 1.0);\n    vec4 viewPosition = viewMatrix * modelPosition;\n    vec4 projectedPosition = projectionMatrix * viewPosition;\n\n    gl_Position   = projectedPosition;\n\n    vUv = uv;\n}",fragmentShader:"#define GLSLIFY 1\nvarying vec2 vUv;\n\nuniform float uTime;\nuniform vec3 uColorA;\nuniform vec3 uColorB;\n\nvec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}\nvec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}\nvec3 fade(vec3 t) {return t*t*t*(t*(t*6.0-15.0)+10.0);}\n\nfloat cnoise(vec3 P){\n    vec3 Pi0 = floor(P); // Integer part for indexing\n    vec3 Pi1 = Pi0 + vec3(1.0); // Integer part + 1\n    Pi0 = mod(Pi0, 289.0);\n    Pi1 = mod(Pi1, 289.0);\n    vec3 Pf0 = fract(P); // Fractional part for interpolation\n    vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0\n    vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n    vec4 iy = vec4(Pi0.yy, Pi1.yy);\n    vec4 iz0 = Pi0.zzzz;\n    vec4 iz1 = Pi1.zzzz;\n\n    vec4 ixy = permute(permute(ix) + iy);\n    vec4 ixy0 = permute(ixy + iz0);\n    vec4 ixy1 = permute(ixy + iz1);\n\n    vec4 gx0 = ixy0 / 7.0;\n    vec4 gy0 = fract(floor(gx0) / 7.0) - 0.5;\n    gx0 = fract(gx0);\n    vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);\n    vec4 sz0 = step(gz0, vec4(0.0));\n    gx0 -= sz0 * (step(0.0, gx0) - 0.5);\n    gy0 -= sz0 * (step(0.0, gy0) - 0.5);\n\n    vec4 gx1 = ixy1 / 7.0;\n    vec4 gy1 = fract(floor(gx1) / 7.0) - 0.5;\n    gx1 = fract(gx1);\n    vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);\n    vec4 sz1 = step(gz1, vec4(0.0));\n    gx1 -= sz1 * (step(0.0, gx1) - 0.5);\n    gy1 -= sz1 * (step(0.0, gy1) - 0.5);\n\n    vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);\n    vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);\n    vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);\n    vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);\n    vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);\n    vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);\n    vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);\n    vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);\n\n    vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));\n    g000 *= norm0.x;\n    g010 *= norm0.y;\n    g100 *= norm0.z;\n    g110 *= norm0.w;\n    vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));\n    g001 *= norm1.x;\n    g011 *= norm1.y;\n    g101 *= norm1.z;\n    g111 *= norm1.w;\n\n    float n000 = dot(g000, Pf0);\n    float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));\n    float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));\n    float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));\n    float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));\n    float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));\n    float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));\n    float n111 = dot(g111, Pf1);\n\n    vec3 fade_xyz = fade(Pf0);\n    vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);\n    vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);\n    float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x);\n    return 2.2 * n_xyz;\n}\n\nvoid main() {\n\n    // Displace UVs\n    vec2 displacedUv = vUv + cnoise(vec3(vUv * 5.0, uTime * 0.1));\n\n    // Perlin noise\n    float strength = cnoise(vec3(displacedUv * 5.0, uTime * 0.2));\n\n    // Outer glow\n    float outerGlow = distance(vUv, vec2 (0.5)) * 5.0 - 1.4;\n    strength += outerGlow;\n    strength += step(-0.2, strength) * 0.8;\n\n    strength = clamp(strength, 0.0, 1.0);\n\n    vec3 color = mix(uColorA, uColorB, strength);\n\n    gl_FragColor = vec4(color, 1.0);\n}\n",wireframe:!1}),this.options.loaders.gltf.load("./scripts/tools/Scene/models/Portal/baked.glb",t=>(t.scene.traverse(t=>"Cube014"===t.name||"Cube018"===t.name||"Cube054"===t.name?t.material=o:"Circle"===t.name?t.material=this.portalLightMaterial:t.material=e),this.mesh.add(t.scene))),t=new Ci,n=new Float32Array(120),i=new Float32Array(40),r=s=0,0;s<=40;r=++s)n[3*r+0]=4*(Math.random()-.5),n[3*r+1]=1.5*Math.random(),n[3*r+2]=4*(Math.random()-.5),i[r]=Math.random();return t.setAttribute("position",new vi(n,3)),t.setAttribute("aScale",new vi(i,1)),this.firefliesMaterial=new Qi({uniforms:{uTime:{value:0},uPixelRatio:{value:Math.min(window.devicePixelRatio,2)},uSize:{value:this.config.firefliesSize}},vertexShader:"#define GLSLIFY 1\nuniform float uTime;\nuniform float uPixelRatio;\nuniform float uSize;\n\nattribute float aScale;\n\nvoid main() {\n\n    vec4 modelPosition = modelMatrix * vec4(position, 1.0);\n    modelPosition.y += sin(uTime + modelPosition.x * 100.0) * aScale * 0.2;\n\n    vec4 viewPosition = viewMatrix * modelPosition;\n    vec4 projectedPosition = projectionMatrix * viewPosition;\n\n    gl_Position   = projectedPosition;\n    gl_PointSize  = uSize * aScale * uPixelRatio;\n    gl_PointSize *= (1.0 / -viewPosition.z);\n}",fragmentShader:"#define GLSLIFY 1\nvoid main() {\n\n    float dist = distance(gl_PointCoord, vec2(0.5));\n    float strength = 0.05 / dist - 0.05 * 2.0;\n\n    gl_FragColor = vec4(1.0, 1.0, 1.0, strength);\n}\n",wireframe:!1,transparent:!0,depthWrite:!1,side:Rt,blending:K}),t=new Ja(t,this.firefliesMaterial),this.mesh.add(t),this.options.scene.add(this.mesh)}debug(){return this.debugFolder=this.options.debug.addFolder({title:this.title,expanded:!1}),this.debugFolder.addButton({title:"Load"}).on("click",t=>this.load()),this.debugFolder.addButton({title:"Unload"}).on("click",t=>this.unload()),this.debugFolder.addSeparator(),this.debugFolder.addInput(this.config,"bgColor",{label:"bgColor"}).on("change",t=>this.options.renderer.setClearColor(this.config.bgColor)),this.debugFolder.addInput(this.config,"firefliesSize",{min:0,max:100,step:1,label:"firefliesSize"}).on("change",t=>this.firefliesMaterial.uniforms.uSize.value=this.config.firefliesSize),this.debugFolder.addInput(this.config,"portalColorA",{label:"portalColorA"}).on("change",t=>this.portalLightMaterial.uniforms.uColorA.value=new di(this.config.portalColorA)),this.debugFolder.addInput(this.config,"portalColorB",{label:"portalColorB"}).on("change",t=>this.portalLightMaterial.uniforms.uColorB.value=new di(this.config.portalColorB))}onUpdate(t){if(this.portalLightMaterial&&(this.portalLightMaterial.uniforms.uTime.value=t),this.firefliesMaterial)return this.firefliesMaterial.uniforms.uTime.value=t}},pv=class{constructor(t){this.options=t,this.clock=new gc,this.scene=this.createScene(),this.camera=this.createCamera(),this.renderer=this.createRenderer(),this.debug=this.createDebug(),this.stats=this.createStats(),this.controls=this.createControls(),this.composer=this.createComposer(),this.loaders=this.createLoaders(),this.components=this.createComponents(),window.addEventListener("resize",t=>this.onResize(t)),window.addEventListener("mousemove",t=>this.onMouseMove(t)),this.onUpdate()}createScene(){return new Qo}createCamera(){var t=this.getViewport().aspectRatio,t=new tr(75,t,.1,100);return t.position.set(0,0,5),t.lookAt(new We(0,0,0)),t}createRenderer(){var t=new Zo({antialias:!0,alpha:!0});return t.setSize(this.getViewport().width,this.getViewport().height),t.setPixelRatio=Math.min(window.devicePixelRatio,2),t.setClearColor("#000000"),this.options.container.appendChild(t.domElement),t.domElement.style.position="fixed",t.domElement.style.top="0px",t.domElement.style.left="0px",t}createComponents(){var t={debug:this.debug,loaders:this.loaders,scene:this.scene,camera:this.camera,renderer:this.renderer};return{axesHelper:new $f(t),font:new tv(t),shadows:new ev(t),particles:new nv(t),galaxy:new iv(t),raycaster:new rv(t),physics:new ov(t),importedModels:new av(t),shaders:new lv(t),shadersPatterns:new hv(t),ragingSea:new cv(t),modifiedMaterials:new uv(t),portalModel:new dv(t)}}createControls(){var t;return!!this.options.controls&&((t=new Uc(this.camera,this.renderer.domElement)).noZoom=!1,t)}createDebug(){var t,e;return!!this.options.debug&&((e=new Iu.Pane({title:"CONTROLS",expanded:!0})).addSeparator(),(t=e.addFolder({title:"Camera",expanded:!1})).addInput(this.camera.position,"x",{min:-30,max:30,step:.01}),t.addInput(this.camera.position,"y",{min:-30,max:30,step:.01}),t.addInput(this.camera.position,"z",{min:-30,max:30,step:.01}),e)}createStats(){var t;return!!this.options.stats&&(t=new Ru,this.options.container.appendChild(t.dom),t)}createComposer(){return!!this.options.composer&&composer}createLoaders(){var t,e={};return e.texture=new Hh,e.font=new vc,(new Lu).setDecoderPath("./scripts/tools/Scene/draco/"),t=new Hc,e.gltf=t,e}getViewport(){var t=window.innerWidth,e=window.innerHeight;return{width:t,height:e,aspectRatio:t/e}}onScroll(t){var e,n,i=this.components,r=[];for(n in i)e=i[n],r.push(e._onScroll(t));return r}onResize(t){var e,n=this.components;for(e in n)n[e]._onResize(t);return this.camera.aspect=this.getViewport().aspectRatio,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.getViewport().width,this.getViewport().height)}onMouseMove(t){var e,n,i=this.components,r=[];for(n in i)e=i[n],r.push(e._onMouseMove(t));return r}onUpdate(){var t,e=this.clock.getElapsedTime(),n=this.components;for(t in n)n[t]._onUpdate(e);return this.controls&&this.controls.update(),this.stats&&this.stats.update(),this.composer?this.composer.render():this.renderer.render(this.scene,this.camera),requestAnimationFrame(()=>this.onUpdate())}};document.addEventListener("DOMContentLoaded",function(){return new pv({container:document.querySelector("body"),debug:!0,controls:!1,stats:!0,composer:!1})})})()})();